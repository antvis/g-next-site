/*! For license information please see built-main.12afda.worker.js.LICENSE.txt */
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=192)}([function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"h",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"f",(function(){return u})),n.d(e,"b",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"k",(function(){return f})),n.d(e,"g",(function(){return h})),n.d(e,"j",(function(){return d})),n.d(e,"i",(function(){return p}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function s(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function l(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Object.create;function f(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function p(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}Object.create},function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n(31))},function(t,e,n){"use strict";n.d(e,"h",(function(){return T})),n.d(e,"j",(function(){return b})),n.d(e,"g",(function(){return R})),n.d(e,"i",(function(){return o.postConstruct})),n.d(e,"f",(function(){return o.decorate})),n.d(e,"b",(function(){return K})),n.d(e,"c",(function(){return W})),n.d(e,"e",(function(){return Z})),n.d(e,"a",(function(){return H})),n.d(e,"d",(function(){return r}));var r,i,o=n(21);n(66);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){return e.lifecycle===r.Lifecycle.singleton?function(t){return t.inSingletonScope()}(t):function(t){return t.inTransientScope()}(t)}function h(t,e){t.whenTargetNamed(v(e))}function d(t,e){return e.bind(y(t))}function p(t,e){if(e.isBound(y(t)))try{return e.rebind(y(t))}catch(n){return e.bind(y(t))}return e.bind(y(t))}function v(t){return i.isDefinedToken(t)?t.symbol:t}function y(t){return i.isDefinedToken(t)?t.symbol:t}!function(t){t.defineToken=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{multiple:!0};return new t.DefinedToken(e,n)};var e,n=u((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,t),this.prototype={},this.name=void 0,this.multiple=void 0,this.symbol=void 0;var r=n.multiple,i=void 0!==r&&r;this.name=e,this.symbol=Symbol(this.name),this.multiple=i}));t.DefinedToken=n,t.isModule=function(t){return!!t&&"object"===a(t)&&"id"in t},function(t){t.singleton="singleton",t.transient="transient"}(e=t.Lifecycle||(t.Lifecycle={})),t.ClassOptionSymbol=Symbol("SyringeClassOptionSymbol"),t.DefaultOption={lifecycle:e.transient}}(r||(r={})),function(t){t.toArray=function(t){return Array.isArray(t)?t:void 0===t?[]:[t]},t.isClass=function(t){return!(!t||"function"!=typeof t||!("prototype"in t))},t.isDefinedToken=function(t){return!!(t&&"object"===a(t)&&"symbol"in t&&"multiple"in t)},t.isInjectOption=function(t){return!(!t||"object"!==a(t)||!("token"in t))},t.isNamedToken=function(t){return!!(t&&"object"===a(t)&&"token"in t&&"named"in t)},t.isMultipleEnabled=function(e){return t.isDefinedToken(e)&&e.multiple}}(i||(i={}));var g=new o.Container;function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){E(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(o.injectable)();return function(n){Reflect.defineMetadata(r.ClassOptionSymbol,_(_({},t),{},{target:n}),n),e(n)}}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T(_(_({},t),{},{lifecycle:r.Lifecycle.singleton}))}function R(t){return Object(o.inject)(y(t))}var A=Symbol("SyringeOptionSymbol");function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){M(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function M(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var x=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.token=void 0,this.rawToken=void 0,this.named=void 0,this.generalToken=void 0,this.option=void 0,this.register=void 0,this.mutiple=void 0,this.register=e,this.token=n,this.option=r,this.rawToken=i.isNamedToken(n)?n.token:n,this.named=i.isNamedToken(n)?n.named:void 0,this.mutiple=!!this.named||i.isMultipleEnabled(this.rawToken),this.generalToken=this.rawToken}var e,n,o;return e=t,o=[{key:"resolveTarget",value:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{try{var a=Reflect.getMetadata(A,n);a&&t.resolveOption(e,a)}catch(l){}if(i.isClass(n))if(o.useClass){var s=i.toArray(o.useClass);s.unshift(n),o.useClass=s}else o.useClass=[n];var u;try{u=Reflect.getMetadata(r.ClassOptionSymbol,n)}catch(l){}if((u=O(O({},u||{}),o)).token){var c=i.toArray(u.token);c.unshift(n),u.token=c}else u.token=[n];t.resolveOption(e,u)}catch(l){}}},{key:"resolveOption",value:function(e,n){var o,a,s,u,c,l,f,h,d=(o=O(O({},t.globalConfig),n),a=i.toArray(o.token),s=i.toArray(o.useClass),u=i.toArray(o.useDynamic),c=i.toArray(o.useFactory),l=i.toArray(o.contrib),f=o.lifecycle||r.Lifecycle.transient,h={token:a,useClass:s,lifecycle:l.length>0?r.Lifecycle.singleton:f,contrib:l,useDynamic:u,useFactory:c},"useValue"in o&&(h.useValue=o.useValue),h);(0!==d.useClass.length||0!==d.useDynamic.length||0!==d.useFactory.length||"useValue"in d)&&d.token.forEach((function(n){new t(e,n,O({},d)).resolve()}))}}],(n=[{key:"resolve",value:function(){var t,e=this,n=this.register;(t=n)&&"object"===l(t)&&"bind"in t&&"unbind"in t&&"rebind"in t&&"isBound"in t&&(this.mutiple?this.resolveMutilple(n):(this.resolveMono(n),!this.named&&this.option.contrib.length>0&&this.option.contrib.forEach((function(t){i.isMultipleEnabled(t)?d(t,n).toService(e.generalToken):p(t,n).toService(e.generalToken)}))))}},{key:"resolveMono",value:function(t){if("useValue"in this.option)return p(this.generalToken,t).toConstantValue(this.option.useValue);if(this.option.useDynamic.length>0){var e=this.option.useDynamic[this.option.useDynamic.length-1];return f(p(this.generalToken,t).toDynamicValue((function(t){var n=q.getContainer(t.container);return e({container:n})})),this.option)}if(this.option.useFactory.length>0){var n=this.option.useFactory[this.option.useFactory.length-1];return p(this.generalToken,t).toFactory((function(t){var e=q.getContainer(t.container);return n({container:e})}))}if(this.option.useClass.length>0){var r=this.option.useClass[this.option.useClass.length-1];return f(p(this.generalToken,t).to(r),this.option)}}},{key:"resolveMutilple",value:function(t){var e=this,n=this.option.useClass.map((function(n){return f(d(e.generalToken,t).to(n),e.option)})),r=this.option.useDynamic.map((function(n){return f(d(e.generalToken,t).toDynamicValue((function(t){var e=q.getContainer(t.container);return n({container:e})})),e.option)})),i=this.option.useFactory.map((function(n){return d(e.generalToken,t).toFactory((function(t){var e=q.getContainer(t.container);return n({container:e})}))})),o="useValue"in this.option?d(this.generalToken,t).toConstantValue(this.option.useValue):void 0;this.named&&(n.forEach((function(t){return e.named&&h(t,e.named)})),r.forEach((function(t){return e.named&&h(t,e.named)})),i.forEach((function(t){return e.named&&h(t,e.named)})),o&&h(o,this.named))}}])&&C(e.prototype,n),o&&C(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();x.globalConfig=r.DefaultOption;var N=r.defineToken("ContributionProvider");function P(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var L=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.option={recursive:!1,cache:!0},this.services=void 0,this.serviceIdentifier=void 0,this.container=void 0,this.container=n,this.serviceIdentifier=e,r&&(this.option=D(D({},this.option),r))}var e,n,r;return e=t,(n=[{key:"setServices",value:function(t){for(var e=[],n=this.container;n;){if(n.isBound(this.serviceIdentifier)){var r=n.getAll(this.serviceIdentifier);e.push.apply(e,P(r))}n=t?n.parent:void 0}return e}},{key:"getContributions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=D(D({},this.option),t),n=e.cache,r=e.recursive;return n&&void 0!==this.services||(this.services=this.setServices(!!r)),this.services}}])&&F(e.prototype,n),r&&F(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function k(t,e){return{token:{token:N,named:t},useDynamic:function(n){return new L(t,n.container,e)},lifecycle:r.Lifecycle.singleton}}function U(t,e,n){t({token:{token:N,named:e},useDynamic:function(t){return new L(e,t.container,n)},lifecycle:r.Lifecycle.singleton})}function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var j=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=void 0,this.inversifyModule=void 0,this.baseRegistry=void 0,this.optionCollection=void 0,this.inversifyRegister=function(t,e,r,o){var a={bind:t,unbind:e,isBound:r,rebind:o},s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.isInjectOption(t)?x.resolveOption(a,t):x.resolveTarget(a,t,e)};n.baseRegistry&&n.baseRegistry(s),n.optionCollection&&n.optionCollection.forEach((function(t){return s(t)}))},this.baseRegistry=e,this.inversifyModule=new o.ContainerModule(this.inversifyRegister),this.id=this.inversifyModule.id}var e,n,r;return e=t,(n=[{key:"options",get:function(){return this.optionCollection||(this.optionCollection=[]),this.optionCollection}},{key:"register",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach((function(e){return t.options.push(e)})),this}},{key:"contribution",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach((function(e){return t.options.push(k(e))})),this}}])&&G(e.prototype,n),r&&G(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function V(t){return t&&"inversifyModule"in t}function W(t){return new j(t)}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var H,Y,z=new Map,q=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.loadedModules=[],this.container=void 0,this.inversify=!0,this.parent=void 0,this.container=e||new o.Container,t.setContainer(this.container,this)}var e,n,r;return e=t,r=[{key:"setContainer",value:function(t,e){return z.set(t.id,e)}},{key:"getContainer",value:function(e){var n=z.get(e.id);if(!n){var r=new t(e);return t.setContainer(e,r),r}return n}},{key:"config",value:function(t){x.globalConfig=t}}],(n=[{key:"load",value:function(t,e){var n=this;return e||!this.loadedModules.includes(t.id)?(V(t)&&this.container.load(t.inversifyModule),this.loadedModules.push(t.id),{dispose:function(){n.unload(t)}}):(console.warn("Unsupported module."),{dispose:function(){}})}},{key:"unload",value:function(t){V(t)&&(this.container.unload(t.inversifyModule),this.loadedModules=this.loadedModules.filter((function(e){return e!==t.id})))}},{key:"remove",value:function(t){return this.container.unbind(y(t))}},{key:"get",value:function(t){return this.container.get(y(t))}},{key:"getNamed",value:function(t,e){return this.container.getNamed(y(t),v(e))}},{key:"getAll",value:function(t){return this.container.getAll(y(t))}},{key:"getAllNamed",value:function(t,e){return this.container.getAllNamed(y(t),v(e))}},{key:"isBound",value:function(t){return this.container.isBound(y(t))}},{key:"isBoundNamed",value:function(t,e){return this.container.isBoundNamed(y(t),v(e))}},{key:"createChild",value:function(){var e=new t(this.container.createChild());return e.parent=this,e}},{key:"register",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.isInjectOption(t)?x.resolveOption(this.container,t):x.resolveTarget(this.container,t,e)}}])&&X(e.prototype,n),r&&X(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),K=new q(g),Z=(K.register.bind(K),function(t){return function(e,n,r){var i;(i=t,Object(o.named)(v(i)))(e,n,r),R(N)(e,n,r)}});(Y=H||(H={})).Provider=N,Y.register=U},function(t,e,n){"use strict";n.d(e,"q",(function(){return y})),n.d(e,"a",(function(){return g})),n.d(e,"m",(function(){return h})),n.d(e,"n",(function(){return d})),n.d(e,"o",(function(){return _})),n.d(e,"p",(function(){return T})),n.d(e,"c",(function(){return u})),n.d(e,"d",(function(){return R})),n.d(e,"g",(function(){return a})),n.d(e,"f",(function(){return A})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return m})),n.d(e,"j",(function(){return c})),n.d(e,"k",(function(){return v})),n.d(e,"l",(function(){return S})),n.d(e,"b",(function(){return l})),n.d(e,"e",(function(){return O}));var r=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},i={}.toString,o=function(t,e){return i.call(t)==="[object "+e+"]"},a=function(t){return o(t,"Function")},s=function(t){return null==t},u=function(t){return Array.isArray?Array.isArray(t):o(t,"Array")},c=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};var l=function(t,e){if(t)if(u(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(c(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break};Object.keys;var f=function(t){return"object"==typeof t&&null!==t};n(22);var h=function(t){if(u(t))return t.reduce((function(t,e){return Math.max(t,e)}),t[0])},d=function(t){if(u(t))return t.reduce((function(t,e){return Math.min(t,e)}),t[0])},p=Array.prototype,v=(p.splice,p.indexOf,Array.prototype.splice,n(15),function(t){return o(t,"String")});function y(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];e.has(o)||(n.push(o),e.set(o,!0))}return n}Object.prototype.hasOwnProperty;var g=function(t,e,n){return t<e?e:t>n?n:t},m=function(t){return o(t,"Number")};Number.isInteger&&Number.isInteger;var _=function(t,e){return(t%e+e)%e},E=(Math.PI,parseInt,Math.PI/180),T=function(t){return E*t},b=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return l(t,(function(n,r){a(t)&&"prototype"===r||e.push(n)})),e};var R=function(t){return o(t,"Boolean")},A=function(t){return m(t)&&isFinite(t)},S=(Object.prototype,function(t){return void 0===t});Object.prototype.hasOwnProperty;var O=function t(e,n){if(e===n)return!0;if(!e||!n)return!1;if(v(e)||v(n))return!1;if(r(e)||r(n)){if(e.length!==n.length)return!1;for(var i=!0,o=0;o<e.length&&(i=t(e[o],n[o]));o++);return i}if(f(e)||f(n)){var a=Object.keys(e),s=Object.keys(n);if(a.length!==s.length)return!1;for(i=!0,o=0;o<a.length&&(i=t(e[a[o]],n[a[o]]));o++);return i}return!1};Object.prototype.hasOwnProperty;var M,C=n(0);(function(t,e){if(!a(t))throw new TypeError("Expected a function");var n=function n(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};n.cache=new Map})((function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return M||(M=document.createElement("canvas").getContext("2d")),M.font=[o,a,i,n+"px",r].join(" "),M.measureText(v(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),Object(C.j)([t],b(e)).join("")})),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},function(t,e){t.exports=function(t){return"function"==typeof t}},function(t,e,n){var r=n(52),i=Function.prototype,o=i.bind,a=i.call,s=r&&o.bind(a,a);t.exports=r?function(t){return t&&s(t)}:function(t){return t&&function(){return a.apply(t,arguments)}}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]};e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},function(t,e,n){"use strict";var r=n(1),i=n(43),o=n(68),a=n(28),s=n(118),u=n(32),c=n(9),l=r.RangeError,f=r.Int8Array,h=f&&f.prototype,d=h&&h.set,p=o.aTypedArray,v=o.exportTypedArrayMethod,y=!c((function(){var t=new Uint8ClampedArray(2);return i(d,t,{length:1,0:3},1),3!==t[1]})),g=y&&o.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var t=new f(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));v("set",(function(t){p(this);var e=s(arguments.length>1?arguments[1]:void 0,1),n=u(t);if(y)return i(d,this,n,e);var r=this.length,o=a(n),c=0;if(o+e>r)throw l("Wrong length");for(;c<o;)this[e+c]=n[c++]}),!y||g)},function(t,e,n){"use strict";var r=n(1),i=n(6),o=n(9),a=n(38),s=n(80),u=n(68),c=n(82),l=n(83),f=n(44),h=n(84),d=r.Array,p=u.aTypedArray,v=u.exportTypedArrayMethod,y=r.Uint16Array,g=y&&i(y.prototype.sort),m=!(!g||o((function(){g(new y(2),null)}))&&o((function(){g(new y(2),{})}))),_=!!g&&!o((function(){if(f)return f<74;if(c)return c<67;if(l)return!0;if(h)return h<602;var t,e,n=new y(516),r=d(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,r[t]=t-2*e+3;for(g(n,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(n[t]!==r[t])return!0}));v("sort",(function(t){return void 0!==t&&a(t),_?g(this,t):s(p(this),function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t))}),!_||m)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(4),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},function(t,e,n){"use strict";var r=n(7),i=n(8);function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s=n(95).deprecate((function(){}),"Hook.context is deprecated and will be removed"),u=function(){return this.call=this._createCall("sync"),this.call.apply(this,arguments)},c=function(){return this.callAsync=this._createCall("async"),this.callAsync.apply(this,arguments)},l=function(){return this.promise=this._createCall("promise"),this.promise.apply(this,arguments)},f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r(this,t),this._args=e,this.name=n,this.taps=[],this.interceptors=[],this._call=u,this.call=u,this._callAsync=c,this.callAsync=c,this._promise=l,this.promise=l,this._x=void 0,this.compile=this.compile,this.tap=this.tap,this.tapAsync=this.tapAsync,this.tapPromise=this.tapPromise}return i(t,[{key:"compile",value:function(t){throw new Error("Abstract: should be overridden")}},{key:"_createCall",value:function(t){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:t})}},{key:"_tap",value:function(t,e,n){if("string"==typeof e)e={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof e.name||""===e.name)throw new Error("Missing name for tap");void 0!==e.context&&s(),e=Object.assign({type:t,fn:n},e),e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tap",value:function(t,e){this._tap("sync",t,e)}},{key:"tapAsync",value:function(t,e){this._tap("async",t,e)}},{key:"tapPromise",value:function(t,e){this._tap("promise",t,e)}},{key:"_runRegisterInterceptors",value:function(t){var e,n=o(this.interceptors);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.register){var i=r.register(t);void 0!==i&&(t=i)}}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"withOptions",value:function(t){var e=this,n=function(e){return Object.assign({},t,"string"==typeof e?{name:e}:e)};return{name:this.name,tap:function(t,r){return e.tap(n(t),r)},tapAsync:function(t,r){return e.tapAsync(n(t),r)},tapPromise:function(t,r){return e.tapPromise(n(t),r)},intercept:function(t){return e.intercept(t)},isUsed:function(){return e.isUsed()},withOptions:function(t){return e.withOptions(n(t))}}}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(t){if(this._resetCompilation(),this.interceptors.push(Object.assign({},t)),t.register)for(var e=0;e<this.taps.length;e++)this.taps[e]=t.register(this.taps[e])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(t){var e;this._resetCompilation(),"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));var n=0;"number"==typeof t.stage&&(n=t.stage);for(var r=this.taps.length;r>0;){r--;var i=this.taps[r];this.taps[r+1]=i;var o=i.stage||0;if(e){if(e.has(i.name)){e.delete(i.name);continue}if(e.size>0)continue}if(!(o>n)){r++;break}}this.taps[r]=t}}]),t}();Object.setPrototypeOf(f.prototype,null),t.exports=f},function(t,e,n){"use strict";var r=n(39),i=n(6),o=n(38),a=n(32),s=n(28),u=n(157),c=n(9),l=n(80),f=n(88),h=n(82),d=n(83),p=n(44),v=n(84),y=[],g=i(y.sort),m=i(y.push),_=c((function(){y.sort(void 0)})),E=c((function(){y.sort(null)})),T=f("sort"),b=!c((function(){if(p)return p<70;if(!(h&&h>3)){if(d)return!0;if(v)return v<603;var t,e,n,r,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)y.push({k:e+r,v:n})}for(y.sort((function(t,e){return e.v-t.v})),r=0;r<y.length;r++)e=y[r].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return"DGBEFHACIJK"!==i}}));r({target:"Array",proto:!0,forced:_||!E||!T||!b},{sort:function(t){void 0!==t&&o(t);var e=a(this);if(b)return void 0===t?g(e):g(e,t);var n,r,i=[],c=s(e);for(r=0;r<c;r++)r in e&&m(i,e[r]);for(l(i,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:u(e)>u(n)?1:-1}}(t)),n=i.length,r=0;r<n;)e[r]=i[r++];for(;r<c;)delete e[r++];return e}})},function(t,e,n){var r=n(160);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var r=n(161).default,i=n(162);t.exports=function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){"use strict";var r=n(7),i=n(8);function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s=function(){function t(e){r(this,t),this.config=e,this.options=void 0,this._args=void 0}return i(t,[{key:"create",value:function(t){var e;switch(this.init(t),this.options.type){case"sync":e=new Function(this.args(),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:function(t){return"throw ".concat(t,";\n")},onResult:function(t){return"return ".concat(t,";\n")},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":e=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:function(t){return"_callback(".concat(t,");\n")},onResult:function(t){return"_callback(null, ".concat(t,");\n")},onDone:function(){return"_callback();\n"}}));break;case"promise":var n=!1,r=this.contentWithInterceptors({onError:function(t){return n=!0,"_error(".concat(t,");\n")},onResult:function(t){return"_resolve(".concat(t,");\n")},onDone:function(){return"_resolve();\n"}}),i="";i+='"use strict";\n',i+=this.header(),i+="return new Promise((function(_resolve, _reject) {\n",n&&(i+="var _sync = true;\n",i+="function _error(_err) {\n",i+="if(_sync)\n",i+="_resolve(Promise.resolve().then((function() { throw _err; })));\n",i+="else\n",i+="_reject(_err);\n",i+="};\n"),i+=r,n&&(i+="_sync = false;\n"),i+="}));\n",e=new Function(this.args(),i)}return this.deinit(),e}},{key:"setup",value:function(t,e){t._x=e.taps.map((function(t){return t.fn}))}},{key:"init",value:function(t){this.options=t,this._args=t.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"contentWithInterceptors",value:function(t){var e=this;if(this.options.interceptors.length>0){for(var n=t.onError,r=t.onResult,i=t.onDone,o="",a=0;a<this.options.interceptors.length;a++){var s=this.options.interceptors[a];s.call&&(o+="".concat(this.getInterceptor(a),".call(").concat(this.args({before:s.context?"_context":void 0}),");\n"))}return o+=this.content(Object.assign(t,{onError:n&&function(t){for(var r="",i=0;i<e.options.interceptors.length;i++){e.options.interceptors[i].error&&(r+="".concat(e.getInterceptor(i),".error(").concat(t,");\n"))}return r+=n(t)},onResult:r&&function(t){for(var n="",i=0;i<e.options.interceptors.length;i++){e.options.interceptors[i].result&&(n+="".concat(e.getInterceptor(i),".result(").concat(t,");\n"))}return n+=r(t)},onDone:i&&function(){for(var t="",n=0;n<e.options.interceptors.length;n++){e.options.interceptors[n].done&&(t+="".concat(e.getInterceptor(n),".done();\n"))}return t+=i()}}))}return this.content(t)}},{key:"header",value:function(){var t="";return this.needContext()?t+="var _context = {};\n":t+="var _context;\n",t+="var _x = this._x;\n",this.options.interceptors.length>0&&(t+="var _taps = this.taps;\n",t+="var _interceptors = this.interceptors;\n"),t}},{key:"needContext",value:function(){var t,e=o(this.options.taps);try{for(e.s();!(t=e.n()).done;){if(t.value.context)return!0}}catch(n){e.e(n)}finally{e.f()}return!1}},{key:"callTap",value:function(t,e){for(var n=e.onError,r=e.onResult,i=e.onDone,o=e.rethrowIfPossible,a="",s=!1,u=0;u<this.options.interceptors.length;u++){var c=this.options.interceptors[u];c.tap&&(s||(a+="var _tap".concat(t," = ").concat(this.getTap(t),";\n"),s=!0),a+="".concat(this.getInterceptor(u),".tap(").concat(c.context?"_context, ":"","_tap").concat(t,");\n"))}a+="var _fn".concat(t," = ").concat(this.getTapFn(t),";\n");var l=this.options.taps[t];switch(l.type){case"sync":o||(a+="var _hasError".concat(t," = false;\n"),a+="try {\n"),a+=r?"var _result".concat(t," = _fn").concat(t,"(").concat(this.args({before:l.context?"_context":void 0}),");\n"):"_fn".concat(t,"(").concat(this.args({before:l.context?"_context":void 0}),");\n"),o||(a+="} catch(_err) {\n",a+="_hasError".concat(t," = true;\n"),a+=n("_err"),a+="}\n",a+="if(!_hasError".concat(t,") {\n")),r&&(a+=r("_result".concat(t))),i&&(a+=i()),o||(a+="}\n");break;case"async":var f="";f+=r?"(function(_err".concat(t,", _result").concat(t,") {\n"):"(function(_err".concat(t,") {\n"),f+="if(_err".concat(t,") {\n"),f+=n("_err".concat(t)),f+="} else {\n",r&&(f+=r("_result".concat(t))),i&&(f+=i()),f+="}\n",f+="})",a+="_fn".concat(t,"(").concat(this.args({before:l.context?"_context":void 0,after:f}),");\n");break;case"promise":a+="var _hasResult".concat(t," = false;\n"),a+="var _promise".concat(t," = _fn").concat(t,"(").concat(this.args({before:l.context?"_context":void 0}),");\n"),a+="if (!_promise".concat(t," || !_promise").concat(t,".then)\n"),a+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise".concat(t," + ')');\n"),a+="_promise".concat(t,".then((function(_result").concat(t,") {\n"),a+="_hasResult".concat(t," = true;\n"),r&&(a+=r("_result".concat(t))),i&&(a+=i()),a+="}), function(_err".concat(t,") {\n"),a+="if(_hasResult".concat(t,") throw _err").concat(t,";\n"),a+=n("_err".concat(t)),a+="});\n"}return a}},{key:"callTapsSeries",value:function(t){var e=this,n=t.onError,r=t.onResult,i=t.resultReturns,o=t.onDone,a=t.doneReturns,s=t.rethrowIfPossible;if(0===this.options.taps.length)return o();for(var u=this.options.taps.findIndex((function(t){return"sync"!==t.type})),c=i||a,l="",f=o,h=0,d=function(t){var i=t;f!==o&&("sync"!==e.options.taps[i].type||h++>20)&&(h=0,l+="function _next".concat(i,"() {\n"),l+=f(),l+="}\n",f=function(){return"".concat(c?"return ":"","_next").concat(i,"();\n")});var a=f,d=function(t){return t?"":o()},p=e.callTap(i,{onError:function(t){return n(i,t,a,d)},onResult:r&&function(t){return r(i,t,a,d)},onDone:!r&&a,rethrowIfPossible:s&&(u<0||i<u)});f=function(){return p}},p=this.options.taps.length-1;p>=0;p--)d(p);return l+=f()}},{key:"callTapsLooping",value:function(t){var e=t.onError,n=t.onDone,r=t.rethrowIfPossible;if(0===this.options.taps.length)return n();var i=this.options.taps.every((function(t){return"sync"===t.type})),o="";i||(o+="var _looper = (function() {\n",o+="var _loopAsync = false;\n"),o+="var _loop;\n",o+="do {\n",o+="_loop = false;\n";for(var a=0;a<this.options.interceptors.length;a++){var s=this.options.interceptors[a];s.loop&&(o+="".concat(this.getInterceptor(a),".loop(").concat(this.args({before:s.context?"_context":void 0}),");\n"))}return o+=this.callTapsSeries({onError:e,onResult:function(t,e,n,r){var o="";return o+="if(".concat(e," !== undefined) {\n"),o+="_loop = true;\n",i||(o+="if(_loopAsync) _looper();\n"),o+=r(!0),o+="} else {\n",o+=n(),o+="}\n"},onDone:n&&function(){var t="";return t+="if(!_loop) {\n",t+=n(),t+="}\n"},rethrowIfPossible:r&&i}),o+="} while(_loop);\n",i||(o+="_loopAsync = true;\n",o+="});\n",o+="_looper();\n"),o}},{key:"callTapsParallel",value:function(t){var e=this,n=t.onError,r=t.onResult,i=t.onDone,o=t.rethrowIfPossible,a=t.onTap,s=void 0===a?function(t,e){return e()}:a;if(this.options.taps.length<=1)return this.callTapsSeries({onError:n,onResult:r,onDone:i,rethrowIfPossible:o});var u="";u+="do {\n",u+="var _counter = ".concat(this.options.taps.length,";\n"),i&&(u+="var _done = (function() {\n",u+=i(),u+="});\n");for(var c=function(t){var a=function(){return i?"if(--_counter === 0) _done();\n":"--_counter;"},c=function(t){return t||!i?"_counter = 0;\n":"_counter = 0;\n_done();\n"};u+="if(_counter <= 0) break;\n",u+=s(t,(function(){return e.callTap(t,{onError:function(e){var r="";return r+="if(_counter > 0) {\n",r+=n(t,e,a,c),r+="}\n"},onResult:r&&function(e){var n="";return n+="if(_counter > 0) {\n",n+=r(t,e,a,c),n+="}\n"},onDone:!r&&function(){return a()},rethrowIfPossible:o})}),a,c)},l=0;l<this.options.taps.length;l++)c(l);return u+="} while(false);\n"}},{key:"args",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.before,n=t.after,r=this._args;return e&&(r=[e].concat(r)),n&&(r=r.concat(n)),0===r.length?"":r.join(", ")}},{key:"getTapFn",value:function(t){return"_x[".concat(t,"]")}},{key:"getTap",value:function(t){return"_taps[".concat(t,"]")}},{key:"getInterceptor",value:function(t){return"_interceptors[".concat(t,"]")}}]),t}();t.exports=s},function(t,e,n){var r=n(6),i=n(32),o=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return o(i(t),e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=e.getServiceIdentifierAsString=e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=e.decorate=e.id=e.MetadataReader=e.postConstruct=e.targetName=e.multiInject=e.unmanaged=e.optional=e.LazyServiceIdentifer=e.inject=e.named=e.tagged=e.injectable=e.ContainerModule=e.AsyncContainerModule=e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=e.Container=e.METADATA_KEY=void 0;var r=n(4);e.METADATA_KEY=r;var i=n(122);Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return i.Container}});var o=n(23);Object.defineProperty(e,"BindingScopeEnum",{enumerable:!0,get:function(){return o.BindingScopeEnum}}),Object.defineProperty(e,"BindingTypeEnum",{enumerable:!0,get:function(){return o.BindingTypeEnum}}),Object.defineProperty(e,"TargetTypeEnum",{enumerable:!0,get:function(){return o.TargetTypeEnum}});var a=n(147);Object.defineProperty(e,"AsyncContainerModule",{enumerable:!0,get:function(){return a.AsyncContainerModule}}),Object.defineProperty(e,"ContainerModule",{enumerable:!0,get:function(){return a.ContainerModule}});var s=n(148);Object.defineProperty(e,"injectable",{enumerable:!0,get:function(){return s.injectable}});var u=n(149);Object.defineProperty(e,"tagged",{enumerable:!0,get:function(){return u.tagged}});var c=n(150);Object.defineProperty(e,"named",{enumerable:!0,get:function(){return c.named}});var l=n(91);Object.defineProperty(e,"inject",{enumerable:!0,get:function(){return l.inject}}),Object.defineProperty(e,"LazyServiceIdentifer",{enumerable:!0,get:function(){return l.LazyServiceIdentifer}});var f=n(151);Object.defineProperty(e,"optional",{enumerable:!0,get:function(){return f.optional}});var h=n(152);Object.defineProperty(e,"unmanaged",{enumerable:!0,get:function(){return h.unmanaged}});var d=n(153);Object.defineProperty(e,"multiInject",{enumerable:!0,get:function(){return d.multiInject}});var p=n(154);Object.defineProperty(e,"targetName",{enumerable:!0,get:function(){return p.targetName}});var v=n(155);Object.defineProperty(e,"postConstruct",{enumerable:!0,get:function(){return v.postConstruct}});var y=n(89);Object.defineProperty(e,"MetadataReader",{enumerable:!0,get:function(){return y.MetadataReader}});var g=n(29);Object.defineProperty(e,"id",{enumerable:!0,get:function(){return g.id}});var m=n(26);Object.defineProperty(e,"decorate",{enumerable:!0,get:function(){return m.decorate}});var _=n(94);Object.defineProperty(e,"traverseAncerstors",{enumerable:!0,get:function(){return _.traverseAncerstors}}),Object.defineProperty(e,"taggedConstraint",{enumerable:!0,get:function(){return _.taggedConstraint}}),Object.defineProperty(e,"namedConstraint",{enumerable:!0,get:function(){return _.namedConstraint}}),Object.defineProperty(e,"typeConstraint",{enumerable:!0,get:function(){return _.typeConstraint}});var E=n(40);Object.defineProperty(e,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return E.getServiceIdentifierAsString}});var T=n(156);Object.defineProperty(e,"multiBindToService",{enumerable:!0,get:function(){return T.multiBindToService}})},function(t,e,n){"use strict";var r=n(39),i=n(130).left,o=n(88),a=n(44),s=n(131);r({target:"Array",proto:!0,forced:!o("reduce")||!s&&a>79&&a<83},{reduce:function(t){var e=arguments.length;return i(this,t,e,e>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0;e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(t,e,n){var r=n(39),i=Math.hypot,o=Math.abs,a=Math.sqrt;r({target:"Math",stat:!0,forced:!!i&&i(1/0,NaN)!==1/0},{hypot:function(t,e){for(var n,r,i=0,s=0,u=arguments.length,c=0;s<u;)c<(n=o(arguments[s++]))?(i=i*(r=c/n)*r+1,c=n):i+=n>0?(r=n/c)*r:n;return c===1/0?1/0:c*a(i)}})},function(t,e,n){var r=n(9);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(10),i=n(4);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var c=a[u];if(Array.isArray(c))for(var l=0,f=c;l<f.length;l++){var h=f[l];if(h.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+h.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}function s(t,e){return function(n,r){e(n,r,t)}}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([s(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},function(t,e,n){var r=n(5);t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},function(t,e,n){var r=n(117);t.exports=function(t){return r(t.length)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var r=0;e.id=function(){return r++}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(50),i=function(){function t(e){this.eventPhase=t.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new r.a,this.page=new r.a,this.canvas=new r.a,this.viewport=new r.a,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"originalEvent",{get:function(){return this.nativeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerX",{get:function(){return this.layer.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerY",{get:function(){return this.layer.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageX",{get:function(){return this.page.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageY",{get:function(){return this.page.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasX",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasY",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportX",{get:function(){return this.viewport.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportY",{get:function(){return this.viewport.y},enumerable:!1,configurable:!0}),t.prototype.composedPath=function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},Object.defineProperty(t.prototype,"propagationPath",{get:function(){return this.composedPath()},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},t.prototype.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.initEvent=function(){},t.prototype.initUIEvent=function(){},t}()},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(1),i=n(69),o=r.Object;t.exports=function(t){return o(i(t))}},function(t,e,n){var r=n(1),i=n(70),o=n(20),a=n(56),s=n(71),u=n(72),c=i("wks"),l=r.Symbol,f=l&&l.for,h=u?l:l&&l.withoutSetter||a;t.exports=function(t){if(!o(c,t)||!s&&"string"!=typeof c[t]){var e="Symbol."+t;s&&o(l,t)?c[t]=l[t]:c[t]=u&&f?f(e):h(e)}return c[t]}},function(t,e,n){var r=n(1),i=n(25),o=n(74),a=n(76),s=n(37),u=n(57),c=r.TypeError,l=Object.defineProperty,f=Object.getOwnPropertyDescriptor;e.f=i?a?function(t,e,n){if(s(t),e=u(e),s(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=f(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return l(t,e,n)}:l:function(t,e,n){if(s(t),e=u(e),s(n),o)try{return l(t,e,n)}catch(r){}if("get"in n||"set"in n)throw c("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){"use strict";n.d(e,"u",(function(){return Ni})),n.d(e,"l",(function(){return Pi})),n.d(e,"m",(function(){return Ii})),n.d(e,"d",(function(){return ki})),n.d(e,"j",(function(){return vi})),n.d(e,"n",(function(){return Mi.a})),n.d(e,"a",(function(){return Mc})),n.d(e,"e",(function(){return Fc})),n.d(e,"c",(function(){return Kc})),n.d(e,"h",(function(){return wc})),n.d(e,"b",(function(){return Gc})),n.d(e,"t",(function(){return wi})),n.d(e,"g",(function(){return to})),n.d(e,"r",(function(){return no})),n.d(e,"s",(function(){return vs})),n.d(e,"o",(function(){return Xi})),n.d(e,"k",(function(){return Li})),n.d(e,"q",(function(){return Ri})),n.d(e,"v",(function(){return Ca})),n.d(e,"A",(function(){return Da})),n.d(e,"z",(function(){return wa})),n.d(e,"p",(function(){return bs})),n.d(e,"x",(function(){return Js})),n.d(e,"y",(function(){return cc})),n.d(e,"i",(function(){return Ja})),n.d(e,"f",(function(){return $a})),n.d(e,"w",(function(){return _c}));var r={};n.r(r),n.d(r,"create",(function(){return g})),n.d(r,"fromMat4",(function(){return m})),n.d(r,"clone",(function(){return _})),n.d(r,"copy",(function(){return E})),n.d(r,"fromValues",(function(){return T})),n.d(r,"set",(function(){return b})),n.d(r,"identity",(function(){return R})),n.d(r,"transpose",(function(){return A})),n.d(r,"invert",(function(){return S})),n.d(r,"adjoint",(function(){return O})),n.d(r,"determinant",(function(){return M})),n.d(r,"multiply",(function(){return C})),n.d(r,"translate",(function(){return x})),n.d(r,"rotate",(function(){return N})),n.d(r,"scale",(function(){return P})),n.d(r,"fromTranslation",(function(){return I})),n.d(r,"fromRotation",(function(){return B})),n.d(r,"fromScaling",(function(){return D})),n.d(r,"fromMat2d",(function(){return w})),n.d(r,"fromQuat",(function(){return F})),n.d(r,"normalFromMat4",(function(){return L})),n.d(r,"projection",(function(){return k})),n.d(r,"str",(function(){return U})),n.d(r,"frob",(function(){return G})),n.d(r,"add",(function(){return j})),n.d(r,"subtract",(function(){return V})),n.d(r,"multiplyScalar",(function(){return W})),n.d(r,"multiplyScalarAndAdd",(function(){return X})),n.d(r,"exactEquals",(function(){return H})),n.d(r,"equals",(function(){return Y})),n.d(r,"mul",(function(){return z})),n.d(r,"sub",(function(){return q}));var i={};n.r(i),n.d(i,"create",(function(){return K})),n.d(i,"clone",(function(){return Z})),n.d(i,"copy",(function(){return Q})),n.d(i,"fromValues",(function(){return J})),n.d(i,"set",(function(){return $})),n.d(i,"identity",(function(){return tt})),n.d(i,"transpose",(function(){return et})),n.d(i,"invert",(function(){return nt})),n.d(i,"adjoint",(function(){return rt})),n.d(i,"determinant",(function(){return it})),n.d(i,"multiply",(function(){return ot})),n.d(i,"translate",(function(){return at})),n.d(i,"scale",(function(){return st})),n.d(i,"rotate",(function(){return ut})),n.d(i,"rotateX",(function(){return ct})),n.d(i,"rotateY",(function(){return lt})),n.d(i,"rotateZ",(function(){return ft})),n.d(i,"fromTranslation",(function(){return ht})),n.d(i,"fromScaling",(function(){return dt})),n.d(i,"fromRotation",(function(){return pt})),n.d(i,"fromXRotation",(function(){return vt})),n.d(i,"fromYRotation",(function(){return yt})),n.d(i,"fromZRotation",(function(){return gt})),n.d(i,"fromRotationTranslation",(function(){return mt})),n.d(i,"fromQuat2",(function(){return _t})),n.d(i,"getTranslation",(function(){return Et})),n.d(i,"getScaling",(function(){return Tt})),n.d(i,"getRotation",(function(){return bt})),n.d(i,"fromRotationTranslationScale",(function(){return Rt})),n.d(i,"fromRotationTranslationScaleOrigin",(function(){return At})),n.d(i,"fromQuat",(function(){return St})),n.d(i,"frustum",(function(){return Ot})),n.d(i,"perspectiveNO",(function(){return Mt})),n.d(i,"perspective",(function(){return Ct})),n.d(i,"perspectiveZO",(function(){return xt})),n.d(i,"perspectiveFromFieldOfView",(function(){return Nt})),n.d(i,"orthoNO",(function(){return Pt})),n.d(i,"ortho",(function(){return It})),n.d(i,"orthoZO",(function(){return Bt})),n.d(i,"lookAt",(function(){return Dt})),n.d(i,"targetTo",(function(){return wt})),n.d(i,"str",(function(){return Ft})),n.d(i,"frob",(function(){return Lt})),n.d(i,"add",(function(){return kt})),n.d(i,"subtract",(function(){return Ut})),n.d(i,"multiplyScalar",(function(){return Gt})),n.d(i,"multiplyScalarAndAdd",(function(){return jt})),n.d(i,"exactEquals",(function(){return Vt})),n.d(i,"equals",(function(){return Wt})),n.d(i,"mul",(function(){return Xt})),n.d(i,"sub",(function(){return Ht}));var o={};n.r(o),n.d(o,"create",(function(){return Yt})),n.d(o,"clone",(function(){return zt})),n.d(o,"length",(function(){return qt})),n.d(o,"fromValues",(function(){return Kt})),n.d(o,"copy",(function(){return Zt})),n.d(o,"set",(function(){return Qt})),n.d(o,"add",(function(){return Jt})),n.d(o,"subtract",(function(){return $t})),n.d(o,"multiply",(function(){return te})),n.d(o,"divide",(function(){return ee})),n.d(o,"ceil",(function(){return ne})),n.d(o,"floor",(function(){return re})),n.d(o,"min",(function(){return ie})),n.d(o,"max",(function(){return oe})),n.d(o,"round",(function(){return ae})),n.d(o,"scale",(function(){return se})),n.d(o,"scaleAndAdd",(function(){return ue})),n.d(o,"distance",(function(){return ce})),n.d(o,"squaredDistance",(function(){return le})),n.d(o,"squaredLength",(function(){return fe})),n.d(o,"negate",(function(){return he})),n.d(o,"inverse",(function(){return de})),n.d(o,"normalize",(function(){return pe})),n.d(o,"dot",(function(){return ve})),n.d(o,"cross",(function(){return ye})),n.d(o,"lerp",(function(){return ge})),n.d(o,"hermite",(function(){return me})),n.d(o,"bezier",(function(){return _e})),n.d(o,"random",(function(){return Ee})),n.d(o,"transformMat4",(function(){return Te})),n.d(o,"transformMat3",(function(){return be})),n.d(o,"transformQuat",(function(){return Re})),n.d(o,"rotateX",(function(){return Ae})),n.d(o,"rotateY",(function(){return Se})),n.d(o,"rotateZ",(function(){return Oe})),n.d(o,"angle",(function(){return Me})),n.d(o,"zero",(function(){return Ce})),n.d(o,"str",(function(){return xe})),n.d(o,"exactEquals",(function(){return Ne})),n.d(o,"equals",(function(){return Pe})),n.d(o,"sub",(function(){return Be})),n.d(o,"mul",(function(){return De})),n.d(o,"div",(function(){return we})),n.d(o,"dist",(function(){return Fe})),n.d(o,"sqrDist",(function(){return Le})),n.d(o,"len",(function(){return ke})),n.d(o,"sqrLen",(function(){return Ue})),n.d(o,"forEach",(function(){return Ge}));var a={};n.r(a),n.d(a,"create",(function(){return je})),n.d(a,"clone",(function(){return Ve})),n.d(a,"fromValues",(function(){return We})),n.d(a,"copy",(function(){return Xe})),n.d(a,"set",(function(){return He})),n.d(a,"add",(function(){return Ye})),n.d(a,"subtract",(function(){return ze})),n.d(a,"multiply",(function(){return qe})),n.d(a,"divide",(function(){return Ke})),n.d(a,"ceil",(function(){return Ze})),n.d(a,"floor",(function(){return Qe})),n.d(a,"min",(function(){return Je})),n.d(a,"max",(function(){return $e})),n.d(a,"round",(function(){return tn})),n.d(a,"scale",(function(){return en})),n.d(a,"scaleAndAdd",(function(){return nn})),n.d(a,"distance",(function(){return rn})),n.d(a,"squaredDistance",(function(){return on})),n.d(a,"length",(function(){return an})),n.d(a,"squaredLength",(function(){return sn})),n.d(a,"negate",(function(){return un})),n.d(a,"inverse",(function(){return cn})),n.d(a,"normalize",(function(){return ln})),n.d(a,"dot",(function(){return fn})),n.d(a,"cross",(function(){return hn})),n.d(a,"lerp",(function(){return dn})),n.d(a,"random",(function(){return pn})),n.d(a,"transformMat4",(function(){return vn})),n.d(a,"transformQuat",(function(){return yn})),n.d(a,"zero",(function(){return gn})),n.d(a,"str",(function(){return mn})),n.d(a,"exactEquals",(function(){return _n})),n.d(a,"equals",(function(){return En})),n.d(a,"sub",(function(){return Tn})),n.d(a,"mul",(function(){return bn})),n.d(a,"div",(function(){return Rn})),n.d(a,"dist",(function(){return An})),n.d(a,"sqrDist",(function(){return Sn})),n.d(a,"len",(function(){return On})),n.d(a,"sqrLen",(function(){return Mn})),n.d(a,"forEach",(function(){return Cn}));var s={};n.r(s),n.d(s,"create",(function(){return xn})),n.d(s,"identity",(function(){return Nn})),n.d(s,"setAxisAngle",(function(){return Pn})),n.d(s,"getAxisAngle",(function(){return In})),n.d(s,"getAngle",(function(){return Bn})),n.d(s,"multiply",(function(){return Dn})),n.d(s,"rotateX",(function(){return wn})),n.d(s,"rotateY",(function(){return Fn})),n.d(s,"rotateZ",(function(){return Ln})),n.d(s,"calculateW",(function(){return kn})),n.d(s,"exp",(function(){return Un})),n.d(s,"ln",(function(){return Gn})),n.d(s,"pow",(function(){return jn})),n.d(s,"slerp",(function(){return Vn})),n.d(s,"random",(function(){return Wn})),n.d(s,"invert",(function(){return Xn})),n.d(s,"conjugate",(function(){return Hn})),n.d(s,"fromMat3",(function(){return Yn})),n.d(s,"fromEuler",(function(){return zn})),n.d(s,"str",(function(){return qn})),n.d(s,"clone",(function(){return er})),n.d(s,"fromValues",(function(){return nr})),n.d(s,"copy",(function(){return rr})),n.d(s,"set",(function(){return ir})),n.d(s,"add",(function(){return or})),n.d(s,"mul",(function(){return ar})),n.d(s,"scale",(function(){return sr})),n.d(s,"dot",(function(){return ur})),n.d(s,"lerp",(function(){return cr})),n.d(s,"length",(function(){return lr})),n.d(s,"len",(function(){return fr})),n.d(s,"squaredLength",(function(){return hr})),n.d(s,"sqrLen",(function(){return dr})),n.d(s,"normalize",(function(){return pr})),n.d(s,"exactEquals",(function(){return vr})),n.d(s,"equals",(function(){return yr})),n.d(s,"rotationTo",(function(){return gr})),n.d(s,"sqlerp",(function(){return mr})),n.d(s,"setAxes",(function(){return _r}));var u={};n.r(u),n.d(u,"create",(function(){return Er})),n.d(u,"clone",(function(){return Tr})),n.d(u,"fromValues",(function(){return br})),n.d(u,"copy",(function(){return Rr})),n.d(u,"set",(function(){return Ar})),n.d(u,"add",(function(){return Sr})),n.d(u,"subtract",(function(){return Or})),n.d(u,"multiply",(function(){return Mr})),n.d(u,"divide",(function(){return Cr})),n.d(u,"ceil",(function(){return xr})),n.d(u,"floor",(function(){return Nr})),n.d(u,"min",(function(){return Pr})),n.d(u,"max",(function(){return Ir})),n.d(u,"round",(function(){return Br})),n.d(u,"scale",(function(){return Dr})),n.d(u,"scaleAndAdd",(function(){return wr})),n.d(u,"distance",(function(){return Fr})),n.d(u,"squaredDistance",(function(){return Lr})),n.d(u,"length",(function(){return kr})),n.d(u,"squaredLength",(function(){return Ur})),n.d(u,"negate",(function(){return Gr})),n.d(u,"inverse",(function(){return jr})),n.d(u,"normalize",(function(){return Vr})),n.d(u,"dot",(function(){return Wr})),n.d(u,"cross",(function(){return Xr})),n.d(u,"lerp",(function(){return Hr})),n.d(u,"random",(function(){return Yr})),n.d(u,"transformMat2",(function(){return zr})),n.d(u,"transformMat2d",(function(){return qr})),n.d(u,"transformMat3",(function(){return Kr})),n.d(u,"transformMat4",(function(){return Zr})),n.d(u,"rotate",(function(){return Qr})),n.d(u,"angle",(function(){return Jr})),n.d(u,"zero",(function(){return $r})),n.d(u,"str",(function(){return ti})),n.d(u,"exactEquals",(function(){return ei})),n.d(u,"equals",(function(){return ni})),n.d(u,"len",(function(){return ii})),n.d(u,"sub",(function(){return oi})),n.d(u,"mul",(function(){return ai})),n.d(u,"div",(function(){return si})),n.d(u,"dist",(function(){return ui})),n.d(u,"sqrDist",(function(){return ci})),n.d(u,"sqrLen",(function(){return li})),n.d(u,"forEach",(function(){return fi}));n(66);var c=n(2),l=n(41),f=n(0),h=function(){function t(){this.pool={}}return t.prototype.getByEntity=function(t){return this.pool[t]},t.prototype.add=function(t,e){this.pool[t]=e},t.prototype.remove=function(t){delete this.pool[t]},t=Object(f.c)([Object(c.j)()],t)}(),d=n(3),p=(n(11),n(12),n(24),1e-6),v="undefined"!=typeof Float32Array?Float32Array:Array,y=Math.random;Math.PI;function g(){var t=new v(9);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function m(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function _(t){var e=new v(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function E(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function T(t,e,n,r,i,o,a,s,u){var c=new v(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=a,c[7]=s,c[8]=u,c}function b(t,e,n,r,i,o,a,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t}function R(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function A(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function S(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=l*a-s*c,h=-l*o+s*u,d=c*o-a*u,p=n*f+r*h+i*d;return p?(p=1/p,t[0]=f*p,t[1]=(-l*r+i*c)*p,t[2]=(s*r-i*a)*p,t[3]=h*p,t[4]=(l*n-i*u)*p,t[5]=(-s*n+i*o)*p,t[6]=d*p,t[7]=(-c*n+r*u)*p,t[8]=(a*n-r*o)*p,t):null}function O(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8];return t[0]=a*l-s*c,t[1]=i*c-r*l,t[2]=r*s-i*a,t[3]=s*u-o*l,t[4]=n*l-i*u,t[5]=i*o-n*s,t[6]=o*c-a*u,t[7]=r*u-n*c,t[8]=n*a-r*o,t}function M(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*o-a*u)+n*(-c*i+a*s)+r*(u*i-o*s)}function C(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1],p=n[2],v=n[3],y=n[4],g=n[5],m=n[6],_=n[7],E=n[8];return t[0]=h*r+d*a+p*c,t[1]=h*i+d*s+p*l,t[2]=h*o+d*u+p*f,t[3]=v*r+y*a+g*c,t[4]=v*i+y*s+g*l,t[5]=v*o+y*u+g*f,t[6]=m*r+_*a+E*c,t[7]=m*i+_*s+E*l,t[8]=m*o+_*u+E*f,t}function x(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h*r+d*a+c,t[7]=h*i+d*s+l,t[8]=h*o+d*u+f,t}function N(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*r+h*a,t[1]=d*i+h*s,t[2]=d*o+h*u,t[3]=d*a-h*r,t[4]=d*s-h*i,t[5]=d*u-h*o,t[6]=c,t[7]=l,t[8]=f,t}function P(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function I(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function B(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function D(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function F(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,f=r*s,h=i*a,d=i*s,p=i*u,v=o*a,y=o*s,g=o*u;return t[0]=1-f-p,t[3]=l-g,t[6]=h+y,t[1]=l+g,t[4]=1-c-p,t[7]=d-v,t[2]=h-y,t[5]=d+v,t[8]=1-c-f,t}function L(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],y=e[14],g=e[15],m=n*s-r*a,_=n*u-i*a,E=n*c-o*a,T=r*u-i*s,b=r*c-o*s,R=i*c-o*u,A=l*v-f*p,S=l*y-h*p,O=l*g-d*p,M=f*y-h*v,C=f*g-d*v,x=h*g-d*y,N=m*x-_*C+E*M+T*O-b*S+R*A;return N?(N=1/N,t[0]=(s*x-u*C+c*M)*N,t[1]=(u*O-a*x-c*S)*N,t[2]=(a*C-s*O+c*A)*N,t[3]=(i*C-r*x-o*M)*N,t[4]=(n*x-i*O+o*S)*N,t[5]=(r*O-n*C-o*A)*N,t[6]=(v*R-y*b+g*T)*N,t[7]=(y*E-p*R-g*_)*N,t[8]=(p*b-v*E+g*m)*N,t):null}function k(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function U(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function G(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function j(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function V(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function W(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function X(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function H(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Y(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=e[0],h=e[1],d=e[2],v=e[3],y=e[4],g=e[5],m=e[6],_=e[7],E=e[8];return Math.abs(n-f)<=p*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-h)<=p*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=p*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-v)<=p*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-y)<=p*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-g)<=p*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-m)<=p*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-_)<=p*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-E)<=p*Math.max(1,Math.abs(l),Math.abs(E))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var z=C,q=V;function K(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Z(t){var e=new v(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Q(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function J(t,e,n,r,i,o,a,s,u,c,l,f,h,d,p,y){var g=new v(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=c,g[10]=l,g[11]=f,g[12]=h,g[13]=d,g[14]=p,g[15]=y,g}function $(t,e,n,r,i,o,a,s,u,c,l,f,h,d,p,v,y){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=l,t[10]=f,t[11]=h,t[12]=d,t[13]=p,t[14]=v,t[15]=y,t}function tt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function et(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function nt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],y=e[14],g=e[15],m=n*s-r*a,_=n*u-i*a,E=n*c-o*a,T=r*u-i*s,b=r*c-o*s,R=i*c-o*u,A=l*v-f*p,S=l*y-h*p,O=l*g-d*p,M=f*y-h*v,C=f*g-d*v,x=h*g-d*y,N=m*x-_*C+E*M+T*O-b*S+R*A;return N?(N=1/N,t[0]=(s*x-u*C+c*M)*N,t[1]=(i*C-r*x-o*M)*N,t[2]=(v*R-y*b+g*T)*N,t[3]=(h*b-f*R-d*T)*N,t[4]=(u*O-a*x-c*S)*N,t[5]=(n*x-i*O+o*S)*N,t[6]=(y*E-p*R-g*_)*N,t[7]=(l*R-h*E+d*_)*N,t[8]=(a*C-s*O+c*A)*N,t[9]=(r*O-n*C-o*A)*N,t[10]=(p*b-v*E+g*m)*N,t[11]=(f*E-l*b-d*m)*N,t[12]=(s*S-a*M-u*A)*N,t[13]=(n*M-r*S+i*A)*N,t[14]=(v*_-p*T-y*m)*N,t[15]=(l*T-f*_+h*m)*N,t):null}function rt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],y=e[14],g=e[15];return t[0]=s*(h*g-d*y)-f*(u*g-c*y)+v*(u*d-c*h),t[1]=-(r*(h*g-d*y)-f*(i*g-o*y)+v*(i*d-o*h)),t[2]=r*(u*g-c*y)-s*(i*g-o*y)+v*(i*c-o*u),t[3]=-(r*(u*d-c*h)-s*(i*d-o*h)+f*(i*c-o*u)),t[4]=-(a*(h*g-d*y)-l*(u*g-c*y)+p*(u*d-c*h)),t[5]=n*(h*g-d*y)-l*(i*g-o*y)+p*(i*d-o*h),t[6]=-(n*(u*g-c*y)-a*(i*g-o*y)+p*(i*c-o*u)),t[7]=n*(u*d-c*h)-a*(i*d-o*h)+l*(i*c-o*u),t[8]=a*(f*g-d*v)-l*(s*g-c*v)+p*(s*d-c*f),t[9]=-(n*(f*g-d*v)-l*(r*g-o*v)+p*(r*d-o*f)),t[10]=n*(s*g-c*v)-a*(r*g-o*v)+p*(r*c-o*s),t[11]=-(n*(s*d-c*f)-a*(r*d-o*f)+l*(r*c-o*s)),t[12]=-(a*(f*y-h*v)-l*(s*y-u*v)+p*(s*h-u*f)),t[13]=n*(f*y-h*v)-l*(r*y-i*v)+p*(r*h-i*f),t[14]=-(n*(s*y-u*v)-a*(r*y-i*v)+p*(r*u-i*s)),t[15]=n*(s*h-u*f)-a*(r*h-i*f)+l*(r*u-i*s),t}function it(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],d=t[12],p=t[13],v=t[14],y=t[15];return(e*a-n*o)*(f*y-h*v)-(e*s-r*o)*(l*y-h*p)+(e*u-i*o)*(l*v-f*p)+(n*s-r*a)*(c*y-h*d)-(n*u-i*a)*(c*v-f*d)+(r*u-i*s)*(c*p-l*d)}function ot(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],v=e[12],y=e[13],g=e[14],m=e[15],_=n[0],E=n[1],T=n[2],b=n[3];return t[0]=_*r+E*s+T*f+b*v,t[1]=_*i+E*u+T*h+b*y,t[2]=_*o+E*c+T*d+b*g,t[3]=_*a+E*l+T*p+b*m,_=n[4],E=n[5],T=n[6],b=n[7],t[4]=_*r+E*s+T*f+b*v,t[5]=_*i+E*u+T*h+b*y,t[6]=_*o+E*c+T*d+b*g,t[7]=_*a+E*l+T*p+b*m,_=n[8],E=n[9],T=n[10],b=n[11],t[8]=_*r+E*s+T*f+b*v,t[9]=_*i+E*u+T*h+b*y,t[10]=_*o+E*c+T*d+b*g,t[11]=_*a+E*l+T*p+b*m,_=n[12],E=n[13],T=n[14],b=n[15],t[12]=_*r+E*s+T*f+b*v,t[13]=_*i+E*u+T*h+b*y,t[14]=_*o+E*c+T*d+b*g,t[15]=_*a+E*l+T*p+b*m,t}function at(t,e,n){var r,i,o,a,s,u,c,l,f,h,d,p,v=n[0],y=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*y+e[8]*g+e[12],t[13]=e[1]*v+e[5]*y+e[9]*g+e[13],t[14]=e[2]*v+e[6]*y+e[10]*g+e[14],t[15]=e[3]*v+e[7]*y+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=d,t[11]=p,t[12]=r*v+s*y+f*g+e[12],t[13]=i*v+u*y+h*g+e[13],t[14]=o*v+c*y+d*g+e[14],t[15]=a*v+l*y+p*g+e[15]),t}function st(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ut(t,e,n,r){var i,o,a,s,u,c,l,f,h,d,v,y,g,m,_,E,T,b,R,A,S,O,M,C,x=r[0],N=r[1],P=r[2],I=Math.hypot(x,N,P);return I<p?null:(x*=I=1/I,N*=I,P*=I,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],c=e[2],l=e[3],f=e[4],h=e[5],d=e[6],v=e[7],y=e[8],g=e[9],m=e[10],_=e[11],E=x*x*a+o,T=N*x*a+P*i,b=P*x*a-N*i,R=x*N*a-P*i,A=N*N*a+o,S=P*N*a+x*i,O=x*P*a+N*i,M=N*P*a-x*i,C=P*P*a+o,t[0]=s*E+f*T+y*b,t[1]=u*E+h*T+g*b,t[2]=c*E+d*T+m*b,t[3]=l*E+v*T+_*b,t[4]=s*R+f*A+y*S,t[5]=u*R+h*A+g*S,t[6]=c*R+d*A+m*S,t[7]=l*R+v*A+_*S,t[8]=s*O+f*M+y*C,t[9]=u*O+h*M+g*C,t[10]=c*O+d*M+m*C,t[11]=l*O+v*M+_*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ct(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=s*i+f*r,t[7]=u*i+h*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=f*i-s*r,t[11]=h*i-u*r,t}function lt(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-l*r,t[2]=s*i-f*r,t[3]=u*i-h*r,t[8]=o*r+c*i,t[9]=a*r+l*i,t[10]=s*r+f*i,t[11]=u*r+h*i,t}function ft(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=s*i+f*r,t[3]=u*i+h*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=f*i-s*r,t[7]=h*i-u*r,t}function ht(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function dt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pt(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<p?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function vt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,c=o+o,l=r*s,f=r*u,h=r*c,d=i*u,p=i*c,v=o*c,y=a*s,g=a*u,m=a*c;return t[0]=1-(d+v),t[1]=f+m,t[2]=h-g,t[3]=0,t[4]=f-m,t[5]=1-(l+v),t[6]=p+y,t[7]=0,t[8]=h+g,t[9]=p-y,t[10]=1-(l+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function _t(t,e){var n=new v(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=r*r+i*i+o*o+a*a;return f>0?(n[0]=2*(s*a+l*r+u*o-c*i)/f,n[1]=2*(u*a+l*i+c*r-s*o)/f,n[2]=2*(c*a+l*o+s*i-u*r)/f):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),n[2]=2*(c*a+l*o+s*i-u*r)),mt(t,e,n),t}function Et(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Tt(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,l),t}function bt(t,e){var n=new v(3);Tt(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,c=e[4]*r,l=e[5]*i,f=e[6]*o,h=e[8]*r,d=e[9]*i,p=e[10]*o,y=a+l+p,g=0;return y>0?(g=2*Math.sqrt(y+1),t[3]=.25*g,t[0]=(f-d)/g,t[1]=(h-u)/g,t[2]=(s-c)/g):a>l&&a>p?(g=2*Math.sqrt(1+a-l-p),t[3]=(f-d)/g,t[0]=.25*g,t[1]=(s+c)/g,t[2]=(h+u)/g):l>p?(g=2*Math.sqrt(1+l-a-p),t[3]=(h-u)/g,t[0]=(s+c)/g,t[1]=.25*g,t[2]=(f+d)/g):(g=2*Math.sqrt(1+p-a-l),t[3]=(s-c)/g,t[0]=(h+u)/g,t[1]=(f+d)/g,t[2]=.25*g),t}function Rt(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,l=a+a,f=i*u,h=i*c,d=i*l,p=o*c,v=o*l,y=a*l,g=s*u,m=s*c,_=s*l,E=r[0],T=r[1],b=r[2];return t[0]=(1-(p+y))*E,t[1]=(h+_)*E,t[2]=(d-m)*E,t[3]=0,t[4]=(h-_)*T,t[5]=(1-(f+y))*T,t[6]=(v+g)*T,t[7]=0,t[8]=(d+m)*b,t[9]=(v-g)*b,t[10]=(1-(f+p))*b,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function At(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],c=o+o,l=a+a,f=s+s,h=o*c,d=o*l,p=o*f,v=a*l,y=a*f,g=s*f,m=u*c,_=u*l,E=u*f,T=r[0],b=r[1],R=r[2],A=i[0],S=i[1],O=i[2],M=(1-(v+g))*T,C=(d+E)*T,x=(p-_)*T,N=(d-E)*b,P=(1-(h+g))*b,I=(y+m)*b,B=(p+_)*R,D=(y-m)*R,w=(1-(h+v))*R;return t[0]=M,t[1]=C,t[2]=x,t[3]=0,t[4]=N,t[5]=P,t[6]=I,t[7]=0,t[8]=B,t[9]=D,t[10]=w,t[11]=0,t[12]=n[0]+A-(M*A+N*S+B*O),t[13]=n[1]+S-(C*A+P*S+D*O),t[14]=n[2]+O-(x*A+I*S+w*O),t[15]=1,t}function St(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,f=r*s,h=i*a,d=i*s,p=i*u,v=o*a,y=o*s,g=o*u;return t[0]=1-f-p,t[1]=l+g,t[2]=h-y,t[3]=0,t[4]=l-g,t[5]=1-c-p,t[6]=d+v,t[7]=0,t[8]=h+y,t[9]=d-v,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ot(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function Mt(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Ct=Mt;function xt(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function Nt(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Pt(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}var It=Pt;function Bt(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*c,t[15]=1,t}function Dt(t,e,n,r){var i,o,a,s,u,c,l,f,h,d,v=e[0],y=e[1],g=e[2],m=r[0],_=r[1],E=r[2],T=n[0],b=n[1],R=n[2];return Math.abs(v-T)<p&&Math.abs(y-b)<p&&Math.abs(g-R)<p?tt(t):(l=v-T,f=y-b,h=g-R,i=_*(h*=d=1/Math.hypot(l,f,h))-E*(f*=d),o=E*(l*=d)-m*h,a=m*f-_*l,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=f*a-h*o,u=h*i-l*a,c=l*o-f*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=h,t[11]=0,t[12]=-(i*v+o*y+a*g),t[13]=-(s*v+u*y+c*g),t[14]=-(l*v+f*y+h*g),t[15]=1,t)}function wt(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],c=r[2],l=i-n[0],f=o-n[1],h=a-n[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-c*f,v=c*l-s*h,y=s*f-u*l;return(d=p*p+v*v+y*y)>0&&(p*=d=1/Math.sqrt(d),v*=d,y*=d),t[0]=p,t[1]=v,t[2]=y,t[3]=0,t[4]=f*y-h*v,t[5]=h*p-l*y,t[6]=l*v-f*p,t[7]=0,t[8]=l,t[9]=f,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Ft(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Lt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function kt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Ut(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Gt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function jt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Vt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Wt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],v=t[12],y=t[13],g=t[14],m=t[15],_=e[0],E=e[1],T=e[2],b=e[3],R=e[4],A=e[5],S=e[6],O=e[7],M=e[8],C=e[9],x=e[10],N=e[11],P=e[12],I=e[13],B=e[14],D=e[15];return Math.abs(n-_)<=p*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(r-E)<=p*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(i-T)<=p*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(o-b)<=p*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-R)<=p*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(s-A)<=p*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-S)<=p*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-O)<=p*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(l-M)<=p*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(f-C)<=p*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-x)<=p*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(d-N)<=p*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(v-P)<=p*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(y-I)<=p*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(g-B)<=p*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(m-D)<=p*Math.max(1,Math.abs(m),Math.abs(D))}var Xt=ot,Ht=Ut;function Yt(){var t=new v(3);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zt(t){var e=new v(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function qt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Kt(t,e,n){var r=new v(3);return r[0]=t,r[1]=e,r[2]=n,r}function Zt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Qt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Jt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function $t(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function te(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ee(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ne(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function re(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function ie(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function oe(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ae(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function se(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ue(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function ce(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function le(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function fe(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function he(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function de(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function pe(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ye(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function ge(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function me(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*l,t}function _e(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,f=3*u*a,h=u*o;return t[0]=e[0]*c+n[0]*l+r[0]*f+i[0]*h,t[1]=e[1]*c+n[1]*l+r[1]*f+i[1]*h,t[2]=e[2]*c+n[2]*l+r[2]*f+i[2]*h,t}function Ee(t,e){e=e||1;var n=2*y()*Math.PI,r=2*y()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function Te(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function be(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function Re(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=i*c-o*u,f=o*s-r*c,h=r*u-i*s,d=i*h-o*f,p=o*l-r*h,v=r*f-i*l,y=2*a;return l*=y,f*=y,h*=y,d*=2,p*=2,v*=2,t[0]=s+l+d,t[1]=u+f+p,t[2]=c+h+v,t}function Ae(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Se(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Oe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Me(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&ve(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function Ce(t){return t[0]=0,t[1]=0,t[2]=0,t}function xe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Pe(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=p*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=p*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=p*Math.max(1,Math.abs(i),Math.abs(s))}var Ie,Be=$t,De=te,we=ee,Fe=ce,Le=le,ke=qt,Ue=fe,Ge=(Ie=Yt(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Ie[0]=t[a],Ie[1]=t[a+1],Ie[2]=t[a+2],i(Ie,Ie,o),t[a]=Ie[0],t[a+1]=Ie[1],t[a+2]=Ie[2];return t});function je(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ve(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function We(t,e,n,r){var i=new v(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Xe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function He(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Ye(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function ze(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function qe(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Ke(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ze(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Qe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Je(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function $e(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function tn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function en(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function nn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function rn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function on(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function an(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function sn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function un(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ln(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function fn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function hn(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=e[0],f=e[1],h=e[2],d=e[3];return t[0]=f*c-h*u+d*s,t[1]=-l*c+h*a-d*o,t[2]=l*u-f*a+d*i,t[3]=-l*s+f*o-h*i,t}function dn(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function pn(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*y()-1)*n+(r=2*y()-1)*r}while(a>=1);do{s=(i=2*y()-1)*i+(o=2*y()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t}function vn(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function yn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*o-u*i,f=c*i+u*r-a*o,h=c*o+a*i-s*r,d=-a*r-s*i-u*o;return t[0]=l*c+d*-a+f*-u-h*-s,t[1]=f*c+d*-s+h*-a-l*-u,t[2]=h*c+d*-u+l*-s-f*-a,t[3]=e[3],t}function gn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function mn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function _n(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function En(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=p*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=p*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=p*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=p*Math.max(1,Math.abs(o),Math.abs(c))}var Tn=ze,bn=qe,Rn=Ke,An=rn,Sn=on,On=an,Mn=sn,Cn=function(){var t=je();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function xn(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Nn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Pn(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function In(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>p?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Bn(t,e){var n=ur(t,e);return Math.acos(2*n*n-1)}function Dn(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+i*c-o*u,t[1]=i*l+a*u+o*s-r*c,t[2]=o*l+a*c+r*u-i*s,t[3]=a*l-r*s-i*u-o*c,t}function wn(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}function Fn(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}function Ln(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}function kn(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Un(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(a),t}function Gn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function jn(t,e,n){return Gn(t,e),sr(t,t,n),Un(t,t),t}function Vn(t,e,n,r){var i,o,a,s,u,c=e[0],l=e[1],f=e[2],h=e[3],d=n[0],v=n[1],y=n[2],g=n[3];return(o=c*d+l*v+f*y+h*g)<0&&(o=-o,d=-d,v=-v,y=-y,g=-g),1-o>p?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*c+u*d,t[1]=s*l+u*v,t[2]=s*f+u*y,t[3]=s*h+u*g,t}function Wn(t){var e=y(),n=y(),r=y(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Xn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function Hn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Yn(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function zn(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return t[0]=o*u*l-a*s*c,t[1]=a*s*l+o*u*c,t[2]=a*u*c-o*s*l,t[3]=a*u*l+o*s*c,t}function qn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Kn,Zn,Qn,Jn,$n,tr,er=Ve,nr=We,rr=Xe,ir=He,or=Ye,ar=Dn,sr=en,ur=fn,cr=dn,lr=an,fr=lr,hr=sn,dr=hr,pr=ln,vr=_n,yr=En,gr=(Kn=Yt(),Zn=Kt(1,0,0),Qn=Kt(0,1,0),function(t,e,n){var r=ve(e,n);return r<-.999999?(ye(Kn,Zn,e),ke(Kn)<1e-6&&ye(Kn,Qn,e),pe(Kn,Kn),Pn(t,Kn,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ye(Kn,e,n),t[0]=Kn[0],t[1]=Kn[1],t[2]=Kn[2],t[3]=1+r,pr(t,t))}),mr=(Jn=xn(),$n=xn(),function(t,e,n,r,i,o){return Vn(Jn,e,i,o),Vn($n,n,r,o),Vn(t,Jn,$n,2*o*(1-o)),t}),_r=(tr=g(),function(t,e,n,r){return tr[0]=n[0],tr[3]=n[1],tr[6]=n[2],tr[1]=r[0],tr[4]=r[1],tr[7]=r[2],tr[2]=-e[0],tr[5]=-e[1],tr[8]=-e[2],pr(t,Yn(t,tr))});function Er(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function Tr(t){var e=new v(2);return e[0]=t[0],e[1]=t[1],e}function br(t,e){var n=new v(2);return n[0]=t,n[1]=e,n}function Rr(t,e){return t[0]=e[0],t[1]=e[1],t}function Ar(t,e,n){return t[0]=e,t[1]=n,t}function Sr(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Or(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Mr(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Cr(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function xr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Nr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Pr(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Ir(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function Br(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Dr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function wr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function Fr(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Lr(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function kr(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Ur(t){var e=t[0],n=t[1];return e*e+n*n}function Gr(t,e){return t[0]=-e[0],t[1]=-e[1],t}function jr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Vr(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Wr(t,e){return t[0]*e[0]+t[1]*e[1]}function Xr(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Hr(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function Yr(t,e){e=e||1;var n=2*y()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function zr(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function qr(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function Kr(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Zr(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function Qr(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t}function Jr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function $r(t){return t[0]=0,t[1]=0,t}function ti(t){return"vec2("+t[0]+", "+t[1]+")"}function ei(t,e){return t[0]===e[0]&&t[1]===e[1]}function ni(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=p*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=p*Math.max(1,Math.abs(r),Math.abs(o))}var ri,ii=kr,oi=Or,ai=Mr,si=Cr,ui=Fr,ci=Lr,li=Ur,fi=function(){var t=Er();return function(e,n,r,i,o,a){var s,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),hi=function(){function t(t,e){this.min=o.create(),this.max=o.create(),this.update(t,e)}return t.isEmpty=function(t){return!t||0===t.halfExtents[0]&&0===t.halfExtents[1]&&0===t.halfExtents[2]},t.prototype.update=function(t,e){this.center=o.copy(o.create(),t||o.create()),this.halfExtents=o.copy(o.create(),e||o.fromValues(0,0,0)),this.min=o.sub(this.min,this.center,this.halfExtents),this.max=o.add(this.max,this.center,this.halfExtents)},t.prototype.setMinMax=function(t,e){o.add(this.center,e,t),o.scale(this.center,this.center,.5),o.sub(this.halfExtents,e,t),o.scale(this.halfExtents,this.halfExtents,.5),o.copy(this.min,t),o.copy(this.max,e)},t.prototype.getMin=function(){return this.min},t.prototype.getMax=function(){return this.max},t.prototype.add=function(e){if(!t.isEmpty(e)){var n=this.center,r=n[0],i=n[1],o=n[2],a=this.halfExtents,s=a[0],u=a[1],c=a[2],l=r-s,f=r+s,h=i-u,d=i+u,p=o-c,v=o+c,y=e.center,g=y[0],m=y[1],_=y[2],E=e.halfExtents,T=E[0],b=E[1],R=E[2],A=g-T,S=g+T,O=m-b,M=m+b,C=_-R,x=_+R;A<l&&(l=A),S>f&&(f=S),O<h&&(h=O),M>d&&(d=M),C<p&&(p=C),x>v&&(v=x),n[0]=.5*(l+f),n[1]=.5*(h+d),n[2]=.5*(p+v),a[0]=.5*(f-l),a[1]=.5*(d-h),a[2]=.5*(v-p),this.min[0]=l,this.min[1]=h,this.min[2]=p,this.max[0]=f,this.max[1]=d,this.max[2]=v}},t.prototype.setFromTransformedAABB=function(t,e){var n=this.center,r=this.halfExtents,i=t.center,a=t.halfExtents,s=e[0],u=e[4],c=e[8],l=e[1],f=e[5],h=e[9],d=e[2],p=e[6],v=e[10],y=Math.abs(s),g=Math.abs(u),m=Math.abs(c),_=Math.abs(l),E=Math.abs(f),T=Math.abs(h),b=Math.abs(d),R=Math.abs(p),A=Math.abs(v);o.set(n,e[12]+s*i[0]+u*i[1]+c*i[2],e[13]+l*i[0]+f*i[1]+h*i[2],e[14]+d*i[0]+p*i[1]+v*i[2]),o.set(r,y*a[0]+g*a[1]+m*a[2],_*a[0]+E*a[1]+T*a[2],b*a[0]+R*a[1]+A*a[2]),this.min=o.sub(this.min,n,r),this.max=o.add(this.max,n,r)},t.prototype.intersects=function(t){var e=this.getMax(),n=this.getMin(),r=t.getMax(),i=t.getMin();return n[0]<=r[0]&&e[0]>=i[0]&&n[1]<=r[1]&&e[1]>=i[1]&&n[2]<=r[2]&&e[2]>=i[2]},t.prototype.intersection=function(e){if(!this.intersects(e))return null;var n=new t,r=o.max(o.create(),this.getMin(),e.getMin()),i=o.min(o.create(),this.getMax(),e.getMax());return n.setMinMax(r,i),n},t.prototype.containsPoint=function(t){var e=this.getMin(),n=this.getMax();return!(t[0]<e[0]||t[0]>n[0]||t[1]<e[1]||t[1]>n[1]||t[2]<e[2]||t[2]>n[2])},t.prototype.getNegativeFarPoint=function(t){return 273===t.pnVertexFlag?o.copy(o.create(),this.min):272===t.pnVertexFlag?o.fromValues(this.min[0],this.min[1],this.max[2]):257===t.pnVertexFlag?o.fromValues(this.min[0],this.max[1],this.min[2]):256===t.pnVertexFlag?o.fromValues(this.min[0],this.max[1],this.max[2]):17===t.pnVertexFlag?o.fromValues(this.max[0],this.min[1],this.min[2]):16===t.pnVertexFlag?o.fromValues(this.max[0],this.min[1],this.max[2]):1===t.pnVertexFlag?o.fromValues(this.max[0],this.max[1],this.min[2]):o.fromValues(this.max[0],this.max[1],this.max[2])},t.prototype.getPositiveFarPoint=function(t){return 273===t.pnVertexFlag?o.copy(o.create(),this.max):272===t.pnVertexFlag?o.fromValues(this.max[0],this.max[1],this.min[2]):257===t.pnVertexFlag?o.fromValues(this.max[0],this.min[1],this.max[2]):256===t.pnVertexFlag?o.fromValues(this.max[0],this.min[1],this.min[2]):17===t.pnVertexFlag?o.fromValues(this.min[0],this.max[1],this.max[2]):16===t.pnVertexFlag?o.fromValues(this.min[0],this.max[1],this.min[2]):1===t.pnVertexFlag?o.fromValues(this.min[0],this.min[1],this.max[2]):o.fromValues(this.min[0],this.min[1],this.min[2])},t}(),di=o.create(),pi=(function(){function t(t,e){this.center=t||o.create(),this.radius=e||.5}t.prototype.containsPoint=function(t){return o.sub(di,t,this.center),o.length(di)<this.radius*this.radius},t.prototype.intersects=function(t){o.sub(di,t.center,this.center);var e=t.radius+this.radius;return o.length(di)<=e*e}}(),function(){function t(t,e){this.distance=t||0,this.normal=e||o.fromValues(0,1,0),this.updatePNVertexFlag()}return t.prototype.updatePNVertexFlag=function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)},t.prototype.distanceToPoint=function(t){return o.dot(t,this.normal)-this.distance},t.prototype.normalize=function(){var t=1/o.len(this.normal);o.scale(this.normal,this.normal,t),this.distance*=t},t.prototype.intersectsLine=function(t,e,n){var r=this.distanceToPoint(t),i=r/(r-this.distanceToPoint(e)),a=i>=0&&i<=1;return a&&n&&o.lerp(n,t,e,i),a},t}());!function(t){t[t.OUTSIDE=4294967295]="OUTSIDE",t[t.INSIDE=0]="INSIDE",t[t.INDETERMINATE=2147483647]="INDETERMINATE"}(ri||(ri={}));var vi,yi=function(){function t(t){if(this.planes=[],t)this.planes=t;else for(var e=0;e<6;e++)this.planes.push(new pi)}return t.prototype.extractFromVPMatrix=function(t){var e=Object(f.g)(t,16),n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=e[9],p=e[10],v=e[11],y=e[12],g=e[13],m=e[14],_=e[15];o.set(this.planes[0].normal,a-n,l-s,v-h),this.planes[0].distance=_-y,o.set(this.planes[1].normal,a+n,l+s,v+h),this.planes[1].distance=_+y,o.set(this.planes[2].normal,a+r,l+u,v+d),this.planes[2].distance=_+g,o.set(this.planes[3].normal,a-r,l-u,v-d),this.planes[3].distance=_-g,o.set(this.planes[4].normal,a-i,l-c,v-p),this.planes[4].distance=_-m,o.set(this.planes[5].normal,a+i,l+c,v+p),this.planes[5].distance=_+m,this.planes.forEach((function(t){t.normalize(),t.updatePNVertexFlag()}))},t}(),gi=o.create(),mi=o.create(),_i=o.create(),Ei=o.create(),Ti=o.create(),bi=(function(){function t(t,e){this.origin=t||o.create(),this.direction=e||o.fromValues(0,0,-1)}t.prototype.intersectsAABB=function(t,e){return e?this.intersectAABBWithIntersection(t,e):this.intersectsAABBWithoutIntersection(t)},t.prototype.intersectsSphere=function(t,e){var n=o.sub(gi,this.origin,t.center);o.normalize(mi,o.copy(mi,this.direction));var r=o.dot(n,mi),i=o.dot(n,n)-t.radius*t.radius;if(i>0&&r>0)return null;var a=r*r-i;if(a<0)return!1;var s=Math.abs(-r-Math.sqrt(a));return e&&(o.copy(e,this.direction),o.scaleAndAdd(e,this.origin,e,s)),!0},t.prototype.intersectsPlane=function(t,e){var n=(t.distance-o.dot(t.normal,this.origin))/o.dot(t.normal,this.direction),r=n>=0;return r&&e&&o.scaleAndAdd(e,this.origin,this.direction,n),r},t.prototype.intersectsAABBWithoutIntersection=function(t){var e=gi,n=mi,r=_i,i=Ei,a=Ti,s=this.direction;return o.sub(e,this.origin,t.center),o.set(i,Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])),o.mul(r,e,s),!(i[0]>t.halfExtents[0]&&r[0]>=0||i[1]>t.halfExtents[1]&&r[1]>=0||i[2]>t.halfExtents[2]&&r[2]>=0)&&(o.set(a,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2])),o.cross(n,s,e),o.set(n,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])),!(n[0]>t.halfExtents[1]*a[2]+t.halfExtents[2]*a[1]||n[1]>t.halfExtents[0]*a[2]+t.halfExtents[2]*a[0]||n[2]>t.halfExtents[0]*a[1]+t.halfExtents[1]*a[0]))},t.prototype.intersectAABBWithIntersection=function(t,e){var n=o.copy(o.create(),t.getMin());o.sub(n,n,this.origin);var r=o.copy(o.create(),t.getMax());o.sub(r,r,this.origin);var i=this.direction;0===i[0]?(n[0]=n[0]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[0]=r[0]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[0]/=i[0],r[0]/=i[0]),0===i[1]?(n[1]=n[1]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[1]=r[1]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[1]/=i[1],r[1]/=i[1]),0===i[2]?(n[2]=n[2]<0?-Number.MAX_VALUE:Number.MAX_VALUE,r[2]=r[2]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(n[2]/=i[2],r[2]/=i[2]);var a=o.set(_i,Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.min(n[2],r[2])),s=o.set(Ei,Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.max(n[2],r[2])),u=Math.min(Math.min(s[0],s[1]),s[2]),c=Math.max(Math.max(a[0],a[1]),a[2]),l=u>=c&&c>=0;return l&&(o.copy(e,this.direction),o.scaleAndAdd(e,this.origin,e,c)),l}}(),n(50)),Ri=function(){function t(t,e,n,r){this.x=t,this.y=e,this.width=n,this.height=r,this.left=t,this.right=t+n,this.top=e,this.bottom=e+r}return t.prototype.toJSON=function(){},t}(),Ai=(function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Array.isArray(t[0])?t[0]:t;if("number"!=typeof n[0]){for(var r=[],i=0,o=n.length;i<o;i++)r.push(n[i].x,n[i].y);n=r}this.points=n,this.closeStroke=!0}t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var a=this.points[2*i],s=this.points[2*i+1],u=this.points[2*o],c=this.points[2*o+1];s>e!=c>e&&t<(e-s)/(c-s)*(u-a)+a&&(n=!n)}return n}}(),c.d.defineToken("SceneGraphSelectorFactory")),Si=c.d.defineToken("SceneGraphSelector",{multiple:!1}),Oi=function(){function t(){}return t.prototype.selectOne=function(t,e){return t.startsWith("#")?e.find((function(e){return e.id===t.substring(1)})):null},t.prototype.selectAll=function(t,e){return t.startsWith(".")?e.findAll((function(e){return e.className===t.substring(1)})):t.startsWith("#")?e.findAll((function(e){return e.id===t.substring(1)})):t.startsWith("[name=")?e.findAll((function(e){return e.name===t.substring(7,t.length-2)})):e.findAll((function(e){return e.nodeName===t}))},t.prototype.is=function(){return!0},t=Object(f.c)([Object(c.j)({token:Si})],t)}();!function(t){t.DESTROY="destroy",t.ATTR_MODIFIED="DOMAttrModified",t.INSERTED="DOMNodeInserted",t.CHILD_INSERTED="child-inserted",t.REMOVED="removed",t.CHILD_REMOVED="child-removed",t.MOUNTED="DOMNodeInsertedIntoDocument",t.UNMOUNTED="DOMNodeRemovedFromDocument",t.BOUNDS_CHANGED="bounds-changed",t.RENDER_ORDER_CHANGED="render-order-changed"}(vi||(vi={}));var Mi=n(42);function Ci(t,e){var n=Number(t.style.zIndex),r=Number(e.style.zIndex);if(n===r){var i=t.parentNode;if(i){var o=i.childNodes||[];return o.indexOf(t)-o.indexOf(e)}}return n-r}function xi(t,e){void 0===e&&(e=!1);for(var n=t;n;){var r=n.renderable;r&&(r.renderBoundsDirty=!0,r.boundsDirty=!0,r.dirty=!0),n=n.parentNode}t.emit(vi.BOUNDS_CHANGED,{affectChildren:e})}var Ni,Pi,Ii,Bi,Di,wi="SceneGraphService",Fi=function(){function t(){var t,e,n,r,a,u=this;this.rotate=(t=s.create(),function(e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof n&&(n=o.fromValues(n,r,i));var a=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var c=s.create();s.fromEuler(c,n[0],n[1],n[2]);var l=u.getRotation(e),f=u.getRotation(e.parentNode);s.copy(t,f),s.invert(t,t),s.multiply(c,t,c),s.multiply(a.localRotation,c,l),s.normalize(a.localRotation,a.localRotation),u.dirtifyLocal(e,a)}else u.rotateLocal(e,n)}),this.rotateLocal=(e=s.create(),function(t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof n&&(n=o.fromValues(n,r,i));var a=t.transformable;s.fromEuler(e,n[0],n[1],n[2]),s.mul(a.localRotation,a.localRotation,e),u.dirtifyLocal(t,a)}),this.setEulerAngles=(n=s.create(),function(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0),"number"==typeof e&&(e=o.fromValues(e,r,i));var a=t.transformable;if(null!==t.parentNode&&t.parentNode.transformable){s.fromEuler(a.localRotation,e[0],e[1],e[2]);var c=u.getRotation(t.parentNode);s.copy(n,s.invert(s.create(),c)),s.mul(a.localRotation,a.localRotation,n),u.dirtifyLocal(t,a)}else u.setLocalEulerAngles(t,e)}),this.translateLocal=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof e&&(e=o.fromValues(e,n,r));var i=t.transformable;o.equals(e,o.create())||(o.transformQuat(e,e,i.localRotation),o.add(i.localPosition,i.localPosition,e),u.dirtifyLocal(t,i))},this.setPosition=(r=i.create(),function(t,e){var n=t.transformable;if(e=o.fromValues(e[0],e[1],e[2]||n.position[2]),!o.equals(u.getPosition(t),e)){if(n.position=e,null!==t.parentNode&&t.parentNode.transformable){var a=t.parentNode.transformable;i.copy(r,a.worldTransform),i.invert(r,r),o.transformMat4(n.localPosition,e,r)}else o.copy(n.localPosition,e);u.dirtifyLocal(t,n)}}),this.translate=(a=o.create(),function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof e&&(e=o.fromValues(e,n,r)),o.equals(e,o.create())||(o.add(a,u.getPosition(t),e),u.setPosition(t,a))}),this.setRotation=function(){var t=s.create();return function(e,n,r,i,o){var a=e.transformable;if("number"==typeof n&&(n=s.fromValues(n,r,i,o)),null!==e.parentNode&&e.parentNode.transformable){var c=u.getRotation(e.parentNode);s.copy(t,c),s.invert(t,t),s.multiply(a.localRotation,t,n),s.normalize(a.localRotation,a.localRotation),u.dirtifyLocal(e,a)}else u.setLocalRotation(e,n)}}}return t.prototype.matches=function(t,e){return this.sceneGraphSelectorFactory().is(t,e)},t.prototype.querySelector=function(t,e){return this.sceneGraphSelectorFactory().selectOne(t,e)},t.prototype.querySelectorAll=function(t,e){return this.sceneGraphSelectorFactory().selectAll(t,e)},t.prototype.attach=function(t,e,n){t.parentNode&&this.detach(t),t.parentNode=e,Object(d.h)(n)?t.parentNode.childNodes.push(t):t.parentNode.childNodes.splice(n,0,t);var r=e.sortable;r&&(r.dirty=!0);var i=t.transformable;i&&this.dirtifyWorld(t,i),i.frozen&&this.unfreezeParentToRoot(t)},t.prototype.detach=function(t){if(t.parentNode){var e=t.transformable;if(e){var n=this.getWorldTransform(t,e);i.getScaling(e.localScale,n),i.getTranslation(e.localPosition,n),i.getRotation(e.localRotation,n),e.localDirtyFlag=!0}var r=t.parentNode.sortable;r&&(r.dirty=!0);var o=t.parentNode.childNodes.indexOf(t);o>-1&&t.parentNode.childNodes.splice(o,1),e&&this.dirtifyWorld(t,e),t.parentNode=null}},t.prototype.getOrigin=function(t){return t.transformable.origin},t.prototype.setOrigin=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof e&&(e=o.fromValues(e,n,r));var i=t.transformable;if(!o.equals(e,i.origin)){var a=i.origin;a[0]=e[0],a[1]=e[1],a[2]=e[2]||0,this.dirtifyLocal(t,i)}},t.prototype.setLocalEulerAngles=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof e&&(e=o.fromValues(e,n,r));var i=t.transformable;s.fromEuler(i.localRotation,e[0],e[1],e[2]),this.dirtifyLocal(t,i)},t.prototype.setLocalPosition=function(t,e){var n=t.transformable;e=o.fromValues(e[0],e[1],e[2]||n.localPosition[2]),o.equals(n.localPosition,e)||(o.copy(n.localPosition,e),this.dirtifyLocal(t,n))},t.prototype.scaleLocal=function(t,e){var n=t.transformable;o.multiply(n.localScale,n.localScale,o.fromValues(e[0],e[1],e[2]||1)),this.dirtifyLocal(t,n)},t.prototype.setLocalScale=function(t,e){var n=t.transformable,r=o.fromValues(e[0],e[1],e[2]||n.localScale[2]);o.equals(r,n.localScale)||(o.copy(n.localScale,r),this.dirtifyLocal(t,n))},t.prototype.setLocalRotation=function(t,e,n,r,i){"number"==typeof e&&(e=s.fromValues(e,n,r,i));var o=t.transformable;s.copy(o.localRotation,e),this.dirtifyLocal(t,o)},t.prototype.dirtifyLocal=function(t,e){e.localDirtyFlag||(e.localDirtyFlag=!0,e.dirtyFlag||this.dirtifyWorld(t,e))},t.prototype.dirtifyWorld=function(t,e){e.dirtyFlag||this.unfreezeParentToRoot(t),this.dirtifyWorldInternal(t,e),xi(t,!0)},t.prototype.getPosition=function(t){var e=t.transformable;return i.getTranslation(e.position,this.getWorldTransform(t,e))},t.prototype.getRotation=function(t){var e=t.transformable;return i.getRotation(e.rotation,this.getWorldTransform(t,e))},t.prototype.getScale=function(t){var e=t.transformable;return i.getScaling(e.scaling,this.getWorldTransform(t,e))},t.prototype.getWorldTransform=function(t,e){return void 0===e&&(e=t.transformable),e.localDirtyFlag||e.dirtyFlag?(t.parentNode&&t.parentNode.transformable&&this.getWorldTransform(t.parentNode),this.sync(t,e),e.worldTransform):e.worldTransform},t.prototype.getLocalPosition=function(t){return t.transformable.localPosition},t.prototype.getLocalRotation=function(t){return t.transformable.localRotation},t.prototype.getLocalScale=function(t){return t.transformable.localScale},t.prototype.getLocalTransform=function(t){var e=t.transformable;return e.localDirtyFlag&&(i.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,e.localScale,e.origin),e.localDirtyFlag=!1),e.localTransform},t.prototype.resetLocalTransform=function(t){this.setLocalScale(t,[1,1,1]),this.setLocalPosition(t,[0,0,0]),this.setLocalEulerAngles(t,[0,0,0])},t.prototype.getTransformedGeometryBounds=function(t,e){void 0===e&&(e=!1);var n=this.getGeometryBounds(t,e);if(hi.isEmpty(n))return null;var r=new hi;return r.setFromTransformedAABB(n,this.getWorldTransform(t)),r},t.prototype.getGeometryBounds=function(t,e){void 0===e&&(e=!1);var n=t.geometry,r=e?n.renderBounds:n.contentBounds||null;return r&&new hi(r.center,r.halfExtents)||new hi},t.prototype.getBounds=function(t,e){var n=this;void 0===e&&(e=!1);var r=t.renderable;if(!r.boundsDirty&&!e&&r.bounds)return r.bounds;if(!r.renderBoundsDirty&&e&&r.renderBounds)return r.renderBounds;var i=this.getTransformedGeometryBounds(t,e);t.childNodes.forEach((function(t){var r=n.getBounds(t,e);r&&(i?i.add(r):(i=new hi).update(r.center,r.halfExtents))}));var o=t.style.clipPath;if(o){var a=this.getTransformedGeometryBounds(o,!0),s=void 0;a&&(s=new hi).setFromTransformedAABB(a,this.getWorldTransform(t)),i?s&&(i=s.intersection(i)):i=s}return i&&(e?r.renderBounds=i:r.bounds=i),e?r.renderBoundsDirty=!1:r.boundsDirty=!1,i||new hi},t.prototype.getLocalBounds=function(t){if(t.parentNode){var e=i.create();t.parentNode.transformable&&(e=i.invert(i.create(),this.getWorldTransform(t.parentNode)));var n=this.getBounds(t);if(!hi.isEmpty(n)){var r=new hi;return r.setFromTransformedAABB(n,e),r}}return this.getBounds(t)},t.prototype.getBoundingClientRect=function(t){var e,n,r,i=this.getGeometryBounds(t);hi.isEmpty(i)||(r=new hi).setFromTransformedAABB(i,this.getWorldTransform(t));var o=null===(n=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===n?void 0:n.getContextService().getBoundingClientRect();if(r){var a=Object(f.g)(r.getMin(),2),s=a[0],u=a[1],c=Object(f.g)(r.getMax(),2),l=c[0],h=c[1];return new Ri(s+((null==o?void 0:o.left)||0),u+((null==o?void 0:o.top)||0),l-s,h-u)}return new Ri((null==o?void 0:o.left)||0,(null==o?void 0:o.top)||0,0,0)},t.prototype.dirtifyWorldInternal=function(t,e){var n=this;if(!e.dirtyFlag){e.dirtyFlag=!0,e.frozen=!1,t.childNodes.forEach((function(t){var e=t.transformable;e.dirtyFlag||n.dirtifyWorldInternal(t,e)}));var r=t.renderable;r&&(r.renderBoundsDirty=!0,r.boundsDirty=!0,r.dirty=!0),t.dispatchEvent(new Mi.a(vi.ATTR_MODIFIED,t,null,null,"modelMatrix",Mi.a.MODIFICATION,null,null))}},t.prototype.syncHierarchy=function(t){var e=t.transformable;if(!e.frozen){e.frozen=!0,(e.localDirtyFlag||e.dirtyFlag)&&this.sync(t,e);for(var n=t.childNodes,r=0;r<n.length;r++)this.syncHierarchy(n[r])}},t.prototype.sync=function(t,e){if(e.localDirtyFlag&&(i.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,e.localScale,e.origin),e.localDirtyFlag=!1),e.dirtyFlag){var n=t.parentNode,r=n&&n.transformable;null!==n&&r?i.multiply(e.worldTransform,r.worldTransform,e.localTransform):i.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1}},t.prototype.unfreezeParentToRoot=function(t){for(var e=t.parentNode;e;){var n=e.transformable;n&&(n.frozen=!1),e=e.parentNode}},Object(f.c)([Object(c.g)(Ai),Object(f.f)("design:type",Function)],t.prototype,"sceneGraphSelectorFactory",void 0),t=Object(f.c)([Object(c.j)()],t)}(),Li="GeometryAABBUpdater";!function(t){t.GROUP="g",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.IMAGE="image",t.RECT="rect",t.LINE="line",t.POLYLINE="polyline",t.POLYGON="polygon",t.TEXT="text",t.PATH="path",t.HTML="html"}(Ni||(Ni={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(Pi||(Pi={})),function(t){t.BEVEL="bevel",t.ROUND="round",t.MITER="miter"}(Ii||(Ii={})),function(t){t.CAPITALIZE="capitalize",t.UPPERCASE="uppercase",t.LOWERCASE="lowercase",t.NONE="none"}(Bi||(Bi={})),function(t){t.START="start",t.CENTER="center",t.END="end",t.LEFT="left",t.RIGHT="right"}(Di||(Di={}));var ki="CanvasConfig",Ui=function(){function t(){}return t.prototype.update=function(t,e){var n=t.r,r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o,s=n.unit,u=n.value,c=0,l=0;return""!==s&&"px"!==s||(c=2*u,l=2*u),e.parsedStyle.rInPixels=c/2,{width:c,height:l,x:i,y:a}},t=Object(f.c)([Object(c.j)({token:{token:Li,named:Ni.CIRCLE}})],t)}(),Gi=function(){function t(){}return t.prototype.update=function(t,e){var n=t.rx,r=t.ry,i=t.x,o=void 0===i?0:i,a=t.y,s=void 0===a?0:a,u=n.unit,c=n.value,l=r.unit,f=r.value,h=0,d=0;return""!==u&&"px"!==u||(h=2*c),""!==l&&"px"!==l||(d=2*f),e.parsedStyle.rxInPixels=h/2,e.parsedStyle.ryInPixels=d/2,{width:h,height:d,x:o,y:s}},t=Object(f.c)([Object(c.j)({token:{token:Li,named:Ni.ELLIPSE}})],t)}(),ji=function(){function t(){}return t.prototype.update=function(t,e){var n=t.img,r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o,s=t.width,u=t.height,c=0,l=0,f=s.unit,h=s.value,p=u.unit,v=u.value;return""!==f&&"px"!==f||(c=h),""!==p&&"px"!==p||(l=v),n&&!Object(d.k)(n)&&(c||(c=n.width),l||(l=n.height)),e.parsedStyle.widthInPixels=c,e.parsedStyle.heightInPixels=l,{width:c,height:l,x:i,y:a}},t=Object(f.c)([Object(c.j)({token:[{token:Li,named:Ni.RECT},{token:Li,named:Ni.IMAGE},{token:Li,named:Ni.GROUP}]})],t)}(),Vi=(n(22),["serif","sans-serif","monospace","cursive","fantasy","system-ui"]);var Wi,Xi=function(){function t(){}return t.prototype.getOrCreateCanvas=function(){if(this.canvas)return this.canvas;try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d"),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return this.canvas.width=10,this.canvas.height=10,this.canvas},t.prototype.getOrCreateContext=function(){return this.context||this.getOrCreateCanvas(),this.context},t=Object(f.c)([Object(c.j)()],t)}(),Hi={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},Yi=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,zi=new RegExp(/[!%),.:;?\]}'""]/.source+"|"+/[!),.:;?\]}'""]/.source+"|"+/[)\]'"?!:;,.]/.source+"|"+/[!%),.:;?\]}'"]/.source),qi=new RegExp(/[$('"]/.source+"|"+/[([{'"]/.source+"|"+/[(['"...]/.source+"|"+/[$([{'"#]/.source),Ki=function(){function t(){var t=this;this.cache={},this.shouldBreakByKinsokuShorui=function(e,n){return!t.isBreakingSpace(n)&&!(!e||!qi.exec(n)&&!zi.exec(e))},this.trimByKinsokuShorui=function(t){var e=Object(f.i)([],Object(f.g)(t),!1),n=e[e.length-2];if(!n)return t;var r=n[n.length-1];return e[e.length-2]=n.slice(0,-1),e[e.length-1]=r+e[e.length-1],e}}return t.prototype.measureFont=function(t){if(this.cache[t])return this.cache[t];var e={ascent:0,descent:0,fontSize:0},n=this.offscreenCanvas.getOrCreateCanvas(),r=this.offscreenCanvas.getOrCreateContext();r.font=t;var i=Hi.MetricsString+Hi.BaselineSymbol,o=Math.ceil(r.measureText(i).width),a=Math.ceil(r.measureText(Hi.BaselineSymbol).width),s=Hi.HeightMultiplier*a;a=a*Hi.BaselineMultiplier|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,a);var u=r.getImageData(0,0,o||1,s||1).data,c=u.length,l=4*o,f=0,h=0,d=!1;for(f=0;f<a;++f){for(var p=0;p<l;p+=4)if(255!==u[h+p]){d=!0;break}if(d)break;h+=l}for(e.ascent=a-f,h=c-l,d=!1,f=s;f>a;--f){for(p=0;p<l;p+=4)if(255!==u[h+p]){d=!0;break}if(d)break;h-=l}return e.descent=f-a,e.fontSize=e.ascent+e.descent,this.cache[t]=e,e},t.prototype.measureText=function(t,e){var n=e.fontSize,r=e.wordWrap,i=e.lineHeight,o=void 0===i?0:i,a=e.lineWidth,s=e.textBaseline,u=e.textAlign,c=e.letterSpacing,l=void 0===c?0:c,f=e.dropShadow,h=e.dropShadowDistance,p=void 0===h?0:h,v=e.leading,y=void 0===v?0:v,g=function(t){var e=t.fontSize,n=t.fontFamily,r=t.fontStyle,i=t.fontVariant,o=t.fontWeight,a=Object(d.i)(e)?e+"px":""+e.value+(e.unit||"px"),s=n;Array.isArray(n)||(s=n.split(","));for(var u=s.length-1;u>=0;u--){var c=s[u].trim();!/([\"\'])[^\'\"]+\1/.test(c)&&Vi.indexOf(c)<0&&(c='"'+c+'"'),s[u]=c}return r+" "+i+" "+o+" "+a+" "+s.join(",")}(e),m=this.measureFont(g);0===m.fontSize&&(m.fontSize=n.value,m.ascent=n.value);var _=this.offscreenCanvas.getOrCreateContext();_.font=g;for(var E=(r?this.wordWrap(t,e):t).split(/(?:\r\n|\r|\n)/),T=new Array(E.length),b=0,R=0;R<E.length;R++){var A=_.measureText(E[R]).width+(E[R].length-1)*l;T[R]=A,b=Math.max(b,A)}var S=b+a.value;f&&(S+=p);var O=o||m.fontSize+a.value,M=Math.max(O,m.fontSize+a.value)+(E.length-1)*(O+y);f&&(M+=p);var C=0;return"middle"===s?C=-M/2:"bottom"===s||"alphabetic"===s||"ideographic"===s?C=-M:"top"!==s&&"hanging"!==s||(C=0),{font:g,width:S,height:M,lines:E,lineWidths:T,lineHeight:O+=y,maxLineWidth:b,fontProperties:m,lineMetrics:T.map((function(t,e){var n=0;return"center"===u?n-=t/2:"right"!==u&&"end"!==u||(n-=t),new Ri(n-a.value/2,C+e*O,t+a.value,O)}))}},t.prototype.wordWrap=function(t,e){var n=this,r=e.wordWrapWidth,i=void 0===r?0:r,o=e.letterSpacing,a=void 0===o?0:o,s=this.offscreenCanvas.getOrCreateContext(),u=i+a,c=[],l=0,f=0,h={},d=function(t){return n.getFromCache(t,a,h,s)};return Array.from(t).forEach((function(e,r){var i=t[r-1],o=t[r+1],a=d(e);if(n.isNewline(e))return l++,f=0,void(c[l]="");if(f>0&&f+a>u){if(l++,f=0,c[l]="",n.isBreakingSpace(e))return;n.canBreakInLastChar(e)||(c=n.trimToBreakable(c),f=n.sumTextWidthByCache(c[l]||"",h)),n.shouldBreakByKinsokuShorui(e,o)&&(c=n.trimByKinsokuShorui(c),f+=d(i||""))}f+=a,c[l]=(c[l]||"")+e})),c.join("\n")},t.prototype.isBreakingSpace=function(t){return"string"==typeof t&&Hi.BreakingSpaces.indexOf(t.charCodeAt(0))>=0},t.prototype.isNewline=function(t){return"string"==typeof t&&Hi.Newlines.indexOf(t.charCodeAt(0))>=0},t.prototype.trimToBreakable=function(t){var e=Object(f.i)([],Object(f.g)(t),!1),n=e[e.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return e;var i=n.slice(r,r+1),o=r+1,a=r+(this.isBreakingSpace(i)?0:1);return e[e.length-1]+=n.slice(o,n.length),e[e.length-2]=n.slice(0,a),e},t.prototype.canBreakInLastChar=function(t){return!t||!Yi.test(t)},t.prototype.sumTextWidthByCache=function(t,e){return t.split("").reduce((function(t,n){if(!e[n])throw Error("cannot count the word without cache");return t+e[n]}),0)},t.prototype.findBreakableIndex=function(t){for(var e=t.length-1;e>=0;e--)if(!Yi.test(t[e]))return e;return-1},t.prototype.getFromCache=function(t,e,n,r){var i=n[t];if("number"!=typeof i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},Object(f.c)([Object(c.g)(Xi),Object(f.f)("design:type",Xi)],t.prototype,"offscreenCanvas",void 0),t=Object(f.c)([Object(c.j)()],t)}(),Zi=function(){function t(){}return t.prototype.update=function(t){var e=t.text,n=void 0===e?"":e,r=t.textAlign,i=t.lineWidth,a=t.textBaseline,s=t.x,u=void 0===s?0:s,c=t.y,l=void 0===c?0:c,f=t.dx,h=t.dy,d=this.textService.measureText(n,t);t.metrics=d;var p=d.width,v=d.height,y=d.lineHeight,g=d.fontProperties,m=o.fromValues(p/2,v/2,0),_=[0,1],E=0;"center"===r?(E=i.value/2,_=[.5,1]):"right"!==r&&"end"!==r||(E=i.value,_=[1,1]),t.anchor=_;var T=0;return"middle"===a?T=m[1]:"top"===a||"hanging"===a?T=2*m[1]:"alphabetic"===a?T=y-g.ascent:"bottom"!==a&&"ideographic"!==a||(T=0),f&&"px"===f.unit&&(E+=f.value),h&&"px"===h.unit&&(T+=h.value),{width:2*m[0],height:2*m[1],x:u,y:l,offsetX:E,offsetY:T}},Object(f.c)([Object(c.g)(Ki),Object(f.f)("design:type",Ki)],t.prototype,"textService",void 0),t=Object(f.c)([Object(c.j)({token:{token:Li,named:Ni.TEXT}})],t)}(),Qi=function(){function t(){}return t.prototype.update=function(t){var e=t.x1,n=t.y1,r=t.x2,i=t.y2,o=Math.min(e,r),a=Math.max(e,r),s=Math.min(n,i);return{width:a-o,height:Math.max(n,i)-s,x:o,y:s}},t=Object(f.c)([Object(c.j)({token:{token:Li,named:Ni.LINE}})],t)}(),Ji=function(){function t(){}return t.prototype.update=function(t){var e=t.points.points,n=Math.min.apply(Math,Object(f.i)([],Object(f.g)(e.map((function(t){return t[0]}))),!1)),r=Math.max.apply(Math,Object(f.i)([],Object(f.g)(e.map((function(t){return t[0]}))),!1)),i=Math.min.apply(Math,Object(f.i)([],Object(f.g)(e.map((function(t){return t[1]}))),!1));return{width:r-n,height:Math.max.apply(Math,Object(f.i)([],Object(f.g)(e.map((function(t){return t[1]}))),!1))-i,x:n,y:i}},t=Object(f.c)([Object(c.j)({token:[{token:Li,named:Ni.POLYLINE},{token:Li,named:Ni.POLYGON}]})],t)}(),$i=function(){function t(){}return t.prototype.update=function(t){var e=t.path.rect,n=e.x,r=e.y;return{width:e.width,height:e.height,x:n,y:r}},t=Object(f.c)([Object(c.j)({token:{token:Li,named:Ni.PATH}})],t)}(),to=c.d.defineToken("ContextService",{multiple:!1});!function(t){t[t.CAMERA_CHANGED=0]="CAMERA_CHANGED",t[t.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",t[t.NONE=2]="NONE"}(Wi||(Wi={}));var eo,no="RenderingContext",ro=(n(15),n(158)),io=n(30),oo=function(t){function e(e,n){var r=t.call(this,null)||this;return r.type=e,r.detail=n,Object.assign(r,n),r}return Object(f.d)(e,t),e}(io.a),ao=function(){function t(){this.emitter=new l.EventEmitter}return t.prototype.on=function(t,e,n){return this.addEventListener(t,e,n),this},t.prototype.addEventListener=function(t,e,n){var r=Object(d.d)(n)&&n||Object(d.j)(n)&&n.capture,i=Object(d.j)(n)&&n.once,o=Object(d.g)(e)?void 0:e,a=!1,s="";if(t.indexOf(":")>-1){var u=Object(f.g)(t.split(":"),2),c=u[0];t=u[1],s=c,a=!0}if(t=r?t+"capture":t,e=Object(d.g)(e)?e:e.handleEvent,a){var l=e;e=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(null===(t=e[0].target)||void 0===t?void 0:t.name)===s&&l.apply(void 0,Object(f.i)([],Object(f.g)(e),!1))}}return i?this.emitter.once(t,e,o):this.emitter.on(t,e,o),this},t.prototype.off=function(t,e,n){return t?this.removeEventListener(t,e,n):this.removeAllEventListeners(),this},t.prototype.removeAllEventListeners=function(){this.emitter.removeAllListeners()},t.prototype.removeEventListener=function(t,e,n){var r=Object(d.d)(n)&&n||Object(d.j)(n)&&n.capture,i=Object(d.g)(e)?void 0:e;return t=r?t+"capture":t,e=Object(d.g)(e)?e:null==e?void 0:e.handleEvent,this.emitter.off(t,e,i),this},t.prototype.emit=function(t,e){this.dispatchEvent(new oo(t,e))},t.prototype.dispatchEvent=function(t){var e,n;if(!(t instanceof io.a))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");var r=this.ownerDocument||this.document;return r&&(t.manager=(null===(e=r.defaultView)||void 0===e?void 0:e.getEventService())||null,t.defaultPrevented=!1,t.path=[],t.target=this,null===(n=t.manager)||void 0===n||n.dispatchEvent(t)),!t.defaultPrevented},t}(),so=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.parentNode=null,e}return Object(f.d)(e,t),e.isNode=function(t){return!!t.childNodes},Object.defineProperty(e.prototype,"textContent",{get:function(){var t,e,n="";this.nodeName===Ni.TEXT&&(n+=this.style.text);try{for(var r=Object(f.k)(this.childNodes),i=r.next();!i.done;i=r.next()){var o=i.value;o.nodeName===Ni.TEXT?n+=o.nodeValue:n+=o.textContent}}catch(a){t={error:a}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},set:function(t){var e=this;this.childNodes.slice().forEach((function(t){e.removeChild(t,!0)})),this.nodeName===Ni.TEXT&&(this.style.text=""+t)},enumerable:!1,configurable:!0}),e.prototype.getRootNode=function(t){return void 0===t&&(t={}),this.parentNode?this.parentNode.getRootNode(t):t.composed&&this.host?this.host.getRootNode(t):this},e.prototype.hasChildNodes=function(){return this.childNodes.length>0},e.prototype.isDefaultNamespace=function(t){throw new Error("Method not implemented.")},e.prototype.lookupNamespaceURI=function(t){throw new Error("Method not implemented.")},e.prototype.lookupPrefix=function(t){throw new Error("Method not implemented.")},e.prototype.normalize=function(){throw new Error("Method not implemented.")},e.prototype.isEqualNode=function(t){return this===t},e.prototype.isSameNode=function(t){return this.isEqualNode(t)},Object.defineProperty(e.prototype,"parent",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.childNodes.length>0?this.childNodes[0]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null},enumerable:!1,configurable:!0}),e.prototype.compareDocumentPosition=function(t){var n;if(t===this)return 0;if(!(t instanceof e))throw new TypeError("Node.compareDocumentPosition: Argument 1 does not implement interface Node.");for(var r=t,i=this,o=[r],a=[i];null!==(n=r.parentNode)&&void 0!==n?n:i.parentNode;)r=r.parentNode?(o.push(r.parentNode),r.parentNode):r,i=i.parentNode?(a.push(i.parentNode),i.parentNode):i;if(r!==i)return e.DOCUMENT_POSITION_DISCONNECTED|e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|e.DOCUMENT_POSITION_PRECEDING;var s=o.length>a.length?o:a,u=s===o?a:o;if(s[s.length-u.length]===u[0])return s===o?e.DOCUMENT_POSITION_CONTAINED_BY|e.DOCUMENT_POSITION_FOLLOWING:e.DOCUMENT_POSITION_CONTAINS|e.DOCUMENT_POSITION_PRECEDING;for(var c=s.length-u.length,l=u.length-1;l>=0;l--){var f=u[l],h=s[c+l];if(h!==f){var d=f.parentNode.childNodes;return d.indexOf(f)<d.indexOf(h)?u===o?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING:s===o?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING}}return e.DOCUMENT_POSITION_FOLLOWING},e.prototype.contain=function(t){return this.contains(t)},e.prototype.contains=function(t){for(var e=t;e&&this!==e;)e=e.parentNode;return!!e},e.prototype.getAncestor=function(t){for(var e=this;t>0&&e;)e=e.parentNode,t--;return e},e.prototype.forEach=function(t){t(this)||this.childNodes.forEach((function(e){e.forEach(t)}))},e.DOCUMENT_POSITION_DISCONNECTED=1,e.DOCUMENT_POSITION_PRECEDING=2,e.DOCUMENT_POSITION_FOLLOWING=4,e.DOCUMENT_POSITION_CONTAINS=8,e.DOCUMENT_POSITION_CONTAINED_BY=16,e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,e}(ao),uo=function(){function t(){}return t.tag="c-geometry",t}(),co=function(){function t(){this.boundsDirty=!0,this.renderBoundsDirty=!0,this.dirty=!1}return t.tag="c-renderable",t}(),lo=function(){function t(){this.dirtyFlag=!1,this.localDirtyFlag=!1,this.frozen=!1,this.localPosition=o.fromValues(0,0,0),this.localRotation=s.fromValues(0,0,0,1),this.localScale=o.fromValues(1,1,1),this.localTransform=i.create(),this.position=o.fromValues(0,0,0),this.rotation=s.fromValues(0,0,0,1),this.scaling=o.fromValues(1,1,1),this.worldTransform=i.create(),this.origin=o.fromValues(0,0,0)}return t.tag="c-transform",t}();!function(t){t[t.Standard=0]="Standard"}(eo||(eo={}));var fo=function(){function t(){this.strategy=eo.Standard,this.visibilityPlaneMask=-1,this.visible=!0,this.enable=!0}return t.prototype.isCulled=function(){return this.enable&&!this.visible},t.tag="c-cullable",t}(),ho=function(){function t(){this.dirty=!1,this.renderOrder=0}return t.tag="c-sortable",t}();function po(t){return void 0===t?0:t>360||t<-360?t%360:t}function vo(t,e,n){return Object(d.i)(t)?o.fromValues(t,e,n):3===t.length?o.clone(t):o.fromValues(t[0],t[1],t[2]||0)}function yo(t){return t*(180/Math.PI)}function go(t,e){return 16===e.length?function(t,e){var n,r,a=.5*Math.PI,s=Object(f.g)(i.getScaling(o.create(),e),3),u=s[0],c=s[1],l=s[2],h=Math.asin(-e[2]/u);return h<a?h>-a?(n=Math.atan2(e[6]/c,e[10]/l),r=Math.atan2(e[1]/u,e[0]/u)):(r=0,n=-Math.atan2(e[4]/c,e[5]/c)):(r=0,n=Math.atan2(e[4]/c,e[5]/c)),t[0]=n,t[1]=h,t[2]=r,t}(t,e):function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=r*r,s=i*i,u=o*o,c=n*n+a+s+u,l=n*o-r*i;return l>.499995*c?(t[0]=Math.PI/2,t[1]=2*Math.atan2(r,n),t[2]=0):l<-.499995*c?(t[0]=-Math.PI/2,t[1]=2*Math.atan2(r,n),t[2]=0):(t[0]=Math.asin(2*(n*i-o*r)),t[1]=Math.atan2(2*(n*o+r*i),1-2*(s+u)),t[2]=Math.atan2(2*(n*r+i*o),1-2*(a+s))),t}(t,e)}var mo="function"==typeof Float32Array,_o=function(t,e){return 1-3*e+3*t},Eo=function(t,e){return 3*e-6*t},To=function(t){return 3*t},bo=function(t,e,n){return((_o(e,n)*t+Eo(e,n))*t+To(e))*t},Ro=function(t,e,n){return 3*_o(e,n)*t*t+2*Eo(e,n)*t+To(e)},Ao=function(t,e,n,r){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===r)return function(t){return t};for(var i=mo?new Float32Array(11):new Array(11),o=0;o<11;++o)i[o]=bo(.1*o,t,n);var a=function(e){for(var r=0,o=1;10!==o&&i[o]<=e;++o)r+=.1;--o;var a=r+.1*((e-i[o])/(i[o+1]-i[o])),s=Ro(a,t,n);return s>=.001?function(t,e,n,r){for(var i=0;i<4;++i){var o=Ro(e,n,r);if(0===o)return e;e-=(bo(e,n,r)-t)/o}return e}(e,a,t,n):0===s?a:function(t,e,n,r,i){var o,a,s=0;do{(o=bo(a=e+(n-e)/2,r,i)-t)>0?n=a:e=a}while(Math.abs(o)>1e-7&&++s<10);return a}(e,r,r+.1,t,n)};return function(t){return 0===t||1===t?t:bo(a(t),e,r)}},So=function(t){return"-"===(t=t.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))).charAt(0)?t.substr(1):t},Oo=function(t,e,n){return Math.min(Math.max(t,e),n)},Mo=function(t){return Math.pow(t,2)},Co=function(t){return Math.pow(t,3)},xo=function(t){return Math.pow(t,4)},No=function(t){return Math.pow(t,5)},Po=function(t){return Math.pow(t,6)},Io=function(t){return 1-Math.cos(t*Math.PI/2)},Bo=function(t){return 1-Math.sqrt(1-t*t)},Do=function(t){return t*t*(3*t-2)},wo=function(t){for(var e,n=4;t<((e=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*e-2)/22-t,2)},Fo=function(t,e){void 0===e&&(e=[]);var n=Object(f.g)(e,2),r=n[0],i=void 0===r?1:r,o=n[1],a=void 0===o?.5:o,s=Oo(Number(i),1,10),u=Oo(Number(a),.1,2);return 0===t||1===t?t:-s*Math.pow(2,10*(t-1))*Math.sin((t-1-u/(2*Math.PI)*Math.asin(1/s))*(2*Math.PI)/u)},Lo=function(t,e,n){void 0===e&&(e=[]);var r=Object(f.g)(e,4),i=r[0],o=void 0===i?1:i,a=r[1],s=void 0===a?100:a,u=r[2],c=void 0===u?10:u,l=r[3],h=void 0===l?0:l;o=Oo(o,.1,1e3),s=Oo(s,.1,1e3),c=Oo(c,.1,1e3),h=Oo(h,.1,1e3);var d=Math.sqrt(s/o),p=c/(2*Math.sqrt(s*o)),v=p<1?d*Math.sqrt(1-p*p):0,y=p<1?(p*d-h)/v:-h+d,g=n?n*t/1e3:t;return g=p<1?Math.exp(-g*p*d)*(1*Math.cos(v*g)+y*Math.sin(v*g)):(1+y*g)*Math.exp(-g*d),0===t||1===t?t:1-g},ko=(new Map,function(t,e){void 0===e&&(e=[]);var n=Object(f.g)(e,2),r=n[0],i=void 0===r?10:r;return("start"==n[1]?Math.ceil:Math.floor)(Oo(t,0,1)*i)/i}),Uo=function(t,e){void 0===e&&(e=[]);var n=Object(f.g)(e,4),r=n[0],i=n[1],o=n[2],a=n[3];return Ao(r,i,o,a)(t)},Go=Ao(.42,0,1,1),jo=function(t){return function(e,n,r){return void 0===n&&(n=[]),1-t(1-e,n,r)}},Vo=function(t){return function(e,n,r){return void 0===n&&(n=[]),e<.5?t(2*e,n,r)/2:1-t(-2*e+2,n,r)/2}},Wo=function(t){return function(e,n,r){return void 0===n&&(n=[]),e<.5?(1-t(1-2*e,n,r))/2:(t(2*e-1,n,r)+1)/2}},Xo={steps:ko,"step-start":function(t){return ko(t,[1,"start"])},"step-end":function(t){return ko(t,[1,"end"])},linear:function(t){return t},"cubic-bezier":Uo,ease:function(t){return Uo(t,[.25,.1,.25,1])},in:Go,out:jo(Go),"in-out":Vo(Go),"out-in":Wo(Go),"in-quad":Mo,"out-quad":jo(Mo),"in-out-quad":Vo(Mo),"out-in-quad":Wo(Mo),"in-cubic":Co,"out-cubic":jo(Co),"in-out-cubic":Vo(Co),"out-in-cubic":Wo(Co),"in-quart":xo,"out-quart":jo(xo),"in-out-quart":Vo(xo),"out-in-quart":Wo(xo),"in-quint":No,"out-quint":jo(No),"in-out-quint":Vo(No),"out-in-quint":Wo(No),"in-expo":Po,"out-expo":jo(Po),"in-out-expo":Vo(Po),"out-in-expo":Wo(Po),"in-sine":Io,"out-sine":jo(Io),"in-out-sine":Vo(Io),"out-in-sine":Wo(Io),"in-circ":Bo,"out-circ":jo(Bo),"in-out-circ":Vo(Bo),"out-in-circ":Wo(Bo),"in-back":Do,"out-back":jo(Do),"in-out-back":Vo(Do),"out-in-back":Wo(Do),"in-bounce":wo,"out-bounce":jo(wo),"in-out-bounce":Vo(wo),"out-in-bounce":Wo(wo),"in-elastic":Fo,"out-elastic":jo(Fo),"in-out-elastic":Vo(Fo),"out-in-elastic":Wo(Fo),spring:Lo,"spring-in":Lo,"spring-out":jo(Lo),"spring-in-out":Vo(Lo),"spring-out-in":Wo(Lo)},Ho=function(t){return Xo[function(t){return So(t).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim()}(t)]||Xo.linear},Yo=function(t){return t};function zo(t,e){return function(n){if(n>=1)return 1;var r=1/t;return(n+=e*r)-n%r}}var qo="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",Ko=new RegExp("cubic-bezier\\("+qo+","+qo+","+qo+","+qo+"\\)"),Zo=/steps\(\s*(\d+)\s*\)/,Qo=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function Jo(t){var e=Ko.exec(t);if(e)return Ao.apply(void 0,Object(f.i)([],Object(f.g)(e.slice(1).map(Number)),!1));var n=Zo.exec(t);if(n)return zo(Number(n[1]),0);var r=Qo.exec(t);return r?zo(Number(r[1]),{start:1,middle:.5,end:0}[r[2]]):Ho(t)}function $o(t){return Math.abs(function(t){var e;if(0===t.duration||0===t.iterations)return 0;return("auto"===t.duration?0:Number(t.duration))*(null!==(e=t.iterations)&&void 0!==e?e:1)}(t)/(t.playbackRate||1))}function ta(t,e,n){var r=function(t,e,n){if(null===e)return 0;var r=n.endTime;return e<Math.min(n.delay,r)?1:e>=Math.min(n.delay+t,r)?2:3}(t,e,n),i=function(t,e,n,r,i){switch(r){case 1:return"backwards"===e||"both"===e?0:null;case 3:return n-i;case 2:return"forwards"===e||"both"===e?t:null;case 0:return null}}(t,n.fill,e,r,n.delay);if(null===i)return null;var o="auto"===n.duration?0:n.duration,a=function(t,e,n,r,i){var o=i;return 0===t?1!==e&&(o+=n):o+=r/t,o}(o,r,n.iterations,i,n.iterationStart),s=function(t,e,n,r,i,o){var a=t===1/0?e%1:t%1;return 0!==a||2!==n||0===r||0===i&&0!==o||(a=1),a}(a,n.iterationStart,r,n.iterations,i,o),u=function(t,e,n,r){return 2===t&&e===1/0?1/0:1===n?Math.floor(r)-1:Math.floor(r)}(r,n.iterations,s,a),c=function(t,e,n){var r=t;if("normal"!==t&&"reverse"!==t){var i=e;"alternate-reverse"===t&&(i+=1),r="normal",i!==1/0&&i%2!=0&&(r="reverse")}return"normal"===r?n:1-n}(n.direction,u,s);return n.currentIteration=u,n.progress=c,n.easingFunction(c)}var ea={in:"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47, 0, 0.745, 0.715)","out-sine":"cubic-bezier(0.39, 0.575, 0.565, 1)","in-out-sine":"cubic-bezier(0.445, 0.05, 0.55, 0.95)","in-quad":"cubic-bezier(0.55, 0.085, 0.68, 0.53)","out-quad":"cubic-bezier(0.25, 0.46, 0.45, 0.94)","in-out-quad":"cubic-bezier(0.455, 0.03, 0.515, 0.955)","in-cubic":"cubic-bezier(0.55, 0.055, 0.675, 0.19)","out-cubic":"cubic-bezier(0.215, 0.61, 0.355, 1)","in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1)","in-quart":"cubic-bezier(0.895, 0.03, 0.685, 0.22)","out-quart":"cubic-bezier(0.165, 0.84, 0.44, 1)","in-out-quart":"cubic-bezier(0.77, 0, 0.175, 1)","in-quint":"cubic-bezier(0.755, 0.05, 0.855, 0.06)","out-quint":"cubic-bezier(0.23, 1, 0.32, 1)","in-out-quint":"cubic-bezier(0.86, 0, 0.07, 1)","in-expo":"cubic-bezier(0.95, 0.05, 0.795, 0.035)","out-expo":"cubic-bezier(0.19, 1, 0.22, 1)","in-out-expo":"cubic-bezier(1, 0, 0, 1)","in-circ":"cubic-bezier(0.6, 0.04, 0.98, 0.335)","out-circ":"cubic-bezier(0.075, 0.82, 0.165, 1)","in-out-circ":"cubic-bezier(0.785, 0.135, 0.15, 0.86)","in-back":"cubic-bezier(0.6, -0.28, 0.735, 0.045)","out-back":"cubic-bezier(0.175, 0.885, 0.32, 1.275)","in-out-back":"cubic-bezier(0.68, -0.55, 0.265, 1.55)"};Object.keys(ea);function na(t,e,n){var r=function(t,e){for(var n={},r=0;r<t.length;r++)for(var i in t[r])if(ra(i)){var o={offset:t[r].offset,computedOffset:t[r].computedOffset,easing:t[r].easing,easingFunction:Jo(t[r].easing)||e.easingFunction,value:t[r][i]};n[i]=n[i]||[],n[i].push(o)}return n}(t,e),i=function(t,e){var n=[];for(var r in t)for(var i=t[r],o=0;o<i.length-1;o++){var a=o,s=o+1,u=i[a].computedOffset,c=i[s].computedOffset,l=u,f=c;0===o&&(l=-1/0,0===c&&(s=a)),o===i.length-2&&(f=1/0,1===u&&(a=s)),n.push({applyFrom:l,applyTo:f,startOffset:i[a].computedOffset,endOffset:i[s].computedOffset,easingFunction:i[a].easingFunction,property:r,interpolation:ia(r,i[a].value,i[s].value,e)})}return n.sort((function(t,e){return t.startOffset-e.startOffset})),n}(r,n);return function(t,e){if(null!==e)i.filter((function(t){return e>=t.applyFrom&&e<t.applyTo})).forEach((function(n){var r=e-n.startOffset,i=n.endOffset-n.startOffset,o=0===i?0:n.easingFunction(r/i);t.style[n.property]=n.interpolation(o)}));else for(var n in r)ra(n)&&(t.style[n]=null)}}function ra(t){return"offset"!==t&&"easing"!==t&&"composite"!==t&&"computedOffset"!==t}function ia(t,e,n,r){var i=e,o=n,a=Tc[t],s=Rc[t];a&&(i=a(e,r,t),o=a(n,r,t));var u=s&&s(i,o,r);if(u){var c=oa.apply(void 0,Object(f.i)([],Object(f.g)(u),!1));return function(t){return 0===t?e:1===t?n:c(t)}}return oa(!1,!0,(function(t){return t?n:e}))}var oa=function(t,e,n){return function(r){return n(function t(e,n,r){if("number"==typeof e&&"number"==typeof n)return e*(1-r)+n*r;if("boolean"==typeof e&&"boolean"==typeof n||"string"==typeof e&&"string"==typeof n)return r<.5?e:n;if(Array.isArray(e)&&Array.isArray(n)&&e.length===n.length){for(var i=[],o=0;o<e.length;o++)i.push(t(e[o],n[o],r));return i}throw new Error("Mismatched interpolation arguments "+e+":"+n)}(t,e,r))}},aa={d:{alias:"path"},cx:{alias:"x"},cy:{alias:"y"},strokeDasharray:{alias:"lineDash"},strokeWidth:{alias:"lineWidth"},textAnchor:{alias:"textAlign",values:{middle:"center"}},src:{alias:"img"}};function sa(t,e){var n,r=function(t){return void 0===t&&(t=""),t.replace(/-([a-z])/g,(function(t){return t[1].toUpperCase()}))}(t),i=aa[r];return[r=(null==i?void 0:i.alias)||r,(null===(n=null==i?void 0:i.values)||void 0===n?void 0:n[e])||e]}n(174),n(180);function ua(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function ca(t,e){return Math.abs(t-e)<.001}function la(t,e){var n=Object(d.n)(t),r=Object(d.n)(e);return{x:n,y:r,width:Object(d.m)(t)-n,height:Object(d.m)(e)-r}}function fa(t){return(t+2*Math.PI)%(2*Math.PI)}var ha={box:function(t,e,n,r){return la([t,n],[e,r])},length:function(t,e,n,r){return ua(t,e,n,r)},pointAt:function(t,e,n,r,i){return{x:(1-i)*t+i*n,y:(1-i)*e+i*r}},pointDistance:function(t,e,n,r,i,o){var a=(n-t)*(i-t)+(r-e)*(o-e);return a<0?ua(t,e,i,o):a>(n-t)*(n-t)+(r-e)*(r-e)?ua(n,r,i,o):this.pointToLine(t,e,n,r,i,o)},pointToLine:function(t,e,n,r,i,o){var a=[n-t,r-e];if(u.exactEquals(a,[0,0]))return Math.sqrt((i-t)*(i-t)+(o-e)*(o-e));var s=[-a[1],a[0]];u.normalize(s,s);var c=[i-t,o-e];return Math.abs(u.dot(c,s))},tangentAngle:function(t,e,n,r){return Math.atan2(r-e,n-t)}};function da(t,e,n,r,i,o){var a=-1,s=1/0,u=[n,r],c=20;o&&o>200&&(c=o/10);for(var l=1/c,f=l/10,h=0;h<=c;h++){var d=h*l,p=[i.apply(null,t.concat([d])),i.apply(null,e.concat([d]))];(m=ua(u[0],u[1],p[0],p[1]))<s&&(a=d,s=m)}if(0===a)return{x:t[0],y:e[0]};if(1===a){var v=t.length;return{x:t[v-1],y:e[v-1]}}s=1/0;for(h=0;h<32&&!(f<1e-4);h++){var y=a-f,g=a+f,m=(p=[i.apply(null,t.concat([y])),i.apply(null,e.concat([y]))],ua(u[0],u[1],p[0],p[1]));if(y>=0&&m<s)a=y,s=m;else{var _=[i.apply(null,t.concat([g])),i.apply(null,e.concat([g]))],E=ua(u[0],u[1],_[0],_[1]);g<=1&&E<s?(a=g,s=E):f*=.5}}return{x:i.apply(null,t.concat([a])),y:i.apply(null,e.concat([a]))}}function pa(t,e,n,r,i){var o=1-i;return o*o*o*t+3*e*i*o*o+3*n*i*i*o+r*i*i*i}function va(t,e,n,r,i){var o=1-i;return 3*(o*o*(e-t)+2*o*i*(n-e)+i*i*(r-n))}function ya(t,e,n,r){var i,o,a,s=-3*t+9*e-9*n+3*r,u=6*t-12*e+6*n,c=3*e-3*t,l=[];if(ca(s,0))ca(u,0)||(i=-c/u)>=0&&i<=1&&l.push(i);else{var f=u*u-4*s*c;ca(f,0)?l.push(-u/(2*s)):f>0&&(o=(-u-(a=Math.sqrt(f)))/(2*s),(i=(-u+a)/(2*s))>=0&&i<=1&&l.push(i),o>=0&&o<=1&&l.push(o))}return l}function ga(t,e,n,r,i,o,a,s,u){var c=pa(t,n,i,a,u),l=pa(e,r,o,s,u),f=ha.pointAt(t,e,n,r,u),h=ha.pointAt(n,r,i,o,u),d=ha.pointAt(i,o,a,s,u),p=ha.pointAt(f.x,f.y,h.x,h.y,u),v=ha.pointAt(h.x,h.y,d.x,d.y,u);return[[t,e,f.x,f.y,p.x,p.y,c,l],[c,l,v.x,v.y,d.x,d.y,a,s]]}function ma(t,e,n,r,i,o,a,s,u){if(0===u)return function(t,e){for(var n=0,r=t.length,i=0;i<r;i++){n+=ua(t[i],e[i],t[(i+1)%r],e[(i+1)%r])}return n/2}([t,n,i,a],[e,r,o,s]);var c=ga(t,e,n,r,i,o,a,s,.5),l=Object(f.i)(Object(f.i)([],Object(f.g)(c[0]),!1),[u-1],!1),h=Object(f.i)(Object(f.i)([],Object(f.g)(c[1]),!1),[u-1],!1);return ma.apply(null,l)+ma.apply(null,h)}var _a={extrema:ya,box:function(t,e,n,r,i,o,a,s){for(var u=[t,a],c=[e,s],l=ya(t,n,i,a),f=ya(e,r,o,s),h=0;h<l.length;h++)u.push(pa(t,n,i,a,l[h]));for(h=0;h<f.length;h++)c.push(pa(e,r,o,s,f[h]));return la(u,c)},length:function(t,e,n,r,i,o,a,s){return ma(t,e,n,r,i,o,a,s,3)},nearestPoint:function(t,e,n,r,i,o,a,s,u,c,l){return da([t,n,i,a],[e,r,o,s],u,c,pa,l)},pointDistance:function(t,e,n,r,i,o,a,s,u,c,l){var f=this.nearestPoint(t,e,n,r,i,o,a,s,u,c,l);return ua(f.x,f.y,u,c)},interpolationAt:pa,pointAt:function(t,e,n,r,i,o,a,s,u){return{x:pa(t,n,i,a,u),y:pa(e,r,o,s,u)}},divide:function(t,e,n,r,i,o,a,s,u){return ga(t,e,n,r,i,o,a,s,u)},tangentAngle:function(t,e,n,r,i,o,a,s,u){var c=va(t,n,i,a,u),l=va(e,r,o,s,u);return fa(Math.atan2(l,c))}};function Ea(t){if(t.length<2)return 0;for(var e=0,n=0;n<t.length-1;n++){var r=t[n],i=t[n+1];e+=ua(r[0],r[1],i[0],i[1])}return e}var Ta=function(t){return Ea(t)};function ba(t,e,n){var r=t[0],i=t[1];return[r+(e[0]-r)*n,i+(e[1]-i)*n]}function Ra(t){return t.map((function(t,e,n){var r=e&&n[e-1].slice(-2).concat(t.slice(1)),i=e?_a.length.apply(_a,Object(f.i)([],Object(f.g)(r),!1)):0;return{s:t,ss:e?i?function(t,e){void 0===e&&(e=.5);var n=t.slice(0,2),r=t.slice(2,4),i=t.slice(4,6),o=t.slice(6,8),a=ba(n,r,e),s=ba(r,i,e),u=ba(i,o,e),c=ba(a,s,e),l=ba(s,u,e),f=ba(c,l,e);return[["C"].concat(a,c,f),["C"].concat(l,u,o)]}(r):[t,t]:[t],l:i}}))}function Aa(t){return function(t){var e=0,n=0,r=0,i=0,o=0;return t.map((function(t){var a;switch(t[0]){case"M":case"Z":return r="M"===t[0]?t[1]:r,i="M"===t[0]?t[2]:i,e=r,n=i,0;default:return o=Sa.apply(0,[e,n].concat(t.slice(1))),a=Object(f.g)(t.slice(-2),2),e=a[0],n=a[1],o}})).reduce((function(t,e){return t+e}),0)}(t)>=0}function Sa(t,e,n,r,i,o,a,s){return 3*((s-e)*(n+i)-(a-t)*(r+o)+r*(t-i)-n*(e-o)+s*(i+t/3)-a*(o+e/3))/20}function Oa(t,e){var n=t.length-1,r=[],i=0,o=function(t){var e=t.length,n=e-1;return t.map((function(r,i){return t.map((function(r,o){var a,s=i+o;return 0===o||t[s]&&"M"===t[s][0]?(a=t[s],["M"].concat(a.slice(-2))):(s>=e&&(s-=n),t[s])}))}))}(t);return o.forEach((function(o,a){t.slice(1).forEach((function(r,o){i+=function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}(t[(a+o)%n].slice(-2),e[o%n].slice(-2))})),r[a]=i,i=0})),o[r.indexOf(Math.min.apply(null,r))]}function Ma(t,e,n,r){var i=(-1+Math.sqrt(2))/3*4,o=t*i,a=e*i,s=n-t,u=n+t,c=r-e,l=r+e;return[["M",s,r],["C",s,r-a,n-o,c,n,c],["C",n+o,c,u,r-a,u,r],["C",u,r+a,n+o,l,n,l],["C",n-o,l,s,r+a,s,r],["Z"]]}function Ca(t){var e=t.getLocalTransform(),n=(t.style.anchor,[]);switch(t.nodeName){case Ni.LINE:var r=t.parsedStyle;n=function(t,e,n,r){return[["M",t,e],["L",n,r]]}(r.x1,r.y1,r.x2,r.y2);break;case Ni.CIRCLE:var i=t.parsedStyle,a=i.rInPixels,s=i.x,u=void 0===s?0:s,c=i.y;n=Ma(a,a,u,void 0===c?0:c);break;case Ni.ELLIPSE:var l=t.parsedStyle,f=l.rxInPixels,h=l.ryInPixels,d=l.x,p=void 0===d?0:d,v=l.y;n=Ma(f,h,p,void 0===v?0:v);break;case Ni.POLYLINE:case Ni.POLYGON:n=function(t){return t.map((function(t,e){return[0===e?"M":"L",t[0],t[1]]}))}(t.parsedStyle.points.points);break;case Ni.RECT:var y=t.parsedStyle;n=function(t,e,n,r,i){return i?[["M",n,i+r],["A",i,i,0,0,1,i+n,r],["L",t-i+n,r],["A",i,i,0,0,1,t+n,i+r],["L",t+n,e-i+r],["A",i,i,0,0,1,t-i+n,e+r],["L",i+n,e+r],["A",i,i,0,0,1,n,e-i+r],["Z"]]:[["M",n,r],["L",n+t,r],["L",n+t,r+e],["L",n,r+e],["Z"]]}(y.widthInPixels,y.heightInPixels,y.x,y.y,y.radius);break;case Ni.PATH:n=t.parsedStyle.path.curve}if(n.length)return function(t,e,n,r){var i=r.x,a=r.y;return t.reduce((function(t,n){var r="";if("M"===n[0]||"L"===n[0]){var s=o.fromValues(n[1]-i,n[2]-a,0);o.transformMat4(s,s,e),r=""+n[0]+s[0]+","+s[1]}else if("Z"===n[0])r=n[0];else if("C"===n[0]){var u=o.fromValues(n[1]-i,n[2]-a,0),c=o.fromValues(n[3]-i,n[4]-a,0),l=o.fromValues(n[5]-i,n[6]-a,0);o.transformMat4(u,u,e),o.transformMat4(c,c,e),o.transformMat4(l,l,e),r=""+n[0]+u[0]+","+u[1]+","+c[0]+","+c[1]+","+l[0]+","+l[1]}else if("A"===n[0]){var f=o.fromValues(n[6]-i,n[7]-a,0);o.transformMat4(f,f,e),r=""+n[0]+n[1]+","+n[2]+","+n[3]+","+n[4]+","+n[5]+","+f[0]+","+f[1]}return t+r}),"")}(n,e,0,t.parsedStyle)}var xa=n(186),Na=xa.b,Pa=xa.a;var Ia=Na,Ba=Pa,Da=(n(97),!!globalThis.TouchEvent),wa=!!globalThis.PointerEvent,Fa={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};function La(t){var e=[];if(function(t){return Da&&t instanceof TouchEvent}(t))for(var n=0;n<t.changedTouches.length;n++){var r=t.changedTouches[n];Object(d.l)(r.button)&&(r.button=t.touches.length?1:0),Object(d.l)(r.buttons)&&(r.buttons=t.touches.length?1:0),Object(d.l)(r.isPrimary)&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),Object(d.l)(r.width)&&(r.width=r.radiusX||1),Object(d.l)(r.height)&&(r.height=r.radiusY||1),Object(d.l)(r.tiltX)&&(r.tiltX=0),Object(d.l)(r.tiltY)&&(r.tiltY=0),Object(d.l)(r.pointerType)&&(r.pointerType="touch"),Object(d.l)(r.pointerId)&&(r.pointerId=r.identifier||0),Object(d.l)(r.pressure)&&(r.pressure=r.force||.5),Object(d.l)(r.twist)&&(r.twist=0),Object(d.l)(r.tangentialPressure)&&(r.tangentialPressure=0),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(function(t){return!globalThis.MouseEvent||t instanceof MouseEvent&&(!wa||!(t instanceof globalThis.PointerEvent))}(t)){var i=t;Object(d.l)(i.isPrimary)&&(i.isPrimary=!0),Object(d.l)(i.width)&&(i.width=1),Object(d.l)(i.height)&&(i.height=1),Object(d.l)(i.tiltX)&&(i.tiltX=0),Object(d.l)(i.tiltY)&&(i.tiltY=0),Object(d.l)(i.pointerType)&&(i.pointerType="mouse"),Object(d.l)(i.pointerId)&&(i.pointerId=1),Object(d.l)(i.pressure)&&(i.pressure=.5),Object(d.l)(i.twist)&&(i.twist=0),Object(d.l)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}var ka=0,Ua=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sceneGraphService=_c.get(wi),e.entity=ka++,e.renderable=new co,e.cullable=new fo,e.transformable=new lo,e.sortable=new ho,e.geometry=new uo,e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.destroyed=!1,e.style={},e.parsedStyle={},e.attributes={},e}return Object(f.d)(e,t),e.isElement=function(t){return!!t.getAttribute},Object.defineProperty(e.prototype,"className",{get:function(){return this.getAttribute("class")||""},set:function(t){this.setAttribute("class",t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classList",{get:function(){return this.className.split(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.nodeName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t+1]||null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t-1]||null}return null},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(t){throw new Error("Method not implemented.")},e.prototype.appendChild=function(t,e){return this.sceneGraphService.attach(t,this,e),this.emit(vi.CHILD_INSERTED,{child:t}),t.dispatchEvent(new Mi.a(vi.INSERTED,this,"","","",0,"","")),t},e.prototype.insertBefore=function(t,e){if(e){var n=this.childNodes.indexOf(e);this.appendChild(t,n-1)}else this.appendChild(t);return t},e.prototype.replaceChild=function(t,e,n){var r=this.childNodes.indexOf(e);return this.removeChild(e,n),this.appendChild(t,r),e},e.prototype.removeChild=function(t,e){return void 0===e&&(e=!0),t.dispatchEvent(new Mi.a(vi.REMOVED,this,"","","",0,"","")),e&&(t.emit(vi.DESTROY,{}),t.destroyed=!0),this.emit(vi.CHILD_REMOVED,{child:t}),this.sceneGraphService.detach(t),e&&t.emitter.removeAllListeners(),t},e.prototype.removeChildren=function(t){var e=this;void 0===t&&(t=!0),this.childNodes.slice().forEach((function(n){e.removeChild(n,t)}))},e.prototype.matches=function(t){return this.sceneGraphService.matches(t,this)},e.prototype.getElementById=function(t){return this.sceneGraphService.querySelector("#"+t,this)},e.prototype.getElementsByName=function(t){return this.sceneGraphService.querySelectorAll('[name="'+t+'"]',this)},e.prototype.getElementsByClassName=function(t){return this.sceneGraphService.querySelectorAll("."+t,this)},e.prototype.getElementsByTagName=function(t){return this.sceneGraphService.querySelectorAll(t,this)},e.prototype.querySelector=function(t){return this.sceneGraphService.querySelector(t,this)},e.prototype.querySelectorAll=function(t){return this.sceneGraphService.querySelectorAll(t,this)},e.prototype.find=function(t){var e=this,n=null;return this.forEach((function(r){return!(r===e||!t(r))&&(n=r,!0)})),n},e.prototype.findAll=function(t){var e=this,n=[];return this.forEach((function(r){r!==e&&t(r)&&n.push(r)})),n},e.prototype.after=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this);e.forEach((function(e,n){var i;return null===(i=t.parentNode)||void 0===i?void 0:i.appendChild(e,r+n+1)}))}},e.prototype.before=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this),i=Object(f.g)(e),o=i[0],a=i.slice(1);this.parentNode.appendChild(o,r),(t=o).after.apply(t,Object(f.i)([],Object(f.g)(a),!1))}},e.prototype.replaceWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.after.apply(this,Object(f.i)([],Object(f.g)(t),!1)),this.remove()},e.prototype.append=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){return t.appendChild(e)}))},e.prototype.prepend=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e,n){return t.appendChild(e,n)}))},e.prototype.replaceChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,Object(f.i)([],Object(f.g)(t),!1))},e.prototype.remove=function(t){return void 0===t&&(t=!0),this.parentNode?this.parentNode.removeChild(this,t):this},e.prototype.destroy=function(){this.emit(vi.DESTROY,{}),this.remove(!1),this.emitter.removeAllListeners(),this.destroyed=!0},e.prototype.getGeometryBounds=function(){return this.sceneGraphService.getGeometryBounds(this)},e.prototype.getRenderBounds=function(){return this.sceneGraphService.getBounds(this,!0)},e.prototype.getBounds=function(){return this.sceneGraphService.getBounds(this)},e.prototype.getLocalBounds=function(){return this.sceneGraphService.getLocalBounds(this)},e.prototype.getBoundingClientRect=function(){return this.sceneGraphService.getBoundingClientRect(this)},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.getAttributeNames=function(){return Object.keys(this.attributes)},e.prototype.getAttribute=function(t){var e=Object(f.g)(sa(t,""),1)[0],n=this.attributes[e];return Object(d.h)(n)?null:n},e.prototype.hasAttribute=function(t){return this.getAttributeNames().includes(t)},e.prototype.hasAttributes=function(){return!!this.getAttributeNames().length},e.prototype.removeAttribute=function(t){delete this.attributes[t]},e.prototype.setAttribute=function(t,e,n){void 0===n&&(n=!1),this.attributes[t]=e},e.prototype.getAttributeNS=function(t,e){throw new Error("Method not implemented.")},e.prototype.getAttributeNode=function(t){throw new Error("Method not implemented.")},e.prototype.getAttributeNodeNS=function(t,e){throw new Error("Method not implemented.")},e.prototype.hasAttributeNS=function(t,e){throw new Error("Method not implemented.")},e.prototype.removeAttributeNS=function(t,e){throw new Error("Method not implemented.")},e.prototype.removeAttributeNode=function(t){throw new Error("Method not implemented.")},e.prototype.setAttributeNS=function(t,e,n){throw new Error("Method not implemented.")},e.prototype.setAttributeNode=function(t){throw new Error("Method not implemented.")},e.prototype.setAttributeNodeNS=function(t){throw new Error("Method not implemented.")},e.prototype.toggleAttribute=function(t,e){throw new Error("Method not implemented.")},e}(so),Ga=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.currentTime=r,o.timelineTime=i,o.target=n,o.type="finish",o.bubbles=!1,o.currentTarget=n,o.defaultPrevented=!1,o.eventPhase=o.AT_TARGET,o.timeStamp=Date.now(),o.currentTime=r,o.timelineTime=i,o}return Object(f.d)(e,t),e}(io.a),ja=0,Va=function(){function t(t,e){this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._playbackRate=1,this._inTimeline=!0,this.effect=t,t.animation=this,this.timeline=e,this.id=""+ja++,this._inEffect=!!this.effect.update(0),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}return Object.defineProperty(t.prototype,"pending",{get:function(){return null===this._startTime&&!this._paused&&0!==this.playbackRate||this.currentTimePending},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playState",{get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise((function(e,n){t.resolveReadyPromise=function(){e(t)},t.rejectReadyPromise=function(){n(new Error)}})),this.pending||this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"finished",{get:function(){var t=this;return this.finishedPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise((function(e,n){t.resolveFinishedPromise=function(){e(t)},t.rejectFinishedPromise=function(){n(new Error)}})),"finished"===this.playState&&this.resolveFinishedPromise()),this.finishedPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(t){var e;t=Number(t),isNaN(t)||(this.timeline.restart(),this._paused||null===this._startTime||(this._startTime=Number(null===(e=this.timeline)||void 0===e?void 0:e.currentTime)-t/this.playbackRate),this.currentTimePending=!1,this._currentTime!==t&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(t,!0),this.timeline.applyDirtiedAnimation(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){if(null!==t){if(this.updatePromises(),t=Number(t),isNaN(t))return;if(this._paused||this._idle)return;this._startTime=t,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){if(t!==this._playbackRate){this.updatePromises();var e=this.currentTime;this._playbackRate=t,this.startTime=null,"paused"!==this.playState&&"idle"!==this.playState&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),null!==e&&(this.currentTime=e),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isFinished",{get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this.totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){var t;return Number(null===(t=this.effect)||void 0===t?void 0:t.getComputedTiming().endTime)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_needsTick",{get:function(){return this.pending||"running"===this.playState||!this._finishedFlag},enumerable:!1,configurable:!0}),t.prototype.updatePromises=function(){var t=this.oldPlayState,e=this.pending?"pending":this.playState;return this.readyPromise&&e!==t&&("idle"===e?(this.rejectReadyPromise(),this.readyPromise=void 0):"pending"===t?this.resolveReadyPromise():"pending"===e&&(this.readyPromise=void 0)),this.finishedPromise&&e!==t&&("idle"===e?(this.rejectFinishedPromise(),this.finishedPromise=void 0):"finished"===e?this.resolveFinishedPromise():"finished"===t&&(this.finishedPromise=void 0)),this.oldPlayState=e,this.readyPromise||this.finishedPromise},t.prototype.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),-1===this.timeline.animations.indexOf(this)&&this.timeline.animations.push(this),this.updatePromises()},t.prototype.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._isFinished||this._paused||this._idle?this._idle&&(this.rewind(),this._idle=!1):this.currentTimePending=!0,this._startTime=null,this._paused=!0,this.updatePromises()},t.prototype.finish=function(){this.updatePromises(),this._idle||(this.currentTime=this._playbackRate>0?this.totalDuration:0,this._startTime=this.totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},t.prototype.cancel=function(){this.updatePromises(),this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises())},t.prototype.reverse=function(){this.updatePromises();var t=this.currentTime;this.playbackRate*=-1,this.play(),null!==t&&(this.currentTime=t),this.updatePromises()},t.prototype.updatePlaybackRate=function(t){this.playbackRate=t},t.prototype.targetAnimations=function(){var t;return(null===(t=this.effect)||void 0===t?void 0:t.target).getAnimations()},t.prototype.markTarget=function(){var t=this.targetAnimations();-1===t.indexOf(this)&&t.push(this)},t.prototype.unmarkTarget=function(){var t=this.targetAnimations(),e=t.indexOf(this);-1!==e&&t.splice(e,1)},t.prototype.tick=function(t,e){this._idle||this._paused||(null===this._startTime?e&&(this.startTime=t-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((t-this._startTime)*this.playbackRate)),e&&(this.currentTimePending=!1,this.fireEvents(t))},t.prototype.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else{if(!(this.totalDuration<1/0))throw new Error("Unable to rewind negative playback rate animation with infinite duration");this.currentTime=this.totalDuration}},t.prototype.persist=function(){throw new Error("Method not implemented.")},t.prototype.addEventListener=function(t,e,n){throw new Error("Method not implemented.")},t.prototype.removeEventListener=function(t,e,n){throw new Error("Method not implemented.")},t.prototype.dispatchEvent=function(t){throw new Error("Method not implemented.")},t.prototype.commitStyles=function(){throw new Error("Method not implemented.")},t.prototype.ensureAlive=function(){var t,e;this.playbackRate<0&&0===this.currentTime?this._inEffect=!!(null===(t=this.effect)||void 0===t?void 0:t.update(-1)):this._inEffect=!!(null===(e=this.effect)||void 0===e?void 0:e.update(this.currentTime)),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,this.timeline.animations.push(this))},t.prototype.tickCurrentTime=function(t,e){t!==this._currentTime&&(this._currentTime=t,this._isFinished&&!e&&(this._currentTime=this._playbackRate>0?this.totalDuration:0),this.ensureAlive())},t.prototype.fireEvents=function(t){var e=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var n=new Ga(null,this,this.currentTime,t);setTimeout((function(){e.onfinish&&e.onfinish(n)}))}this._finishedFlag=!0}}else{if(this.onframe&&"running"===this.playState){var r=new Ga(null,this,this.currentTime,t);this.onframe(r)}this._finishedFlag=!1}},t}();function Wa(t,e){return Number(t.id)-Number(e.id)}var Xa=function(){function t(){var t=this;this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.webAnimationsNextTick=function(e){t.currentTime=e,t.discardAnimations(),0===t.animations.length?t.timelineTicking=!1:t.requestAnimationFrame(t.webAnimationsNextTick)},this.processRafCallbacks=function(e){var n=t.rafCallbacks;t.rafCallbacks=[],e<Number(t.currentTime)&&(e=Number(t.currentTime)),t.animations.sort(Wa),t.animations=t.tick(e,!0,t.animations)[0],n.forEach((function(t){t[1](e)})),t.applyPendingEffects()}}return t.prototype.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},t.prototype.isTicking=function(){return this.inTick},t.prototype.play=function(t){var e=new Va(t,this);return this.animations.push(e),this.restartWebAnimationsNextTick(),e.updatePromises(),e.play(),e.updatePromises(),e},t.prototype.applyDirtiedAnimation=function(t){var e=this;if(!this.inTick){t.markTarget();var n=t.targetAnimations();n.sort(Wa),this.tick(Number(this.currentTime),!1,n.slice())[1].forEach((function(t){var n=e.animations.indexOf(t);-1!==n&&e.animations.splice(n,1)})),this.applyPendingEffects()}},t.prototype.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame((function(){})),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},t.prototype.destroy=function(){Ba(this.frameId)},t.prototype.applyPendingEffects=function(){this.pendingEffects.forEach((function(t){null==t||t.applyInterpolations()})),this.pendingEffects=[]},t.prototype.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter((function(t){return t.updatePromises()}))},t.prototype.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter((function(t){return"finished"!==t.playState&&"idle"!==t.playState}))},t.prototype.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},t.prototype.rAF=function(t){var e=this.rafId++;return 0===this.rafCallbacks.length&&(this.frameId=Ia(this.processRafCallbacks)),this.rafCallbacks.push([e,t]),e},t.prototype.requestAnimationFrame=function(t){var e=this;return this.rAF((function(n){e.updateAnimationsPromises(),t(n),e.updateAnimationsPromises()}))},t.prototype.tick=function(t,e,n){var r,i,o=this;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=t,this.ticking=!1;var a=[],s=[],u=[],c=[];return n.forEach((function(n){n.tick(t,e),n._inEffect?(s.push(n.effect),n.markTarget()):(a.push(n.effect),n.unmarkTarget()),n._needsTick&&(o.ticking=!0);var r=n._inEffect||n._needsTick;n._inTimeline=r,r?u.push(n):c.push(n)})),(r=this.pendingEffects).push.apply(r,Object(f.i)([],Object(f.g)(a),!1)),(i=this.pendingEffects).push.apply(i,Object(f.i)([],Object(f.g)(s),!1)),this.ticking&&this.requestAnimationFrame((function(){})),this.inTick=!1,[u,c]},t}(),Ha=function(){function t(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=Yo,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.currentIteration=null,this.progress=null}return Object.defineProperty(t.prototype,"easing",{get:function(){return this._easing},set:function(t){this.easingFunction=Jo(t),this._easing=t},enumerable:!1,configurable:!0}),t}();function Ya(t,e){if(null===t)return[];Array.isArray(t)||(t=function(t){var e=[];for(var n in t)if(!(n in["easing","offset","composite"])){var r=t[n];Array.isArray(r)||(r=[r]);for(var i=r.length,o=0;o<i;o++){if(!e[o]){var a={};"offset"in t&&(a.offset=Number(t.offset)),"easing"in t&&(a.easing=t.easing),"composite"in t&&(a.composite=t.composite),e[o]=a}void 0!==r[o]&&null!==r[o]&&(e[o][n]=r[o])}}return e.sort((function(t,e){return(t.computedOffset||0)-(e.computedOffset||0)})),e}(t));for(var n=t.map((function(t){var n={};for(var r in(null==e?void 0:e.composite)&&(n.composite="auto"),t){var i=t[r];if("offset"===r){if(null!==i){if(i=Number(i),!isFinite(i))throw new Error("Keyframe offsets must be numbers.");if(i<0||i>1)throw new Error("Keyframe offsets must be between 0 and 1.");n.computedOffset=i}}else if("composite"===r&&-1===["replace","add","accumulate","auto"].indexOf(i))throw new Error(i+" compositing is not supported");n[r]=i}return void 0===n.offset&&(n.offset=null),void 0===n.easing&&(n.easing=(null==e?void 0:e.easing)||"linear"),void 0===n.composite&&(n.composite="auto"),n})),r=!0,i=-1/0,o=0;o<n.length;o++){var a=n[o].offset;if(null!=a){if(a<i)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");i=a}else r=!1}return n=n.filter((function(t){return Number(t.offset)>=0&&Number(t.offset)<=1})),r||function(){var t,e,r=n.length;n[r-1].computedOffset=Number(null!==(t=n[r-1].offset)&&void 0!==t?t:1),r>1&&(n[0].computedOffset=Number(null!==(e=n[0].offset)&&void 0!==e?e:0));for(var i=0,o=Number(n[0].computedOffset),a=1;a<r;a++){var s=Number(n[a].computedOffset);if(null!=s&&null!=o){for(var u=1;u<a-i;u++)n[i+u].computedOffset=o+(s-o)*u/(a-i);i=a,o=s}}}(),n}var za="backwards|forwards|both|none".split("|"),qa="reverse|alternate|alternate-reverse".split("|");function Ka(t,e){return function(t,e){var n=new Ha;return e&&(n.fill="both",n.duration="auto"),"number"!=typeof t||isNaN(t)?void 0!==t&&Object.keys(t).forEach((function(e){if(void 0!==t[e]&&null!==t[e]&&"auto"!==t[e]){if(("number"==typeof n[e]||"duration"===e)&&("number"!=typeof t[e]||isNaN(t[e])))return;if("fill"===e&&-1===za.indexOf(t[e]))return;if("direction"===e&&-1===qa.indexOf(t[e]))return;n[e]=t[e]}})):n.duration=t,n}(t=function(t){"number"==typeof t&&(t=isNaN(t)?{duration:"auto"}:{duration:t});return t}(null!=t?t:{duration:"auto"}),e)}var Za=function(){function t(t,e,n){var r=this;this.composite="replace",this.iterationComposite="replace",this.target=t,this.timing=Ka(n,!1),this.timing.effect=this,this.timing.activeDuration=$o(this.timing),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=Ya(e,this.timing),this.interpolations=na(this.normalizedKeyframes,this.timing,this.target),this.computedTiming=new Proxy(this.timing,{get:function(t,e){return"duration"===e?"auto"===t.duration?0:t.duration:"fill"===e?"auto"===t.fill?"none":t.fill:"localTime"===e?r.animation&&r.animation.currentTime||null:"currentIteration"===e?r.animation&&"running"===r.animation.playState?t.currentIteration||0:null:"progress"===e?r.animation&&"running"===r.animation.playState?t.progress||0:null:t[e]},set:function(){return!0}})}return t.prototype.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},t.prototype.update=function(t){return null!==t&&(this.timeFraction=ta(this.timing.activeDuration,t,this.timing),null!==this.timeFraction)},t.prototype.getKeyframes=function(){return this.normalizedKeyframes},t.prototype.setKeyframes=function(t){this.normalizedKeyframes=Ya(t)},t.prototype.getComputedTiming=function(){return this.computedTiming},t.prototype.getTiming=function(){return this.timing},t.prototype.updateTiming=function(t){var e=this;Object.keys(t||{}).forEach((function(n){e.timing=t[n]}))},t}(),Qa={anchor:[0,0,0],origin:[0,0,0],opacity:1,fillOpacity:1,strokeOpacity:1,fill:"transparent",stroke:"transparent"},Ja=function(t){function e(e){var n,r,i,o=t.call(this)||this;return o.activeAnimations=[],o.config=e,o.config.interactive=null!==(n=o.config.capture)&&void 0!==n?n:o.config.interactive,o.id=o.config.id||"",o.name=o.config.name||"",(o.config.className||o.config.class)&&(o.className=o.config.className||o.config.class),o.interactive=null===(r=o.config.interactive)||void 0===r||r,o.nodeName=o.config.type||Ni.GROUP,o.config.style=Object(f.a)(Object(f.a)(Object(f.a)(Object(f.a)({},Qa),{zIndex:null!==(i=o.config.zIndex)&&void 0!==i?i:0,visibility:!1===o.config.visible?"hidden":"visible"}),o.config.style),o.config.attrs),o.style=new Proxy(Object(f.a)(Object(f.a)({},o.attributes),{setProperty:function(t,e){o.setAttribute(t,e)},getPropertyValue:function(t){return o.getAttribute(t)},removeProperty:function(t){o.removeAttribute(t)},item:function(){return""}}),{get:function(t,e){return e in t?t[e]:o.getAttribute(e)},set:function(t,e,n){return o.setAttribute(e,n),!0}}),o.initAttributes(o.config.style),_c.get(h).add(o.entity,o),o}return Object(f.d)(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),_c.get(h).remove(this.entity),this.getAnimations().forEach((function(t){t.cancel()}))},e.prototype.cloneNode=function(t){var e=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:Object(f.a)({},this.attributes)});return t&&this.children.forEach((function(n){var r=n.cloneNode(t);e.appendChild(r)})),e},e.prototype.initAttributes=function(t){var e=this;void 0===t&&(t={});var n=this.renderable;for(var r in t){var i=Object(f.g)(sa(r,t[r]),2),o=i[0],a=i[1];this.attributes[o]=a,this.parseStyleProperty(o,a)}var s={x:1/0,y:1/0};Object.keys(t).sort((function(t,e){return(s[t]||0)-(s[e]||0)})).forEach((function(t){var n=Object(f.g)(sa(t,""),1)[0];e.updateStyleProperty(n,void 0,e.parsedStyle[n])})),n.dirty=!0},e.prototype.setAttribute=function(e,n,r){void 0===r&&(r=!1);var i=Object(f.g)(sa(e,n),2),o=i[0],a=i[1];!r&&Object(d.e)(a,this.attributes[o])&&"transformOrigin"!==o&&"visibility"!==o||("visibility"===o?this.forEach((function(t){t.changeAttribute(o,a)})):this.changeAttribute(o,a),t.prototype.setAttribute.call(this,o,a))},e.prototype.parseStyleProperty=function(t,e){var n=Tc[t];this.parsedStyle[t]=n?n(e,this,t):e},e.prototype.updateStyleProperty=function(t,e,n){var r=this,i=bc[t];i&&i.forEach((function(i){i(e,n,r,r.sceneGraphService,t)}))},e.prototype.changeAttribute=function(t,e){var n=this,r=this.renderable,i=this.attributes[t],o=this.parsedStyle[t];this.attributes[t]=e,this.parseStyleProperty(t,e);var a=this.parsedStyle[t];this.updateStyleProperty(t,o,a),this.attributes.clipPathTargets&&this.attributes.clipPathTargets.length&&this.attributes.clipPathTargets.forEach((function(t){xi(t),t.dispatchEvent(new Mi.a(vi.ATTR_MODIFIED,t,n,n,"clipPath",Mi.a.MODIFICATION,n,n))})),r.dirty=!0,this.dispatchEvent(new Mi.a(vi.ATTR_MODIFIED,this,i,e,t,Mi.a.MODIFICATION,o,a))},e.prototype.getBBox=function(){var t=this.getBounds(),e=Object(f.g)(t.getMin(),2),n=e[0],r=e[1],i=Object(f.g)(t.getMax(),2),o=i[0],a=i[1];return new Ri(n,r,o-n,a-r)},e.prototype.setOrigin=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.sceneGraphService.setOrigin(this,vo(t,e,n)),this.attributes.origin=this.getOrigin(),this},e.prototype.getOrigin=function(){return this.sceneGraphService.getOrigin(this)},e.prototype.setPosition=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.sceneGraphService.setPosition(this,vo(t,e,n)),this.syncLocalPosition(),this},e.prototype.setLocalPosition=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.sceneGraphService.setLocalPosition(this,vo(t,e,n)),this.syncLocalPosition(),this},e.prototype.translate=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.sceneGraphService.translate(this,vo(t,e,n)),this.syncLocalPosition(),this},e.prototype.translateLocal=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.sceneGraphService.translateLocal(this,vo(t,e,n)),this.syncLocalPosition(),this},e.prototype.getPosition=function(){return this.sceneGraphService.getPosition(this)},e.prototype.getLocalPosition=function(){return this.sceneGraphService.getLocalPosition(this)},e.prototype.scale=function(t,e,n){return this.scaleLocal(t,e,n)},e.prototype.scaleLocal=function(t,e,n){return"number"==typeof t&&(t=vo(t,e=e||t,n=n||t)),this.sceneGraphService.scaleLocal(this,t),this},e.prototype.setLocalScale=function(t,e,n){return"number"==typeof t&&(t=vo(t,e=e||t,n=n||t)),this.sceneGraphService.setLocalScale(this,t),this},e.prototype.getLocalScale=function(){return this.sceneGraphService.getLocalScale(this)},e.prototype.getScale=function(){return this.sceneGraphService.getScale(this)},e.prototype.getEulerAngles=function(){var t=Object(f.g)(go(o.create(),this.sceneGraphService.getWorldTransform(this)),3);t[0],t[1];return yo(t[2])},e.prototype.getLocalEulerAngles=function(){var t=Object(f.g)(go(o.create(),this.sceneGraphService.getLocalRotation(this)),3);t[0],t[1];return yo(t[2])},e.prototype.setEulerAngles=function(t){return this.sceneGraphService.setEulerAngles(this,0,0,t),this},e.prototype.setLocalEulerAngles=function(t){return this.sceneGraphService.setLocalEulerAngles(this,0,0,t),this},e.prototype.rotateLocal=function(t,e,n){return Object(d.h)(e)&&Object(d.h)(n)?this.sceneGraphService.rotateLocal(this,0,0,t):this.sceneGraphService.rotateLocal(this,t,e,n),this},e.prototype.rotate=function(t,e,n){return Object(d.h)(e)&&Object(d.h)(n)?this.sceneGraphService.rotate(this,0,0,t):this.sceneGraphService.rotate(this,t,e,n),this},e.prototype.setRotation=function(t,e,n,r){return this.sceneGraphService.setRotation(this,t,e,n,r),this},e.prototype.setLocalRotation=function(t,e,n,r){return this.sceneGraphService.setLocalRotation(this,t,e,n,r),this},e.prototype.getRotation=function(){return this.sceneGraphService.getRotation(this)},e.prototype.getLocalRotation=function(){return this.sceneGraphService.getLocalRotation(this)},e.prototype.getLocalTransform=function(){return this.sceneGraphService.getLocalTransform(this)},e.prototype.getWorldTransform=function(){return this.sceneGraphService.getWorldTransform(this)},e.prototype.resetLocalTransform=function(){this.sceneGraphService.resetLocalTransform(this)},e.prototype.syncLocalPosition=function(){var t=this.getLocalPosition();this.attributes.x=t[0],this.attributes.y=t[1]},e.prototype.getAnimations=function(){return this.activeAnimations},e.prototype.animate=function(t,e){var n,r,i=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;this.attributes.clipPathTargets&&this.attributes.clipPathTargets.length&&(i=null===(r=this.attributes.clipPathTargets[0].ownerDocument)||void 0===r?void 0:r.timeline);return this.parsedStyle.transform=void 0,i?i.play(new Za(this,t,e)):null},e.prototype.show=function(){this.style.visibility="visible"},e.prototype.hide=function(){this.style.visibility="hidden"},e.prototype.isVisible=function(){var t=this.cullable;return"visible"===this.getAttribute("visibility")&&(!t||t&&!t.isCulled())},e.prototype.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,Object(f.i)([],Object(f.g)(this.parentNode.children.map((function(t){return Number(t.style.zIndex)}))),!1))+1),this},e.prototype.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,Object(f.i)([],Object(f.g)(this.parentNode.children.map((function(t){return Number(t.style.zIndex)}))),!1))-1),this},e.prototype.getCount=function(){return this.childElementCount},e.prototype.getParent=function(){return this.parentElement},e.prototype.getChildren=function(){return this.children},e.prototype.getFirst=function(){return this.firstElementChild},e.prototype.getLast=function(){return this.lastElementChild},e.prototype.getChildByIndex=function(t){return this.children[t]||null},e.prototype.add=function(t,e){return this.appendChild(t,e)},e.prototype.setClip=function(t){this.style.clipPath=t},e.prototype.getClip=function(){return this.style.clipPath||null},e.prototype.set=function(t,e){this.config[t]=e},e.prototype.get=function(t){return this.config[t]},e.prototype.getConfig=function(){return this.config},e.prototype.attr=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Object(f.g)(e,2),i=r[0],o=r[1];return i?Object(d.j)(i)?(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),this):2===e.length?(this.setAttribute(i,o),this):this.attributes[i]:this.attributes},e.prototype.moveTo=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.setPosition(t,e,n),this},e.prototype.move=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.setPosition(t,e,n),this},e.prototype.setZIndex=function(t){return this.style.zIndex=t,this},e.prototype.getMatrix=function(){var t=this.getWorldTransform(),e=Object(f.g)(i.getTranslation(o.create(),t),2),n=e[0],a=e[1],u=Object(f.g)(i.getScaling(o.create(),t),2),c=u[0],l=u[1],h=i.getRotation(s.create(),t),d=Object(f.g)(go(o.create(),h),3),p=d[0],v=(d[1],d[2]);return function(t,e,n,i,o){var a=Math.cos(t),s=Math.sin(t);return r.fromValues(i*a,o*s,0,-i*s,o*a,0,e,n,1)}(p||v,n,a,c,l)},e.prototype.setMatrix=function(t){var e=t[0],n=t[3],r=t[1],i=t[4],o=Math.sqrt(e*e+n*n),a=Math.sqrt(r*r+i*i);e*i-n*r<0&&(e<i?o=-o:a=-a),o&&(e*=1/o,n*=1/o),a&&(r*=1/a,i*=1/a);var s=Math.atan2(n,e);this.setEulerAngles(s).setPosition(t[6],t[7]).setLocalScale(o,a)},e}(Ua),$a=(function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n.handleMounted=function(t){t.target===t.currentTarget&&n.connectedCallback&&n.connectedCallback()},n.handleUnmounted=function(t){t.target===t.currentTarget&&n.disconnectedCallback&&n.disconnectedCallback()},n.handleAttributeChanged=function(t){if(t.target===n){var e=t.attrName,r=t.prevValue,i=t.newValue;n.attributeChangedCallback&&n.attributeChangedCallback(e,r,i)}},n.attributeChangedCallback&&n.addEventListener(vi.ATTR_MODIFIED,n.handleAttributeChanged),n.connectedCallback&&n.addEventListener(vi.MOUNTED,n.handleMounted),n.disconnectedCallback&&n.addEventListener(vi.UNMOUNTED,n.handleUnmounted),n}Object(f.d)(e,t)}(Ja),function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.CIRCLE,style:Object(f.a)({r:0,anchor:[.5,.5],lineWidth:0},n)},r))||this}return Object(f.d)(e,t),e}(Ja)),ts=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.ELLIPSE,style:Object(f.a)({rx:0,ry:0,anchor:[.5,.5],lineWidth:0},n)},r))||this}return Object(f.d)(e,t),e}(Ja),es=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.GROUP,style:Object(f.a)({width:"auto",height:"auto",textAlign:"inherit",fontSize:"inherit"},n)},r))||this}return Object(f.d)(e,t),e}(Ja),ns=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.IMAGE,style:Object(f.a)({img:"",width:"auto",height:"auto",lineWidth:0},n)},r))||this}return Object(f.d)(e,t),e}(Ja),rs=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.LINE,style:Object(f.a)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0,lineJoin:Ii.MITER,lineCap:Pi.BUTT,lineWidth:1,isBillboard:!1},n)},r))||this}return Object(f.d)(e,t),e.prototype.getPoint=function(t){var e=this.parsedStyle,n=e.x1,r=e.y1,i=e.x2,o=e.y2,a=ha.pointAt(n,r,i,o,t);return new bi.a(a.x,a.y)},e.prototype.getTotalLength=function(){var t=this.parsedStyle,e=t.x1,n=t.y1,r=t.x2,i=t.y2;return ha.length(e,n,r,i)},e}(Ja),is=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.PATH,style:Object(f.a)({path:"",lineJoin:Ii.MITER,lineCap:Pi.BUTT,lineWidth:1,miterLimit:4},n)},r))||this}return Object(f.d)(e,t),e.prototype.getTotalLength=function(){return this.parsedStyle.path.totalLength},e.prototype.getPoint=function(t){var e=0,n=0,r=this.parsedStyle.path.curve;if(!this.parsedStyle.path.curveSegments.length)return r?new bi.a(r[0][1],r[0][2]):null;this.parsedStyle.path.curveSegments.forEach((function(r,i){t>=r[0]&&t<=r[1]&&(e=(t-r[0])/(r[1]-r[0]),n=i)}));var i=r[n];if(Object(d.h)(i)||Object(d.h)(n))return null;var o=i.length,a=r[n+1],s=_a.pointAt(i[o-2],i[o-1],a[1],a[2],a[3],a[4],a[5],a[6],e),u=s.x,c=s.y;return new bi.a(u,c)},e.prototype.getStartTangent=function(){var t=this.parsedStyle.path.segments,e=[];if(t.length>1){var n=t[0].currentPoint,r=t[1].currentPoint,i=t[1].startTangent;e=[],i?(e.push([n[0]-i[0],n[1]-i[1]]),e.push([n[0],n[1]])):(e.push([r[0],r[1]]),e.push([n[0],n[1]]))}return e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.path.segments,e=t.length,n=[];if(e>1){var r=t[e-2].currentPoint,i=t[e-1].currentPoint,o=t[e-1].endTangent;n=[],o?(n.push([i[0]-o[0],i[1]-o[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n},e}(Ja),os=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.POLYGON,style:Object(f.a)({points:[],miterLimit:4,lineWidth:1},n)},r))||this}return Object(f.d)(e,t),e}(Ja),as=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.POLYLINE,style:Object(f.a)({points:[],lineJoin:Ii.MITER,lineCap:Pi.BUTT,lineWidth:1,miterLimit:4},n)},r))||this}return Object(f.d)(e,t),e.prototype.getTotalLength=function(){return this.parsedStyle.points.totalLength},e.prototype.getPoint=function(t){var e=this.parsedStyle.points,n=e.points,r=e.segments,i=0,o=0;r.forEach((function(e,n){t>=e[0]&&t<=e[1]&&(i=(t-e[0])/(e[1]-e[0]),o=n)}));var a=ha.pointAt(n[o][0],n[o][1],n[o+1][0],n[o+1][1],i),s=a.x,u=a.y;return new bi.a(s,u)},e.prototype.getStartTangent=function(){var t=this.parsedStyle.points.points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.points.points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},e}(Ja),ss=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]);return t.call(this,Object(f.a)({type:Ni.RECT,style:Object(f.a)({width:"auto",height:"auto",lineWidth:0},n)},r))||this}return Object(f.d)(e,t),e}(Ja),us=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]),i=t.call(this,Object(f.a)({type:Ni.TEXT,style:Object(f.a)({text:"",fontSize:"inherit",fontFamily:"inherit",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"inherit",textBaseline:"alphabetic",dropShadow:!1,dropShadowDistance:5,fill:"#000",letterSpacing:0,lineHeight:0,lineJoin:Ii.MITER,lineCap:Pi.BUTT,lineWidth:0,miterLimit:10,stroke:"#000",whiteSpace:"pre",wordWrap:!1,wordWrapWidth:0,leading:0,dx:0,dy:0},n)},r))||this;return i.LENGTHADJUST_SPACING=1,i.LENGTHADJUST_SPACINGANDGLYPHS=2,i.LENGTHADJUST_UNKNOWN=0,i}return Object(f.d)(e,t),e.prototype.getCharNumAtPosition=function(t){throw new Error("Method not implemented.")},e.prototype.getComputedTextLength=function(){var t;return(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.maxLineWidth)||0},e.prototype.getEndPositionOfChar=function(t){throw new Error("Method not implemented.")},e.prototype.getExtentOfChar=function(t){throw new Error("Method not implemented.")},e.prototype.getNumberOfChars=function(){throw new Error("Method not implemented.")},e.prototype.getRotationOfChar=function(t){throw new Error("Method not implemented.")},e.prototype.getStartPositionOfChar=function(t){throw new Error("Method not implemented.")},e.prototype.getSubStringLength=function(t,e){throw new Error("Method not implemented.")},e.prototype.selectSubString=function(t,e){throw new Error("Method not implemented.")},e.prototype.getLineBoundingRects=function(){var t;return(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.lineMetrics)||[]},e}(Ja),cs=function(t){function e(e){void 0===e&&(e={});var n=e.style,r=Object(f.h)(e,["style"]),i=t.call(this,Object(f.a)({type:Ni.HTML,style:Object(f.a)({innerHTML:"",className:"",style:""},n)},r))||this;return i.cullable.enable=!1,i}return Object(f.d)(e,t),e.prototype.getDomElement=function(){return this.parsedStyle.$el},e.prototype.getBoundingClientRect=function(){return this.parsedStyle.$el.getBoundingClientRect()},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.getBounds=function(){var t,e,n=this.getBoundingClientRect(),r=null===(e=null===(t=this.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===e?void 0:e.getContextService().getBoundingClientRect();if(r){var i=n.left-r.left,a=n.top-r.top,s=new hi;return s.setMinMax(o.fromValues(i,a,0),o.fromValues(i+n.width,a+n.height,0)),s}return null},e.prototype.getLocalBounds=function(){if(this.parentNode){var t=i.invert(i.create(),this.parentNode.getWorldTransform()),e=this.getBounds();if(!hi.isEmpty(e)){var n=new hi;return n.setFromTransformedAABB(e,t),n}}return this.getBounds()},e}(Ja),ls=function(t){function e(){var e=t.call(this)||this;return e.defaultView=null,e.ownerDocument=null,e.nodeName="document",e.timeline=new Xa,e.documentElement=new es({id:"g-root",style:{textAlign:Di.START,fontSize:"16px",fontFamily:"sans-serif"}}),e.documentElement.ownerDocument=e,e.documentElement.parentNode=e,e.childNodes=[e.documentElement],e}return Object(f.d)(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),e.prototype.createElement=function(t,e){var n=this.defaultView.customElements.get(t);return n||(console.warn("Unsupported tagName: ",t),n="tspan"===t?us:es),new n(e)},e.prototype.createElementNS=function(t,e,n){return this.createElement(e,n)},e.prototype.cloneNode=function(t){throw new Error("Method not implemented.")},e.prototype.destroy=function(){try{this.documentElement.destroy()}catch(t){}this.timeline.destroy()},e.prototype.appendChild=function(t,e){throw new Error("Use document.documentElement instead.")},e.prototype.insertBefore=function(t,e){throw new Error("Use document.documentElement instead.")},e.prototype.removeChild=function(t,e){throw new Error("Use document.documentElement instead.")},e.prototype.replaceChild=function(t,e,n){throw new Error("Use document.documentElement instead.")},e.prototype.append=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("Use document.documentElement instead.")},e.prototype.prepend=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("Use document.documentElement instead.")},e.prototype.getElementById=function(t){return this.documentElement.getElementById(t)},e.prototype.getElementsByName=function(t){return this.documentElement.getElementsByName(t)},e.prototype.getElementsByTagName=function(t){return this.documentElement.getElementsByTagName(t)},e.prototype.getElementsByClassName=function(t){return this.documentElement.getElementsByClassName(t)},e.prototype.querySelector=function(t){return this.documentElement.querySelector(t)},e.prototype.querySelectorAll=function(t){return this.documentElement.querySelectorAll(t)},e.prototype.find=function(t){return this.documentElement.find(t)},e.prototype.findAll=function(t){return this.documentElement.findAll(t)},e}(so),fs=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.client=new bi.a,e.movement=new bi.a,e.offset=new bi.a,e.global=new bi.a,e.screen=new bi.a,e}return Object(f.d)(e,t),Object.defineProperty(e.prototype,"clientX",{get:function(){return this.client.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientY",{get:function(){return this.client.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementX",{get:function(){return this.movement.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementY",{get:function(){return this.movement.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalX",{get:function(){return this.global.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalY",{get:function(){return this.global.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenX",{get:function(){return this.screen.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenY",{get:function(){return this.screen.y},enumerable:!1,configurable:!0}),e.prototype.getModifierState=function(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)},e.prototype.initMouseEvent=function(){throw new Error("Method not implemented.")},e}(io.a),hs=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.height=0,e.isPrimary=!1,e}return Object(f.d)(e,t),e.prototype.getCoalescedEvents=function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]},e.prototype.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},e}(fs),ds=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.DOM_DELTA_LINE=0,e.DOM_DELTA_PAGE=1,e.DOM_DELTA_PIXEL=2,e}return Object(f.d)(e,t),e}(fs),ps=(n(98),n(65),function(){function t(){this.registry={},this.define(Ni.CIRCLE,$a),this.define(Ni.ELLIPSE,ts),this.define(Ni.RECT,ss),this.define(Ni.IMAGE,ns),this.define(Ni.LINE,rs),this.define(Ni.GROUP,es),this.define(Ni.PATH,is),this.define(Ni.POLYGON,os),this.define(Ni.POLYLINE,as),this.define(Ni.TEXT,us),this.define(Ni.HTML,cs)}return t.prototype.define=function(t,e){this.registry[t]=e},t.prototype.get=function(t){return this.registry[t]},t}()),vs=c.d.defineToken("RenderingPluginContribution"),ys=function(){function t(){this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.hooks={init:new ro.AsyncParallelHook,prepare:new ro.SyncWaterfallHook(["object"]),beginFrame:new ro.SyncHook([]),beforeRender:new ro.SyncHook(["objectToRender"]),render:new ro.SyncHook(["objectToRender"]),afterRender:new ro.SyncHook(["objectToRender"]),endFrame:new ro.SyncHook([]),destroy:new ro.SyncHook([]),pick:new ro.AsyncSeriesWaterfallHook(["result"]),pointerDown:new ro.SyncHook(["event"]),pointerUp:new ro.SyncHook(["event"]),pointerMove:new ro.SyncHook(["event"]),pointerOut:new ro.SyncHook(["event"]),pointerOver:new ro.SyncHook(["event"]),pointerWheel:new ro.SyncHook(["event"])}}return t.prototype.init=function(){return Object(f.b)(this,void 0,void 0,(function(){var t=this;return Object(f.e)(this,(function(e){switch(e.label){case 0:return this.renderingPluginProvider.getContributions({cache:!1}).forEach((function(e){e.apply(t)})),[4,this.hooks.init.promise()];case 1:return e.sent(),this.inited=!0,[2]}}))}))},t.prototype.getStats=function(){return this.stats},t.prototype.render=function(){this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0,this.sceneGraphService.syncHierarchy(this.renderingContext.root),this.renderingContext.renderReasons.size&&this.inited&&(this.renderDisplayObject(this.renderingContext.root),this.renderingContext.dirty&&(this.hooks.endFrame.call(),this.renderingContext.dirty=!1),this.renderingContext.renderReasons.clear())},t.prototype.renderDisplayObject=function(t){var e=this,n=this.hooks.prepare.call(t);t.sortable.renderOrder=this.zIndexCounter++,this.stats.total++,n&&(this.stats.rendered++,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.call()),this.hooks.beforeRender.call(n),this.hooks.render.call(n),this.hooks.afterRender.call(n),t.renderable.dirty=!1);var r=t.sortable,i=!1;r.dirty&&(r.sorted=t.childNodes.slice().sort(Ci),i=!0,r.dirty=!1),(r.sorted||t.childNodes).forEach((function(t){e.renderDisplayObject(t)})),i&&t.forEach((function(t){t.emit(vi.RENDER_ORDER_CHANGED,{renderOrder:t.sortable.renderOrder})}))},t.prototype.destroy=function(){this.inited=!1,this.hooks.destroy.call()},t.prototype.dirtify=function(){this.renderingContext.renderReasons.add(Wi.DISPLAY_OBJECT_CHANGED)},Object(f.c)([Object(c.e)(vs),Object(f.f)("design:type",Object)],t.prototype,"renderingPluginProvider",void 0),Object(f.c)([Object(c.g)(no),Object(f.f)("design:type",Object)],t.prototype,"renderingContext",void 0),Object(f.c)([Object(c.g)(wi),Object(f.f)("design:type",Object)],t.prototype,"sceneGraphService",void 0),t=Object(f.c)([Object(c.j)()],t)}(),gs=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cursor="default",e.mappingTable={},e.mappingState={trackingData:{}},e.eventPool=new Map,e.onPointerDown=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n;return Object(f.e)(this,(function(r){switch(r.label){case 0:return t instanceof hs?[4,this.createPointerEvent(t)]:[2];case 1:return e=r.sent(),this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType?this.dispatchEvent(e,"touchstart"):"mouse"!==e.pointerType&&"pen"!==e.pointerType||(n=2===e.button,this.dispatchEvent(e,n?"rightdown":"mousedown")),this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e),[2]}}))}))},e.onPointerUp=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c;return Object(f.e)(this,(function(l){switch(l.label){case 0:return t instanceof hs?(e=performance.now(),[4,this.createPointerEvent(t)]):[2];case 1:if(n=l.sent(),this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType?this.dispatchEvent(n,"touchend"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||(s=2===n.button,this.dispatchEvent(n,s?"rightup":"mouseup")),r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]),o=i,i&&!n.composedPath().includes(i)){for(a=i;a&&!n.composedPath().includes(a);)n.currentTarget=a,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||(s=2===n.button,this.notifyTarget(n,s?"rightupoutside":"mouseupoutside")),so.isNode(a)&&(a=a.parentNode);delete r.pressTargetsByButton[t.button],o=a}return o&&((u=this.clonePointerEvent(n,"click")).target=o,u.path=[],r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:u.target,timeStamp:e}),(c=r.clicksByButton[t.button]).target===u.target&&e-c.timeStamp<200?++c.clickCount:c.clickCount=1,c.target=u.target,c.timeStamp=e,u.detail=c.clickCount,"mouse"===u.pointerType||"touch"===u.pointerType?this.dispatchEvent(u,"click"):this.dispatchEvent(u,"pointertap"),this.freeEvent(u)),this.freeEvent(n),[2]}}))}))},e.onPointerMove=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c,l,h;return Object(f.e)(this,(function(f){switch(f.label){case 0:return t instanceof hs?[4,this.createPointerEvent(t)]:[2];case 1:return e=f.sent(),n="mouse"===e.pointerType||"pen"===e.pointerType,r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.overTargets),r.overTargets&&i!==e.target?(o="mousemove"===t.type?"mouseout":"pointerout",[4,this.createPointerEvent(t,o,i||void 0)]):[3,5];case 2:return a=f.sent(),this.dispatchEvent(a,"pointerout"),n&&this.dispatchEvent(a,"mouseout"),e.composedPath().includes(i)?[3,4]:[4,this.createPointerEvent(t,"pointerleave",i||void 0)];case 3:for((s=f.sent()).eventPhase=s.AT_TARGET;s.target&&!e.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),so.isNode(s.target)&&(s.target=s.target.parentNode);this.freeEvent(s),f.label=4;case 4:this.freeEvent(a),f.label=5;case 5:if(i!==e.target){for(u="mousemove"===t.type?"mouseover":"pointerover",c=this.clonePointerEvent(e,u),this.dispatchEvent(c,"pointerover"),n&&this.dispatchEvent(c,"mouseover"),l=i&&so.isNode(i)&&i.parentNode;l&&l!==(so.isNode(this.rootTarget)&&this.rootTarget.parentNode)&&l!==e.target;)l=l.parentNode;if(!l||l===(so.isNode(this.rootTarget)&&this.rootTarget.parentNode)){for((h=this.clonePointerEvent(e,"pointerenter")).eventPhase=h.AT_TARGET;h.target&&h.target!==i&&h.target!==(so.isNode(this.rootTarget)&&this.rootTarget.parentNode);)h.currentTarget=h.target,this.notifyTarget(h),n&&this.notifyTarget(h,"mouseenter"),so.isNode(h.target)&&(h.target=h.target.parentNode);this.freeEvent(h)}this.freeEvent(c)}return this.dispatchEvent(e,"pointermove"),"touch"===e.pointerType&&this.dispatchEvent(e,"touchmove"),n&&(this.dispatchEvent(e,"mousemove"),this.cursor=this.getCursor(e.target)),r.overTargets=e.composedPath(),this.freeEvent(e),[2]}}))}))},e.onPointerOut=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n,r,i,o;return Object(f.e)(this,(function(a){switch(a.label){case 0:return t instanceof hs?(e=this.trackingData(t.pointerId)).overTargets?(n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.findMountedTarget(e.overTargets),[4,this.createPointerEvent(t,"pointerout",r||void 0)]):[3,3]:[2];case 1:return i=a.sent(),this.dispatchEvent(i),n&&this.dispatchEvent(i,"mouseout"),[4,this.createPointerEvent(t,"pointerleave",r||void 0)];case 2:for((o=a.sent()).eventPhase=o.AT_TARGET;o.target&&o.target!==(so.isNode(this.rootTarget)&&this.rootTarget.parentNode);)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseleave"),so.isNode(o.target)&&(o.target=o.target.parentNode);e.overTargets=null,this.freeEvent(i),this.freeEvent(o),a.label=3;case 3:return this.cursor=null,[2]}}))}))},e.onPointerOver=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n,r,i;return Object(f.e)(this,(function(o){switch(o.label){case 0:return t instanceof hs?(e=this.trackingData(t.pointerId),[4,this.createPointerEvent(t)]):[2];case 1:for(n=o.sent(),r="mouse"===n.pointerType||"pen"===n.pointerType,this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=this.getCursor(n.target)),(i=this.clonePointerEvent(n,"pointerenter")).eventPhase=i.AT_TARGET;i.target&&i.target!==(so.isNode(this.rootTarget)&&this.rootTarget.parentNode);)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseenter"),so.isNode(i.target)&&(i.target=i.target.parentNode);return e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(i),[2]}}))}))},e.onPointerUpOutside=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e,n,r,i;return Object(f.e)(this,(function(o){switch(o.label){case 0:return t instanceof hs?(e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),[4,this.createPointerEvent(t)]):[2];case 1:if(r=o.sent(),n){for(i=n;i;)r.currentTarget=i,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),so.isNode(i)&&(i=i.parentNode);delete e.pressTargetsByButton[t.button]}return this.freeEvent(r),[2]}}))}))},e.onWheel=function(t){return Object(f.b)(e,void 0,void 0,(function(){var e;return Object(f.e)(this,(function(n){switch(n.label){case 0:return t instanceof ds?[4,this.createWheelEvent(t)]:[2];case 1:return e=n.sent(),this.dispatchEvent(e),this.freeEvent(e),[2]}}))}))},e}return Object(f.d)(e,t),e.prototype.init=function(){this.rootTarget=this.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)},e.prototype.client2Viewport=function(t){var e=this.contextService.getBoundingClientRect();return new bi.a(t.x-((null==e?void 0:e.left)||0),t.y-((null==e?void 0:e.top)||0))},e.prototype.viewport2Client=function(t){var e=this.contextService.getBoundingClientRect();return new bi.a(t.x+((null==e?void 0:e.left)||0),t.y+((null==e?void 0:e.top)||0))},e.prototype.viewport2Canvas=function(t){var e=t.x,n=t.y,r=this.rootTarget.defaultView.getCamera(),a=this.canvasConfig,s=a.width,u=a.height,c=r.getPerspectiveInverse(),l=r.getWorldTransform(),f=i.multiply(i.create(),l,c),h=o.fromValues(e/s*2-1,2*(1-n/u)-1,0);return o.transformMat4(h,h,f),new bi.a(h[0],h[1])},e.prototype.canvas2Viewport=function(t){var e=this.rootTarget.defaultView.getCamera(),n=e.getPerspective(),r=e.getViewTransform(),a=i.multiply(i.create(),n,r),s=o.fromValues(t.x,t.y,0);o.transformMat4(s,s,a);var u=this.canvasConfig,c=u.width,l=u.height;return new bi.a((s[0]+1)/2*c,(1-(s[1]+1)/2)*l)},e.prototype.setPickHandler=function(t){this.pickHandler=t},e.prototype.addEventMapping=function(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((function(t,e){return t.priority-e.priority}))},e.prototype.mapEvent=function(t){if(this.rootTarget){var e=this.mappingTable[t.type];if(e)for(var n=0,r=e.length;n<r;n++)e[n].fn(t);else console.warn("[EventService]: Event mapping not defined for "+t.type)}},e.prototype.dispatchEvent=function(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.emit(e||t.type,t)},e.prototype.propagate=function(t,e){if(t.target){var n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(var r=n.length-1;r>=1;r--)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){var i=n.indexOf(t.currentTarget);t.eventPhase=t.BUBBLING_PHASE;for(r=i+1;r<n.length;r++)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}},e.prototype.propagationPath=function(t){var e=[t],n=this.rootTarget.defaultView||null;if(n&&n===t)return e.unshift(n.document),e;for(var r=0;r<2048&&t!==this.rootTarget;r++)so.isNode(t)&&t.parentNode&&(e.push(t.parentNode),t=t.parentNode);return n&&e.push(n),e},e.prototype.hitTest=function(t){return Object(f.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(f.e)(this,(function(a){switch(a.label){case 0:return e=t.viewportX,n=t.viewportY,r=this.canvasConfig,i=r.width,o=r.height,e<0||n<0||e>i||n>o?[2,null]:[4,this.pickHandler(t)];case 1:return[2,a.sent()||this.rootTarget||null]}}))}))},e.prototype.createPointerEvent=function(t,e,n){return Object(f.b)(this,void 0,void 0,(function(){var r,i,o;return Object(f.e)(this,(function(a){switch(a.label){case 0:return r=this.allocateEvent(hs),this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r._originalEvent=t,i=r,null==n?[3,1]:(o=n,[3,3]);case 1:return[4,this.hitTest({clientX:r.clientX,clientY:r.clientY,viewportX:r.viewportX,viewportY:r.viewportY,x:r.global.x,y:r.global.y})];case 2:o=a.sent(),a.label=3;case 3:return i.target=o,"string"==typeof e&&(r.type=e),[2,r]}}))}))},e.prototype.createWheelEvent=function(t){return Object(f.b)(this,void 0,void 0,(function(){var e,n;return Object(f.e)(this,(function(r){switch(r.label){case 0:return e=this.allocateEvent(ds),this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e._originalEvent=t,n=e,[4,this.hitTest({clientX:e.clientX,clientY:e.clientY,viewportX:e.viewportX,viewportY:e.viewportY,x:e.global.x,y:e.global.y})];case 1:return n.target=r.sent(),[2,e]}}))}))},e.prototype.trackingData=function(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]},e.prototype.clonePointerEvent=function(t,e){var n=this.allocateEvent(hs);return n.nativeEvent=t.nativeEvent,n._originalEvent=t._originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=null!=e?e:n.type,n},e.prototype.copyPointerData=function(t,e){t instanceof hs&&e instanceof hs&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)},e.prototype.copyMouseData=function(t,e){t instanceof fs&&e instanceof fs&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.client.copyFrom(t.client),e.movement.copyFrom(t.movement),e.canvas.copyFrom(t.canvas),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global),e.offset.copyFrom(t.offset))},e.prototype.copyWheelData=function(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ},e.prototype.copyData=function(t,e){e.isTrusted=t.isTrusted,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.page.copyFrom(t.page),e.viewport.copyFrom(t.viewport)},e.prototype.allocateEvent=function(t){this.eventPool.has(t)||this.eventPool.set(t,[]);var e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=[],e.target=null,e},e.prototype.freeEvent=function(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)},e.prototype.notifyTarget=function(t,e){e=null!=e?e:t.type;var n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?e+"capture":e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)},e.prototype.notifyListeners=function(t,e){var n=t.currentTarget.emitter,r=n._events[e];if(r)if("fn"in r)r.once&&n.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(var i=0;i<r.length&&!t.propagationImmediatelyStopped;i++)r[i].once&&n.removeListener(e,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,t)},e.prototype.findMountedTarget=function(t){if(!t)return null;for(var e=t[t.length-1],n=t.length-2;n>=0;n--){var r=t[n];if(!(r===this.rootTarget||so.isNode(r)&&r.parentNode===e))break;e=t[n]}return e},e.prototype.getCursor=function(t){for(var e=t;e;){var n=Ua.isElement(e)&&e.getAttribute("cursor");if(n)return n;e=so.isNode(e)&&e.parentNode}},Object(f.c)([Object(c.g)(no),Object(f.f)("design:type",Object)],e.prototype,"renderingContext",void 0),Object(f.c)([Object(c.g)(to),Object(f.f)("design:type",Object)],e.prototype,"contextService",void 0),Object(f.c)([Object(c.g)(ki),Object(f.f)("design:type",Object)],e.prototype,"canvasConfig",void 0),Object(f.c)([Object(c.i)(),Object(f.f)("design:type",Function),Object(f.f)("design:paramtypes",[]),Object(f.f)("design:returntype",void 0)],e.prototype,"init",null),e=Object(f.c)([Object(c.j)()],e)}(l.EventEmitter);function ms(t,e,n){var r=n.getGeometryBounds();if(!hi.isEmpty(r)){var i=n.geometry;if(i&&i.contentBounds){var a=o.multiply(o.create(),o.fromValues.apply(o,Object(f.i)([],Object(f.g)(r.halfExtents.map((function(t){return 2*t}))),!1)),o.subtract(o.create(),vo(e||o.create()),vo(t||o.create())));i.contentBounds.update(o.subtract(i.contentBounds.center,i.contentBounds.center,a),i.contentBounds.halfExtents),i.renderBounds.update(o.subtract(i.renderBounds.center,i.renderBounds.center,a),i.renderBounds.halfExtents),xi(n)}}}var _s=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function Es(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ts(){}var bs,Rs="\\s*([+-]?\\d+)\\s*",As="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ss="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Os=/^#([0-9a-f]{3,8})$/,Ms=new RegExp("^rgb\\("+[Rs,Rs,Rs]+"\\)$"),Cs=new RegExp("^rgb\\("+[Ss,Ss,Ss]+"\\)$"),xs=new RegExp("^rgba\\("+[Rs,Rs,Rs,As]+"\\)$"),Ns=new RegExp("^rgba\\("+[Ss,Ss,Ss,As]+"\\)$"),Ps=new RegExp("^hsl\\("+[As,Ss,Ss]+"\\)$"),Is=new RegExp("^hsla\\("+[As,Ss,Ss,As]+"\\)$"),Bs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ds(){return this.rgb().formatHex()}function ws(){return this.rgb().formatRgb()}function Fs(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Os.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ls(e):3===n?new Gs(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ks(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ks(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ms.exec(t))?new Gs(e[1],e[2],e[3],1):(e=Cs.exec(t))?new Gs(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=xs.exec(t))?ks(e[1],e[2],e[3],e[4]):(e=Ns.exec(t))?ks(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ps.exec(t))?Xs(e[1],e[2]/100,e[3]/100,1):(e=Is.exec(t))?Xs(e[1],e[2]/100,e[3]/100,e[4]):Bs.hasOwnProperty(t)?Ls(Bs[t]):"transparent"===t?new Gs(NaN,NaN,NaN,0):null}function Ls(t){return new Gs(t>>16&255,t>>8&255,255&t,1)}function ks(t,e,n,r){return r<=0&&(t=e=n=NaN),new Gs(t,e,n,r)}function Us(t){return t instanceof Ts||(t=Fs(t)),t?new Gs((t=t.rgb()).r,t.g,t.b,t.opacity):new Gs}function Gs(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function js(){return"#"+Ws(this.r)+Ws(this.g)+Ws(this.b)}function Vs(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Ws(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Xs(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ys(t,e,n,r)}function Hs(t){if(t instanceof Ys)return new Ys(t.h,t.s,t.l,t.opacity);if(t instanceof Ts||(t=Fs(t)),!t)return new Ys;if(t instanceof Ys)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Ys(a,s,u,t.opacity)}function Ys(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function zs(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}_s(Ts,Fs,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ds,formatHex:Ds,formatHsl:function(){return Hs(this).formatHsl()},formatRgb:ws,toString:ws}),_s(Gs,(function(t,e,n,r){return 1===arguments.length?Us(t):new Gs(t,e,n,null==r?1:r)}),Es(Ts,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Gs(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Gs(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:js,formatHex:js,formatRgb:Vs,toString:Vs})),_s(Ys,(function(t,e,n,r){return 1===arguments.length?Hs(t):new Ys(t,e,n,null==r?1:r)}),Es(Ts,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ys(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ys(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Gs(zs(t>=240?t-240:t+120,i,r),zs(t,i,r),zs(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}})),function(t){t[t.Constant=0]="Constant",t[t.LinearGradient=1]="LinearGradient",t[t.RadialGradient=2]="RadialGradient",t[t.Pattern=3]="Pattern"}(bs||(bs={}));var qs=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Ks=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Zs=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Qs=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function Js(t){if(void 0===t&&(t=""),"transparent"===t)return{type:bs.Constant,value:[0,0,0,0],formatted:"rgba(0,0,0,0)"};"currentColor"===t&&(t="black");var e=t[0];if("("===t[1]||"("===t[2])if("l"===e){var n=function(t){var e,n=qs.exec(t);if(n){var r=parseFloat(n[1])%360*(Math.PI/180),i=(null===(e=n[2].match(Qs))||void 0===e?void 0:e.map((function(t){return t.split(":")})))||[],o=Object(f.g)([1,1],2),a=o[0],s=o[1],u=Object(f.g)([0,0],2),c=u[0],l=u[1],h=void 0,d=void 0;r>=0&&r<.5*Math.PI?(h={x:c,y:l},d={x:a,y:s}):.5*Math.PI<=r&&r<Math.PI?(h={x:a,y:l},d={x:c,y:s}):Math.PI<=r&&r<1.5*Math.PI?(h={x:a,y:s},d={x:c,y:l}):(h={x:c,y:s},d={x:a,y:l});var p=Math.tan(r),v=p*p,y=(d.x-h.x+p*(d.y-h.y))/(v+1)+h.x,g=p*(d.x-h.x+p*(d.y-h.y))/(v+1)+h.y;return{x0:h.x,y0:h.y,x1:y,y1:g,steps:i,hash:t}}return null}(t);if(n)return{type:bs.LinearGradient,value:n,formatted:""}}else if("r"===e){var r=function(t){var e,n=Ks.exec(t);if(n){var r=parseFloat(n[1]),i=parseFloat(n[2]),o=parseFloat(n[3]),a=(null===(e=n[4].match(Qs))||void 0===e?void 0:e.map((function(t){return t.split(":")})))||[];if(0===o){var s=n[4].match(Qs);return s[s.length-1].split(":")[1]}return{x0:r,y0:i,r0:0,x1:.5,y1:.5,r1:o,steps:a,hash:t}}return null}(t);if(r){if(!Object(d.k)(r))return{type:bs.RadialGradient,value:r,formatted:""};t=r}}else if("p"===e){var i=function(t){var e=Zs.exec(t);if(e){var n=e[1],r=e[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;case"n":n="no-repeat";break;default:n="no-repeat"}return{src:r,repetition:n,hash:t}}return null}(t);if(i)return{type:bs.Pattern,value:i,formatted:""}}var o=Fs(t),a=[0,0,0,0];return null!==o&&(a[0]=o.r/255,a[1]=o.g/255,a[2]=o.b/255,a[3]=o.opacity),{type:bs.Constant,value:a,formatted:o&&"rgba("+o.r+","+o.g+","+o.b+","+o.opacity+")"||"rgba(0,0,0,0)"}}function $s(t,e){if(t.type===bs.Constant&&e.type===bs.Constant)return[t.value,e.value,function(t){var e=t.slice();if(e[3])for(var n=0;n<3;n++)e[n]=Math.round(Object(d.a)(255*e[n],0,255));return e[3]=Object(d.a)(e[3],0,1),"rgba("+e.join(",")+")"}]}function tu(t,e,n){var r=_c.get("GeometryUpdaterFactory")(n.nodeName);if(r){var i=n.geometry;i.contentBounds||(i.contentBounds=new hi),i.renderBounds||(i.renderBounds=new hi);var a=r.update(n.parsedStyle,n),s=a.width,u=a.height,c=a.depth,l=void 0===c?0:c,f=a.x,h=void 0===f?0:f,d=a.y,p=void 0===d?0:d,v=a.z,y=void 0===v?0:v,g=a.offsetX,m=void 0===g?0:g,_=a.offsetY,E=void 0===_?0:_,T=a.offsetZ,b=void 0===T?0:T;n.nodeName===Ni.LINE||n.nodeName===Ni.POLYLINE||n.nodeName===Ni.POLYGON||n.nodeName===Ni.PATH?(n.parsedStyle.offsetX=h-(n.parsedStyle.defX||0),n.parsedStyle.offsetY=p-(n.parsedStyle.defY||0),n.parsedStyle.defX=h,n.parsedStyle.defY=p,n.translateLocal(n.parsedStyle.offsetX,n.parsedStyle.offsetY),n.parsedStyle.x=n.style.x,n.parsedStyle.y=n.style.y,n.parsedStyle.z=y):(n.parsedStyle.x=h,n.parsedStyle.y=p,n.parsedStyle.z=y);var R=o.fromValues(s/2,u/2,l/2),A=n.parsedStyle,S=A.lineWidth,O=A.anchor,M=void 0===O?[0,0]:O,C=A.shadowColor,x=A.filter,N=void 0===x?[]:x;n.nodeName===Ni.TEXT&&delete n.parsedStyle.anchor;var P=o.fromValues((1-2*M[0])*R[0]+m,(1-2*M[1])*R[1]+E,(1-2*(M[2]||0))*R[2]+b);if(i.contentBounds.update(P,R),S&&o.add(R,R,o.fromValues(S.value/2,S.value/2,0)),i.renderBounds.update(P,R),C&&C.type===bs.Constant){var I=i.renderBounds,B=I.min,D=I.max,w=n.parsedStyle,F=w.shadowBlur,L=void 0===F?0:F,k=w.shadowOffsetX,U=void 0===k?0:k,G=w.shadowOffsetY,j=void 0===G?0:G,V=B[0]-L+U,W=D[0]+L+U,X=B[1]-L+j,H=D[1]+L+j;B[0]=Math.min(B[0],V),D[0]=Math.max(D[0],W),B[1]=Math.min(B[1],X),D[1]=Math.max(D[1],H),i.renderBounds.setMinMax(B,D)}N.forEach((function(t){var e=t.name,n=t.params;if("blur"===e){var r=n[0].value;i.renderBounds.update(i.renderBounds.center,o.add(i.renderBounds.halfExtents,i.renderBounds.halfExtents,o.fromValues(r,r,0)))}else if("drop-shadow"===e){var a=n[0].value,s=n[1].value,u=n[2].value,c=i.renderBounds,l=c.min,f=c.max,h=l[0]-u+a,d=f[0]+u+a,p=l[1]-u+s,v=f[1]+u+s;l[0]=Math.min(l[0],h),f[0]=Math.max(f[0],d),l[1]=Math.min(l[1],p),f[1]=Math.max(f[1],v),i.renderBounds.setMinMax(l,f)}})),xi(n)}}function eu(t,e,n){var r=n.parsedStyle,i=r.x,o=void 0===i?0:i,a=r.y,s=void 0===a?0:a,u=r.z,c=void 0===u?0:u;n.setLocalPosition(o,s,c)}function nu(t){return t.toFixed(3).replace(/0+$/,"").replace(/\.$/,"")}function ru(t){return"number"==typeof t?t:/^\s*[-+]?(\d*\.)?\d+\s*$/.test(t)?Number(t):0}function iu(t,e){return[t,e,nu]}function ou(t,e){return function(n,r){return[n,r,function(n){return nu(Object(d.a)(n,t,e))}]}}function au(t,e){if(t.length==e.length)return[t,e,function(t){return t}]}function su(t,e,n){if(t&&t!==e&&t.style.offsetPathTargets){var r=t.style.offsetPathTargets.indexOf(n);t.style.offsetPathTargets.splice(r,1)}e&&(e.style.offsetPathTargets||(e.style.offsetPathTargets=[]),e.style.offsetPathTargets.push(n))}function uu(t,e,n){if(n.attributes.offsetPath){var r=n.attributes.offsetPath.nodeName;if(r===Ni.LINE||r===Ni.PATH||r===Ni.POLYLINE){var i=n.attributes.offsetPath.getPoint(e);i&&n.setLocalPosition(i.x,i.y)}}}function cu(t,e,n){if(t&&t!==e&&t.style.clipPathTargets){var r=t.style.clipPathTargets.indexOf(n);t.style.clipPathTargets.splice(r,1)}e&&(e.style.clipPathTargets||(e.style.clipPathTargets=[]),e.style.clipPathTargets.push(n)),xi(n)}function lu(t,e,n){if(n.parentNode){var r=n.parentNode,i=r.renderable,o=r.sortable;i&&(i.dirty=!0),o&&(o.dirty=!0)}}function fu(t,e,n,r,i){n.children.forEach((function(t){if("inherit"===t.getAttribute(i)){t.parsedStyle[i]=e;var n=t.parsedStyle[i];t.updateStyleProperty(i,n,e)}}))}function hu(t,e){for(var n=t.parentElement;n;){if("inherit"!==n.getAttribute(e)&&n.parsedStyle.hasOwnProperty(e))return n.parsedStyle[e];n=n.parentElement}return null}function du(t){return"px"===t||"%"===t||"em"===t}function pu(t){return"deg"===t||"rad"===t||"turn"===t}function vu(t,e,n,r){if("inherit"===(e=(""+e).trim().toLowerCase())){var i=hu(n,r);if(!Object(d.h)(i))return i}if("0"===e){if("px".search(t)>=0)return{unit:"px",value:0};if("%".search(t)>=0)return{unit:"%",value:0}}else if("auto"===e||"inherit"===e)return{unit:"",value:0};if(Object(d.f)(Number(e)))return"px".search(t)>=0?{unit:"px",value:Number(e)}:{unit:"",value:Number(e)};if(e.endsWith("em")){var o=0;if(n.parentElement){var a=n.parentElement.parsedStyle.fontSize;a&&a.value&&(o=a.value*Number(e.replace("em","")))}return{unit:"px",value:o}}var s=[];e=e.replace(t,(function(t){return s.push(t),"U"+t}));var u="U("+t.source+")";return s.map((function(t){return{unit:t,value:Number(e.replace(new RegExp("U"+t,"g"),"").replace(new RegExp(u,"g"),"*0"))}}))[0]}function yu(t,e,n,r,i){void 0===r&&(r=null),void 0===i&&(i=0);var o=t.unit,a=t.value||0,s=e.value||0;return(du(t.unit)||du(e.unit))&&(a=Eu(t,i,r),s=Eu(e,i,r),o="px"),(pu(t.unit)||pu(e.unit))&&(a=Tu(t),s=Tu(e),o="deg"),[a,s,function(t){return n&&(t=Math.max(t,0)),nu(t)+o}]}var gu=vu.bind(null,new RegExp("px","g")),mu=vu.bind(null,new RegExp("px|%|em","g")),_u=vu.bind(null,/deg|rad|grad|turn/g);function Eu(t,e,n){if("px"===t.unit)return Number(t.value);if("%"===t.unit&&n){var r=n.getBounds(),i=0;return hi.isEmpty(r)||(i=2*r.halfExtents[e]),Number(t.value)/100*i}return 0}function Tu(t){var e=0;return"deg"===t.unit?e=Number(t.value):"rad"===t.unit?e=yo(Number(t.value)):"turn"===t.unit&&(e=360*Number(t.value)),e}function bu(t,e,n){n.setOrigin(e[0],e[1],e[2])}function Ru(t,e,n){var r,i,o=e.split(" ");if(1===o.length&&("top"===o[0]||"bottom"===o[0]?(o[1]=o[0],o[0]="center"):o[1]="center"),2===o.length){var a=mu(Au(o[0])),s=mu(Au(o[1]));a&&(r=Eu(a,0,n)),s&&(i=Eu(s,1,n))}Object(d.h)(r)||Object(d.h)(i)||n.setOrigin([r,i])}function Au(t){return"center"===t?"50%":"left"===t||"top"===t?"0":"right"===t||"bottom"===t?"100%":t}var Su=null,Ou={unit:"px",value:0},Mu={unit:"deg",value:0};function Cu(t){return function(e){var n=0;return t.map((function(t){return t===Su?e[n++]:t}))}}function xu(t){return t}var Nu={rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],scale:["Nn",Cu([Su,Su,1]),xu],scalex:["N",Cu([Su,1,1]),Cu([Su,1])],scaley:["N",Cu([1,Su,1]),Cu([1,Su])],scalez:["N",Cu([1,1,Su])],scale3d:["NNN",xu],translate:["Tt",Cu([Su,Su,Ou]),xu],translatex:["T",Cu([Su,Ou,Ou]),Cu([Su,Ou])],translatey:["T",Cu([Ou,Su,Ou]),Cu([Ou,Su])],translatez:["L",Cu([Ou,Ou,Su])],translate3d:["TTL",xu]};function Pu(t){if("none"===(t=t.toLowerCase().trim()))return[];for(var e,n=/\s*(\w+)\(([^)]*)\)/g,r=[],i=0;e=n.exec(t);){if(e.index!==i)return[];i=e.index+e[0].length;var o=e[1],a=Nu[o];if(!a)return[];var s=e[2].split(","),u=a[0];if(u.length<s.length)return[];for(var c=[],l=0;l<u.length;l++){var f=s[l],h=u[l],d=void 0;if(void 0===(d=f?{A:function(t){return"0"===t.trim()?Mu:_u(t)},N:ru,T:mu,L:gu}[h.toUpperCase()](f):{a:Mu,n:c[0],t:Ou}[h]))return[];c.push(d)}if(r.push({t:o,d:c}),n.lastIndex===t.length)return r}return[]}function Iu(t){return t.replace(/[xy]/,"")}function Bu(t){return t.replace(/(x|y|z|3d)?$/,"3d")}function Du(t,e,n){var r=!1;if(!t.length||!e.length){t.length||(r=!0,t=e,e=[]);for(var i=function(n){var r=t[n],i=r.t,o=r.d,a="scale"===i.substr(0,5)?1:0;e.push({t:i,d:o.map((function(t){return"number"==typeof t?a:{unit:t.unit,value:a}}))})},o=0;o<t.length;o++)i(o)}var a,s,u=[],c=[],l=[];if(t.length!==e.length);else for(o=0;o<t.length;o++){var f=t[o].t,h=e[o].t,d=t[o].d,p=e[o].d,v=Nu[f],y=Nu[h],g=void 0;if(s=h,("perspective"!==(a=f)||"perspective"!==s)&&("matrix"!==a&&"matrix3d"!==a||"matrix"!==s&&"matrix3d"!==s)){if(f===h)g=f;else if(v[2]&&y[2]&&Iu(f)===Iu(h))g=Iu(f),d=v[2](d),p=y[2](p);else{if(!v[1]||!y[1]||Bu(f)!==Bu(h))break;g=Bu(f),d=v[1](d),p=y[1](p)}for(var m=[],_=[],E=[],T=0;T<d.length;T++){var b=("number"==typeof d[T]?iu:yu)(d[T],p[T],!1,n,T);m[T]=b[0],_[T]=b[1],E.push(b[2])}u.push(m),c.push(_),l.push([g,E])}}if(r){var R=u;u=c,c=R}return[u,c,function(t){return t.map((function(t,e){var n=t.map((function(t,n){return l[e][1][n](t)})).join(",");return"matrix"===l[e][0]&&16===n.split(",").length&&(l[e][0]="matrix3d"),l[e][0]+"("+n+")"})).join(" ")}]}function wu(t,e,n){Object(d.q)(Object(f.i)(Object(f.i)([],Object(f.g)((t||[]).map((function(t){return t.t}))),!1),Object(f.g)((e||[]).map((function(t){return t.t}))),!1)).forEach((function(r){var i=(e||[]).find((function(t){return t.t===r})),o=(t||[]).find((function(t){return t.t===r}));if("scale"===r){var a=i&&i.d||[1,1],s=o&&o.d||[1,1];n.scaleLocal(a[0]/s[0],a[1]/s[1],1)}else if("scalex"===r){a=i&&i.d||[1],s=o&&o.d||[1];n.scaleLocal(a[0]/s[0],1,1)}else if("scaley"===r){a=i&&i.d||[1],s=o&&o.d||[1];n.scaleLocal(1,a[0]/s[0],1)}else if("scalez"===r){a=i&&i.d||[1],s=o&&o.d||[1];n.scaleLocal(1,1,a[0]/s[0])}else if("scale3d"===r){a=i&&i.d||[1,1,1],s=o&&o.d||[1,1,1];n.scaleLocal(a[0]/s[0],a[1]/s[1],a[2]/s[2])}else if("translate"===r){var u=i&&i.d||[Ou,Ou],c=o&&o.d||[Ou,Ou];n.translateLocal(u[0].value-c[0].value,u[1].value-c[1].value,0)}else if("translatex"===r){u=i&&i.d||[Ou],c=o&&o.d||[Ou];n.translateLocal(u[0].value-c[0].value,0,0)}else if("translatey"===r){u=i&&i.d||[Ou],c=o&&o.d||[Ou];n.translateLocal(0,u[0].value-c[0].value,0)}else if("translatez"===r){u=i&&i.d||[Ou],c=o&&o.d||[Ou];n.translateLocal(0,0,u[0].value-c[0].value)}else if("translate3d"===r){u=i&&i.d||[Ou,Ou,Ou],c=o&&o.d||[Ou,Ou,Ou];n.translateLocal(u[0].value-c[0].value,u[1].value-c[1].value,u[2].value-c[2].value)}else if("rotate"===r){var l=i&&i.d||[Mu],f=o&&o.d||[Mu];n.rotateLocal(0,0,l[0].value-f[0].value)}else if("rotatex"===r){l=i&&i.d||[Mu],f=o&&o.d||[Mu];n.rotateLocal(l[0].value-f[0].value,0,0)}else if("rotatey"===r){l=i&&i.d||[Mu],f=o&&o.d||[Mu];n.rotateLocal(0,l[0].value-f[0].value,0)}else if("rotatez"===r){l=i&&i.d||[Mu],f=o&&o.d||[Mu];n.rotateLocal(0,0,l[0].value-f[0].value)}}))}var Fu=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/gi,Lu=/[^\s\,]+/gi;var ku=function(t){var e=t||[];return Object(d.c)(e)?e:Object(d.k)(e)?(e=e.match(Fu),Object(d.b)(e,(function(t,n){if((t=t.match(Lu))[0].length>1){var r=t[0].charAt(0);t.splice(1,0,t[0].substr(1)),t[0]=r}Object(d.b)(t,(function(e,n){isNaN(e)||(t[n]=+e)})),e[n]=t})),e):void 0};var Uu="\t\n\v\f\r \u2028\u2029",Gu=new RegExp("([a-z])["+Uu+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Uu+"]*,?["+Uu+"]*)+)","ig"),ju=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Uu+"]*,?["+Uu+"]*","ig");var Vu=/[a-z]/;function Wu(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}function Xu(t){var e=function(t){if(!t)return null;if(Object(d.c)(t))return t;var e={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},n=[];return String(t).replace(Gu,(function(t,r,i){var o=[],a=r.toLowerCase();if(i.replace(ju,(function(t,e){e&&o.push(+e)})),"m"===a&&o.length>2&&(n.push([r].concat(o.splice(0,2))),a="l",r="m"===r?"l":"L"),"o"===a&&1===o.length&&n.push([r,o[0]]),"r"===a)n.push([r].concat(o));else for(;o.length>=e[a]&&(n.push([r].concat(o.splice(0,e[a]))),e[a]););return""})),n}(t);if(!e||!e.length)return[["M",0,0]];for(var n=!1,r=0;r<e.length;r++){var i=e[r][0];if(Vu.test(i)||["V","H","T","S"].indexOf(i)>=0){n=!0;break}}if(!n)return e;var o=[],a=0,s=0,u=0,c=0,l=0,f=e[0];"M"!==f[0]&&"m"!==f[0]||(u=a=+f[1],c=s=+f[2],l++,o[0]=["M",a,s]);r=l;for(var h=e.length;r<h;r++){var p=e[r],v=o[r-1],y=[],g=(i=p[0]).toUpperCase();if(i!==g)switch(y[0]=g,g){case"A":y[1]=p[1],y[2]=p[2],y[3]=p[3],y[4]=p[4],y[5]=p[5],y[6]=+p[6]+a,y[7]=+p[7]+s;break;case"V":y[1]=+p[1]+s;break;case"H":y[1]=+p[1]+a;break;case"M":u=+p[1]+a,c=+p[2]+s,y[1]=u,y[2]=c;break;default:for(var m=1,_=p.length;m<_;m++)y[m]=+p[m]+(m%2?a:s)}else y=e[r];switch(g){case"Z":a=+u,s=+c;break;case"H":y=["L",a=y[1],s];break;case"V":y=["L",a,s=y[1]];break;case"T":a=y[1],s=y[2];var E=Wu([v[1],v[2]],[v[3],v[4]]);y=["Q",E[0],E[1],a,s];break;case"S":a=y[y.length-2],s=y[y.length-1];var T=v.length,b=Wu([v[T-4],v[T-3]],[v[T-2],v[T-1]]);y=["C",b[0],b[1],y[1],y[2],a,s];break;case"M":u=y[y.length-2],c=y[y.length-1];break;default:a=y[y.length-2],s=y[y.length-1]}o.push(y)}return o}var Hu=2*Math.PI,Yu=function(t,e,n,r,i,o,a){var s=t.x,u=t.y;return{x:r*(s*=e)-i*(u*=n)+o,y:i*s+r*u+a}},zu=function(t,e){var n=1.5707963267948966===e?.551915024494:-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),r=Math.cos(t),i=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:r-i*n,y:i+r*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]},qu=function(t,e,n,r){var i=t*n+e*r;return i>1&&(i=1),i<-1&&(i=-1),(t*r-e*n<0?-1:1)*Math.acos(i)},Ku=function(t){var e=t.px,n=t.py,r=t.cx,i=t.cy,o=t.rx,a=t.ry,s=t.xAxisRotation,u=void 0===s?0:s,c=t.largeArcFlag,l=void 0===c?0:c,f=t.sweepFlag,h=void 0===f?0:f,d=[];if(0===o||0===a)return[{x1:0,y1:0,x2:0,y2:0,x:r,y:i}];var p=Math.sin(u*Hu/360),v=Math.cos(u*Hu/360),y=v*(e-r)/2+p*(n-i)/2,g=-p*(e-r)/2+v*(n-i)/2;if(0===y&&0===g)return[{x1:0,y1:0,x2:0,y2:0,x:r,y:i}];o=Math.abs(o),a=Math.abs(a);var m=Math.pow(y,2)/Math.pow(o,2)+Math.pow(g,2)/Math.pow(a,2);m>1&&(o*=Math.sqrt(m),a*=Math.sqrt(m));var _=function(t,e,n,r,i,o,a,s,u,c,l,f){var h=Math.pow(i,2),d=Math.pow(o,2),p=Math.pow(l,2),v=Math.pow(f,2),y=h*d-h*v-d*p;y<0&&(y=0),y/=h*v+d*p;var g=(y=Math.sqrt(y)*(a===s?-1:1))*i/o*f,m=y*-o/i*l,_=c*g-u*m+(t+n)/2,E=u*g+c*m+(e+r)/2,T=(l-g)/i,b=(f-m)/o,R=(-l-g)/i,A=(-f-m)/o,S=qu(1,0,T,b),O=qu(T,b,R,A);return 0===s&&O>0&&(O-=Hu),1===s&&O<0&&(O+=Hu),[_,E,S,O]}(e,n,r,i,o,a,l,h,p,v,y,g),E=_[0],T=_[1],b=_[2],R=_[3],A=Math.abs(R)/(Hu/4);Math.abs(1-A)<1e-7&&(A=1);var S=Math.max(Math.ceil(A),1);R/=S;for(var O=0;O<S;O++)d.push(zu(b,R)),b+=R;return d.map((function(t){var e=Yu(t[0],o,a,v,p,E,T),n=e.x,r=e.y,i=Yu(t[1],o,a,v,p,E,T),s=i.x,u=i.y,c=Yu(t[2],o,a,v,p,E,T);return{x1:n,y1:r,x2:s,y2:u,x:c.x,y:c.y}}))};function Zu(t,e,n,r,i,o,a,s,u){return Ku({px:t,py:e,cx:s,cy:u,rx:n,ry:r,xAxisRotation:i,largeArcFlag:o,sweepFlag:a}).reduce((function(t,e){var n=e.x1,r=e.y1,i=e.x2,o=e.y2,a=e.x,s=e.y;return t.push(n,r,i,o,a,s),t}),[])}function Qu(t,e,n,r,i,o){return[1/3*t+2/3*n,1/3*e+2/3*r,1/3*i+2/3*n,1/3*o+2/3*r,i,o]}function Ju(t,e,n,r){return[t,e,n,r,n,r]}function $u(t,e){"TQ".indexOf(t[0])<0&&(e.qx=null,e.qy=null);var n=t.slice(1),r=n[0],i=n[1];switch(t[0]){case"M":return e.x=r,e.y=i,t;case"A":return["C"].concat(Zu.apply(0,[e.x1,e.y1].concat(t.slice(1))));case"Q":return e.qx=r,e.qy=i,["C"].concat(Qu.apply(0,[e.x1,e.y1].concat(t.slice(1))));case"L":return["C"].concat(Ju(e.x1,e.y1,t[1],t[2]));case"H":return["C"].concat(Ju(e.x1,e.y1,t[1],e.y1));case"V":return["C"].concat(Ju(e.x1,e.y1,e.x1,t[1]));case"Z":return["C"].concat(Ju(e.x1,e.y1,e.x,e.y))}return t}function tc(t,e){void 0===e&&(e=!1);for(var n,r,i=Xu(t),o={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null},a=[],s="",u=i.length,c=[],l=0;l<u;l+=1)i[l]&&(s=i[l][0]),a[l]=s,i[l]=$u(i[l],o),ec(i,a,l),u=i.length,"Z"===s&&c.push(l),r=(n=i[l]).length,o.x1=+n[r-2],o.y1=+n[r-1],o.x2=+n[r-4]||o.x1,o.y2=+n[r-3]||o.y1;return e?[i,c]:i}function ec(t,e,n){if(t[n].length>7){t[n].shift();for(var r=t[n],i=n;r.length;)e[n]="A",t.splice(i+=1,0,["C"].concat(r.splice(0,6)));t.splice(n,1)}}function nc(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function rc(t,e){return nc(t)*nc(e)?(t[0]*e[0]+t[1]*e[1])/(nc(t)*nc(e)):1}function ic(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(rc(t,e))}function oc(t,e){return t[0]===e[0]&&t[1]===e[1]}function ac(t,e){var n=e[1],r=e[2],i=Object(d.o)(Object(d.p)(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],u=t[1],c=e[6],l=e[7],f=Math.cos(i)*(s-c)/2+Math.sin(i)*(u-l)/2,h=-1*Math.sin(i)*(s-c)/2+Math.cos(i)*(u-l)/2,p=f*f/(n*n)+h*h/(r*r);p>1&&(n*=Math.sqrt(p),r*=Math.sqrt(p));var v=n*n*(h*h)+r*r*(f*f),y=v?Math.sqrt((n*n*(r*r)-v)/v):1;o===a&&(y*=-1),isNaN(y)&&(y=0);var g=r?y*n*h/r:0,m=n?y*-r*f/n:0,_=(s+c)/2+Math.cos(i)*g-Math.sin(i)*m,E=(u+l)/2+Math.sin(i)*g+Math.cos(i)*m,T=[(f-g)/n,(h-m)/r],b=[(-1*f-g)/n,(-1*h-m)/r],R=ic([1,0],T),A=ic(T,b);return rc(T,b)<=-1&&(A=Math.PI),rc(T,b)>=1&&(A=0),0===a&&A>0&&(A-=2*Math.PI),1===a&&A<0&&(A+=2*Math.PI),{cx:_,cy:E,rx:oc(t,[c,l])?0:n,ry:oc(t,[c,l])?0:r,startAngle:R,endAngle:R+A,xRotation:i,arcFlag:o,sweepFlag:a}}function sc(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}var uc=function(){function t(t,e,n,r){this.x=t,this.y=e,this.width=n,this.height=r,this.left=t,this.right=t+n,this.top=e,this.bottom=e+r,this.width=n,this.height=r,this.x=t,this.y=e}return t.prototype.toJSON=function(){},t}();function cc(t){var e=Xu(t),n=function(t){for(var e=!1,n=t.length,r=0;r<n;r++){var i=t[r][0];if("C"===i||"A"===i||"Q"===i){e=!0;break}}return e}(e),r=e.slice(),i=function(t){for(var e=[],n=[],r=[],i=0;i<t.length;i++){var o=t[i],a=o[0];"M"===a?(r.length&&(n.push(r),r=[]),r.push([o[1],o[2]])):"Z"===a?r.length&&(e.push(r),r=[]):r.push([o[1],o[2]])}r.length>0&&n.push(r);return{polygons:e,polylines:n}}(r),o=i.polygons,a=i.polylines,s=Object(f.g)(tc(r,!0),2),u=s[0],c=s[1],l=function(t){for(var e=[],n=null,r=null,i=null,o=0,a=(t=ku(t)).length,s=0;s<a;s++){var u=t[s];r=t[s+1];var c=u[0],l={command:c,prePoint:n,params:u,startTangent:null,endTangent:null};switch(c){case"M":i=[u[1],u[2]],o=s;break;case"A":var f=ac(n,u);l.arcParams=f}if("Z"===c)n=i,r=t[o+1];else{var h=u.length;n=[u[h-2],u[h-1]]}r&&"Z"===r[0]&&(r=t[o],e[o]&&(e[o].prePoint=n)),l.currentPoint=n,e[o]&&oc(n,e[o].currentPoint)&&(e[o].prePoint=l.prePoint);var d=r?[r[r.length-2],r[r.length-1]]:null;l.nextPoint=d;var p=l.prePoint;if(["L","H","V"].includes(c))l.startTangent=[p[0]-n[0],p[1]-n[1]],l.endTangent=[n[0]-p[0],n[1]-p[1]];else if("Q"===c){var v=[u[1],u[2]];l.startTangent=[p[0]-v[0],p[1]-v[1]],l.endTangent=[n[0]-v[0],n[1]-v[1]]}else if("T"===c){v=sc((m=e[s-1]).currentPoint,p);"Q"===m.command?(l.command="Q",l.startTangent=[p[0]-v[0],p[1]-v[1]],l.endTangent=[n[0]-v[0],n[1]-v[1]]):(l.command="TL",l.startTangent=[p[0]-n[0],p[1]-n[1]],l.endTangent=[n[0]-p[0],n[1]-p[1]])}else if("C"===c){var y=[u[1],u[2]],g=[u[3],u[4]];l.startTangent=[p[0]-y[0],p[1]-y[1]],l.endTangent=[n[0]-g[0],n[1]-g[1]],0===l.startTangent[0]&&0===l.startTangent[1]&&(l.startTangent=[y[0]-g[0],y[1]-g[1]]),0===l.endTangent[0]&&0===l.endTangent[1]&&(l.endTangent=[g[0]-y[0],g[1]-y[1]])}else if("S"===c){var m;y=sc((m=e[s-1]).currentPoint,p),g=[u[1],u[2]];"C"===m.command?(l.command="C",l.startTangent=[p[0]-y[0],p[1]-y[1]],l.endTangent=[n[0]-g[0],n[1]-g[1]]):(l.command="SQ",l.startTangent=[p[0]-g[0],p[1]-g[1]],l.endTangent=[n[0]-g[0],n[1]-g[1]])}else if("A"===c){var _=.001,E=l.arcParams||{},T=E.cx,b=void 0===T?0:T,R=E.cy,A=void 0===R?0:R,S=E.rx,O=void 0===S?0:S,M=E.ry,C=void 0===M?0:M,x=E.sweepFlag,N=void 0===x?0:x,P=E.startAngle,I=void 0===P?0:P,B=E.endAngle,D=void 0===B?0:B;0===N&&(_*=-1);var w=O*Math.cos(I-_)+b,F=C*Math.sin(I-_)+A;l.startTangent=[w-i[0],F-i[1]];var L=O*Math.cos(I+D+_)+b,k=C*Math.sin(I+D-_)+A;l.endTangent=[p[0]-L,p[1]-k]}e.push(l)}return e}(r),h=function(t){var e,n,r,i,o=0,a=0,s=[];if(!t)return{curveSegments:[],totalLength:o};if(t.forEach((function(e,n){r=t[n+1],i=e.length,r&&(o+=_a.length(e[i-2],e[i-1],r[1],r[2],r[3],r[4],r[5],r[6])||0)})),0===o)return{curveSegments:[],totalLength:o};return t.forEach((function(u,c){r=t[c+1],i=u.length,r&&((e=[])[0]=a/o,n=_a.length(u[i-2],u[i-1],r[1],r[2],r[3],r[4],r[5],r[6]),a+=n||0,e[1]=a/o,s.push(e))})),{curveSegments:s,totalLength:o}}(u);return{absolutePath:e,hasArc:n,segments:l,polygons:o,polylines:a,curve:u,totalLength:h.totalLength,curveSegments:h.curveSegments,zCommandIndexes:c,rect:lc(u)}}function lc(t){var e=0,n=0,r=[],i=[];t.forEach((function(t){var o=Object(f.g)(t.slice(-2),2),a=o[0],s=o[1];if("M"===t[0])e=a,n=s,r.push(a),i.push(s);else if("C"===t[0]){var u=_a.box.apply(_a,Object(f.i)([],Object(f.g)([e,n].concat(t.slice(1))),!1));r=r.concat(u.x,u.x+u.width),i=i.concat(u.y,u.y+u.height),e=a,n=s}}));var o=Math.min.apply(0,r),a=Math.min.apply(0,i),s=Math.max.apply(0,r),u=Math.max.apply(0,i);return new uc(o,a,s-o,u-a)}function fc(t,e){var n=t.curve,r=e.curve,i=[n,r];n.length!==r.length&&(i=function t(e,n,r){var i=Ra(e),o=Ra(n),a=i.length,s=o.length,u=i.filter((function(t){return t.l})).length,c=o.filter((function(t){return t.l})).length,l=i.filter((function(t){return t.l})).reduce((function(t,e){return t+e.l}),0)/u||0,f=o.filter((function(t){return t.l})).reduce((function(t,e){return t+e.l}),0)/c||0,h=r||Math.max(a,s),d=[l,f],p=[h-a,h-s],v=0,y=[i,o].map((function(t,e){return t.l===h?t.map((function(t){return t.s})):t.map((function(t,n){return v=n&&p[e]&&t.l>=d[e],p[e]-=v?1:0,v?t.ss:[t.s]})).flat()}));return y[0].length===y[1].length?y:t(y[0],y[1],h)}(n,r));var o,a,s=Aa(i[0])!==Aa(i[1])?(o=i[0],a=o.slice(1).map((function(t,e,n){return e?n[e-1].slice(-2).concat(t.slice(1)):o[0].slice(1).concat(t.slice(1))})).map((function(t){return t.map((function(e,n){return t[t.length-n-2*(1-n%2)]}))})).reverse(),[["M"].concat(a[0].slice(0,2))].concat(a.map((function(t){return["C"].concat(t.slice(2))})))):function t(e){return e.map((function(e){return Array.isArray(e)?t(e):Number.isNaN(+e)?e:+e}))}(i[0]);return[s,Oa(i[1],s),function(t){return t}]}function hc(t){var e,n,r=[],i=0,o=Ta(t);return t.forEach((function(a,s){t[s+1]&&((e=[0,0])[0]=i/o,n=ha.length(a[0],a[1],t[s+1][0],t[s+1][1]),i+=n,e[1]=i/o,r.push(e))})),{points:t,totalLength:o,segments:r}}var dc=vu.bind(null,/deg|rad|grad|turn|px|%/g),pc=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function vc(t){if(void 0===t&&(t=""),"none"===(t=t.toLowerCase().trim()))return[];for(var e,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;e=n.exec(t);){if(e.index!==i)return[];if(i=e.index+e[0].length,pc.indexOf(e[1])>-1&&r.push({name:e[1],params:e[2].split(" ").map((function(t){return dc(t)||Js(t)}))}),n.lastIndex===t.length)return r}return[]}function yc(t){var e=[];return Object(d.k)(t)?t.split(" ").forEach((function(t){var n=gu(t);e.push(n.value)})):e.push.apply(e,Object(f.i)([],Object(f.g)(t),!1)),e&&1===e.length?[e[0],e[0]]:[e[0],e[1]]}function gc(t,e,n){n.nodeValue=""+e||""}function mc(t,e,n){if(n.nodeName===Ni.TEXT){var r=n;e===Bi.CAPITALIZE?r.style.text=r.style.text.charAt(0).toUpperCase()+r.style.text.slice(1):e===Bi.LOWERCASE?r.style.text=r.style.text.toLowerCase():e===Bi.UPPERCASE&&(r.style.text=r.style.text.toUpperCase())}}var _c=c.b,Ec=["textAlign","fontSize","fontFamily","fontWeight","fontStyle"],Tc={},bc={},Rc={};function Ac(t,e,n,r){e&&(Tc[t]=e),n&&(Rc[t]=n),r&&(bc[t]||(bc[t]=[]),bc[t].push(r))}function Sc(t,e,n,r){for(var i=0;i<t.length;i++)Ac(t[i],e,n,r)}var Oc=Object(c.c)((function(t){Object(c.f)(Object(c.h)(),l.EventEmitter),t(h),t(Oi),t({token:Ai,useFactory:function(t){return function(){return t.container.get(Si)}}}),t({token:wi,useClass:Fi}),t(Xi),t(Ki),t(Ui),t(Gi),t(ji),t(Zi),t(Qi),t(Ji),t($i),t({token:"GeometryUpdaterFactory",useFactory:function(t){var e={};return function(n){return e[n]||t.container.isBoundNamed(Li,n)&&(e[n]=t.container.getNamed(Li,n)),e[n]}}}),Sc(["opacity","fillOpacity","strokeOpacity","offsetDistance"],ru,ou(0,1),void 0),Sc(["shadowBlur"],ru,ou(0,1/0),void 0),Sc(["r","rx","ry","width","height","fontSize","lineWidth","dx","dy"],mu,yu,void 0),Sc(["lineDash"],yc,au,void 0),Sc(["x1","x2","y1","y2","lineDashOffset","shadowOffsetX","shadowOffsetY"],ru,iu,void 0),Sc(Ec,void 0,void 0,fu),Sc(["x1","x2","y1","y2","r","rx","ry","width","height","path","points","text","shadowBlur","shadowOffsetX","shadowOffsetY","lineWidth","filter","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","wordWrap","wordWrapWidth","leading","textBaseline","textAlign","whiteSpace"],void 0,void 0,tu),Sc(["fill","stroke","shadowColor"],Js,$s,void 0),Ac("clipPath",void 0,void 0,cu),Ac("zIndex",void 0,void 0,lu),Ac("offsetPath",void 0,void 0,su),Ac("offsetDistance",void 0,void 0,uu),Ac("origin",void 0,void 0,bu),Ac("transformOrigin",void 0,void 0,Ru),Ac("transform",Pu,Du,wu),Ac("text",void 0,void 0,gc),Ac("textTransform",void 0,void 0,mc),Ac("path",cc,fc,void 0),Ac("points",hc,void 0,void 0),Sc(["x","y","z","points","path","x1","x2","y1","y2","z1","z2"],void 0,void 0,eu),Ac("filter",vc,void 0,void 0),Ac("anchor",void 0,void 0,ms)})),Mc=function(){function t(t){this.plugins=[],this.config=Object(f.a)({enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableTAA:!1},t)}return t.prototype.registerPlugin=function(t){this.plugins.push(t)},t.prototype.getPlugins=function(){return this.plugins},t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){Object.assign(this.config,t)},t}(),Cc={},xc=0;var Nc,Pc,Ic,Bc="undefined"!=typeof window&&void 0!==window.document,Dc=function(){function t(t,e){this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=i.clone(e.matrix),this.right=o.clone(e.right),this.up=o.clone(e.up),this.forward=o.clone(e.forward),this.position=o.clone(e.position),this.focalPoint=o.clone(e.focalPoint),this.distanceVector=o.clone(e.distanceVector),this.azimuth=e.azimuth,this.elevation=e.elevation,this.roll=e.roll,this.relAzimuth=e.relAzimuth,this.relElevation=e.relElevation,this.relRoll=e.relRoll,this.dollyingStep=e.dollyingStep,this.distance=e.distance}return t.prototype.getPosition=function(){return this.position},t.prototype.getFocalPoint=function(){return this.focalPoint},t.prototype.getRoll=function(){return this.roll},t.prototype.retrieve=function(t){t.matrix=i.copy(t.matrix,this.matrix),t.right=o.copy(t.right,this.right),t.up=o.copy(t.up,this.up),t.forward=o.copy(t.forward,this.forward),t.position=o.copy(t.position,this.position),t.focalPoint=o.copy(t.focalPoint,this.focalPoint),t.distanceVector=o.copy(t.distanceVector,this.distanceVector),t.azimuth=this.azimuth,t.elevation=this.elevation,t.roll=this.roll,t.relAzimuth=this.relAzimuth,t.relElevation=this.relElevation,t.relRoll=this.relRoll,t.dollyingStep=this.dollyingStep,t.distance=this.distance},t}(),wc="DefaultCamera";!function(t){t.ORBITING="ORBITING",t.EXPLORING="EXPLORING",t.TRACKING="TRACKING"}(Nc||(Nc={})),function(t){t.DEFAULT="DEFAULT",t.ROTATIONAL="ROTATIONAL",t.TRANSLATIONAL="TRANSLATIONAL",t.CINEMATIC="CINEMATIC"}(Pc||(Pc={})),function(t){t.ORTHOGRAPHIC="ORTHOGRAPHIC",t.PERSPECTIVE="PERSPECTIVE"}(Ic||(Ic={}));var Fc,Lc="updated",kc=Math.PI/180,Uc=180/Math.PI,Gc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.matrix=i.create(),e.right=o.fromValues(1,0,0),e.up=o.fromValues(0,1,0),e.forward=o.fromValues(0,0,1),e.position=o.fromValues(0,0,1),e.focalPoint=o.fromValues(0,0,0),e.distanceVector=o.fromValues(0,0,0),e.distance=1,e.azimuth=0,e.elevation=0,e.roll=0,e.relAzimuth=0,e.relElevation=0,e.relRoll=0,e.dollyingStep=0,e.maxDistance=1/0,e.minDistance=-1/0,e.zoom=1,e.rotateWorld=!1,e.fov=30,e.near=.1,e.far=1e3,e.aspect=1,e.projectionMatrix=i.create(),e.projectionMatrixInverse=i.create(),e.jitteredProjectionMatrix=void 0,e.following=void 0,e.type=Nc.EXPLORING,e.trackingMode=Pc.DEFAULT,e.projectionMode=Ic.PERSPECTIVE,e.frustum=new yi,e.landmarks=[],e.orthoMatrix=i.create(),e}return Object(f.d)(e,t),e.prototype.isOrtho=function(){return this.projectionMode===Ic.ORTHOGRAPHIC},e.prototype.clone=function(){var t=new e;return t.setType(this.type,void 0),t},e.prototype.getProjectionMode=function(){return this.projectionMode},e.prototype.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},e.prototype.getPerspectiveInverse=function(){return this.projectionMatrixInverse},e.prototype.getFrustum=function(){return this.frustum},e.prototype.getPosition=function(){return this.position},e.prototype.getFocalPoint=function(){return this.focalPoint},e.prototype.getNear=function(){return this.near},e.prototype.getFar=function(){return this.far},e.prototype.getZoom=function(){return this.zoom},e.prototype.getOrthoMatrix=function(){return this.orthoMatrix},e.prototype.setType=function(t,e){return this.type=t,this.type===Nc.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Nc.TRACKING&&void 0!==e&&this.setTrackingMode(e),this},e.prototype.setProjectionMode=function(t){return this.projectionMode=t,this},e.prototype.setTrackingMode=function(t){if(this.type!==Nc.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this},e.prototype.setWorldRotation=function(t){this.rotateWorld=t,this._getAngles()},e.prototype.getViewTransform=function(){return i.invert(i.create(),this.matrix)},e.prototype.getWorldTransform=function(){return this.matrix},e.prototype.jitterProjectionMatrix=function(t,e){var n=i.fromTranslation(i.create(),[t,e,0]);this.jitteredProjectionMatrix=i.multiply(i.create(),n,this.projectionMatrix)},e.prototype.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},e.prototype.setMatrix=function(t){return this.matrix=t,this._update(),this},e.prototype.setFov=function(t){return this.setPerspective(this.near,this.far,t,this.aspect),this},e.prototype.setAspect=function(t){return this.setPerspective(this.near,this.far,this.fov,t),this},e.prototype.setNear=function(t){return this.projectionMode===Ic.PERSPECTIVE?this.setPerspective(t,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,t,this.far),this},e.prototype.setFar=function(t){return this.projectionMode===Ic.PERSPECTIVE?this.setPerspective(this.near,t,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,t),this},e.prototype.setViewOffset=function(t,e,n,r,i,o){return this.aspect=t/e,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.projectionMode===Ic.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},e.prototype.clearViewOffset=function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Ic.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},e.prototype.setZoom=function(t){return this.zoom=t,this.projectionMode===Ic.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===Ic.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},e.prototype.setPerspective=function(t,e,n,r){this.projectionMode=Ic.PERSPECTIVE,this.fov=n,this.near=t,this.far=e,this.aspect=r;var a=this.near*Math.tan(.5*kc*this.fov)/this.zoom,s=2*a,u=this.aspect*s,c=-.5*u;if(void 0!==this.view&&this.view.enabled){var l=this.view.fullWidth,f=this.view.fullHeight;c+=this.view.offsetX*u/l,a-=this.view.offsetY*s/f,u*=this.view.width/l,s*=this.view.height/f}return function(t,e,n,r,i,o,a){var s=2*o/(n-e),u=2*o/(r-i),c=(n+e)/(n-e),l=(r+i)/(r-i),f=-(a+o)/(a-o),h=-2*a*o/(a-o);t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0}(this.projectionMatrix,c,c+u,a,a-s,t,this.far),i.scale(this.projectionMatrix,this.projectionMatrix,o.fromValues(1,-1,1)),i.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this},e.prototype.setOrthographic=function(t,e,n,r,a,s){this.projectionMode=Ic.ORTHOGRAPHIC,this.rright=e,this.left=t,this.top=n,this.bottom=r,this.near=a,this.far=s;var u=(this.rright-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),l=(this.rright+this.left)/2,f=(this.top+this.bottom)/2,h=l-u,d=l+u,p=f+c,v=f-c;if(void 0!==this.view&&this.view.enabled){var y=(this.rright-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=y*this.view.offsetX)+y*this.view.width,v=(p-=g*this.view.offsetY)-g*this.view.height}return i.ortho(this.projectionMatrix,h,d,v,p,a,s),i.scale(this.projectionMatrix,this.projectionMatrix,o.fromValues(1,-1,1)),i.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this},e.prototype.setPosition=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this._setPosition(t,e,n),this.setFocalPoint(this.focalPoint),this},e.prototype.setFocalPoint=function(t,e,n){var r=o.fromValues(0,1,0);if(this.focalPoint=vo(t,e,n),this.trackingMode===Pc.CINEMATIC){var a=o.subtract(o.create(),this.focalPoint,this.position);t=a[0],e=a[1],n=a[2];var s=o.length(a),u=Math.asin(e/s)*Uc,c=90+Math.atan2(n,t)*Uc,l=i.create();i.rotateY(l,l,c*kc),i.rotateX(l,l,u*kc),r=o.transformMat4(o.create(),[0,1,0],l)}return i.invert(this.matrix,i.lookAt(i.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this},e.prototype.setDistance=function(t){if(!(this.distance===t||t<0)){this.distance=t,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var e=o.create();t=this.distance;var n=this.forward,r=this.focalPoint;return e[0]=t*n[0]+r[0],e[1]=t*n[1]+r[1],e[2]=t*n[2]+r[2],this._setPosition(e),this}},e.prototype.setMaxDistance=function(t){return this.maxDistance=t,this},e.prototype.setMinDistance=function(t){return this.minDistance=t,this},e.prototype.changeAzimuth=function(t){return this.setAzimuth(this.azimuth+t),this},e.prototype.changeElevation=function(t){return this.setElevation(this.elevation+t),this},e.prototype.changeRoll=function(t){return this.setRoll(this.roll+t),this},e.prototype.setAzimuth=function(t){return this.azimuth=po(t),this.computeMatrix(),this._getAxes(),this.type===Nc.ORBITING||this.type===Nc.EXPLORING?this._getPosition():this.type===Nc.TRACKING&&this._getFocalPoint(),this},e.prototype.getAzimuth=function(){return this.azimuth},e.prototype.setElevation=function(t){return this.elevation=po(t),this.computeMatrix(),this._getAxes(),this.type===Nc.ORBITING||this.type===Nc.EXPLORING?this._getPosition():this.type===Nc.TRACKING&&this._getFocalPoint(),this},e.prototype.setRoll=function(t){return this.roll=po(t),this.computeMatrix(),this._getAxes(),this.type===Nc.ORBITING||this.type===Nc.EXPLORING?this._getPosition():this.type===Nc.TRACKING&&this._getFocalPoint(),this},e.prototype.rotate=function(t,e,n){if(this.relElevation=po(e),this.relAzimuth=po(t),this.relRoll=po(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===Nc.EXPLORING){var r=s.setAxisAngle(s.create(),[1,0,0],(this.rotateWorld?1:-1)*this.relElevation*kc),o=s.setAxisAngle(s.create(),[0,1,0],(this.rotateWorld?1:-1)*this.relAzimuth*kc),a=s.setAxisAngle(s.create(),[0,0,1],this.relRoll*kc),u=s.multiply(s.create(),o,r);u=s.multiply(s.create(),u,a);var c=i.fromQuat(i.create(),u);i.translate(this.matrix,this.matrix,[0,0,-this.distance]),i.multiply(this.matrix,this.matrix,c),i.translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return;this.computeMatrix()}return this._getAxes(),this.type===Nc.ORBITING||this.type===Nc.EXPLORING?this._getPosition():this.type===Nc.TRACKING&&this._getFocalPoint(),this._update(),this},e.prototype.pan=function(t,e){var n=vo(t,e,0),r=o.clone(this.position);return o.add(r,r,o.scale(o.create(),this.right,n[0])),o.add(r,r,o.scale(o.create(),this.up,n[1])),this._setPosition(r),this.triggerUpdate(),this},e.prototype.dolly=function(t){var e=this.forward,n=o.clone(this.position),r=this.dollyingStep,i=this.distance+t*this.dollyingStep;return r=Math.max(Math.min(i,this.maxDistance),this.minDistance)-this.distance,n[0]+=r*e[0],n[1]+=r*e[1],n[2]+=r*e[2],this._setPosition(n),this.type===Nc.ORBITING||this.type===Nc.EXPLORING?this._getDistance():this.type===Nc.TRACKING&&o.add(this.focalPoint,n,this.distanceVector),this.triggerUpdate(),this},e.prototype.createLandmark=function(t,e){var n=this.clone();n.setPosition(e.position),n.setFocalPoint(e.focalPoint),void 0!==e.roll&&n.setRoll(e.roll);var r=new Dc(t,n);return this.landmarks.push(r),r},e.prototype.setLandmark=function(t){var e=new Dc(t,this);return this.landmarks.push(e),this},e.prototype.gotoLandmark=function(t,e){var n=this;void 0===e&&(e=1e3);var r=this.landmarks.find((function(e){return e.name===t}));if(r){if(0===e)return void r.retrieve(this);void 0!==this.landmarkAnimationID&&Ba(this.landmarkAnimationID);var i,a=r.getPosition(),s=r.getFocalPoint(),u=r.getRoll();Ia((function t(r){void 0===i&&(i=r);var c,l=r-i,f=(1-Math.cos(l/e*Math.PI))/2,h=o.create(),d=o.create();if(o.lerp(h,n.focalPoint,s,f),o.lerp(d,n.position,a,f),c=n.roll*(1-f)+u*f,n.setFocalPoint(h),n.setPosition(d),n.setRoll(c),n.computeMatrix(),n.triggerUpdate(),!(o.dist(h,s)+o.dist(d,a)>.01))return n.setFocalPoint(h),n.setPosition(d),n.setRoll(c),void n.computeMatrix();l<e&&(n.landmarkAnimationID=Ia(t))}))}},e.prototype._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()},e.prototype.computeMatrix=function(){var t=s.setAxisAngle(s.create(),[0,0,1],this.roll*kc);i.identity(this.matrix);var e=s.setAxisAngle(s.create(),[1,0,0],(this.rotateWorld&&this.type!==Nc.TRACKING||this.type===Nc.TRACKING?1:-1)*this.elevation*kc),n=s.setAxisAngle(s.create(),[0,1,0],(this.rotateWorld&&this.type!==Nc.TRACKING||this.type===Nc.TRACKING?1:-1)*this.azimuth*kc),r=s.multiply(s.create(),n,e);r=s.multiply(s.create(),r,t);var o=i.fromQuat(i.create(),r);this.type===Nc.ORBITING||this.type===Nc.EXPLORING?(i.translate(this.matrix,this.matrix,this.focalPoint),i.multiply(this.matrix,this.matrix,o),i.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===Nc.TRACKING&&(i.translate(this.matrix,this.matrix,this.position),i.multiply(this.matrix,this.matrix,o))},e.prototype._setPosition=function(t,e,n){this.position=vo(t,e,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()},e.prototype._getAxes=function(){o.copy(this.right,vo(a.transformMat4(a.create(),[1,0,0,0],this.matrix))),o.copy(this.up,vo(a.transformMat4(a.create(),[0,1,0,0],this.matrix))),o.copy(this.forward,vo(a.transformMat4(a.create(),[0,0,1,0],this.matrix))),o.normalize(this.right,this.right),o.normalize(this.up,this.up),o.normalize(this.forward,this.forward)},e.prototype._getAngles=function(){var t=this.distanceVector[0],e=this.distanceVector[1],n=this.distanceVector[2],r=o.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Nc.TRACKING||this.rotateWorld?(this.elevation=Math.asin(e/r)*Uc,this.azimuth=Math.atan2(-t,-n)*Uc):(this.elevation=-Math.asin(e/r)*Uc,this.azimuth=-Math.atan2(-t,-n)*Uc)},e.prototype._getPosition=function(){o.copy(this.position,vo(a.transformMat4(a.create(),[0,0,0,1],this.matrix))),this._getDistance()},e.prototype._getFocalPoint=function(){o.transformMat3(this.distanceVector,[0,0,-this.distance],r.fromMat4(r.create(),this.matrix)),o.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()},e.prototype._getDistance=function(){this.distanceVector=o.subtract(o.create(),this.focalPoint,this.position),this.distance=o.length(this.distanceVector),this.dollyingStep=this.distance/100},e.prototype._getOrthoMatrix=function(){if(this.projectionMode===Ic.ORTHOGRAPHIC){var t=this.position,e=s.setAxisAngle(s.create(),[0,0,1],-this.roll*Math.PI/180);i.fromRotationTranslationScaleOrigin(this.orthoMatrix,e,o.fromValues((this.rright-this.left)/2-t[0],(this.top-this.bottom)/2-t[1],0),o.fromValues(this.zoom,this.zoom,1),t)}},e.prototype.triggerUpdate=function(){var t=this.getViewTransform(),e=i.multiply(i.create(),this.getPerspective(),t);this.getFrustum().extractFromVPMatrix(e),this.emit(Lc)},e.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},e}(l.EventEmitter),jc=function(){function t(){}var e;return e=t,t.prototype.apply=function(t){var n=this;t.hooks.prepare.tap(e.tag,(function(t){if(t){var e=n.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering;return t.renderable.dirty||n.renderingContext.renderReasons.has(Wi.CAMERA_CHANGED)||!e?t:null}return t}))},t.tag="DirtyCheckPlugin",Object(f.c)([Object(c.g)(ki),Object(f.f)("design:type",Object)],t.prototype,"canvasConfig",void 0),Object(f.c)([Object(c.g)(no),Object(f.f)("design:type",Object)],t.prototype,"renderingContext",void 0),t=e=Object(f.c)([Object(c.j)({contrib:vs})],t)}(),Vc=c.d.defineToken("CullingStrategyContribution"),Wc=function(){function t(){}var e;return e=t,t.prototype.apply=function(t){var n=this.strategyProvider.getContributions();t.hooks.prepare.tap(e.tag,(function(t){if(t){var e=t.cullable;return 0===n.length?e.visible=!0:e.visible=n.every((function(e){return e.isVisible(t)})),t.isVisible()?t:null}return t})),t.hooks.afterRender.tap(e.tag,(function(t){t.cullable.visibilityPlaneMask=-1}))},t.tag="CullingPlugin",Object(f.c)([Object(c.e)(Vc),Object(f.f)("design:type",Object)],t.prototype,"strategyProvider",void 0),t=e=Object(f.c)([Object(c.j)({contrib:vs})],t)}(),Xc=function(){function t(){}var e;return e=t,t.prototype.apply=function(t){var n=this,r=function(){n.renderingContext.renderReasons.add(Wi.DISPLAY_OBJECT_CHANGED)},i=function(){t.dirtify()},o=function(e){var n=e.target;Ec.forEach((function(t){if("inherit"===n.getAttribute(t)){var e=hu(n,t);if(!Object(d.h)(e)){var r=n.parsedStyle[t];n.parsedStyle[t]=e,n.updateStyleProperty(t,r,e)}}})),xi(n),t.dirtify()},a=function(e){xi(e.target),t.dirtify()};t.hooks.init.tap(e.tag,(function(){n.renderingContext.root.addEventListener(vi.MOUNTED,o),n.renderingContext.root.addEventListener(vi.UNMOUNTED,a),n.renderingContext.root.addEventListener(vi.ATTR_MODIFIED,r),n.renderingContext.root.addEventListener(vi.BOUNDS_CHANGED,i)})),t.hooks.destroy.tap(e.tag,(function(){n.renderingContext.root.removeEventListener(vi.MOUNTED,o),n.renderingContext.root.removeEventListener(vi.UNMOUNTED,a),n.renderingContext.root.removeEventListener(vi.ATTR_MODIFIED,r),n.renderingContext.root.removeEventListener(vi.BOUNDS_CHANGED,i)}))},t.tag="PrepareRendererPlugin",Object(f.c)([Object(c.g)(no),Object(f.f)("design:type",Object)],t.prototype,"renderingContext",void 0),t=e=Object(f.c)([Object(c.j)({contrib:vs})],t)}(),Hc=[Ni.CIRCLE,Ni.ELLIPSE,Ni.IMAGE,Ni.RECT,Ni.LINE,Ni.POLYLINE,Ni.POLYGON,Ni.TEXT,Ni.PATH,Ni.HTML],Yc=function(){function t(){}return t.prototype.isVisible=function(t){var e,n,r=t.cullable;if(!r.enable)return!0;var i=t.getRenderBounds();if(!i)return!1;var o=this.camera.getFrustum(),a=null===(n=null===(e=t.parentNode)||void 0===e?void 0:e.cullable)||void 0===n?void 0:n.visibilityPlaneMask;return r.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(t,i,a||ri.INDETERMINATE,o.planes),r.visible=r.visibilityPlaneMask!==ri.OUTSIDE,r.visible},t.prototype.computeVisibilityWithPlaneMask=function(t,e,n,r){if(n===ri.OUTSIDE||n===ri.INSIDE)return n;for(var i=ri.INSIDE,a=Hc.indexOf(t.nodeName)>-1,s=0,u=r.length;s<u;++s){var c=1<<s;if(0!=(n&c)&&(!a||4!==s&&5!==s)){var l=r[s],f=l.normal,h=l.distance;if(o.dot(f,e.getPositiveFarPoint(r[s]))+h<0)return ri.OUTSIDE;o.dot(f,e.getNegativeFarPoint(r[s]))+h<0&&(i|=c)}}return i},Object(f.c)([Object(c.g)(wc),Object(f.f)("design:type",Gc)],t.prototype,"camera",void 0),t=Object(f.c)([Object(c.j)({contrib:Vc})],t)}(),zc=function(){function t(){var t=this;this.autoPreventDefault=!0,this.rootPointerEvent=new hs(null),this.rootWheelEvent=new ds(null),this.onPointerMove=function(e){var n,r,i,o;if(!Da||"touch"!==e.pointerType){var a=La(e);try{for(var s=Object(f.k)(a),u=s.next();!u.done;u=s.next()){var c=u.value,l=t.bootstrapEvent(t.rootPointerEvent,c,null===(o=null===(i=t.renderingContext.root)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.defaultView);t.eventService.mapEvent(l)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}t.setCursor(t.eventService.cursor)}}}var e;return e=t,t.prototype.apply=function(t){var n=this;this.eventService.setPickHandler((function(t){return Object(f.b)(n,void 0,void 0,(function(){return Object(f.e)(this,(function(e){switch(e.label){case 0:return[4,this.renderingService.hooks.pick.promise({position:t,picked:null})];case 1:return[2,e.sent().picked]}}))}))})),t.hooks.pointerWheel.tap(e.tag,(function(t){var e=n.normalizeWheelEvent(t);n.eventService.mapEvent(e)})),t.hooks.pointerDown.tap(e.tag,(function(t){var e,r,i,o;if(!Da||"touch"!==t.pointerType){var a=La(t);if(n.autoPreventDefault&&a[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();try{for(var s=Object(f.k)(a),u=s.next();!u.done;u=s.next()){var c=u.value,l=n.bootstrapEvent(n.rootPointerEvent,c,null===(o=null===(i=n.renderingContext.root)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.defaultView);n.eventService.mapEvent(l)}}catch(h){e={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}n.setCursor(n.eventService.cursor)}})),t.hooks.pointerUp.tap(e.tag,(function(t){var e,r,i,o;if(!Da||"touch"!==t.pointerType){var a=n.contextService.getDomElement(),s=a&&t.target&&t.target!==a&&a.contains&&!a.contains(t.target)?"outside":"",u=La(t);try{for(var c=Object(f.k)(u),l=c.next();!l.done;l=c.next()){var h=l.value,d=n.bootstrapEvent(n.rootPointerEvent,h,null===(o=null===(i=n.renderingContext.root)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.defaultView);d.type+=s,n.eventService.mapEvent(d)}}catch(p){e={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}n.setCursor(n.eventService.cursor)}})),t.hooks.pointerMove.tap(e.tag,this.onPointerMove),t.hooks.pointerOver.tap(e.tag,this.onPointerMove),t.hooks.pointerOut.tap(e.tag,this.onPointerMove)},t.prototype.bootstrapEvent=function(t,e,n){t.view=n,t._originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);var r=this.eventService.client2Viewport(new bi.a(e.clientX,e.clientY)),i=r.x,o=r.y;t.viewport.x=i,t.viewport.y=o;var a=this.eventService.viewport2Canvas(t.viewport),s=a.x,u=a.y;return t.canvas.x=s,t.canvas.y=u,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Fa[t.type]||t.type),t},t.prototype.normalizeWheelEvent=function(t){var e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;var n=this.eventService.client2Viewport(new bi.a(t.clientX,t.clientY)),r=n.x,i=n.y;e.viewport.x=r,e.viewport.y=i;var o=this.eventService.viewport2Canvas(e.viewport),a=o.x,s=o.y;return e.canvas.x=a,e.canvas.y=s,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.nativeEvent=t,e.type=t.type,e},t.prototype.transferMouseData=function(t,e){t.isTrusted=e.isTrusted,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null},t.prototype.setCursor=function(t){this.contextService.applyCursorStyle(t||this.canvasConfig.cursor||"default")},t.tag="EventPlugin",Object(f.c)([Object(c.g)(ki),Object(f.f)("design:type",Object)],t.prototype,"canvasConfig",void 0),Object(f.c)([Object(c.g)(to),Object(f.f)("design:type",Object)],t.prototype,"contextService",void 0),Object(f.c)([Object(c.g)(ys),Object(f.f)("design:type",ys)],t.prototype,"renderingService",void 0),Object(f.c)([Object(c.g)(no),Object(f.f)("design:type",Object)],t.prototype,"renderingContext",void 0),Object(f.c)([Object(c.g)(gs),Object(f.f)("design:type",gs)],t.prototype,"eventService",void 0),t=e=Object(f.c)([Object(c.j)({contrib:vs})],t)}(),qc=Object(c.c)((function(t){c.a.register(t,vs,{cache:!1}),c.a.register(t,Vc,{cache:!1}),t(ys),t(gs),t(zc),t(Xc),t(jc),t(Wc),t(Yc)}));!function(t){t.READY="ready",t.BEFORE_RENDER="beforerender",t.AFTER_RENDER="afterrender",t.BEFORE_DESTROY="beforedestroy",t.AFTER_DESTROY="afterdestroy",t.RESIZE="resize"}(Fc||(Fc={}));var Kc=function(t){function e(e){var n=t.call(this)||this;n.container=_c.createChild(),n.Element=Ja,n.inited=!1,n.document=new ls,n.document.defaultView=n,n.customElements=new ps;var r=e.container,i=e.canvas,o=e.width,a=e.height,s=e.devicePixelRatio,u=e.renderer,c=e.background,l=e.requestAnimationFrame,f=e.cancelAnimationFrame;!function(t,e){if(t){var n="string"==typeof t?t:t.id||xc++;Cc[n]&&Cc[n].destroy(),Cc[n]=e}}(r,n);var h=o,d=a,p=s;return i&&(p=(p=s||Bc&&window.devicePixelRatio||1)>=1?Math.ceil(p):1,h=o||i.width/p,d=a||i.height/p),l&&f&&(Na=l,Pa=f),n.initRenderingContext({container:r,canvas:i,width:h,height:d,renderer:u,devicePixelRatio:p,cursor:"default",background:c}),n.initDefaultCamera(h,d),n.initRenderer(u),n}return Object(f.d)(e,t),e.prototype.initRenderingContext=function(t){var e=this;this.container.register({token:ki,useValue:t}),this.container.register({token:no,useValue:{root:this.document.documentElement,renderReasons:new Set,force:!1,dirty:!1}}),this.document.documentElement.addEventListener(vi.CHILD_INSERTED,(function(t){e.mountChildren(t.detail.child)})),this.document.documentElement.addEventListener(vi.CHILD_REMOVED,(function(t){e.unmountChildren(t.detail.child)}))},e.prototype.initDefaultCamera=function(t,e){var n=(new Gc).setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0).setOrthographic(t/-2,t/2,e/2,e/-2,.1,1e3),r=this.container.get(no);n.on(Lc,(function(){r.renderReasons.add(Wi.CAMERA_CHANGED)})),this.container.register({token:wc,useValue:n})},e.prototype.getConfig=function(){return this.container.get(ki)},e.prototype.getContainer=function(){return this.container},e.prototype.getRoot=function(){return this.document.documentElement},e.prototype.getCamera=function(){return this.container.get(wc)},e.prototype.getContextService=function(){return this.container.get(to)},e.prototype.getEventService=function(){return this.eventService},e.prototype.getRenderingService=function(){return this.renderingService},e.prototype.getRenderingContext=function(){return this.container.get(no)},e.prototype.getStats=function(){return this.getRenderingService().getStats()},e.prototype.getComputedStyle=function(t){return t.parsedStyle},Object.defineProperty(e.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(this.readyPromise=new Promise((function(e){t.resolveReadyPromise=function(){e(t)}})),this.inited&&this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),e.prototype.destroy=function(t){(void 0===t&&(t=!0),this.emit(Fc.BEFORE_DESTROY,(function(){})),this.frameId)&&(this.getConfig().cancelAnimationFrame||Ba)(this.frameId);var e=this.getRoot();this.unmountChildren(e),t&&this.document.destroy(),this.getContextService().destroy(),this.getRenderingService().destroy(),this.emit(Fc.AFTER_DESTROY,{})},e.prototype.changeSize=function(t,e){this.resize(t,e)},e.prototype.resize=function(t,e){var n=this.container.get(ki);n.width=t,n.height=e,this.getContextService().resize(t,e);var r=this.container.get(wc),i=r.getProjectionMode();r.setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0),i===Ic.ORTHOGRAPHIC?r.setOrthographic(t/-2,t/2,e/2,e/-2,r.getNear(),r.getFar()):r.setAspect(t/e),this.emit(Fc.RESIZE,{width:t,height:e})},e.prototype.appendChild=function(t,e){return this.document.documentElement.appendChild(t,e)},e.prototype.insertBefore=function(t,e){return this.document.documentElement.insertBefore(t,e)},e.prototype.removeChild=function(t,e){return void 0===e&&(e=!0),this.document.documentElement.removeChild(t,e)},e.prototype.removeChildren=function(t){void 0===t&&(t=!0),this.document.documentElement.removeChildren(t)},e.prototype.render=function(){(this.emit(Fc.BEFORE_RENDER,{}),this.container.isBound(ys))&&this.container.get(ys).render();this.emit(Fc.AFTER_RENDER,{})},e.prototype.run=function(){var t=this;!function e(){t.render(),t.frameId=Ia(e)}()},e.prototype.initRenderer=function(t){var e=this;if(!t)throw new Error("Renderer is required.");this.inited=!1,this.readyPromise=void 0,this.loadCommonContainerModule(),this.loadRendererContainerModule(t);var n=this.container.get(to);this.renderingService=this.container.get(ys),this.eventService=this.container.get(gs),n.init(),this.renderingService.init().then((function(){e.emit(Fc.READY,{}),e.readyPromise&&e.resolveReadyPromise(),e.inited=!0})),t.getConfig().enableAutoRendering&&this.run(),this.getRoot().forEach((function(t){var e=t.renderable;e&&(e.renderBoundsDirty=!0,e.boundsDirty=!0,e.dirty=!0)})),this.mountChildren(this.getRoot())},e.prototype.loadCommonContainerModule=function(){this.container.unload(qc),this.container.load(qc,!0)},e.prototype.loadRendererContainerModule=function(t){var e=this;t.getPlugins().forEach((function(t){t.init(e.container)}))},e.prototype.setRenderer=function(t){var e=this,n=this.getConfig();if(n.renderer!==t){var r=n.renderer;n.renderer=t,this.destroy(!1),null==r||r.getPlugins().reverse().forEach((function(t){t.destroy(e.container)})),this.initRenderer(t)}},e.prototype.setCursor=function(t){this.getContextService().applyCursorStyle(t)},e.prototype.unmountChildren=function(t){var e=[];t.forEach((function(t){t.isConnected&&e.push(t)})),e.reverse().forEach((function(t){t.emit(vi.UNMOUNTED,{}),t.ownerDocument=null,t.isConnected=!1}))},e.prototype.mountChildren=function(t){var e=this;t.forEach((function(t){t.isConnected||(t.ownerDocument=e.document,t.isConnected=!0,t.emit(vi.MOUNTED,{}))}))},e.prototype.client2Viewport=function(t){return this.getEventService().client2Viewport(t)},e.prototype.viewport2Client=function(t){return this.getEventService().viewport2Client(t)},e.prototype.viewport2Canvas=function(t){return this.getEventService().viewport2Canvas(t)},e.prototype.canvas2Viewport=function(t){return this.getEventService().canvas2Viewport(t)},e.prototype.getPointByClient=function(t,e){return this.client2Viewport({x:t,y:e})},e.prototype.getClientByPoint=function(t,e){return this.viewport2Client({x:t,y:e})},e}(ao);_c.load(Oc)},function(t,e,n){var r=n(1),i=n(5),o=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?o(r[t]):r[t]&&r[t][e]}},function(t,e,n){var r=n(1),i=n(27),o=r.String,a=r.TypeError;t.exports=function(t){if(i(t))return t;throw a(o(t)+" is not an object")}},function(t,e,n){var r=n(1),i=n(5),o=n(73),a=r.TypeError;t.exports=function(t){if(i(t))return t;throw a(o(t)+" is not a function")}},function(t,e,n){var r=n(1),i=n(85).f,o=n(47),a=n(79),s=n(55),u=n(124),c=n(129);t.exports=function(t,e){var n,l,f,h,d,p=t.target,v=t.global,y=t.stat;if(n=v?r:y?r[p]||s(p,{}):(r[p]||{}).prototype)for(l in e){if(h=e[l],f=t.noTargetGet?(d=i(n,l))&&d.value:n[l],!c(v?l:p+(y?".":"#")+l,t.forced)&&void 0!==f){if(typeof h==typeof f)continue;u(h,f)}(t.sham||f&&f.sham)&&o(h,"sham",!0),a(n,l,h,t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var r=n(10);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=o(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(function t(e,n){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===n||t(e.parentRequest,n))}(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=o},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&u(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),i=function(t){function e(e,n,r,i,o,a,s,u){var c=t.call(this,null)||this;return c.relatedNode=n,c.prevValue=r,c.newValue=i,c.attrName=o,c.attrChange=a,c.prevParsedValue=s,c.newParsedValue=u,c.type=e,c}return Object(r.d)(e,t),e.ADDITION=2,e.MODIFICATION=1,e.REMOVAL=3,e}(n(30).a)},function(t,e,n){var r=n(52),i=Function.prototype.call;t.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},function(t,e,n){var r,i,o=n(1),a=n(45),s=o.process,u=o.Deno,c=s&&s.versions||u&&u.version,l=c&&c.v8;l&&(i=(r=l.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=+r[1]),t.exports=i},function(t,e,n){var r=n(36);t.exports=r("navigator","userAgent")||""},function(t,e,n){var r=n(6),i=r({}.toString),o=r("".slice);t.exports=function(t){return o(i(t),8,-1)}},function(t,e,n){var r=n(25),i=n(34),o=n(58);t.exports=r?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){var e=+t;return e!=e||0===e?0:(e>0?r:n)(e)}},function(t,e,n){var r=n(86),i=n(69);t.exports=function(t){return r(i(t))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t}()},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));r();function r(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}}).call(this,n(31))},function(t,e,n){var r=n(9);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},function(t,e,n){var r=n(1),i=n(105),o=n(5),a=n(46),s=n(33)("toStringTag"),u=r.Object,c="Arguments"==a(function(){return arguments}());t.exports=i?a:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(n){}}(e=u(t),s))?n:c?a(e):"Object"==(r=a(e))&&o(e.callee)?"Arguments":r}},function(t,e,n){var r=n(1),i=n(55),o=r["__core-js_shared__"]||i("__core-js_shared__",{});t.exports=o},function(t,e,n){var r=n(1),i=Object.defineProperty;t.exports=function(t,e){try{i(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},function(t,e,n){var r=n(6),i=0,o=Math.random(),a=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++i+o,36)}},function(t,e,n){var r=n(107),i=n(77);t.exports=function(t){var e=r(t,"string");return i(e)?e:e+""}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var r=n(6),i=n(5),o=n(54),a=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(t){return a(t)}),t.exports=o.inspectSource},function(t,e,n){var r=n(70),i=n(56),o=r("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},function(t,e){t.exports={}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(64),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(63),i=n(94),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t,e){this.type=t,this.target=e,this.addedNodes=[],this.attributeName=null,this.attributeNamespace=null,this.nextSibling=null,this.oldValue=null,this.previousSibling=null,this.removedNodes=[]}return t.copy=function(e){var n=new t(e.type,e.target);return n.addedNodes=e.addedNodes.slice(),n.removedNodes=e.removedNodes.slice(),n.previousSibling=e.previousSibling,n.nextSibling=e.nextSibling,n.attributeName=e.attributeName,n.attributeNamespace=e.attributeNamespace,n.oldValue=e.oldValue,n},t}()},function(t,e,n){(function(t,e){var r;n(11),n(12),function(n){!function(r){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=a(n);function a(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===i.Reflect?i.Reflect=n:o=a(i.Reflect,o),function(e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,u=!a&&!s,c={create:a?function(){return B(Object.create(null))}:s?function(){return B({__proto__:null})}:function(){return B({})},has:u?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:u?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),f="object"==typeof t&&{}&&"true"==={}.REFLECT_METADATA_USE_MAP_POLYFILL,h=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function a(t,e){return[t,e]}}():Map,d=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}():Set,p=new(f||"function"!=typeof WeakMap?function(){var t=c.create(),e=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+a()}while(c.has(t,e));return t[e]=!0,e}function i(t,r){if(!n.call(t,e)){if(!r)return;Object.defineProperty(t,e,{value:c.create()})}return t[e]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function v(t,e,n){var r=p.get(t);if(T(r)){if(!n)return;r=new h,p.set(t,r)}var i=r.get(e);if(T(i)){if(!n)return;i=new h,r.set(e,i)}return i}function y(t,e,n){var r=v(e,n,!1);return!T(r)&&!!r.has(t)}function g(t,e,n){var r=v(e,n,!1);if(!T(r))return r.get(t)}function m(t,e,n,r){v(n,r,!0).set(t,e)}function _(t,e){var n=[],r=v(t,e,!1);if(T(r))return n;for(var i=function(t){var e=x(t,o);if(!M(e))throw new TypeError;var n=e.call(t);if(!R(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=N(i);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(c){try{P(i)}finally{throw c}}a++}}function E(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function T(t){return void 0===t}function b(t){return null===t}function R(t){return"object"==typeof t?null!==t:"function"==typeof t}function A(t,e){switch(E(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=x(t,i);if(void 0!==r){var o=r.call(t,n);if(R(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(M(n))if(!R(i=n.call(t)))return i;if(M(r=t.valueOf))if(!R(i=r.call(t)))return i}else{var r;if(M(r=t.valueOf))if(!R(i=r.call(t)))return i;var i,o=t.toString;if(M(o))if(!R(i=o.call(t)))return i}throw new TypeError}(t,"default"===n?"number":n)}function S(t){var e=A(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function O(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function M(t){return"function"==typeof t}function C(t){return"function"==typeof t}function x(t,e){var n=t[e];if(null!=n){if(!M(n))throw new TypeError;return n}}function N(t){var e=t.next();return!e.done&&e}function P(t){var e=t.return;e&&e.call(t)}function I(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function B(t){return t.__=void 0,delete t.__,t}e("decorate",(function(t,e,n,r){if(T(n)){if(!O(t))throw new TypeError;if(!C(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!T(r)&&!b(r)){if(!C(r))throw new TypeError;e=r}}return e}(t,e)}if(!O(t))throw new TypeError;if(!R(e))throw new TypeError;if(!R(r)&&!T(r)&&!b(r))throw new TypeError;return b(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!T(o)&&!b(o)){if(!R(o))throw new TypeError;r=o}}return r}(t,e,n=S(n),r)})),e("metadata",(function(t,e){return function(n,r){if(!R(n))throw new TypeError;if(!T(r)&&!function(t){switch(E(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(t,e,n,r)}})),e("defineMetadata",(function(t,e,n,r){if(!R(n))throw new TypeError;return T(r)||(r=S(r)),m(t,e,n,r)})),e("hasMetadata",(function(t,e,n){if(!R(e))throw new TypeError;return T(n)||(n=S(n)),function t(e,n,r){if(y(e,n,r))return!0;var i=I(n);return!b(i)&&t(e,i,r)}(t,e,n)})),e("hasOwnMetadata",(function(t,e,n){if(!R(e))throw new TypeError;return T(n)||(n=S(n)),y(t,e,n)})),e("getMetadata",(function(t,e,n){if(!R(e))throw new TypeError;return T(n)||(n=S(n)),function t(e,n,r){if(y(e,n,r))return g(e,n,r);var i=I(n);return b(i)?void 0:t(e,i,r)}(t,e,n)})),e("getOwnMetadata",(function(t,e,n){if(!R(e))throw new TypeError;return T(n)||(n=S(n)),g(t,e,n)})),e("getMetadataKeys",(function(t,e){if(!R(t))throw new TypeError;return T(e)||(e=S(e)),function t(e,n){var r=_(e,n),i=I(e);if(null===i)return r;var o=t(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new d,s=[],u=0,c=r;u<c.length;u++){var l=c[u];a.has(l)||(a.add(l),s.push(l))}for(var f=0,h=o;f<h.length;f++){l=h[f];a.has(l)||(a.add(l),s.push(l))}return s}(t,e)})),e("getOwnMetadataKeys",(function(t,e){if(!R(t))throw new TypeError;return T(e)||(e=S(e)),_(t,e)})),e("deleteMetadata",(function(t,e,n){if(!R(e))throw new TypeError;T(n)||(n=S(n));var r=v(e,n,!1);if(T(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=p.get(e);return i.delete(n),i.size>0||p.delete(e),!0}))}(o)}()}(r||(r={}))}).call(this,n(67),n(31))},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var t=s(h);l=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";var r,i,o,a=n(104),s=n(25),u=n(1),c=n(5),l=n(27),f=n(20),h=n(53),d=n(73),p=n(47),v=n(79),y=n(34).f,g=n(78),m=n(113),_=n(115),E=n(33),T=n(56),b=u.Int8Array,R=b&&b.prototype,A=u.Uint8ClampedArray,S=A&&A.prototype,O=b&&m(b),M=R&&m(R),C=Object.prototype,x=u.TypeError,N=E("toStringTag"),P=T("TYPED_ARRAY_TAG"),I=T("TYPED_ARRAY_CONSTRUCTOR"),B=a&&!!_&&"Opera"!==h(u.opera),D=!1,w={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},L=function(t){if(!l(t))return!1;var e=h(t);return f(w,e)||f(F,e)};for(r in w)(o=(i=u[r])&&i.prototype)?p(o,I,i):B=!1;for(r in F)(o=(i=u[r])&&i.prototype)&&p(o,I,i);if((!B||!c(O)||O===Function.prototype)&&(O=function(){throw x("Incorrect invocation")},B))for(r in w)u[r]&&_(u[r],O);if((!B||!M||M===C)&&(M=O.prototype,B))for(r in w)u[r]&&_(u[r].prototype,M);if(B&&m(S)!==M&&_(S,M),s&&!f(M,N))for(r in D=!0,y(M,N,{get:function(){return l(this)?this[P]:void 0}}),w)u[r]&&p(u[r],P,r);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:B,TYPED_ARRAY_CONSTRUCTOR:I,TYPED_ARRAY_TAG:D&&P,aTypedArray:function(t){if(L(t))return t;throw x("Target is not a typed array")},aTypedArrayConstructor:function(t){if(c(t)&&(!_||g(O,t)))return t;throw x(d(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n,r){if(s){if(n)for(var i in w){var o=u[i];if(o&&f(o.prototype,t))try{delete o.prototype[t]}catch(a){try{o.prototype[t]=e}catch(c){}}}M[t]&&!n||v(M,t,n?e:B&&R[t]||e,r)}},exportTypedArrayStaticMethod:function(t,e,n){var r,i;if(s){if(_){if(n)for(r in w)if((i=u[r])&&f(i,t))try{delete i[t]}catch(o){}if(O[t]&&!n)return;try{return v(O,t,n?e:B&&O[t]||e)}catch(o){}}for(r in w)!(i=u[r])||i[t]&&!n||v(i,t,e)}},isView:function(t){if(!l(t))return!1;var e=h(t);return"DataView"===e||f(w,e)||f(F,e)},isTypedArray:L,TypedArray:O,TypedArrayPrototype:M}},function(t,e,n){var r=n(1).TypeError;t.exports=function(t){if(null==t)throw r("Can't call method on "+t);return t}},function(t,e,n){var r=n(106),i=n(54);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(t,e,n){var r=n(44),i=n(9);t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(t,e,n){var r=n(71);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,n){var r=n(1).String;t.exports=function(t){try{return r(t)}catch(e){return"Object"}}},function(t,e,n){var r=n(25),i=n(9),o=n(75);t.exports=!r&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var r=n(1),i=n(27),o=r.document,a=i(o)&&i(o.createElement);t.exports=function(t){return a?o.createElement(t):{}}},function(t,e,n){var r=n(25),i=n(9);t.exports=r&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(t,e,n){var r=n(1),i=n(36),o=n(5),a=n(78),s=n(72),u=r.Object;t.exports=s?function(t){return"symbol"==typeof t}:function(t){var e=i("Symbol");return o(e)&&a(e.prototype,u(t))}},function(t,e,n){var r=n(6);t.exports=r({}.isPrototypeOf)},function(t,e,n){var r=n(1),i=n(5),o=n(20),a=n(47),s=n(55),u=n(59),c=n(110),l=n(112).CONFIGURABLE,f=c.get,h=c.enforce,d=String(String).split("String");(t.exports=function(t,e,n,u){var c,f=!!u&&!!u.unsafe,p=!!u&&!!u.enumerable,v=!!u&&!!u.noTargetGet,y=u&&void 0!==u.name?u.name:e;i(n)&&("Symbol("===String(y).slice(0,7)&&(y="["+String(y).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(n,"name")||l&&n.name!==y)&&a(n,"name",y),(c=h(n)).source||(c.source=d.join("string"==typeof y?y:""))),t!==r?(f?!v&&t[e]&&(p=!0):delete t[e],p?t[e]=n:a(t,e,n)):p?t[e]=n:s(e,n)})(Function.prototype,"toString",(function(){return i(this)&&f(this).source||u(this)}))},function(t,e,n){var r=n(120),i=Math.floor,o=function(t,e){var n=t.length,u=i(n/2);return n<8?a(t,e):s(t,o(r(t,0,u),e),o(r(t,u),e),e)},a=function(t,e){for(var n,r,i=t.length,o=1;o<i;){for(r=o,n=t[o];r&&e(t[r-1],n)>0;)t[r]=t[--r];r!==o++&&(t[r]=n)}return t},s=function(t,e,n,r){for(var i=e.length,o=n.length,a=0,s=0;a<i||s<o;)t[a+s]=a<i&&s<o?r(e[a],n[s])<=0?e[a++]:n[s++]:a<i?e[a++]:n[s++];return t};t.exports=o},function(t,e,n){var r=n(48),i=Math.max,o=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):o(n,e)}},function(t,e,n){var r=n(45).match(/firefox\/(\d+)/i);t.exports=!!r&&+r[1]},function(t,e,n){var r=n(45);t.exports=/MSIE|Trident/.test(r)},function(t,e,n){var r=n(45).match(/AppleWebKit\/(\d+)\./);t.exports=!!r&&+r[1]},function(t,e,n){var r=n(25),i=n(43),o=n(123),a=n(58),s=n(49),u=n(57),c=n(20),l=n(74),f=Object.getOwnPropertyDescriptor;e.f=r?f:function(t,e){if(t=s(t),e=u(e),l)try{return f(t,e)}catch(n){}if(c(t,e))return a(!i(o.f,t,e),t[e])}},function(t,e,n){var r=n(1),i=n(6),o=n(9),a=n(46),s=r.Object,u=i("".split);t.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(t){return"String"==a(t)?u(t,""):s(t)}:s},function(t,e,n){var r=n(6),i=n(20),o=n(49),a=n(127).indexOf,s=n(61),u=r([].push);t.exports=function(t,e){var n,r=o(t),c=0,l=[];for(n in r)!i(s,n)&&i(r,n)&&u(l,n);for(;e.length>c;)i(r,n=e[c++])&&(~a(l,n)||u(l,n));return l}},function(t,e,n){"use strict";var r=n(9);t.exports=function(t,e){var n=[][t];return!!n&&r((function(){n.call(null,e||function(){return 1},1)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(4),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(10);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(10),i=n(4),o=n(13),a=n(26),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(4),i=n(29),o=n(13),a=n(138),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){if(n[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(63),i=n(64),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(4),i=n(13);e.traverseAncerstors=function t(e,n){var r=e.parentRequest;return null!==r&&(!!n(r)||t(r,n))};var o=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=o;var a=o(r.NAMED_TAG);e.namedConstraint=a;e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},function(t,e,n){"use strict";e.deprecate=function(t,e){var n=!0;return function(){return n&&(console.warn("DeprecationWarning: "+e),n=!1),t.apply(this,arguments)}}},function(t,e,n){var r=n(46);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,n){n(188)},function(t,e,n){"use strict";(function(t){n(15),n(99);var e,r,i=n(35),o=n(42),a=n(65),s=0,u=new WeakMap,c=function(){function n(t,e,n){this.observer=t,this.target=e,this.options=n,this.transientObservedNodes=[]}return n.prototype.enqueue=function(n){var i,o=this.observer.records,a=o.length;if(o.length>0){var s=function(t,n){return t===n?t:r&&function(t){return t===r||t===e}(t)?r:null}(o[a-1],n);if(s)return void(o[a-1]=s)}else i=this.observer,d.push(i),h||(h=!0,t(p));o[a]=n},n.prototype.addListeners=function(){this.addListeners_(this.target)},n.prototype.addListeners_=function(t){var e=this.options;e.attributes&&t.addEventListener(i.j.ATTR_MODIFIED,this,!0),e.childList&&t.addEventListener(i.j.INSERTED,this,!0),(e.childList||e.subtree)&&t.addEventListener(i.j.REMOVED,this,!0)},n.prototype.removeListeners=function(){this.removeListeners_(this.target)},n.prototype.removeListeners_=function(t){var e=this.options;e.attributes&&t.removeEventListener(i.j.ATTR_MODIFIED,this,!0),e.childList&&t.removeEventListener(i.j.INSERTED,this,!0),(e.childList||e.subtree)&&t.removeEventListener(i.j.REMOVED,this,!0)},n.prototype.removeTransientObservers=function(){var t=this.transientObservedNodes;this.transientObservedNodes=[],t.forEach((function(t){this.removeListeners_(t);for(var e=u.get(t),n=0;n<e.length;n++)if(e[n]===this){e.splice(n,1);break}}),this)},n.prototype.handleEvent=function(t){var n,s;switch(t.stopImmediatePropagation(),t.type){case i.j.ATTR_MODIFIED:var u=t.attrName,c=t.relatedNode.namespaceURI;s=t.target,(n=l("attributes",s)).attributeName=u,n.attributeNamespace=c;var h=t.attrChange===o.a.ADDITION?null:t.prevValue;f(s,(function(t){var i;if(t.attributes&&(!t.attributeFilter||!t.attributeFilter.length||-1!==t.attributeFilter.indexOf(u)||-1!==t.attributeFilter.indexOf(c)))return t.attributeOldValue?(i=h,r||((r=a.a.copy(e)).oldValue=i,r)):n}));break;case i.j.REMOVED:case i.j.INSERTED:s=t.relatedNode;var d=t.target,p=void 0,v=void 0;t.type===i.j.INSERTED?(p=[d],v=[]):(p=[],v=[d]);var y=d.previousSibling,g=d.nextSibling;(n=l("childList",s)).addedNodes=p,n.removedNodes=v,n.previousSibling=y,n.nextSibling=g,f(s,(function(t){if(t.childList)return n}))}e=r=void 0},n}();!function(){function t(t){this.callback=t,this.nodes=[],this.records=[],this.uid=s++}t.prototype.observe=function(t,e){if(!e.childList&&!e.attributes&&!e.characterData||e.attributeOldValue&&!e.attributes||e.attributeFilter&&e.attributeFilter.length&&!e.attributes||e.characterDataOldValue&&!e.characterData)throw new SyntaxError;var n,r=u.get(t);r||u.set(t,r=[]);for(var i=0;i<r.length;i++)if(r[i].observer===this){(n=r[i]).removeListeners(),n.options=e;break}n||(n=new c(this,t,e),r.push(n),this.nodes.push(t)),n.addListeners()},t.prototype.disconnect=function(){var t=this;this.nodes.forEach((function(e){for(var n=u.get(e),r=0;r<n.length;r++){var i=n[r];if(i.observer===t){i.removeListeners(),n.splice(r,1);break}}}),this),this.records=[]},t.prototype.takeRecords=function(){var t=this.records;return this.records=[],t}}();function l(t,n){return e=new a.a(t,n)}function f(t,e){for(var n=t;n;n=n.parentNode){var r=u.get(n);if(r)for(var i=0;i<r.length;i++){var o=r[i],a=o.options;if(n===t||a.subtree){var s=e(a);s&&o.enqueue(s)}}}}var h=!1,d=[];function p(){h=!1;var t=d;d=[],t.sort((function(t,e){return t.uid-e.uid}));var e=!1;t.forEach((function(t){var n=t.takeRecords();!function(t){t.nodes.forEach((function(e){var n=u.get(e);n&&n.forEach((function(e){e.observer===t&&e.removeTransientObservers()}))}))}(t),n.length&&(t.callback(n,t),e=!0)})),e&&p()}}).call(this,n(189).setImmediate)},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,f=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},r=function(t){o.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},h.clearImmediate=d}function d(t){delete c[t]}function p(t){if(l)setTimeout(p,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{d(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(31),n(67))},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(O){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(O){return{type:"throw",arg:O}}}t.wrap=u;var l={};function f(){}function h(){}function d(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(A([])));y&&y!==e&&n.call(y,i)&&(p=y);var g=d.prototype=f.prototype=Object.create(p);function m(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function E(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,s(g,"constructor",d),s(d,"constructor",h),h.displayName=s(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(_.prototype),s(_.prototype,o,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new _(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),s(g,a,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=A,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),b(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;b(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(i){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},,,,function(t,e){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(t,e,n){var r={};r[n(33)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,e){t.exports=!1},function(t,e,n){var r=n(1),i=n(43),o=n(27),a=n(77),s=n(108),u=n(109),c=n(33),l=r.TypeError,f=c("toPrimitive");t.exports=function(t,e){if(!o(t)||a(t))return t;var n,r=s(t,f);if(r){if(void 0===e&&(e="default"),n=i(r,t,e),!o(n)||a(n))return n;throw l("Can't convert object to primitive value")}return void 0===e&&(e="number"),u(t,e)}},function(t,e,n){var r=n(38);t.exports=function(t,e){var n=t[e];return null==n?void 0:r(n)}},function(t,e,n){var r=n(1),i=n(43),o=n(5),a=n(27),s=r.TypeError;t.exports=function(t,e){var n,r;if("string"===e&&o(n=t.toString)&&!a(r=i(n,t)))return r;if(o(n=t.valueOf)&&!a(r=i(n,t)))return r;if("string"!==e&&o(n=t.toString)&&!a(r=i(n,t)))return r;throw s("Can't convert object to primitive value")}},function(t,e,n){var r,i,o,a=n(111),s=n(1),u=n(6),c=n(27),l=n(47),f=n(20),h=n(54),d=n(60),p=n(61),v=s.TypeError,y=s.WeakMap;if(a||h.state){var g=h.state||(h.state=new y),m=u(g.get),_=u(g.has),E=u(g.set);r=function(t,e){if(_(g,t))throw new v("Object already initialized");return e.facade=t,E(g,t,e),e},i=function(t){return m(g,t)||{}},o=function(t){return _(g,t)}}else{var T=d("state");p[T]=!0,r=function(t,e){if(f(t,T))throw new v("Object already initialized");return e.facade=t,l(t,T,e),e},i=function(t){return f(t,T)?t[T]:{}},o=function(t){return f(t,T)}}t.exports={set:r,get:i,has:o,enforce:function(t){return o(t)?i(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=i(e)).type!==t)throw v("Incompatible receiver, "+t+" required");return n}}}},function(t,e,n){var r=n(1),i=n(5),o=n(59),a=r.WeakMap;t.exports=i(a)&&/native code/.test(o(a))},function(t,e,n){var r=n(25),i=n(20),o=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,s=i(o,"name"),u=s&&"something"===function(){}.name,c=s&&(!r||r&&a(o,"name").configurable);t.exports={EXISTS:s,PROPER:u,CONFIGURABLE:c}},function(t,e,n){var r=n(1),i=n(20),o=n(5),a=n(32),s=n(60),u=n(114),c=s("IE_PROTO"),l=r.Object,f=l.prototype;t.exports=u?l.getPrototypeOf:function(t){var e=a(t);if(i(e,c))return e[c];var n=e.constructor;return o(n)&&e instanceof n?n.prototype:e instanceof l?f:null}},function(t,e,n){var r=n(9);t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,n){var r=n(6),i=n(37),o=n(116);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(a){}return function(n,r){return i(n),o(r),e?t(n,r):n.__proto__=r,n}}():void 0)},function(t,e,n){var r=n(1),i=n(5),o=r.String,a=r.TypeError;t.exports=function(t){if("object"==typeof t||i(t))return t;throw a("Can't set "+o(t)+" as a prototype")}},function(t,e,n){var r=n(48),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},function(t,e,n){var r=n(1),i=n(119),o=r.RangeError;t.exports=function(t,e){var n=i(t);if(n%e)throw o("Wrong offset");return n}},function(t,e,n){var r=n(1),i=n(48),o=r.RangeError;t.exports=function(t){var e=i(t);if(e<0)throw o("The argument can't be less than 0");return e}},function(t,e,n){var r=n(1),i=n(81),o=n(28),a=n(121),s=r.Array,u=Math.max;t.exports=function(t,e,n){for(var r=o(t),c=i(e,r),l=i(void 0===n?r:n,r),f=s(u(l-c,0)),h=0;c<l;c++,h++)a(f,h,t[c]);return f.length=h,f}},function(t,e,n){"use strict";var r=n(57),i=n(34),o=n(58);t.exports=function(t,e,n){var a=r(e);a in t?i.f(t,a,o(0,n)):t[a]=n}},function(t,e,n){"use strict";n(22);var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var a=n(132),s=n(10),u=n(23),c=n(4),l=n(89),f=n(133),h=n(140),d=n(142),p=n(29),v=n(40),y=n(145),g=n(146),m=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=u.BindingScopeEnum.Transient;else if(e.defaultScope!==u.BindingScopeEnum.Singleton&&e.defaultScope!==u.BindingScopeEnum.Transient&&e.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=p.id(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new l.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new t,s=o([e,n],r).map((function(t){return f.getBindingDictionary(t)})),u=f.getBindingDictionary(a);function c(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s.forEach((function(t){c(t,u)})),a},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(t,e);return this._bindingDictionary.add(t,n),new d.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+v.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new g.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,c.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=f.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(y.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,u.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,c.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,u.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,c.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=f.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),h.resolve(n)}},t}();e.Container=m},function(t,e,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);e.f=o?function(t){var e=i(this,t);return!!e&&e.enumerable}:r},function(t,e,n){var r=n(20),i=n(125),o=n(85),a=n(34);t.exports=function(t,e,n){for(var s=i(e),u=a.f,c=o.f,l=0;l<s.length;l++){var f=s[l];r(t,f)||n&&r(n,f)||u(t,f,c(e,f))}}},function(t,e,n){var r=n(36),i=n(6),o=n(126),a=n(128),s=n(37),u=i([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(s(t)),n=a.f;return n?u(e,n(t)):e}},function(t,e,n){var r=n(87),i=n(62).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,i)}},function(t,e,n){var r=n(49),i=n(81),o=n(28),a=function(t){return function(e,n,a){var s,u=r(e),c=o(u),l=i(a,c);if(t&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((t||l in u)&&u[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var r=n(9),i=n(5),o=/#|\.prototype\./,a=function(t,e){var n=u[s(t)];return n==l||n!=c&&(i(e)?r(e):!!e)},s=a.normalize=function(t){return String(t).replace(o,".").toLowerCase()},u=a.data={},c=a.NATIVE="N",l=a.POLYFILL="P";t.exports=a},function(t,e,n){var r=n(1),i=n(38),o=n(32),a=n(86),s=n(28),u=r.TypeError,c=function(t){return function(e,n,r,c){i(n);var l=o(e),f=a(l),h=s(l),d=t?h-1:0,p=t?-1:1;if(r<2)for(;;){if(d in f){c=f[d],d+=p;break}if(d+=p,t?d<0:h<=d)throw u("Reduce of empty array with no initial value")}for(;t?d>=0:h>d;d+=p)d in f&&(c=n(c,f[d],d,l));return c}};t.exports={left:c(!1),right:c(!0)}},function(t,e,n){var r=n(46),i=n(1);t.exports="process"==r(i.process)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(23),i=n(29),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(134),i=n(10),o=n(23),a=n(4),s=n(90),u=n(40),c=n(135),l=n(13),f=n(136),h=n(137),d=n(139),p=n(92);function v(t){return t._bindingDictionary}function y(t,e,n,o,a){var s=g(n.container,a.serviceIdentifier),c=[];return s.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),s=g(n.container,a.serviceIdentifier)),c=e?s:s.filter((function(t){var e=new d.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)})),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a;throw s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s)}}(a.serviceIdentifier,c,a,n.container),c}function g(t,e){var n=[],r=v(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=g(t.parent,e)),n}e.getBindingDictionary=v,e.plan=function(t,e,n,r,v,g,m,_){void 0===_&&(_=!1);var E=new c.Context(e),T=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new p.Target(e,r,n,u);if(void 0!==i){var f=new l.Metadata(i,o);c.metadata.push(f)}return c}(n,r,v,"",g,m);try{return function t(e,n,r,a,s,u){var c,l;if(null===s){c=y(e,n,a,null,u),l=new d.Request(r,a,null,c,u);var p=new f.Plan(a,l);a.addPlan(p)}else c=y(e,n,a,s,u),l=s.addChildRequest(u.serviceIdentifier,c,u);c.forEach((function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var s=h.getDependencies(e,n.implementationType);if(!a.container.options.skipBaseClassChecks){var c=h.getBaseClassDependencyCount(e,n.implementationType);if(s.length<c){var f=i.ARGUMENTS_LENGTH_MISMATCH(h.getFunctionName(n.implementationType));throw new Error(f)}}s.forEach((function(n){t(e,!1,n.serviceIdentifier,a,r,n)}))}}))}(t,_,v,E,null,T),E}catch(b){throw s.isStackOverflowExeption(b)&&E.plan&&u.circularDependencyToException(E.plan.rootRequest),b}},e.createMockRequest=function(t,e,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",e,new l.Metadata(n,r)),a=new c.Context(t);return new d.Request(e,a,null,[],i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0;e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(29),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;var r=function(t,e){this.parentContext=t,this.rootRequest=e};e.Plan=r},function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(91),o=n(10),a=n(23),s=n(4),u=n(40);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var c=n(92);function l(t,e,n,i){var s=t.getConstructorMetadata(n),u=s.compilerGeneratedMetadata;if(void 0===u){var l=o.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(l)}var d=s.userGeneratedMetadata,p=Object.keys(d),v=0===n.length&&p.length>0,y=p.length>n.length,g=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=f(a,t,e,n,r);null!==s&&o.push(s)}return o}(i,e,u,d,v||y?p.length:n.length),m=function t(e,n){for(var i=e.getPropertiesMetadata(n),o=[],s=Object.keys(i),u=0,l=s;u<l.length;u++){var f=l[u],d=i[f],p=h(i[f]),v=p.targetName||f,y=p.inject||p.multiInject,g=new c.Target(a.TargetTypeEnum.ClassProperty,v,y);g.metadata=d,o.push(g)}var m=Object.getPrototypeOf(n.prototype).constructor;if(m!==Object){var _=t(e,m);o=r(r([],o),_)}return o}(t,n);return r(r([],g),m)}function f(t,e,n,r,s){var u=s[t.toString()]||[],l=h(u),f=!0!==l.unmanaged,d=r[t],p=l.inject||l.multiInject;if((d=p||d)instanceof i.LazyServiceIdentifer&&(d=d.unwrap()),f){if(!e&&(d===Object||d===Function||void 0===d)){var v=o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(v)}var y=new c.Target(a.TargetTypeEnum.ConstructorArgument,l.targetName,d);return y.metadata=u,y}return null}function h(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return l(t,u.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=l(e,u.getFunctionName(r),r,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,c=i.length-a;return c>0?c:t(e,r)}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var r=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(29),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(10),i=n(23),o=n(90),a=n(40),s=n(141),u=function(t,e,n){try{return n()}catch(i){throw o.isStackOverflowExeption(i)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):i}};e.resolve=function(t){return function t(e){return function(n){n.parentContext.setCurrentRequest(n);var o=n.bindings,c=n.childRequests,l=n.target&&n.target.isArray(),f=!(n.parentRequest&&n.parentRequest.target&&n.target&&n.parentRequest.target.matchesArray(n.target.serviceIdentifier));if(l&&f)return c.map((function(n){return t(e)(n)}));var h=null;if(!n.target.isOptional()||0!==o.length){var d=o[0],p=d.scope===i.BindingScopeEnum.Singleton,v=d.scope===i.BindingScopeEnum.Request;if(p&&d.activated)return d.cache;if(v&&null!==e&&e.has(d.id))return e.get(d.id);if(d.type===i.BindingTypeEnum.ConstantValue)h=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Function)h=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Constructor)h=d.implementationType;else if(d.type===i.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)h=u("toDynamicValue",d.serviceIdentifier,(function(){return d.dynamicValue(n.parentContext)}));else if(d.type===i.BindingTypeEnum.Factory&&null!==d.factory)h=u("toFactory",d.serviceIdentifier,(function(){return d.factory(n.parentContext)}));else if(d.type===i.BindingTypeEnum.Provider&&null!==d.provider)h=u("toProvider",d.serviceIdentifier,(function(){return d.provider(n.parentContext)}));else{if(d.type!==i.BindingTypeEnum.Instance||null===d.implementationType){var y=a.getServiceIdentifierAsString(n.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+y)}h=s.resolveInstance(d.implementationType,c,t(e))}return"function"==typeof d.onActivation&&(h=d.onActivation(n.parentContext,h)),p&&(d.cache=h,d.activated=!0),v&&null!==e&&!e.has(d.id)&&e.set(d.id,h),h}}}(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(10),o=n(23),a=n(4);e.resolveInstance=function(t,e,n){var s,u,c=null;if(e.length>0){var l=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n);u=l,c=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var o=i[n];t[r]=o})),t}(c=new((s=t).bind.apply(s,r([void 0],u))),e,n)}else c=new t;return function(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(r){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,r.message))}}}(t,c),c}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(10),i=n(23),o=n(143),a=n(93),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(144),i=n(63),o=n(64),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(23),i=n(93),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var r=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(10),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(r.NULL_ARGUMENT);if(null==e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(29),i=function(t){this.id=r.id(),this.registry=t};e.ContainerModule=i;var o=function(t){this.id=r.id(),this.registry=t};e.AsyncContainerModule=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(10),i=n(4);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(13),i=n(26);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(4),i=n(13),o=n(26);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(4),i=n(13),o=n(26);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(4),i=n(13),o=n(26);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(4),i=n(13),o=n(26);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(4),i=n(13),o=n(26);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(10),i=n(4),o=n(13);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0;e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}}},function(t,e,n){var r=n(1),i=n(53),o=r.String;t.exports=function(t){if("Symbol"===i(t))throw TypeError("Cannot convert a Symbol value to a string");return o(t)}},function(t,e,n){"use strict";e.__esModule=!0,e.SyncHook=n(159),e.SyncBailHook=n(163),e.SyncWaterfallHook=n(164),e.SyncLoopHook=n(165),e.AsyncParallelHook=n(166),e.AsyncParallelBailHook=n(167),e.AsyncSeriesHook=n(168),e.AsyncSeriesBailHook=n(169),e.AsyncSeriesLoopHook=n(170),e.AsyncSeriesWaterfallHook=n(171),e.HookMap=n(172),e.MultiHook=n(173)},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onDone,r=t.rethrowIfPossible;return this.callTapsSeries({onError:function(t,n){return e(n)},onDone:n,rethrowIfPossible:r})}}]),n}(n(19))),f=function(){throw new Error("tapAsync is not supported on a SyncHook")},h=function(){throw new Error("tapPromise is not supported on a SyncHook")},d=function(t){return l.setup(this,t),l.create(t)};function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=p,n.tapAsync=f,n.tapPromise=h,n.compile=d,n}p.prototype=null,t.exports=p},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,n(e,r)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onResult,r=t.resultReturns,i=t.onDone,o=t.rethrowIfPossible;return this.callTapsSeries({onError:function(t,n){return e(n)},onResult:function(t,e,r){return"if(".concat(e," !== undefined) {\n").concat(n(e),";\n} else {\n").concat(r(),"}\n")},resultReturns:r,onDone:i,rethrowIfPossible:o})}}]),n}(n(19))),f=function(){throw new Error("tapAsync is not supported on a SyncBailHook")},h=function(){throw new Error("tapPromise is not supported on a SyncBailHook")},d=function(t){return l.setup(this,t),l.create(t)};function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=p,n.tapAsync=f,n.tapPromise=h,n.compile=d,n}p.prototype=null,t.exports=p},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=this,n=t.onError,r=t.onResult,i=t.resultReturns,o=t.rethrowIfPossible;return this.callTapsSeries({onError:function(t,e){return n(e)},onResult:function(t,n,r){var i="";return i+="if(".concat(n," !== undefined) {\n"),i+="".concat(e._args[0]," = ").concat(n,";\n"),i+="}\n",i+=r()},onDone:function(){return r(e._args[0])},doneReturns:i,rethrowIfPossible:o})}}]),n}(n(19))),f=function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")},h=function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")},d=function(t){return l.setup(this,t),l.create(t)};function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t.length<1)throw new Error("Waterfall hooks must have at least one argument");var n=new c(t,e);return n.constructor=p,n.tapAsync=f,n.tapPromise=h,n.compile=d,n}p.prototype=null,t.exports=p},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onDone,r=t.rethrowIfPossible;return this.callTapsLooping({onError:function(t,n){return e(n)},onDone:n,rethrowIfPossible:r})}}]),n}(n(19))),f=function(){throw new Error("tapAsync is not supported on a SyncLoopHook")},h=function(){throw new Error("tapPromise is not supported on a SyncLoopHook")},d=function(t){return l.setup(this,t),l.create(t)};function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=p,n.tapAsync=f,n.tapPromise=h,n.compile=d,n}p.prototype=null,t.exports=p},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onDone;return this.callTapsParallel({onError:function(t,n,r,i){return e(n)+i(!0)},onDone:n})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onResult,r=t.onDone,i="";return i+="var _results = new Array(".concat(this.options.taps.length,");\n"),i+="var _checkDone = function() {\n",i+="for(var i = 0; i < _results.length; i++) {\n",i+="var item = _results[i];\n",i+="if(item === undefined) return false;\n",i+="if(item.result !== undefined) {\n",i+=n("item.result"),i+="return true;\n",i+="}\n",i+="if(item.error) {\n",i+=e("item.error"),i+="return true;\n",i+="}\n",i+="}\n",i+="return false;\n",i+="}\n",i+=this.callTapsParallel({onError:function(t,e,n,r){var i="";return i+="if(".concat(t," < _results.length && ((_results.length = ").concat(t+1,"), (_results[").concat(t,"] = { error: ").concat(e," }), _checkDone())) {\n"),i+=r(!0),i+="} else {\n",i+=n(),i+="}\n"},onResult:function(t,e,n,r){var i="";return i+="if(".concat(t," < _results.length && (").concat(e," !== undefined && (_results.length = ").concat(t+1,"), (_results[").concat(t,"] = { result: ").concat(e," }), _checkDone())) {\n"),i+=r(!0),i+="} else {\n",i+=n(),i+="}\n"},onTap:function(t,e,n,r){var i="";return t>0&&(i+="if(".concat(t," >= _results.length) {\n"),i+=n(),i+="} else {\n"),i+=e(),t>0&&(i+="}\n"),i},onDone:r})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onDone;return this.callTapsSeries({onError:function(t,n,r,i){return e(n)+i(!0)},onDone:n})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onResult,r=t.resultReturns,i=t.onDone;return this.callTapsSeries({onError:function(t,n,r,i){return e(n)+i(!0)},onResult:function(t,e,r){return"if(".concat(e," !== undefined) {\n").concat(n(e),"\n} else {\n").concat(r(),"}\n")},resultReturns:r,onDone:i})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=t.onError,n=t.onDone;return this.callTapsLooping({onError:function(t,n,r,i){return e(n)+i(!0)},onDone:n})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(16),a=n(17),s=n(18);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var c=n(14),l=new(function(t){o(n,t);var e=u(n);function n(){return r(this,n),e.apply(this,arguments)}return i(n,[{key:"content",value:function(t){var e=this,n=t.onError,r=t.onResult;t.onDone;return this.callTapsSeries({onError:function(t,e,r,i){return n(e)+i(!0)},onResult:function(t,n,r){var i="";return i+="if(".concat(n," !== undefined) {\n"),i+="".concat(e._args[0]," = ").concat(n,";\n"),i+="}\n",i+=r()},onDone:function(){return r(e._args[0])}})}}]),n}(n(19))),f=function(t){return l.setup(this,t),l.create(t)};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t.length<1)throw new Error("Waterfall hooks must have at least one argument");var n=new c(t,e);return n.constructor=h,n.compile=f,n._call=void 0,n.call=void 0,n}h.prototype=null,t.exports=h},function(t,e,n){"use strict";var r=n(7),i=n(8),o=n(95),a=function(t,e){return e},s=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r(this,t),this._map=new Map,this.name=n,this._factory=e,this._interceptors=[]}return i(t,[{key:"get",value:function(t){return this._map.get(t)}},{key:"for",value:function(t){var e=this.get(t);if(void 0!==e)return e;for(var n=this._factory(t),r=this._interceptors,i=0;i<r.length;i++)n=r[i].factory(t,n);return this._map.set(t,n),n}},{key:"intercept",value:function(t){this._interceptors.push(Object.assign({factory:a},t))}}]),t}();s.prototype.tap=o.deprecate((function(t,e,n){return this.for(t).tap(e,n)}),"HookMap#tap(key,) is deprecated. Use HookMap#for(key).tap() instead."),s.prototype.tapAsync=o.deprecate((function(t,e,n){return this.for(t).tapAsync(e,n)}),"HookMap#tapAsync(key,) is deprecated. Use HookMap#for(key).tapAsync() instead."),s.prototype.tapPromise=o.deprecate((function(t,e,n){return this.for(t).tapPromise(e,n)}),"HookMap#tapPromise(key,) is deprecated. Use HookMap#for(key).tapPromise() instead."),t.exports=s},function(t,e,n){"use strict";var r=n(7),i=n(8);function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n(14);var s=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r(this,t),this.hooks=e,this.name=n}return i(t,[{key:"tap",value:function(t,e){var n,r=o(this.hooks);try{for(r.s();!(n=r.n()).done;){n.value.tap(t,e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"tapAsync",value:function(t,e){var n,r=o(this.hooks);try{for(r.s();!(n=r.n()).done;){n.value.tapAsync(t,e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"tapPromise",value:function(t,e){var n,r=o(this.hooks);try{for(r.s();!(n=r.n()).done;){n.value.tapPromise(t,e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"isUsed",value:function(){var t,e=o(this.hooks);try{for(e.s();!(t=e.n()).done;){if(t.value.isUsed())return!0}}catch(n){e.e(n)}finally{e.f()}return!1}},{key:"intercept",value:function(t){var e,n=o(this.hooks);try{for(n.s();!(e=n.n()).done;){e.value.intercept(t)}}catch(r){n.e(r)}finally{n.f()}}},{key:"withOptions",value:function(e){return new t(this.hooks.map((function(t){return t.withOptions(e)})),this.name)}}]),t}();t.exports=s},function(t,e,n){"use strict";var r=n(39),i=n(175),o=n(32),a=n(28),s=n(48),u=n(177);r({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=o(this),n=a(e),r=u(e,0);return r.length=i(r,e,e,n,0,void 0===t?1:s(t)),r}})},function(t,e,n){"use strict";var r=n(1),i=n(96),o=n(28),a=n(176),s=r.TypeError,u=function(t,e,n,r,c,l,f,h){for(var d,p,v=c,y=0,g=!!f&&a(f,h);y<r;){if(y in n){if(d=g?g(n[y],y,e):n[y],l>0&&i(d))p=o(d),v=u(t,e,d,p,v,l-1)-1;else{if(v>=9007199254740991)throw s("Exceed the acceptable array length");t[v]=d}v++}y++}return v};t.exports=u},function(t,e,n){var r=n(6),i=n(38),o=n(52),a=r(r.bind);t.exports=function(t,e){return i(t),void 0===e?t:o?a(t,e):function(){return t.apply(e,arguments)}}},function(t,e,n){var r=n(178);t.exports=function(t,e){return new(r(t))(0===e?0:e)}},function(t,e,n){var r=n(1),i=n(96),o=n(179),a=n(27),s=n(33)("species"),u=r.Array;t.exports=function(t){var e;return i(t)&&(e=t.constructor,(o(e)&&(e===u||i(e.prototype))||a(e)&&null===(e=e[s]))&&(e=void 0)),void 0===e?u:e}},function(t,e,n){var r=n(6),i=n(9),o=n(5),a=n(53),s=n(36),u=n(59),c=function(){},l=[],f=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,d=r(h.exec),p=!h.exec(c),v=function(t){if(!o(t))return!1;try{return f(c,l,t),!0}catch(e){return!1}},y=function(t){if(!o(t))return!1;switch(a(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(h,u(t))}catch(e){return!0}};y.sham=!0,t.exports=!f||i((function(){var t;return v(v.call)||!v(Object)||!v((function(){t=!0}))||t}))?y:v},function(t,e,n){n(181)("flat")},function(t,e,n){var r=n(33),i=n(182),o=n(34),a=r("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),t.exports=function(t){s[a][t]=!0}},function(t,e,n){var r,i=n(37),o=n(183),a=n(62),s=n(61),u=n(185),c=n(75),l=n(60),f=l("IE_PROTO"),h=function(){},d=function(t){return"<script>"+t+"<\/script>"},p=function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e},v=function(){try{r=new ActiveXObject("htmlfile")}catch(i){}var t,e;v="undefined"!=typeof document?document.domain&&r?p(r):((e=c("iframe")).style.display="none",u.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(d("document.F=Object")),t.close(),t.F):p(r);for(var n=a.length;n--;)delete v.prototype[a[n]];return v()};s[f]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(h.prototype=i(t),n=new h,h.prototype=null,n[f]=t):n=v(),void 0===e?n:o.f(n,e)}},function(t,e,n){var r=n(25),i=n(76),o=n(34),a=n(37),s=n(49),u=n(184);e.f=r&&!i?Object.defineProperties:function(t,e){a(t);for(var n,r=s(e),i=u(e),c=i.length,l=0;c>l;)o.f(t,n=i[l++],r[n]);return t}},function(t,e,n){var r=n(87),i=n(62);t.exports=Object.keys||function(t){return r(t,i)}},function(t,e,n){var r=n(36);t.exports=r("document","documentElement")},function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return p}));var i,o=1,a="object"==typeof self&&self.self==self?self:"object"==typeof t&&t.global==t?t:{},s=Date.now(),u={},c=Date.now(),l=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");var e=Date.now(),n=e-c,r=n>16?0:16-n,i=o++;return u[i]=t,Object.keys(u).length>1||setTimeout((function(){c=e;var t=u;u={},Object.keys(t).forEach((function(e){return t[e](a.performance&&"function"==typeof a.performance.now?a.performance.now():Date.now()-s)}))}),r),i},f=function(t){delete u[t]},h=function(t){return"string"!=typeof t?l:""===t?a.requestAnimationFrame:a[t+"RequestAnimationFrame"]},d=function(t,e){for(var n=0;void 0!==t[n];){if(e(t[n]))return t[n];n+=1}}(["","webkit","moz","ms","o"],(function(t){return!!h(t)})),p=h(d),v="string"!=typeof(i=d)?f:""===i?a.cancelAnimationFrame:a[i+"CancelAnimationFrame"]||a[i+"CancelRequestAnimationFrame"];a.requestAnimationFrame=p,a.cancelAnimationFrame=v,r.exports&&(r.exports={requestAnimationFrame:p,cancelAnimationFrame:v})}).call(this,n(31),n(187)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){n(39)({global:!0},{globalThis:n(1)})},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(99),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(31))},function(t,e,n){t.exports=n(100)},function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,u,c,l,d,p,y=e&&e.length,g=y?e[0]*n:t.length,m=i(t,0,g,n,!0),_=[];if(!m||m.next===m.prev)return _;if(y&&(m=function(t,e,n,r){var a,s,u,c,l,d=[];for(a=0,s=e.length;a<s;a++)u=e[a]*r,c=a<s-1?e[a+1]*r:t.length,(l=i(t,u,c,r,!1))===l.next&&(l.steiner=!0),d.push(v(l));for(d.sort(f),a=0;a<d.length;a++)n=o(n=h(d[a],n),n.next);return n}(t,e,m,n)),t.length>80*n){r=u=t[0],s=c=t[1];for(var E=n;E<g;E+=n)(l=t[E])<r&&(r=l),(d=t[E+1])<s&&(s=d),l>u&&(u=l),d>c&&(c=d);p=0!==(p=Math.max(u-r,c-s))?1/p:0}return a(m,_,n,r,s,p),_}function i(t,e,n,r,i){var o,a;if(i===C(t,e,n,r)>0)for(o=e;o<n;o+=r)a=S(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=S(o,t[o],t[o+1],a);return a&&_(a,a.next)&&(O(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(O(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,f,h){if(t){!h&&f&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,f);for(var d,v,y=t;t.prev!==t.next;)if(d=t.prev,v=t.next,f?u(t,r,i,f):s(t))e.push(d.i/n),e.push(t.i/n),e.push(v.i/n),O(t),t=v.next,y=v.next;else if((t=v)===y){h?1===h?a(t=c(o(t),e,n),e,n,r,i,f,2):2===h&&l(t,e,n,r,i,f):a(o(t),e,n,r,i,f,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(m(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(y(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(m(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=p(s,u,e,n,r),h=p(c,l,e,n,r),d=t.prevZ,v=t.nextZ;d&&d.z>=f&&v&&v.z<=h;){if(d!==t.prev&&d!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,v!==t.prev&&v!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;d&&d.z>=f;){if(d!==t.prev&&d!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;v&&v.z<=h;){if(v!==t.prev&&v!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!_(i,a)&&E(i,r,r.next,a)&&R(i,a)&&R(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),O(r),O(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,s){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&g(u,c)){var l=A(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,r,i,s),void a(l,e,n,r,i,s)}c=c.next}u=u.next}while(u!==t)}function f(t,e){return t.x-e.x}function h(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,f=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&y(o<f?i:a,o,l,f,o<f?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),R(r,t)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&d(n,r)))&&(n=r,h=u)),r=r.next}while(r!==c);return n}(t,e);if(!n)return e;var r=A(n,t),i=o(n,n.next);return o(r,r.next),e===n?i:e}function d(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&E(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(R(t,e)&&R(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||_(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function E(t,e,n,r){var i=b(m(t,e,n)),o=b(m(t,e,r)),a=b(m(n,r,t)),s=b(m(n,r,e));return i!==o&&a!==s||(!(0!==i||!T(t,n,e))||(!(0!==o||!T(t,r,e))||(!(0!==a||!T(n,t,r))||!(0!==s||!T(n,e,r)))))}function T(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function b(t){return t>0?1:t<0?-1:0}function R(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function A(t,e){var n=new M(t.i,t.x,t.y),r=new M(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(t,e,n,r){var i=new M(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function O(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}n(15),t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(C(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(C(t,c,l,n))}var f=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,d=r[s+1]*n,p=r[s+2]*n;f+=Math.abs((t[h]-t[p])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[p+1]-t[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},function(t,e,n){"use strict";n.r(e),n.d(e,"render",(function(){return Xo}));function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=n(51);var a=n(35),s=n(0),u=n(2),c=(n(97),function(){function t(){}var e;return e=t,t.prototype.apply=function(t){var n=this,r=function(e){t.hooks.pointerMove.call(e)},i=function(e){t.hooks.pointerUp.call(e)},o=function(e){t.hooks.pointerDown.call(e)},s=function(e){t.hooks.pointerOver.call(e)},u=function(e){t.hooks.pointerOut.call(e)},c=function(e){t.hooks.pointerWheel.call(e)};t.hooks.init.tap(e.tag,(function(){var t=n.contextService.getDomElement();a.z?(globalThis.document.addEventListener("pointermove",r,!0),t.addEventListener("pointerdown",o,!0),t.addEventListener("pointerleave",u,!0),t.addEventListener("pointerover",s,!0),globalThis.addEventListener("pointerup",i,!0)):(globalThis.document.addEventListener("mousemove",r,!0),t.addEventListener("mousedown",o,!0),t.addEventListener("mouseout",u,!0),t.addEventListener("mouseover",s,!0),globalThis.addEventListener("mouseup",i,!0)),a.A&&(t.addEventListener("touchstart",o,!0),t.addEventListener("touchend",i,!0),t.addEventListener("touchmove",r,!0)),t.addEventListener("wheel",c,{passive:!0,capture:!0})})),t.hooks.destroy.tap(e.tag,(function(){var t=n.contextService.getDomElement();a.z?(globalThis.document.removeEventListener("pointermove",r,!0),t.removeEventListener("pointerdown",o,!0),t.removeEventListener("pointerleave",u,!0),t.removeEventListener("pointerover",s,!0),globalThis.removeEventListener("pointerup",i,!0)):(globalThis.document.removeEventListener("mousemove",r,!0),t.removeEventListener("mousedown",o,!0),t.removeEventListener("mouseout",u,!0),t.removeEventListener("mouseover",s,!0),globalThis.removeEventListener("mouseup",i,!0)),a.A&&(t.removeEventListener("touchstart",o,!0),t.removeEventListener("touchend",i,!0),t.removeEventListener("touchmove",r,!0)),t.removeEventListener("wheel",c,!0)}))},t.tag="DOMInteractionPlugin",Object(s.c)([Object(u.g)(a.g),Object(s.f)("design:type",Object)],t.prototype,"contextService",void 0),t=e=Object(s.c)([Object(u.j)({contrib:a.s})],t)}()),l=Object(u.c)((function(t){t(c)})),f=function(){function t(){}return t.prototype.init=function(t){t.load(l,!0)},t.prototype.destroy=function(t){t.unload(l)},t}(),h=n(190),d=n.n(h),p=(n(11),n(12),n(24),n(15),n(22),n(100),n(3)),v=n(41),y=n(191),g=n.n(y);function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var E=1e20,T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.fontSize,r=void 0===n?24:n,i=e.buffer,o=void 0===i?3:i,a=e.radius,s=void 0===a?8:a,u=e.cutoff,c=void 0===u?.25:u,l=e.fontFamily,f=void 0===l?"sans-serif":l,h=e.fontWeight,d=void 0===h?"normal":h,p=e.fontStyle,v=void 0===p?"normal":p;m(this,t),this.buffer=o,this.cutoff=c,this.radius=s;var y=this.size=r+4*o,g=this._createCanvas(y),_=this.ctx=g.getContext("2d",{willReadFrequently:!0});_.font="".concat(v," ").concat(d," ").concat(r,"px ").concat(f),_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}var e,n,r;return e=t,(n=[{key:"_createCanvas",value:function(t){var e=document.createElement("canvas");return e.width=e.height=t,e}},{key:"draw",value:function(t){var e=this.ctx.measureText(t),n=e.width,r=e.actualBoundingBoxAscent,i=e.actualBoundingBoxDescent,o=e.actualBoundingBoxLeft,a=e.actualBoundingBoxRight,s=Math.ceil(r),u=Math.min(this.size-this.buffer,Math.ceil(a-o)),c=Math.min(this.size-this.buffer,s+Math.ceil(i)),l=u+2*this.buffer,f=c+2*this.buffer,h=Math.max(l*f,0),d=new Uint8ClampedArray(h),p={data:d,width:l,height:f,glyphWidth:u,glyphHeight:c,glyphTop:s,glyphLeft:0,glyphAdvance:n};if(0===u||0===c)return p;var v=this.ctx,y=this.buffer,g=this.gridInner,m=this.gridOuter;v.clearRect(y,y,u,c),v.fillText(t,y,y+s);var _=v.getImageData(y,y,u,c);m.fill(E,0,h),g.fill(0,0,h);for(var T=0;T<c;T++)for(var R=0;R<u;R++){var A=_.data[4*(T*u+R)+3]/255;if(0!==A){var S=(T+y)*l+R+y;if(1===A)m[S]=0,g[S]=E;else{var O=.5-A;m[S]=O>0?O*O:0,g[S]=O<0?O*O:0}}}b(m,0,0,l,f,l,this.f,this.v,this.z),b(g,y,y,u,c,l,this.f,this.v,this.z);for(var M=0;M<h;M++){var C=Math.sqrt(m[M])-Math.sqrt(g[M]);d[M]=Math.round(255-255*(C/this.radius+this.cutoff))}return p}}])&&_(e.prototype,n),r&&_(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function b(t,e,n,r,i,o,a,s,u){for(var c=e;c<e+r;c++)R(t,n*o+c,o,i,a,s,u);for(var l=n;l<n+i;l++)R(t,l*o+e,1,r,a,s,u)}function R(t,e,n,r,i,o,a){o[0]=0,a[0]=-E,a[1]=E,i[0]=t[e];for(var s=1,u=0,c=0;s<r;s++){i[s]=t[e+s*n];var l=s*s;do{var f=o[u];c=(i[s]-i[f]+l-f*f)/(s-f)/2}while(c<=a[u]&&--u>-1);o[++u]=s,a[u]=c,a[u+1]=E}for(var h=0,d=0;h<r;h++){for(;a[d+1]<h;)d++;var p=o[d],v=h-p;t[e+h*n]=i[p]+v*v}}function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function O(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(c){return void n(c)}s.done?e(u):Promise.resolve(u).then(r,i)}function M(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){O(o,r,i,a,s,"next",t)}function s(t){O(o,r,i,a,s,"throw",t)}a(void 0)}))}}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e&&x(t.prototype,e),n&&x(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function L(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return F(t)}function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=B(t);if(e){var i=B(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return L(this,n)}}function U(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}function G(){return(G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=U(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function j(t,e){return X(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||Y(t,e)||q()}function V(t){return X(t)||H(t)||Y(t)||q()}function W(t){return function(t){if(Array.isArray(t))return z(t)}(t)||H(t)||Y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t){if(Array.isArray(t))return t}function H(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function Y(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function K(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Y(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var Z=N((function t(){C(this,t),this.pickingId=void 0,this.encodedPickingColor=void 0,this.meshes=[]}));Z.tag="c-renderable-3d";var Q,J,$,tt,et,nt,rt,it,ot,at,st,ut,ct,lt,ft,ht,dt,pt,vt,yt,gt,mt,_t,Et,Tt,bt,Rt,At,St=function(){function t(){C(this,t),this.counter=0,this.id2DisplayObjectMap={}}return N(t,[{key:"getId",value:function(t){var e=this.counter++;return this.id2DisplayObjectMap[e]=t,e}},{key:"getById",value:function(t){return this.id2DisplayObjectMap[t]}},{key:"reset",value:function(){this.counter=0,this.id2DisplayObjectMap={}}},{key:"decodePickingColor",value:function(t){var e=j(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"encodePickingColor",value:function(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}}]),t}();function Ot(t,e,n,r){return{dimension:lt.n2D,pixelFormat:t,width:e,height:n,depth:1,numLevels:r,usage:ft.Sampled}}function Mt(t,e,n){return t<<16|e<<8|n}function Ct(t){return t>>>8&255}function xt(t){return t>>>16&255}function Nt(t){return 255&t}function Pt(t){switch(t){case mt.F32:case mt.U32:case mt.S32:return 4;case mt.U16:case mt.S16:case mt.F16:return 2;case mt.U8:case mt.S8:return 1;default:throw"whoops"}}function It(t){return Pt(xt(t))}function Bt(t){return Pt(xt(t))*Ct(t)}function Dt(t){var e=Nt(t);if(e&Et.Depth)return pt.Depth;if(e&Et.Normalized)return pt.Float;var n=xt(t);if(n===mt.F16||n===mt.F32)return pt.Float;if(n===mt.U8||n===mt.U16||n===mt.U32)return pt.Uint;if(n===mt.S8||n===mt.S16||n===mt.S32)return pt.Sint;throw"whoops"}function wt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)throw console.error((new Error).stack),new Error("Assert fail: ".concat(e))}function Ft(t){if(null!=t)return t;throw new Error("Missing object")}function Lt(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}function kt(t,e){t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a}function Ut(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}function Gt(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{r:t,g:e,b:n,a:r}}St=Object(s.c)([Object(u.j)()],St),function(t){t[t.Buffer=0]="Buffer",t[t.Texture=1]="Texture",t[t.RenderTarget=2]="RenderTarget",t[t.Sampler=3]="Sampler",t[t.Program=4]="Program",t[t.Bindings=5]="Bindings",t[t.InputLayout=6]="InputLayout",t[t.InputState=7]="InputState",t[t.RenderPipeline=8]="RenderPipeline",t[t.ComputePipeline=9]="ComputePipeline",t[t.Readback=10]="Readback",t[t.QueryPool=11]="QueryPool"}(Q||(Q={})),function(t){t[t.Never=512]="Never",t[t.Less=513]="Less",t[t.Equal=514]="Equal",t[t.LessEqual=515]="LessEqual",t[t.Greater=516]="Greater",t[t.NotEqual=517]="NotEqual",t[t.GreaterEqual=518]="GreaterEqual",t[t.Always=519]="Always"}(J||(J={})),function(t){t[t.CCW=2305]="CCW",t[t.CW=2304]="CW"}($||($={})),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.FrontAndBack=3]="FrontAndBack"}(tt||(tt={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Src=768]="Src",t[t.OneMinusSrc=769]="OneMinusSrc",t[t.Dst=774]="Dst",t[t.OneMinusDst=775]="OneMinusDst",t[t.SrcAlpha=770]="SrcAlpha",t[t.OneMinusSrcAlpha=771]="OneMinusSrcAlpha",t[t.DstAlpha=772]="DstAlpha",t[t.OneMinusDstAlpha=773]="OneMinusDstAlpha"}(et||(et={})),function(t){t[t.Add=32774]="Add",t[t.Subtract=32778]="Subtract",t[t.ReverseSubtract=32779]="ReverseSubtract"}(nt||(nt={})),function(t){t[t.Clamp=0]="Clamp",t[t.Repeat=1]="Repeat",t[t.Mirror=2]="Mirror"}(rt||(rt={})),function(t){t[t.Point=0]="Point",t[t.Bilinear=1]="Bilinear"}(it||(it={})),function(t){t[t.NoMip=0]="NoMip",t[t.Nearest=1]="Nearest",t[t.Linear=2]="Linear"}(ot||(ot={})),function(t){t[t.Points=0]="Points",t[t.Triangles=1]="Triangles",t[t.TriangleStrip=2]="TriangleStrip",t[t.Lines=3]="Lines",t[t.LineStrip=4]="LineStrip"}(at||(at={})),function(t){t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(st||(st={})),function(t){t[t.Static=1]="Static",t[t.Dynamic=2]="Dynamic"}(ut||(ut={})),function(t){t[t.PerVertex=1]="PerVertex",t[t.PerInstance=2]="PerInstance"}(ct||(ct={})),function(t){t[t.n2D=0]="n2D",t[t.n2DArray=1]="n2DArray",t[t.n3D=2]="n3D",t[t.Cube=3]="Cube"}(lt||(lt={})),function(t){t[t.Sampled=1]="Sampled",t[t.RenderTarget=2]="RenderTarget"}(ft||(ft={})),function(t){t[t.None=0]="None",t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.RGB=7]="RGB",t[t.AllChannels=15]="AllChannels"}(ht||(ht={})),function(t){t[t.Keep=7680]="Keep",t[t.Zero=0]="Zero",t[t.Replace=7681]="Replace",t[t.Invert=5386]="Invert",t[t.IncrementClamp=7682]="IncrementClamp",t[t.DecrementClamp=7683]="DecrementClamp",t[t.IncrementWrap=34055]="IncrementWrap",t[t.DecrementWrap=34056]="DecrementWrap"}(dt||(dt={})),function(t){t[t.Float=0]="Float",t[t.Uint=1]="Uint",t[t.Sint=2]="Sint",t[t.Depth=3]="Depth"}(pt||(pt={})),function(t){t[t.LowerLeft=0]="LowerLeft",t[t.UpperLeft=1]="UpperLeft"}(vt||(vt={})),function(t){t[t.NegativeOne=0]="NegativeOne",t[t.Zero=1]="Zero"}(yt||(yt={})),function(t){t[t.OcclusionConservative=0]="OcclusionConservative"}(gt||(gt={})),function(t){t[t.U8=1]="U8",t[t.U16=2]="U16",t[t.U32=3]="U32",t[t.S8=4]="S8",t[t.S16=5]="S16",t[t.S32=6]="S32",t[t.F16=7]="F16",t[t.F32=8]="F32",t[t.BC1=65]="BC1",t[t.BC2=66]="BC2",t[t.BC3=67]="BC3",t[t.BC4_UNORM=68]="BC4_UNORM",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5_UNORM=70]="BC5_UNORM",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.U16_PACKED_5551=97]="U16_PACKED_5551",t[t.D24=129]="D24",t[t.D32F=130]="D32F",t[t.D24S8=131]="D24S8",t[t.D32FS8=132]="D32FS8"}(mt||(mt={})),function(t){t[t.R=1]="R",t[t.RG=2]="RG",t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA",t[t.A=5]="A",t[t.MAT3=6]="MAT3",t[t.MAT4=7]="MAT4"}(_t||(_t={})),function(t){t[t.None=0]="None",t[t.Normalized=1]="Normalized",t[t.sRGB=2]="sRGB",t[t.Depth=4]="Depth",t[t.Stencil=8]="Stencil",t[t.RenderTarget=16]="RenderTarget"}(Et||(Et={})),function(t){t[t.ALPHA=Mt(mt.U8,_t.A,Et.None)]="ALPHA",t[t.F16_RG=Mt(mt.F16,_t.RG,Et.None)]="F16_RG",t[t.F16_RGB=Mt(mt.F16,_t.RGB,Et.None)]="F16_RGB",t[t.F16_RGBA=Mt(mt.F16,_t.RGBA,Et.None)]="F16_RGBA",t[t.F32_R=Mt(mt.F32,_t.R,Et.None)]="F32_R",t[t.F32_RG=Mt(mt.F32,_t.RG,Et.None)]="F32_RG",t[t.F32_RGB=Mt(mt.F32,_t.RGB,Et.None)]="F32_RGB",t[t.F32_RGBA=Mt(mt.F32,_t.RGBA,Et.None)]="F32_RGBA",t[t.F32_MAT3=Mt(mt.F32,_t.MAT3,Et.None)]="F32_MAT3",t[t.F32_MAT4=Mt(mt.F32,_t.MAT4,Et.None)]="F32_MAT4",t[t.U8_R=Mt(mt.U8,_t.R,Et.None)]="U8_R",t[t.U8_R_NORM=Mt(mt.U8,_t.R,Et.Normalized)]="U8_R_NORM",t[t.U8_RG=Mt(mt.U8,_t.RG,Et.None)]="U8_RG",t[t.U8_RG_NORM=Mt(mt.U8,_t.RG,Et.Normalized)]="U8_RG_NORM",t[t.U8_RGB=Mt(mt.U8,_t.RGB,Et.None)]="U8_RGB",t[t.U8_RGB_NORM=Mt(mt.U8,_t.RGB,Et.Normalized)]="U8_RGB_NORM",t[t.U8_RGB_SRGB=Mt(mt.U8,_t.RGB,Et.sRGB|Et.Normalized)]="U8_RGB_SRGB",t[t.U8_RGBA=Mt(mt.U8,_t.RGBA,Et.None)]="U8_RGBA",t[t.U8_RGBA_NORM=Mt(mt.U8,_t.RGBA,Et.Normalized)]="U8_RGBA_NORM",t[t.U8_RGBA_SRGB=Mt(mt.U8,_t.RGBA,Et.sRGB|Et.Normalized)]="U8_RGBA_SRGB",t[t.U16_R=Mt(mt.U16,_t.R,Et.None)]="U16_R",t[t.U16_R_NORM=Mt(mt.U16,_t.R,Et.Normalized)]="U16_R_NORM",t[t.U16_RG_NORM=Mt(mt.U16,_t.RG,Et.Normalized)]="U16_RG_NORM",t[t.U16_RGBA_NORM=Mt(mt.U16,_t.RGBA,Et.Normalized)]="U16_RGBA_NORM",t[t.U16_RGB=Mt(mt.U16,_t.RGB,Et.None)]="U16_RGB",t[t.U32_R=Mt(mt.U32,_t.R,Et.None)]="U32_R",t[t.U32_RG=Mt(mt.U32,_t.RG,Et.None)]="U32_RG",t[t.S8_R=Mt(mt.S8,_t.R,Et.None)]="S8_R",t[t.S8_R_NORM=Mt(mt.S8,_t.R,Et.Normalized)]="S8_R_NORM",t[t.S8_RG_NORM=Mt(mt.S8,_t.RG,Et.Normalized)]="S8_RG_NORM",t[t.S8_RGB_NORM=Mt(mt.S8,_t.RGB,Et.Normalized)]="S8_RGB_NORM",t[t.S8_RGBA_NORM=Mt(mt.S8,_t.RGBA,Et.Normalized)]="S8_RGBA_NORM",t[t.S16_R=Mt(mt.S16,_t.R,Et.None)]="S16_R",t[t.S16_RG=Mt(mt.S16,_t.RG,Et.None)]="S16_RG",t[t.S16_RG_NORM=Mt(mt.S16,_t.RG,Et.Normalized)]="S16_RG_NORM",t[t.S16_RGB_NORM=Mt(mt.S16,_t.RGB,Et.Normalized)]="S16_RGB_NORM",t[t.S16_RGBA=Mt(mt.S16,_t.RGBA,Et.None)]="S16_RGBA",t[t.S16_RGBA_NORM=Mt(mt.S16,_t.RGBA,Et.Normalized)]="S16_RGBA_NORM",t[t.S32_R=Mt(mt.S32,_t.R,Et.None)]="S32_R",t[t.U16_RGBA_5551=Mt(mt.U16_PACKED_5551,_t.RGBA,Et.Normalized)]="U16_RGBA_5551",t[t.BC1=Mt(mt.BC1,_t.RGBA,Et.None)]="BC1",t[t.BC1_SRGB=Mt(mt.BC1,_t.RGBA,Et.sRGB)]="BC1_SRGB",t[t.BC2=Mt(mt.BC2,_t.RGBA,Et.None)]="BC2",t[t.BC2_SRGB=Mt(mt.BC2,_t.RGBA,Et.sRGB)]="BC2_SRGB",t[t.BC3=Mt(mt.BC3,_t.RGBA,Et.None)]="BC3",t[t.BC3_SRGB=Mt(mt.BC3,_t.RGBA,Et.sRGB)]="BC3_SRGB",t[t.BC4_UNORM=Mt(mt.BC4_UNORM,_t.R,Et.None)]="BC4_UNORM",t[t.BC4_SNORM=Mt(mt.BC4_SNORM,_t.R,Et.None)]="BC4_SNORM",t[t.BC5_UNORM=Mt(mt.BC5_UNORM,_t.RG,Et.None)]="BC5_UNORM",t[t.BC5_SNORM=Mt(mt.BC5_SNORM,_t.RG,Et.None)]="BC5_SNORM",t[t.D24=Mt(mt.D24,_t.R,Et.Depth)]="D24",t[t.D24_S8=Mt(mt.D24S8,_t.RG,Et.Depth|Et.Stencil)]="D24_S8",t[t.D32F=Mt(mt.D32F,_t.R,Et.Depth)]="D32F",t[t.D32F_S8=Mt(mt.D32FS8,_t.RG,Et.Depth|Et.Stencil)]="D32F_S8",t[t.U8_RGB_RT=Mt(mt.U8,_t.RGB,Et.RenderTarget)]="U8_RGB_RT",t[t.U8_RGBA_RT=Mt(mt.U8,_t.RGBA,Et.RenderTarget)]="U8_RGBA_RT",t[t.U8_RGBA_RT_SRGB=Mt(mt.U8,_t.RGBA,Et.RenderTarget|Et.sRGB)]="U8_RGBA_RT_SRGB"}(Tt||(Tt={})),function(t){t[t.COPY_SRC=1]="COPY_SRC",t[t.COPY_DST=2]="COPY_DST",t[t.TEXTURE_BINDING=4]="TEXTURE_BINDING",t[t.STORAGE_BINDING=8]="STORAGE_BINDING",t[t.STORAGE=8]="STORAGE",t[t.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(bt||(bt={})),function(t){t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(Rt||(Rt={})),function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.ALWAYS=519]="ALWAYS",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.GEQUAL=518]="GEQUAL",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.RGB32F_EXT=34837]="RGB32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",t[t.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",t[t.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",t[t.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",t[t.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",t[t.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",t[t.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",t[t.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",t[t.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",t[t.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",t[t.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",t[t.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",t[t.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",t[t.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",t[t.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",t[t.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",t[t.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",t[t.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",t[t.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",t[t.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",t[t.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",t[t.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",t[t.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",t[t.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",t[t.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",t[t.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",t[t.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",t[t.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",t[t.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",t[t.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",t[t.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",t[t.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",t[t.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",t[t.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",t[t.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",t[t.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(At||(At={}));var jt=Gt(0,0,0,0),Vt=Gt(0,0,0,1),Wt=Gt(1,1,1,0),Xt=Gt(1,1,1,1);function Ht(t){return t&&0==(t&t-1)}function Yt(t,e){return null!=t?t:e}function zt(t){return void 0===t?null:t}function qt(t,e,n){t.length=e,t.fill(n)}function Kt(t,e){return((t+e-1)/e|0)*e}function Zt(t,e,n){return n?t|=e:t&=~e,t}function Qt(t,e){for(var n=new Array(t),r=0;r<t;r++)n[r]=e();return n}function Jt(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";t.length<e;)t="".concat(n).concat(t);return t}function $t(t,e){t.blendDstFactor=e.blendDstFactor,t.blendSrcFactor=e.blendSrcFactor,t.blendMode=e.blendMode}function te(t,e){return void 0===t&&(t={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),$t(t.rgbBlendState,e.rgbBlendState),$t(t.alphaBlendState,e.alphaBlendState),t.channelWriteMask=e.channelWriteMask,t}function ee(t,e){t.length!==e.length&&(t.length=e.length);for(var n=0;n<e.length;n++)t[n]=te(t[n],e[n])}function ne(t,e){void 0!==e.attachmentsState&&ee(t.attachmentsState,e.attachmentsState),void 0!==e.blendConstant&&kt(t.blendConstant,e.blendConstant),t.depthCompare=Yt(e.depthCompare,t.depthCompare),t.depthWrite=Yt(e.depthWrite,t.depthWrite),t.stencilCompare=Yt(e.stencilCompare,t.stencilCompare),t.stencilWrite=Yt(e.stencilWrite,t.stencilWrite),t.stencilPassOp=Yt(e.stencilPassOp,t.stencilPassOp),t.stencilRef=Yt(e.stencilRef,t.stencilRef),t.cullMode=Yt(e.cullMode,t.cullMode),t.frontFace=Yt(e.frontFace,t.frontFace),t.polygonOffset=Yt(e.polygonOffset,t.polygonOffset)}function re(t){var e=Object.assign({},t);return e.attachmentsState=[],ee(e.attachmentsState,t.attachmentsState),e.blendConstant=Ut(e.blendConstant),e}var ie,oe={blendMode:nt.Add,blendSrcFactor:et.One,blendDstFactor:et.Zero},ae={attachmentsState:[{channelWriteMask:ht.RGB,rgbBlendState:oe,alphaBlendState:oe}],blendConstant:Ut(jt),depthWrite:!0,depthCompare:J.LessEqual,stencilCompare:J.Always,stencilWrite:!1,stencilPassOp:dt.Keep,stencilRef:0,cullMode:tt.None,frontFace:$.CCW,polygonOffset:!1};!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae,n=re(e);null!==t&&ne(n,t)}({depthCompare:J.Always,depthWrite:!1},ae);function se(t,e,n){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1;return!0}function ue(t,e){for(var n=Array(t.length),r=0;r<t.length;r++)n[r]=e(t[r]);return n}function ce(t,e){return t.buffer===e.buffer&&t.wordCount===e.wordCount}function le(t,e){return null===t?null===e:null!==e&&(t.sampler===e.sampler&&t.texture===e.texture)}function fe(t,e){return t.numSamplers===e.numSamplers&&t.numUniformBuffers===e.numUniformBuffers}function he(t,e){return t.samplerBindings.length===e.samplerBindings.length&&(!!se(t.samplerBindings,e.samplerBindings,le)&&(!!se(t.uniformBufferBindings,e.uniformBufferBindings,ce)&&!!ve(t.bindingLayout,e.bindingLayout)))}function de(t,e){return t.blendMode==e.blendMode&&t.blendSrcFactor===e.blendSrcFactor&&t.blendDstFactor===e.blendDstFactor}function pe(t,e){return!!de(t.rgbBlendState,e.rgbBlendState)&&(!!de(t.alphaBlendState,e.alphaBlendState)&&t.channelWriteMask===e.channelWriteMask)}function ve(t,e){return t.numSamplers===e.numSamplers&&t.numUniformBuffers===e.numUniformBuffers}function ye(t,e){return t===e}function ge(t,e){return t.topology===e.topology&&(t.inputLayout===e.inputLayout&&(t.sampleCount===e.sampleCount&&(!!function(t,e){return!!se(t.attachmentsState,e.attachmentsState,pe)&&(!!Lt(t.blendConstant,e.blendConstant)&&(t.depthCompare===e.depthCompare&&t.depthWrite===e.depthWrite&&t.stencilCompare===e.stencilCompare&&t.stencilWrite===e.stencilWrite&&t.stencilPassOp===e.stencilPassOp&&t.stencilRef===e.stencilRef&&t.cullMode===e.cullMode&&t.frontFace===e.frontFace&&t.polygonOffset===e.polygonOffset))}(t.megaStateDescriptor,e.megaStateDescriptor)&&(!!function(t,e){return t.id===e.id}(t.program,e.program)&&(!!se(t.bindingLayouts,e.bindingLayouts,ve)&&(!!se(t.colorAttachmentFormats,e.colorAttachmentFormats,ye)&&t.depthStencilAttachmentFormat===e.depthStencilAttachmentFormat))))))}function me(t,e){return t.bufferIndex===e.bufferIndex&&t.bufferByteOffset===e.bufferByteOffset&&t.location===e.location&&t.format===e.format}function _e(t,e){return Object(p.h)(t)?Object(p.h)(e):!Object(p.h)(e)&&(t.byteStride===e.byteStride&&t.frequency===e.frequency)}function Ee(t,e){return t.indexBufferFormat===e.indexBufferFormat&&(!!se(t.vertexBufferDescriptors,e.vertexBufferDescriptors,_e)&&!!se(t.vertexAttributeDescriptors,e.vertexAttributeDescriptors,me))}function Te(t,e){return t.wrapS===e.wrapS&&t.wrapT===e.wrapT&&t.minFilter===e.minFilter&&t.magFilter===e.magFilter&&t.mipFilter===e.mipFilter&&t.minLOD===e.minLOD&&t.maxLOD===e.maxLOD}function be(t){return{sampler:t.sampler,texture:t.texture,lateBinding:t.lateBinding}}function Re(t){return{buffer:t.buffer,wordCount:t.wordCount}}function Ae(t){return{dimension:t.dimension,formatKind:t.formatKind}}function Se(t){return{numSamplers:t.numSamplers,numUniformBuffers:t.numUniformBuffers,samplerEntries:void 0!==t.samplerEntries?ue(t.samplerEntries,Ae):void 0}}function Oe(t){return{location:t.location,format:t.format,bufferIndex:t.bufferIndex,bufferByteOffset:t.bufferByteOffset,byteStride:t.byteStride,divisor:t.divisor}}function Me(t){return Object(p.h)(t)?t:{byteStride:t.byteStride,frequency:t.frequency}}!function(t){t[t.LITTLE_ENDIAN=0]="LITTLE_ENDIAN",t[t.BIG_ENDIAN=1]="BIG_ENDIAN"}(ie||(ie={}));var Ce,xe=new Uint16Array([65279]),Ne=(255==new DataView(xe.buffer).getUint8(0)?ie.LITTLE_ENDIAN:ie.BIG_ENDIAN,/([^[]*)(\[[0-9]+\])?/);function Pe(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(Ne);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:Number(e[2])||1,isArray:Boolean(e[2])}}function Ie(t,e,n){var r=He[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function Be(){var t=null;return function(e,n,r){var i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function De(t,e,n,r){var i=null,o=null;return function(a,s,u){var c=e(u,n),l=c.length,f=!1;if(null===i)i=new Float32Array(l),o=l,f=!0;else{wt(o===l,"Uniform length cannot change.");for(var h=0;h<l;++h)if(c[h]!==i[h]){f=!0;break}}return f&&(r(a,t,s,c),i.set(c)),f}}function we(t,e,n,r){t[e](n,r)}function Fe(t,e,n,r){t[e](n,!1,r)}var Le={},ke={},Ue={},Ge=[0];function je(t,e,n,r){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(Ge[0]=t,t=Ge);var i=t.length;if(t instanceof n)return t;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=t[a];return o}function Ve(t,e){return je(t,e,Float32Array,Le)}function We(t,e){return je(t,e,Int32Array,ke)}function Xe(t,e){return je(t,e,Uint32Array,Ue)}var He=(P(Ce={},At.FLOAT,De.bind(null,"uniform1fv",Ve,1,we)),P(Ce,At.FLOAT_VEC2,De.bind(null,"uniform2fv",Ve,2,we)),P(Ce,At.FLOAT_VEC3,De.bind(null,"uniform3fv",Ve,3,we)),P(Ce,At.FLOAT_VEC4,De.bind(null,"uniform4fv",Ve,4,we)),P(Ce,At.INT,De.bind(null,"uniform1iv",We,1,we)),P(Ce,At.INT_VEC2,De.bind(null,"uniform2iv",We,2,we)),P(Ce,At.INT_VEC3,De.bind(null,"uniform3iv",We,3,we)),P(Ce,At.INT_VEC4,De.bind(null,"uniform4iv",We,4,we)),P(Ce,At.BOOL,De.bind(null,"uniform1iv",We,1,we)),P(Ce,At.BOOL_VEC2,De.bind(null,"uniform2iv",We,2,we)),P(Ce,At.BOOL_VEC3,De.bind(null,"uniform3iv",We,3,we)),P(Ce,At.BOOL_VEC4,De.bind(null,"uniform4iv",We,4,we)),P(Ce,At.FLOAT_MAT2,De.bind(null,"uniformMatrix2fv",Ve,4,Fe)),P(Ce,At.FLOAT_MAT3,De.bind(null,"uniformMatrix3fv",Ve,9,Fe)),P(Ce,At.FLOAT_MAT4,De.bind(null,"uniformMatrix4fv",Ve,16,Fe)),P(Ce,At.SAMPLER_2D,Be),P(Ce,At.SAMPLER_CUBE,Be),P(Ce,At.UNSIGNED_INT,De.bind(null,"uniform1uiv",Xe,1,we)),P(Ce,At.UNSIGNED_INT_VEC2,De.bind(null,"uniform2uiv",Xe,2,we)),P(Ce,At.UNSIGNED_INT_VEC3,De.bind(null,"uniform3uiv",Xe,3,we)),P(Ce,At.UNSIGNED_INT_VEC4,De.bind(null,"uniform4uiv",Xe,4,we)),P(Ce,At.FLOAT_MAT2x3,De.bind(null,"uniformMatrix2x3fv",Ve,6,Fe)),P(Ce,At.FLOAT_MAT2x4,De.bind(null,"uniformMatrix2x4fv",Ve,8,Fe)),P(Ce,At.FLOAT_MAT3x2,De.bind(null,"uniformMatrix3x2fv",Ve,6,Fe)),P(Ce,At.FLOAT_MAT3x4,De.bind(null,"uniformMatrix3x4fv",Ve,12,Fe)),P(Ce,At.FLOAT_MAT4x2,De.bind(null,"uniformMatrix4x2fv",Ve,8,Fe)),P(Ce,At.FLOAT_MAT4x3,De.bind(null,"uniformMatrix4x3fv",Ve,12,Fe)),P(Ce,At.SAMPLER_2D,Be),P(Ce,At.SAMPLER_CUBE,Be),P(Ce,At.SAMPLER_3D,Be),P(Ce,At.SAMPLER_2D_SHADOW,Be),P(Ce,At.SAMPLER_2D_ARRAY,Be),P(Ce,At.SAMPLER_2D_ARRAY_SHADOW,Be),P(Ce,At.SAMPLER_CUBE_SHADOW,Be),P(Ce,At.INT_SAMPLER_2D,Be),P(Ce,At.INT_SAMPLER_3D,Be),P(Ce,At.INT_SAMPLER_CUBE,Be),P(Ce,At.INT_SAMPLER_2D_ARRAY,Be),P(Ce,At.UNSIGNED_INT_SAMPLER_2D,Be),P(Ce,At.UNSIGNED_INT_SAMPLER_3D,Be),P(Ce,At.UNSIGNED_INT_SAMPLER_CUBE,Be),P(Ce,At.UNSIGNED_INT_SAMPLER_2D_ARRAY,Be),Ce),Ye=function(){function t(e){C(this,t),this.device=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=e;var n=e.queryLimits();this.uniformBufferWordAlignment=n.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=n.uniformBufferMaxPageWordSize}return N(t,[{key:"isSupportedUBO",value:function(){return"WebGL1"!==this.device.queryVendorInfo().platformString}},{key:"findPageIndex",value:function(t){return t/this.uniformBufferMaxPageWordSize|0}},{key:"allocateChunk",value:function(t){wt((t=Kt(t,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var e=this.currentWordOffset;return this.findPageIndex(e)!==this.findPageIndex(e+t-1)&&(e=Kt(e,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=e+t,this.ensureShadowBuffer(e,t),e}},{key:"ensureShadowBuffer",value:function(t,e){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var n=Kt(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*n),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(t+e>=this.shadowBufferF32.length){wt(t<this.currentWordOffset&&t+e<=this.currentWordOffset);var r=Kt(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize),i=new Uint8Array(4*r);if(i.set(this.shadowBufferU8,0),this.shadowBufferU8=i,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=r))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}}},{key:"mapBufferF32",value:function(){return Ft(this.shadowBufferF32)}},{key:"prepareToRender",value:function(){if(null!==this.shadowBufferF32){var t=Ft(this.shadowBufferF32);t.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=t.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:this.currentBufferWordSize,usage:st.UNIFORM,hint:ut.Dynamic}));var e=Kt(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(e<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(e,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())Ft(this.buffer).setSubData(0,this.shadowBufferU8,0,4*e);this.currentWordOffset=0}}},{key:"destroy",value:function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null}}]),t}();function ze(t,e){return t+=e,t+=t<<10,(t+=t>>>6)>>>0}function qe(t){return t+=t<<3,t^=t>>>11,(t+=t<<15)>>>0}function Ke(t){return 0}var Ze=N((function t(){C(this,t),this.keys=[],this.values=[]})),Qe=function(){function t(e,n){C(this,t),this.keyEqualFunc=void 0,this.keyHashFunc=void 0,this.buckets=new Map,this.keyEqualFunc=e,this.keyHashFunc=n}return N(t,[{key:"findBucketIndex",value:function(t,e){for(var n=0;n<t.keys.length;n++)if(this.keyEqualFunc(e,t.keys[n]))return n;return-1}},{key:"findBucket",value:function(t){var e=this.keyHashFunc(t);return this.buckets.get(e)}},{key:"get",value:function(t){var e=this.findBucket(t);if(void 0===e)return null;var n=this.findBucketIndex(e,t);return n<0?null:e.values[n]}},{key:"add",value:function(t,e){var n=this.keyHashFunc(t);void 0===this.buckets.get(n)&&this.buckets.set(n,new Ze);var r=this.buckets.get(n);r.keys.push(t),r.values.push(e)}},{key:"delete",value:function(t){var e=this.findBucket(t);if(void 0!==e){var n=this.findBucketIndex(e,t);-1!==n&&(e.keys.splice(n,1),e.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var t,e=0,n=K(this.buckets.values());try{for(n.s();!(t=n.n()).done;){e+=t.value.values.length}}catch(r){n.e(r)}finally{n.f()}return e}},{key:"values",value:d.a.mark((function t(){var e,n,r,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=K(this.buckets.values()),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=14;break}r=n.value,i=r.values.length-1;case 6:if(!(i>=0)){t.next=12;break}return t.next=9,r.values[i];case 9:i--,t.next=6;break;case 12:t.next=3;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),e.e(t.t0);case 19:return t.prev=19,e.f(),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[1,16,19,22]])}))}]),t}();function Je(t,e){return wt(""!==t.preprocessedVert&&""!==e.preprocessedVert),wt(""!==t.preprocessedFrag&&""!==e.preprocessedFrag),t.preprocessedVert===e.preprocessedVert&&t.preprocessedFrag===e.preprocessedFrag}function $e(t,e){return t=ze(t,e.numUniformBuffers),t=ze(t,e.numSamplers)}function tn(t,e){return t=ze(t,e.blendMode),t=ze(t,e.blendSrcFactor),t=ze(t,e.blendDstFactor)}function en(t,e){return t=tn(t,e.rgbBlendState),t=ze(t=tn(t,e.alphaBlendState),e.channelWriteMask)}function nn(t,e){for(var n=0;n<e.attachmentsState.length;n++)t=en(t,e.attachmentsState[n]);return t=function(t,e){return t=ze(t,e.r<<24|e.g<<16|e.b<<8|e.a)}(t,e.blendConstant),t=ze(t,e.depthCompare),t=ze(t,e.depthWrite?1:0),t=ze(t,e.stencilCompare),t=ze(t,e.stencilPassOp),t=ze(t,e.stencilWrite?1:0),t=ze(t,e.cullMode),t=ze(t,e.frontFace?1:0),t=ze(t,e.polygonOffset?1:0)}function rn(t){var e=0;e=ze(e,t.program.id),null!==t.inputLayout&&(e=ze(e,t.inputLayout.id));for(var n=0;n<t.bindingLayouts.length;n++)e=$e(e,t.bindingLayouts[n]);e=nn(e,t.megaStateDescriptor);for(var r=0;r<t.colorAttachmentFormats.length;r++)e=ze(e,t.colorAttachmentFormats[r]||0);return qe(e=ze(e,t.depthStencilAttachmentFormat||0))}function on(t){for(var e=0,n=0;n<t.samplerBindings.length;n++){var r=t.samplerBindings[n];null!==r&&null!==r.texture&&(e=ze(e,r.texture.id))}for(var i=0;i<t.uniformBufferBindings.length;i++){var o=t.uniformBufferBindings[i];null!==o&&null!==o.buffer&&(e=ze(e,o.buffer.id),e=ze(e,o.wordCount))}return qe(e)}var an,sn=function(){function t(e){C(this,t),this.device=void 0,this.bindingsCache=new Qe(he,on),this.renderPipelinesCache=new Qe(ge,rn),this.inputLayoutsCache=new Qe(Ee,Ke),this.programCache=new Qe(Je,Ke),this.samplerCache=new Qe(Te,Ke),this.device=e}return N(t,[{key:"createBindings",value:function(t){var e,n=this.bindingsCache.get(t);if(null===n){var r={bindingLayout:(e=t).bindingLayout,samplerBindings:ue(e.samplerBindings,be),uniformBufferBindings:ue(e.uniformBufferBindings,Re),pipeline:e.pipeline};n=this.device.createBindings(r),this.bindingsCache.add(r,n)}return n}},{key:"createRenderPipeline",value:function(t){var e,n,r,i,o,a=this.renderPipelinesCache.get(t);if(null===a){var s=(n=ue((e=t).bindingLayouts,Se),r=e.inputLayout,i=e.program,o=e.topology,{bindingLayouts:n,inputLayout:r,megaStateDescriptor:re(e.megaStateDescriptor),program:i,topology:o,colorAttachmentFormats:e.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:e.depthStencilAttachmentFormat,sampleCount:e.sampleCount});a=this.device.createRenderPipeline(s),this.renderPipelinesCache.add(s,a)}return a}},{key:"createInputLayout",value:function(t){var e,n=this.inputLayoutsCache.get(t);if(null===n){var r={vertexAttributeDescriptors:ue((e=t).vertexAttributeDescriptors,Oe),vertexBufferDescriptors:ue(e.vertexBufferDescriptors,Me),indexBufferFormat:e.indexBufferFormat};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgramSimple",value:function(t){var e,n=this.programCache.get(t);if(null===n){var r={preprocessedVert:(e=t).preprocessedVert,preprocessedFrag:e.preprocessedFrag,vert:e.vert,frag:e.frag};n=this.device.createProgramSimple(r),this.programCache.add(r,n)}return n}},{key:"createProgram",value:function(t){return t.ensurePreprocessed(this.device.queryVendorInfo()),this.createProgramSimple(t)}},{key:"createSampler",value:function(t){var e=this.samplerCache.get(t);return null===e&&(e=this.device.createSampler(t),this.samplerCache.add(t,e)),e}},{key:"destroy",value:function(){var t,e=K(this.bindingsCache.values());try{for(e.s();!(t=e.n()).done;){t.value.destroy()}}catch(l){e.e(l)}finally{e.f()}var n,r=K(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(l){r.e(l)}finally{r.f()}var i,o=K(this.inputLayoutsCache.values());try{for(o.s();!(i=o.n()).done;){i.value.destroy()}}catch(l){o.e(l)}finally{o.f()}var a,s=K(this.programCache.values());try{for(s.s();!(a=s.n()).done;){a.value.destroy()}}catch(l){s.e(l)}finally{s.f()}var u,c=K(this.samplerCache.values());try{for(c.s();!(u=c.n()).done;){u.value.destroy()}}catch(l){c.e(l)}finally{c.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()}}]),t}();!function(t){t[t.Color0=0]="Color0",t[t.Color1=1]="Color1",t[t.Color2=2]="Color2",t[t.Color3=3]="Color3",t[t.ColorMax=3]="ColorMax",t[t.DepthStencil=4]="DepthStencil"}(an||(an={}));var un,cn={x:0,y:0,w:1,h:1},ln=function(){function t(){C(this,t),this.renderTargetIDs=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.viewport=cn,this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorResolveTo:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=0,this.viewportH=0,this.execFunc=null,this.postFunc=null,this.debugName=void 0,this.debugThumbnails=[]}return N(t,[{key:"setDebugName",value:function(t){this.debugName=t}},{key:"pushDebugThumbnail",value:function(t){this.debugThumbnails[t]=!0}},{key:"setViewport",value:function(t){this.viewport=t}},{key:"attachRenderTargetID",value:function(t,e){wt(void 0===this.renderTargetIDs[t]),this.renderTargetIDs[t]=e}},{key:"attachResolveTexture",value:function(t){this.resolveTextureInputIDs.push(t)}},{key:"attachOcclusionQueryPool",value:function(t){this.descriptor.occlusionQueryPool=t}},{key:"resolveToExternalTexture",value:function(t,e){this.resolveTextureOutputExternalTextures[t]=e}},{key:"exec",value:function(t){wt(null===this.execFunc),this.execFunc=t}},{key:"post",value:function(t){wt(null===this.postFunc),this.postFunc=t}},{key:"addExtraRef",value:function(t){this.renderTargetExtraRefs[t]=!0}}]),t}(),fn=function(){function t(e,n){C(this,t),this.debugName=void 0,this.dimension=lt.n2D,this.depth=1,this.numLevels=1,this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.usage=ft.RenderTarget,this.immutable=!0,this.needsClear=!0,this.texture=null,this.attachment=void 0,this.age=0,this.pixelFormat=n.pixelFormat,this.width=n.width,this.height=n.height,this.sampleCount=n.sampleCount,wt(this.sampleCount>=1),this.sampleCount>1?this.attachment=e.createRenderTarget(this):(this.texture=e.createTexture(this),e.setResourceName(this.texture,this.debugName),this.attachment=e.createRenderTargetFromTexture(this.texture)),e.setResourceName(this.attachment,this.debugName)}return N(t,[{key:"matchesDescription",value:function(t){return this.pixelFormat===t.pixelFormat&&this.width===t.width&&this.height===t.height&&this.sampleCount===t.sampleCount}},{key:"reset",value:function(t){wt(this.matchesDescription(t)),this.age=0}},{key:"destroy",value:function(t){null!==this.texture&&this.texture.destroy(),this.attachment.destroy()}}]),t}(),hn=function(){function t(e,n){C(this,t),this.dimension=lt.n2D,this.depth=1,this.numLevels=1,this.usage=ft.RenderTarget,this.pixelFormat=void 0,this.width=0,this.height=0,this.texture=void 0,this.age=0,this.immutable=!0,this.pixelFormat=n.pixelFormat,this.width=n.width,this.height=n.height,this.texture=e.createTexture(this)}return N(t,[{key:"matchesDescription",value:function(t){return this.pixelFormat===t.pixelFormat&&this.width===t.width&&this.height===t.height}},{key:"reset",value:function(t){wt(this.matchesDescription(t)),this.age=0}},{key:"destroy",value:function(t){this.texture.destroy()}}]),t}();un=Symbol.species;var dn,pn=N((function t(){C(this,t),this[un]=void 0,this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]})),vn=function(){function t(e){C(this,t),this.device=void 0,this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=e}return N(t,[{key:"acquireRenderTargetForDescription",value:function(t){for(var e=0;e<this.renderTargetDeadPool.length;e++){var n=this.renderTargetDeadPool[e];if(n.matchesDescription(t))return n.reset(t),this.renderTargetDeadPool.splice(e--,1),n}return new fn(this.device,t)}},{key:"acquireSingleSampledTextureForDescription",value:function(t){for(var e=0;e<this.singleSampledTextureDeadPool.length;e++){var n=this.singleSampledTextureDeadPool[e];if(n.matchesDescription(t))return n.reset(t),this.singleSampledTextureDeadPool.splice(e--,1),n}return new hn(this.device,t)}},{key:"beginGraphBuilder",value:function(){wt(null===this.currentGraph),this.currentGraph=new pn}},{key:"pushPass",value:function(t){var e=new ln;t(e),this.currentGraph.passes.push(e)}},{key:"createRenderTargetID",value:function(t,e){return this.currentGraph.renderTargetDebugNames.push(e),this.currentGraph.renderTargetDescriptions.push(t)-1}},{key:"createResolveTextureID",value:function(t){return this.currentGraph.resolveTextureRenderTargetIDs.push(t)-1}},{key:"findMostRecentPassThatAttachedRenderTarget",value:function(t){for(var e=this.currentGraph.passes.length-1;e>=0;e--){var n=this.currentGraph.passes[e];if(n.renderTargetIDs.includes(t))return n}return null}},{key:"resolveRenderTargetPassAttachmentSlot",value:function(t,e){var n=t;if(void 0===n.resolveTextureOutputIDs[e]){var r=n.renderTargetIDs[e],i=this.createResolveTextureID(r);n.resolveTextureOutputIDs[e]=i}return n.resolveTextureOutputIDs[e]}},{key:"findPassForResolveRenderTarget",value:function(t){var e=Ft(this.findMostRecentPassThatAttachedRenderTarget(t)),n=e.renderTargetIDs.indexOf(t);return wt(void 0===e.resolveTextureOutputExternalTextures[n]),e}},{key:"resolveRenderTarget",value:function(t){var e=this.findPassForResolveRenderTarget(t),n=e.renderTargetIDs.indexOf(t);return this.resolveRenderTargetPassAttachmentSlot(e,n)}},{key:"resolveRenderTargetToExternalTexture",value:function(t,e){var n=this.findPassForResolveRenderTarget(t),r=n.renderTargetIDs.indexOf(t);wt(void 0===n.resolveTextureOutputIDs[r]),n.resolveTextureOutputExternalTextures[r]=e}},{key:"getRenderTargetDescription",value:function(t){return Ft(this.currentGraph.renderTargetDescriptions[t])}},{key:"scheduleAddUseCount",value:function(t,e){for(var n=0;n<e.renderTargetIDs.length;n++){var r=e.renderTargetIDs[n];void 0!==r&&(this.renderTargetOutputCount[r]++,e.renderTargetExtraRefs[n]&&this.renderTargetOutputCount[r]++)}for(var i=0;i<e.resolveTextureInputIDs.length;i++){var o=e.resolveTextureInputIDs[i];if(void 0!==o){this.resolveTextureUseCount[o]++;var a=t.resolveTextureRenderTargetIDs[o];this.renderTargetResolveCount[a]++}}}},{key:"acquireRenderTargetForID",value:function(t,e){if(void 0===e)return null;if(wt(this.renderTargetOutputCount[e]>0),!this.renderTargetAliveForID[e]){var n=t.renderTargetDescriptions[e],r=this.acquireRenderTargetForDescription(n);r.debugName=t.renderTargetDebugNames[e],this.renderTargetAliveForID[e]=r}return this.renderTargetAliveForID[e]}},{key:"releaseRenderTargetForID",value:function(t,e){if(void 0===t)return null;var n=Ft(this.renderTargetAliveForID[t]);return e?(wt(this.renderTargetOutputCount[t]>0),this.renderTargetOutputCount[t]--):(wt(this.renderTargetResolveCount[t]>0),this.renderTargetResolveCount[t]--),0===this.renderTargetOutputCount[t]&&0===this.renderTargetResolveCount[t]&&(n.needsClear=!0,delete this.renderTargetAliveForID[t],this.renderTargetDeadPool.push(n)),n}},{key:"acquireResolveTextureInputTextureForID",value:function(t,e){var n=t.resolveTextureRenderTargetIDs[e];wt(this.resolveTextureUseCount[e]>0),this.resolveTextureUseCount[e]--;var r=Ft(this.releaseRenderTargetForID(n,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[e]){var i=this.singleSampledTextureForResolveTextureID[e];return 0===this.resolveTextureUseCount[e]&&this.singleSampledTextureDeadPool.push(i),i.texture}return Ft(r.texture)}},{key:"determineResolveParam",value:function(t,e,n){var r=e.renderTargetIDs[n],i=e.resolveTextureOutputIDs[n],o=e.resolveTextureOutputExternalTextures[n],a=void 0!==i,s=void 0!==o;wt(!(a&&s));var u=null,c=!1;if(this.renderTargetOutputCount[r]>1&&(c=!0),a){wt(t.resolveTextureRenderTargetIDs[i]===r),wt(this.resolveTextureUseCount[i]>0),wt(this.renderTargetOutputCount[r]>0);var l=Ft(this.renderTargetAliveForID[r]);if(null!==l.texture&&1===this.renderTargetOutputCount[r])u=null,c=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var f=Ft(t.renderTargetDescriptions[r]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(f),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,l.debugName+" (Resolve ".concat(i,")"))}u=this.singleSampledTextureForResolveTextureID[i].texture}}else u=s?o:null;return{resolveTo:u,store:c}}},{key:"schedulePass",value:function(t,e){for(var n=e.renderTargetIDs[an.DepthStencil],r=an.Color0;r<=an.ColorMax;r++){var i=e.renderTargetIDs[r],o=this.acquireRenderTargetForID(t,i);e.renderTargets[r]=o,e.descriptor.colorAttachment[r]=null!==o?o.attachment:null;var a=this.determineResolveParam(t,e,r),s=a.resolveTo,u=a.store;e.descriptor.colorResolveTo[r]=s,e.descriptor.colorStore[r]=u,e.descriptor.colorClearColor[r]=null!==o&&o.needsClear?t.renderTargetDescriptions[i].colorClearColor:"load"}var c=this.acquireRenderTargetForID(t,n);e.renderTargets[an.DepthStencil]=c,e.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var l=this.determineResolveParam(t,e,an.DepthStencil),f=l.resolveTo,h=l.store;e.descriptor.depthStencilResolveTo=f,e.descriptor.depthStencilStore=h,e.descriptor.depthClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].depthClearValue:"load",e.descriptor.stencilClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].stencilClearValue:"load";for(var d=0,p=0,v=0,y=0;y<e.renderTargets.length;y++){var g=e.renderTargets[y];g&&(0===d&&(d=g.width,p=g.height,v=g.sampleCount),wt(g.width===d),wt(g.height===p),wt(g.sampleCount===v),g.needsClear=!1)}if(d>0&&p>0){var m=d*e.viewport.x,_=p*e.viewport.y,E=d*e.viewport.w,T=p*e.viewport.h;e.viewportX=m,e.viewportY=_,e.viewportW=E,e.viewportH=T}for(var b=0;b<e.resolveTextureInputIDs.length;b++){var R=e.resolveTextureInputIDs[b];e.resolveTextureInputTextures[b]=this.acquireResolveTextureInputTextureForID(t,R)}for(var A=0;A<e.renderTargetIDs.length;A++)this.releaseRenderTargetForID(e.renderTargetIDs[A],!0);for(var S=0;S<e.renderTargetExtraRefs.length;S++)e.renderTargetExtraRefs[S]&&this.releaseRenderTargetForID(e.renderTargetIDs[S],!0)}},{key:"scheduleGraph",value:function(t){wt(0===this.renderTargetOutputCount.length),wt(0===this.renderTargetResolveCount.length),wt(0===this.resolveTextureUseCount.length);for(var e=0;e<this.renderTargetDeadPool.length;e++)this.renderTargetDeadPool[e].age++;for(var n=0;n<this.singleSampledTextureDeadPool.length;n++)this.singleSampledTextureDeadPool[n].age++;qt(this.renderTargetOutputCount,t.renderTargetDescriptions.length,0),qt(this.renderTargetResolveCount,t.renderTargetDescriptions.length,0),qt(this.resolveTextureUseCount,t.resolveTextureRenderTargetIDs.length,0);for(var r=0;r<t.passes.length;r++)this.scheduleAddUseCount(t,t.passes[r]);for(var i=0;i<t.passes.length;i++)this.schedulePass(t,t.passes[i]);for(var o=0;o<this.renderTargetOutputCount.length;o++)wt(0===this.renderTargetOutputCount[o]);for(var a=0;a<this.renderTargetResolveCount.length;a++)wt(0===this.renderTargetResolveCount[a]);for(var s=0;s<this.resolveTextureUseCount.length;s++)wt(0===this.resolveTextureUseCount[s]);for(var u=0;u<this.renderTargetAliveForID.length;u++)wt(void 0===this.renderTargetAliveForID[u]);for(var c=0;c<this.renderTargetDeadPool.length;c++)this.renderTargetDeadPool[c].age>=1&&(this.renderTargetDeadPool[c].destroy(this.device),this.renderTargetDeadPool.splice(c--,1));for(var l=0;l<this.singleSampledTextureDeadPool.length;l++)this.singleSampledTextureDeadPool[l].age>=1&&(this.singleSampledTextureDeadPool[l].destroy(this.device),this.singleSampledTextureDeadPool.splice(l--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0}},{key:"execPass",value:function(t){wt(null===this.currentPass),this.currentPass=t;var e=this.device.createRenderPass(t.descriptor);e.beginDebugGroup(t.debugName),e.setViewport(t.viewportX,t.viewportY,t.viewportW,t.viewportH),null!==t.execFunc&&t.execFunc(e,this),e.endDebugGroup(),this.device.submitPass(e),null!==t.postFunc&&t.postFunc(this),this.currentPass=null}},{key:"execGraph",value:function(t){var e=this;this.scheduleGraph(t),t.passes.forEach((function(t){e.execPass(t)})),this.singleSampledTextureForResolveTextureID.length=0}},{key:"execute",value:function(){var t=Ft(this.currentGraph);this.execGraph(t),this.currentGraph=null}},{key:"getDebug",value:function(){return this}},{key:"getPasses",value:function(){return this.currentGraph.passes}},{key:"getPassDebugThumbnails",value:function(t){return t.debugThumbnails}},{key:"getPassRenderTargetID",value:function(t,e){return t.renderTargetIDs[e]}},{key:"getRenderTargetIDDebugName",value:function(t){return this.currentGraph.renderTargetDebugNames[t]}},{key:"getResolveTextureForID",value:function(t){var e=this.currentPass,n=e.resolveTextureInputIDs.indexOf(t);return wt(n>=0),Ft(e.resolveTextureInputTextures[n])}},{key:"getRenderTargetAttachment",value:function(t){var e=this.currentPass.renderTargets[t];return e?e.attachment:null}},{key:"getRenderTargetTexture",value:function(t){var e=this.currentPass.renderTargets[t];return e?e.texture:null}},{key:"newGraphBuilder",value:function(){return this.beginGraphBuilder(),this}},{key:"destroy",value:function(){for(var t=0;t<this.renderTargetAliveForID.length;t++)wt(void 0===this.renderTargetAliveForID[t]);for(var e=0;e<this.singleSampledTextureForResolveTextureID.length;e++)wt(void 0===this.singleSampledTextureForResolveTextureID[e]);for(var n=0;n<this.renderTargetDeadPool.length;n++)this.renderTargetDeadPool[n].destroy(this.device);for(var r=0;r<this.singleSampledTextureDeadPool.length;r++)this.singleSampledTextureDeadPool[r].destroy(this.device)}}]),t}();!function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.ALPHA_TEST=16]="ALPHA_TEST",t[t.OPAQUE=32]="OPAQUE",t[t.TRANSLUCENT=128]="TRANSLUCENT"}(dn||(dn={}));function yn(t,e){return(16777215&t|(255&e)<<24)>>>0}function gn(t,e){return yn(function(t,e){return!!(t>>>31&1)?t:(4278190335&t|(65535&e)<<8)>>>0}(0,e),t)}var mn="undefined"!=typeof Float32Array?Float32Array:Array;function _n(){var t=new mn(16);return mn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function En(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Tn(t,e,n,r,i,o,a,s,u,c,l,f,h,d,p,v){var y=new mn(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=i,y[5]=o,y[6]=a,y[7]=s,y[8]=u,y[9]=c,y[10]=l,y[11]=f,y[12]=h,y[13]=d,y[14]=p,y[15]=v,y}function bn(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Rn=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],v=e[12],y=e[13],g=e[14],m=e[15],_=n[0],E=n[1],T=n[2],b=n[3];return t[0]=_*r+E*s+T*f+b*v,t[1]=_*i+E*u+T*h+b*y,t[2]=_*o+E*c+T*d+b*g,t[3]=_*a+E*l+T*p+b*m,_=n[4],E=n[5],T=n[6],b=n[7],t[4]=_*r+E*s+T*f+b*v,t[5]=_*i+E*u+T*h+b*y,t[6]=_*o+E*c+T*d+b*g,t[7]=_*a+E*l+T*p+b*m,_=n[8],E=n[9],T=n[10],b=n[11],t[8]=_*r+E*s+T*f+b*v,t[9]=_*i+E*u+T*h+b*y,t[10]=_*o+E*c+T*d+b*g,t[11]=_*a+E*l+T*p+b*m,_=n[12],E=n[13],T=n[14],b=n[15],t[12]=_*r+E*s+T*f+b*v,t[13]=_*i+E*u+T*h+b*y,t[14]=_*o+E*c+T*d+b*g,t[15]=_*a+E*l+T*p+b*m,t};function An(t,e,n){var r=new mn(3);return r[0]=t,r[1]=e,r[2]=n,r}var Sn,On;Sn=new mn(3),mn!=Float32Array&&(Sn[0]=0,Sn[1]=0,Sn[2]=0),On=Sn;(function(){var t=function(){var t=new mn(2);return mn!=Float32Array&&(t[0]=0,t[1]=0),t}()})(),Tn(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);var Mn;Tn(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function Cn(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return t[e+0]=n,t[e+1]=r,t[e+2]=i,t[e+3]=o,4}!function(t){t[t.Indexed=1]="Indexed",t[t.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",t[t.Template=4]="Template",t[t.Draw=8]="Draw",t[t.InheritedFlags=3]="InheritedFlags"}(Mn||(Mn={}));var xn,Nn=function(){function t(){C(this,t),this.sortKey=0,this.debug=null,this.renderPipelineDescriptor=void 0,this.uniformBuffer=void 0,this.uniforms=[],this.bindingDescriptors=Qt(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=Qt(4,(function(){return 0})),this.flags=0,this.inputState=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={bindingLayouts:[],inputLayout:null,megaStateDescriptor:re(ae),program:null,topology:at.Triangles,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return N(t,[{key:"reset",value:function(){this.sortKey=0,this.flags=Mn.AllowSkippingIfPipelineNotReady,this.inputState=null,this.renderPipelineDescriptor.inputLayout=null}},{key:"setFromTemplate",value:function(t){ne(this.renderPipelineDescriptor.megaStateDescriptor,t.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=t.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=t.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=t.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,t.renderPipelineDescriptor.colorAttachmentFormats.length);for(var e=0;e<t.renderPipelineDescriptor.colorAttachmentFormats.length;e++)this.renderPipelineDescriptor.colorAttachmentFormats[e]=t.renderPipelineDescriptor.colorAttachmentFormats[e];this.renderPipelineDescriptor.depthStencilAttachmentFormat=t.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=t.renderPipelineDescriptor.sampleCount,this.inputState=t.inputState,this.uniformBuffer=t.uniformBuffer,this.uniforms=W(t.uniforms),this.drawCount=t.drawCount,this.drawStart=t.drawStart,this.drawInstanceCount=t.drawInstanceCount,this.flags=this.flags&~Mn.InheritedFlags|t.flags&Mn.InheritedFlags,this.sortKey=t.sortKey;var n=this.bindingDescriptors[0],r=t.bindingDescriptors[0];null!==r.bindingLayout&&this.setBindingLayout(r.bindingLayout);for(var i=0;i<Math.min(n.uniformBufferBindings.length,r.uniformBufferBindings.length);i++)n.uniformBufferBindings[i].wordCount=t.bindingDescriptors[0].uniformBufferBindings[i].wordCount;this.setSamplerBindingsFromTextureMappings(r.samplerBindings);for(var o=0;o<t.dynamicUniformBufferByteOffsets.length;o++)this.dynamicUniformBufferByteOffsets[o]=t.dynamicUniformBufferByteOffsets[o]}},{key:"setProgram",value:function(t){this.renderPipelineDescriptor.program=t}},{key:"setMegaStateFlags",value:function(t){return ne(this.renderPipelineDescriptor.megaStateDescriptor,t),this.renderPipelineDescriptor.megaStateDescriptor}},{key:"getMegaStateFlags",value:function(){return this.renderPipelineDescriptor.megaStateDescriptor}},{key:"setInputLayoutAndState",value:function(t,e){this.inputState=e,this.renderPipelineDescriptor.inputLayout=t}},{key:"setBindingLayout",value:function(t){wt(t.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.renderPipelineDescriptor.bindingLayouts[0]=t,this.bindingDescriptors[0].bindingLayout=t;for(var e=this.bindingDescriptors[0].uniformBufferBindings.length;e<t.numUniformBuffers;e++)this.bindingDescriptors[0].uniformBufferBindings.push({buffer:null,wordCount:0});for(var n=this.bindingDescriptors[0].samplerBindings.length;n<t.numSamplers;n++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null,lateBinding:null})}},{key:"setBindingLayouts",value:function(t){wt(t.length<=this.bindingDescriptors.length),wt(1===t.length),this.setBindingLayout(t[0])}},{key:"drawIndexes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Zt(this.flags,Mn.Indexed,!0),this.drawCount=t,this.drawStart=e,this.drawInstanceCount=1}},{key:"drawIndexesInstanced",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.flags=Zt(this.flags,Mn.Indexed,!0),this.drawCount=t,this.drawStart=n,this.drawInstanceCount=e}},{key:"drawPrimitives",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Zt(this.flags,Mn.Indexed,!1),this.drawCount=t,this.drawStart=e,this.drawInstanceCount=1}},{key:"setUniforms",value:function(t,e){this.uniforms[t]=e;var n=0,r=[];e.forEach((function(t){t.name;var e=t.value,i="number"==typeof e?[e]:e,o=i.length>4?4:i.length,a=4-n%4;if(4!==a)if(a>=o);else{n+=a;for(var s=0;s<a;s++)r.push(0)}n+=i.length,r.push.apply(r,W(i))}));var i=4-r.length%4;if(4!==i)for(var o=0;o<i;o++)r.push(0);for(var a=this.allocateUniformBuffer(t,r.length),s=this.mapUniformBufferF32(t),u=0;u<r.length;u+=4)a+=Cn(s,a,r[u],r[u+1],r[u+2],r[u+3])}},{key:"setUniformBuffer",value:function(t){this.uniformBuffer=t}},{key:"allocateUniformBuffer",value:function(t,e){return wt(this.bindingDescriptors[0].bindingLayout.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[t]=this.uniformBuffer.allocateChunk(e)<<2,this.bindingDescriptors[0].uniformBufferBindings[t].wordCount=e,this.getUniformBufferOffset(t)}},{key:"getUniformBufferOffset",value:function(t){return this.dynamicUniformBufferByteOffsets[t]>>>2}},{key:"setUniformBufferOffset",value:function(t,e,n){this.dynamicUniformBufferByteOffsets[t]=e<<2,this.bindingDescriptors[0].uniformBufferBindings[t].wordCount=n}},{key:"mapUniformBufferF32",value:function(t){return this.uniformBuffer.mapBufferF32()}},{key:"getUniformBuffer",value:function(){return this.uniformBuffer}},{key:"setSamplerBindingsFromTextureMappings",value:function(t){t=t.filter((function(t){return t}));for(var e=0;e<this.bindingDescriptors[0].samplerBindings.length;e++){var n=this.bindingDescriptors[0].samplerBindings[e],r=t[e];null!=r?(n.texture=r.texture,n.sampler=r.sampler,n.lateBinding=r.lateBinding):(n.texture=null,n.sampler=null,n.lateBinding=null)}}},{key:"hasLateSamplerBinding",value:function(t){for(var e=0;e<this.bindingDescriptors[0].samplerBindings.length;e++){if(this.bindingDescriptors[0].samplerBindings[e].lateBinding===t)return!0}return!1}},{key:"resolveLateSamplerBinding",value:function(t,e){for(var n=0;n<this.bindingDescriptors[0].samplerBindings.length;n++){var r=this.bindingDescriptors[0].samplerBindings[n];r.lateBinding===t&&(null===e?(r.texture=null,r.sampler=null):(wt(null===e.lateBinding),r.texture=e.texture,null!==e.sampler&&(r.sampler=e.sampler)),r.lateBinding=null)}}},{key:"queryPipelineReady",value:function(t){var e=t.createRenderPipeline(this.renderPipelineDescriptor);return t.device.queryPipelineReady(e)}},{key:"setAllowSkippingIfPipelineNotReady",value:function(t){this.flags=Zt(this.flags,Mn.AllowSkippingIfPipelineNotReady,t)}},{key:"setAttachmentFormatsFromRenderPass",value:function(t,e){for(var n=t.queryRenderPass(e),r=-1,i=0;i<n.colorAttachment.length;i++){var o=null!==n.colorAttachment[i]?t.queryRenderTarget(n.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==o?o.pixelFormat:null,null!==o&&(-1===r?r=o.sampleCount:wt(r===o.sampleCount))}var a=null!==n.depthStencilAttachment?t.queryRenderTarget(n.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==a?a.pixelFormat:null,null!==a&&(-1===r?r=a.sampleCount:wt(r==a.sampleCount)),wt(r>0),this.renderPipelineDescriptor.sampleCount=r}},{key:"drawOnPass",value:function(t,e){var n=this,r=t.device;this.setAttachmentFormatsFromRenderPass(r,e);var i=t.createRenderPipeline(this.renderPipelineDescriptor);if(!r.queryPipelineReady(i)){if(this.flags&Mn.AllowSkippingIfPipelineNotReady)return!1;r.pipelineForceReady(i)}e.setPipeline(i),e.setInputState(this.inputState);for(var o=0;o<this.bindingDescriptors[0].uniformBufferBindings.length;o++)this.bindingDescriptors[0].uniformBufferBindings[o].buffer=Ft(this.uniformBuffer.buffer);this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(t){var e={};t.forEach((function(t){var n=t.name,r=t.value;e[n]=r})),n.renderPipelineDescriptor.program.setUniforms(e)}));var a=t.createBindings(S(S({},this.bindingDescriptors[0]),{},{pipeline:i}));return e.setBindings(0,a,this.dynamicUniformBufferByteOffsets),this.drawInstanceCount>1?(wt(!!(this.flags&Mn.Indexed)),e.drawIndexedInstanced(this.drawCount,this.drawStart,this.drawInstanceCount)):this.flags&Mn.Indexed?e.drawIndexed(this.drawCount,this.drawStart):e.draw(this.drawCount,this.drawStart),!0}}]),t}();function Pn(t,e){return t.sortKey-e.sortKey}!function(t){t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards"}(xn||(xn={}));var In=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xn.Forwards;C(this,t),this.renderInsts=[],this.compareFunction=void 0,this.executionOrder=void 0,this.usePostSort=!1,this.compareFunction=e,this.executionOrder=n}return N(t,[{key:"checkUsePostSort",value:function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500}},{key:"insertSorted",value:function(t){var e,n,r,i;null===this.compareFunction||this.usePostSort?this.renderInsts.push(t):(e=this.renderInsts,n=t,r=this.compareFunction,i=function(t,e,n){for(var r=0,i=t.length;r<i;){var o=r+(i-r>>>1);n(e,t[o])<0?i=o:r=o+1}return r}(e,n,r),e.splice(i,0,n)),this.checkUsePostSort()}},{key:"submitRenderInst",value:function(t){t.flags|=Mn.Draw,this.insertSorted(t)}},{key:"hasLateSamplerBinding",value:function(t){for(var e=0;e<this.renderInsts.length;e++)if(this.renderInsts[e].hasLateSamplerBinding(t))return!0;return!1}},{key:"resolveLateSamplerBinding",value:function(t,e){for(var n=0;n<this.renderInsts.length;n++)this.renderInsts[n].resolveLateSamplerBinding(t,e)}},{key:"ensureSorted",value:function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)}},{key:"drawOnPassRendererNoReset",value:function(t,e){this.ensureSorted();var n=0;if(this.executionOrder===xn.Forwards)for(var r=0;r<this.renderInsts.length;r++)this.renderInsts[r].drawOnPass(t,e)&&n++;else for(var i=this.renderInsts.length-1;i>=0;i--)this.renderInsts[i].drawOnPass(t,e)&&n++;return n}},{key:"reset",value:function(){this.renderInsts.length=0}},{key:"drawOnPassRenderer",value:function(t,e){var n=this.drawOnPassRendererNoReset(t,e);return this.reset(),n}}]),t}(),Bn=function(){function t(){C(this,t),this.pool=[],this.allocCount=0}return N(t,[{key:"allocRenderInstIndex",value:function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new Nn),this.allocCount-1}},{key:"popRenderInst",value:function(){this.allocCount--}},{key:"reset",value:function(){for(var t=0;t<this.pool.length;t++)this.pool[t].reset();this.allocCount=0}},{key:"destroy",value:function(){this.pool.length=0,this.allocCount=0}}]),t}(),Dn=function(){function t(e){C(this,t),this.renderCache=void 0,this.instPool=new Bn,this.templatePool=new Bn,this.simpleRenderInstList=new In,this.currentRenderInstList=this.simpleRenderInstList,this.renderCache=e}return N(t,[{key:"newRenderInst",value:function(){var t=this.templatePool.allocCount-1,e=this.instPool.allocRenderInstIndex(),n=this.instPool.pool[e];return n.debug=null,t>=0&&n.setFromTemplate(this.templatePool.pool[t]),n}},{key:"submitRenderInst",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRenderInstList;e.submitRenderInst(t)}},{key:"setCurrentRenderInstList",value:function(t){wt(null===this.simpleRenderInstList),this.currentRenderInstList=t}},{key:"pushTemplateRenderInst",value:function(){var t=this.templatePool.allocCount-1,e=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[e];return t>=0&&n.setFromTemplate(this.templatePool.pool[t]),n.flags|=Mn.Template,n}},{key:"popTemplateRenderInst",value:function(){this.templatePool.popRenderInst()}},{key:"getTemplateRenderInst",value:function(){var t=this.templatePool.allocCount-1;return this.templatePool.pool[t]}},{key:"resetRenderInsts",value:function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),wt(0===this.templatePool.allocCount)}},{key:"destroy",value:function(){this.instPool.destroy(),this.renderCache.destroy()}},{key:"disableSimpleMode",value:function(){this.simpleRenderInstList=null}},{key:"drawListOnPassRenderer",value:function(t,e){t.drawOnPassRenderer(this.renderCache,e)}},{key:"drawOnPassRenderer",value:function(t){Ft(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,t)}},{key:"drawOnPassRendererNoReset",value:function(t){Ft(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,t)}}]),t}(),wn=function(){function t(){C(this,t),this.renderCache=void 0,this.renderGraph=void 0,this.renderInstManager=void 0,this.uniformBuffer=void 0,this.device=void 0}return N(t,[{key:"getDevice",value:function(){return this.device}},{key:"setDevice",value:function(t){this.device=t,this.renderCache=new sn(t),this.renderGraph=new vn(this.device),this.renderInstManager=new Dn(this.renderCache),this.uniformBuffer=new Ye(this.device)}},{key:"pushTemplateRenderInst",value:function(){var t=this.renderInstManager.pushTemplateRenderInst();return t.setUniformBuffer(this.uniformBuffer),t}},{key:"prepareToRender",value:function(){this.uniformBuffer.prepareToRender()}},{key:"destroy",value:function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager.destroy(),this.renderCache.destroy(),this.renderGraph.destroy()}},{key:"getCache",value:function(){return this.renderCache}}]),t}();wn=Object(s.c)([Object(u.j)()],wn);var Fn=function(){function t(){C(this,t),this.offscreenCanvas=void 0,this.textureCache={},this.gradientCache={}}return N(t,[{key:"getOrCreateTexture",value:function(t,e,n,r){var i=this,o="string"==typeof e?e:e.src||"";if(!this.textureCache[o])if(this.textureCache[o]=t.createTexture(S({pixelFormat:Tt.U8_RGBA_NORM,width:1,height:1,depth:1,numLevels:1,dimension:lt.n2D,usage:ft.Sampled,pixelStore:{unpackFlipY:!1},immutable:!1},n)),"string"!=typeof e)this.textureCache[o].setImageData(e);else{var a=new window.Image;a.onload=function(){i.textureCache[o].setImageData(a),r&&r()},a.onerror=function(){},a.crossOrigin="Anonymous",a.src=e}return this.textureCache[o]}},{key:"getOrCreateCanvas",value:function(){return this.offscreenCanvas.getOrCreateCanvas()}},{key:"getOrCreateGradient",value:function(t){var e=this.generateCacheKey(t),n=t.type,r=t.x0,i=t.y0,o=t.x1,s=t.y1,u=t.steps,c=t.width,l=t.height,f=this.gradientCache[e],h=this.offscreenCanvas.getOrCreateCanvas(),d=this.offscreenCanvas.getOrCreateContext();if(!f){if(h.width=c,h.height=l,n===a.p.LinearGradient)f=d.createLinearGradient(r*c,i*l,o*c,s*l);else if(n===a.p.RadialGradient){var p=Math.sqrt(c*c+l*l)/2;f=d.createRadialGradient(r*c,i*l,0,o*c,s*l,t.r1*p)}u.forEach((function(t){var e,n=j(t,2),r=n[0],i=n[1];null===(e=f)||void 0===e||e.addColorStop(Number(r),i)})),this.gradientCache[e]=f}h.src=e,f&&(d.fillStyle=f,d.fillRect(0,0,c,l))}},{key:"generateCacheKey",value:function(t){var e=t.type,n=t.x0,r=t.y0,i=t.x1,o=t.y1,a=t.r1,s=t.steps,u=t.width,c=t.height;return"gradient-".concat(e,"-").concat(n,"-").concat(r,"-").concat(i,"-").concat(o,"-").concat(a||0,"-").concat(u,"-").concat(c,"-").concat(s.map((function(t){return t.join("")})).join("-"))}},{key:"destroy",value:function(){for(var t in this.textureCache)this.textureCache[t].destroy();this.textureCache={},this.gradientCache={}}}]),t}();Object(s.c)([Object(u.g)(a.o),Object(s.f)("design:type",a.o)],Fn.prototype,"offscreenCanvas",void 0),Fn=Object(s.c)([Object(u.j)()],Fn);var Ln=function(){function t(){C(this,t),this.lights=[],this.fog=void 0}return N(t,[{key:"addLight",value:function(t){this.lights.push(t),this.sortLights()}},{key:"removeLight",value:function(t){var e=this.lights.indexOf(t);this.lights.splice(e,1),this.sortLights()}},{key:"addFog",value:function(t){this.fog=t}},{key:"removeFog",value:function(t){this.fog=null}},{key:"getFog",value:function(){return this.fog}},{key:"getAllLights",value:function(){return this.lights}},{key:"getDefines",value:function(){var t={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(e){t[e.define]||(t[e.define]=0),t[e.define]++})),t}},{key:"sortLights",value:function(){this.lights.sort((function(t,e){return t.order-e.order}))}}]),t}();Ln=Object(s.c)([Object(u.j)()],Ln);var kn=u.d.defineToken("RendererFactory"),Un=u.d.defineToken("ShapeRenderer"),Gn=u.d.defineToken("MeshFactory"),jn=[[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]];function Vn(t,e){return"#define ".concat(t," ").concat(e)}function Wn(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o="#version 100"===t.glslVersion,a=t.supportMRT&&!!i.MRT,s=(i.PICKING,n.split("\n").map((function(t){return t.replace(/[/][/].*$/,"")})).filter((function(t){return!(!t||/^\s+$/.test(t))}))),u="";null!==r&&(u=W(r.entries()).map((function(t){var e=j(t,2);return Vn(e[0],e[1])})).join("\n"));var c=s.find((function(t){return t.startsWith("precision")}))||"precision mediump float;",l=s.filter((function(t){return!t.startsWith("precision")})).join("\n"),f="";if(t.viewportOrigin===vt.UpperLeft&&(f+="".concat(Vn("VIEWPORT_ORIGIN_TL","1"),"\n")),t.clipSpaceNearZ===yt.Zero&&(f+="".concat(Vn("CLIPSPACE_NEAR_ZERO","1"),"\n")),t.explicitBindingLocations){var h=0,d=0,p=0;l=l.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(t,e,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(h,", binding = ").concat(d++,") uniform ").concat(r)})),h++,d=0,wt(t.separateSamplerTextures),l=(l=l.replace(/uniform sampler2D (.*);/g,(function(t,n){return"frag"===e?"\nlayout(set = ".concat(h,", binding = ").concat(d++,") uniform texture2D T_").concat(n,";\nlayout(set = ").concat(h,", binding = ").concat(d++,") uniform sampler S_").concat(n,";\n"):""}))).replace("frag"===e?/^\b(varying|in)\b/gm:/^\b(varying|out)\b/gm,(function(t,e){return"layout(location = ".concat(p++,") ").concat(e)})),f+="".concat(Vn("gl_VertexID","gl_VertexIndex"),"\n")}l=t.separateSamplerTextures?(l=(l=(l=l.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(t,e){return"texture2D T_P_".concat(e,", sampler S_P_").concat(e)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(t,e){return"SAMPLER_2D(P_".concat(e,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(t,e){return"T_".concat(e,", S_").concat(e)}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(t,e){return"sampler2D(T_".concat(e,", S_").concat(e,")")})):(l=(l=(l=l.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,(function(t,e){return"sampler2D P_".concat(e)}))).replace(/\bPU_SAMPLER_2D\((.*?)\)/g,(function(t,e){return"SAMPLER_2D(P_".concat(e,")")}))).replace(/\bPP_SAMPLER_2D\((.*?)\)/g,(function(t,e){return e}))).replace(/\bSAMPLER_2D\((.*?)\)/g,(function(t,e){return e}));var v="\n".concat(t.glslVersion,"\n").concat(o&&a?"#extension GL_EXT_draw_buffers : require":"","\n").concat(o&&"frag"===e?"#extension GL_OES_standard_derivatives : enable":"","\n").concat(c,"\n").concat(f,"\n").concat(u,"\n").concat(l,"\n").trim();if(t.explicitBindingLocations&&"frag"===e&&(v=v.replace(/^\b(out)\b/gm,(function(t,e){return"layout(location = 0) ".concat(e)}))),o){if("frag"===e&&(v=v.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"varying ".concat(e," ").concat(n,";\n")}))),"vert"===e&&(v=(v=v.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"varying ".concat(e," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"attribute ".concat(e," ").concat(n,";\n")}))),v=v.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(t,e){return e.trim().replace(/^.*$/gm,(function(t){var e=t.trim();return e.startsWith("#")?e:t?"uniform ".concat(e):""}))})),a&&"frag"===e){var y=[],g=(v=v.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(t,e){return y.push(e),"vec4 ".concat(e,";\n")}))).lastIndexOf("}");v=v.substring(0,g)+"\n    ".concat(y.map((function(t,e){return"gl_FragData[".concat(e,"] = ").concat(t,";\n    ")})).join("\n"))+v.substring(g)}v=v.replace(/^\s*layout\((.*)\)/gm,"");var m,_=K(jn);try{for(_.s();!(m=_.n()).done;){var E=j(m.value,2),T=E[0],b=E[1];v=v.replace(T,b)}}catch(R){_.e(R)}finally{_.f()}}return v}function Xn(t,e){var n=void 0!==e.defines?e.defines:null,r=void 0!==e.features?e.features:null,i=void 0!==e.both?e.both+e.vert:e.vert,o=void 0!==e.both?e.both+e.frag:e.frag;return function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=Wn(t,"vert",e,r,i),a=Wn(t,"frag",n,r,i);return{vert:e,frag:n,preprocessedVert:o,preprocessedFrag:a}}(t.queryVendorInfo(),i,o,n,r)}var Hn=function(){function t(){C(this,t),this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines=new Map,this.features={MRT:!0}}return N(t,[{key:"definesChanged",value:function(){this.preprocessedVert="",this.preprocessedFrag=""}},{key:"setDefineString",value:function(t,e){if(null!==e){if(this.defines.get(t)===e)return!1;this.defines.set(t,e)}else{if(!this.defines.has(t))return!1;this.defines.delete(t)}return this.definesChanged(),!0}},{key:"setDefineBool",value:function(t,e){return this.setDefineString(t,e?"1":null)}},{key:"getDefineString",value:function(t){return zt(this.defines.get(t))}},{key:"getDefineBool",value:function(t){var e=this.getDefineString(t);return null!==e&&wt("1"===e),null!==e}},{key:"ensurePreprocessed",value:function(t){""===this.preprocessedVert&&(this.preprocessedVert=Wn(t,"vert",this.both+this.vert,this.defines,this.features),this.preprocessedFrag=Wn(t,"frag",this.both+this.frag,this.defines,this.features))}}]),t}(),Yn=function(){function t(){C(this,t),this.name=void 0,this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0}return N(t,[{key:"reset",value:function(){this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0}},{key:"copy",value:function(t){this.texture=t.texture,this.sampler=t.sampler,this.lateBinding=t.lateBinding,this.width=t.width,this.height=t.height,this.lodBias=t.lodBias}}]),t}(),zn=1,qn=function(){function t(){C(this,t),this.renderHelper=void 0,this.rendererFactory=void 0,this.meshFactory=void 0,this.device=void 0,this.renderingService=void 0,this.meshes=[],this.stencilRefCache={}}return N(t,[{key:"render",value:function(t){var e=this;this.meshes.forEach((function(n){n.init(e.device,e.renderingService);var r=n.objects;n.clipPathTarget&&(r=[n.clipPath]);var i=e.renderHelper.renderInstManager.newRenderInst();n.applyRenderInst(i,r),e.renderHelper.renderInstManager.submitRenderInst(i,t),n.objects.forEach((function(t){t.renderable.dirty=!1}))}))}},{key:"attach",value:function(t,e){this.device=t,this.renderingService=e}},{key:"add",value:function(t){var e=this,n=t.renderable3D;if(n&&!n.meshes.length){var r=this.rendererFactory(t.nodeName);r&&r.meshes.forEach((function(i,o){if(n.meshes[o]=void 0,r.shouldSubmitRenderInst(t,o)){var a=e.meshes.find((function(e){return i===e.constructor&&e.index===o&&e.shouldMerge(t,o)}));a||((a=e.meshFactory(i)).renderer=r,a.index=o,e.meshes.push(a)),a&&(a.objects.push(t),n.meshes[o]=a,a.geometryDirty=!0)}}))}}},{key:"remove",value:function(t){var e=this,n=t.renderable3D;n&&(n.meshes.forEach((function(n){if(n){var r=n.objects.indexOf(t);r>-1&&(n.objects.splice(r,1),n.geometryDirty=!0),0===n.objects.length&&e.meshes.splice(e.meshes.indexOf(n),1)}})),n.meshes=[])}},{key:"updateAttribute",value:function(t,e,n){var r=this,i=t.renderable3D,o=this.rendererFactory(t.nodeName);o&&o.meshes.forEach((function(a,s){var u=o.shouldSubmitRenderInst(t,s),c=i.meshes.find((function(t){return t&&t.index===s&&t.constructor===a}));u!==!!c&&(c&&(c.objects.splice(c.objects.indexOf(t),1),c.geometryDirty=!0,0===c.objects.length&&r.meshes.splice(r.meshes.indexOf(c),1),i.meshes[i.meshes.indexOf(c)]=void 0),u&&((c=r.meshes.find((function(e){return a===e.constructor&&e.index===s&&e.shouldMerge(t,s)})))||((c=r.meshFactory(a)).renderer=o,c.index=s,c.init(r.device,r.renderingService),r.meshes.push(c)),c&&(c.objects.push(t),i.meshes[s]=c))),u&&c&&c.inited&&!c.geometryDirty&&c.updateAttribute(t,e,n)}))}},{key:"changeRenderOrder",value:function(t,e){var n=t.renderable3D;n&&n.meshes.length&&n.meshes.forEach((function(n){n&&n.inited&&!n.geometryDirty&&(n.renderer.shouldSubmitRenderInst(t,n.index)&&n.inited&&n.changeRenderOrder(t,e))}))}},{key:"getStencilRef",value:function(t){return this.stencilRefCache[t.entity]||(this.stencilRefCache[t.entity]=zn++),this.stencilRefCache[t.entity]}}]),t}();Object(s.c)([Object(u.g)(wn),Object(s.f)("design:type",wn)],qn.prototype,"renderHelper",void 0),Object(s.c)([Object(u.g)(kn),Object(s.f)("design:type",Function)],qn.prototype,"rendererFactory",void 0),Object(s.c)([Object(u.g)(Gn),Object(s.f)("design:type",Function)],qn.prototype,"meshFactory",void 0),qn=Object(s.c)([Object(u.j)()],qn);var Kn,Zn=1,Qn=function(){function t(){C(this,t),this.renderHelper=void 0,this.texturePool=void 0,this.camera=void 0,this.lightPool=void 0,this.batchManager=void 0,this.meshFactory=void 0,this.device=void 0,this.renderingService=void 0,this.id=Zn++,this.meshes=[],this.clipPathMeshCreated=!1}return N(t,[{key:"shouldSubmitRenderInst",value:function(t,e){return!0}},{key:"beforeUploadUBO",value:function(t,e,n){}},{key:"beforeInitMesh",value:function(t){}},{key:"afterInitMesh",value:function(t){}}]),t}();function Jn(t,e,n){var r,i,o,a=t.createBuffer({viewOrSize:(r=n.byteLength,i=4,o=i-1,(r+o&~o)/4),usage:e,hint:ut.Static});return a.setSubData(0,new Uint8Array(n)),a}Object(s.c)([Object(u.g)(wn),Object(s.f)("design:type",wn)],Qn.prototype,"renderHelper",void 0),Object(s.c)([Object(u.g)(Fn),Object(s.f)("design:type",Fn)],Qn.prototype,"texturePool",void 0),Object(s.c)([Object(u.g)(a.h),Object(s.f)("design:type",a.b)],Qn.prototype,"camera",void 0),Object(s.c)([Object(u.g)(Ln),Object(s.f)("design:type",Ln)],Qn.prototype,"lightPool",void 0),Object(s.c)([Object(u.g)(qn),Object(s.f)("design:type",qn)],Qn.prototype,"batchManager",void 0),Object(s.c)([Object(u.g)(Gn),Object(s.f)("design:type",Function)],Qn.prototype,"meshFactory",void 0),Qn=Object(s.c)([Object(u.h)()],Qn),function(t){t[t.MODEL_MATRIX0=0]="MODEL_MATRIX0",t[t.MODEL_MATRIX1=1]="MODEL_MATRIX1",t[t.MODEL_MATRIX2=2]="MODEL_MATRIX2",t[t.MODEL_MATRIX3=3]="MODEL_MATRIX3",t[t.COLOR=4]="COLOR",t[t.STROKE_COLOR=5]="STROKE_COLOR",t[t.PACKED_STYLE1=6]="PACKED_STYLE1",t[t.PACKED_STYLE2=7]="PACKED_STYLE2",t[t.PICKING_COLOR=8]="PICKING_COLOR",t[t.ANCHOR=9]="ANCHOR",t[t.MAX=10]="MAX"}(Kn||(Kn={}));var $n=function(t){I(n,t);var e=k(n);function n(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return C(this,n),(r=e.call(this)).device=void 0,r.props=void 0,r.drawMode=at.Triangles,r.vertexBuffers=[],r.vertices=[],r.indexBuffer=void 0,r.indices=void 0,r.inputLayoutDescriptor={vertexBufferDescriptors:[],vertexAttributeDescriptors:[],indexBufferFormat:Tt.U32_R},r.vertexCount=0,r.instancedCount=0,r.indexStart=0,r.primitiveStart=0,r.dirty=!0,r.meshes=[],r.device=t,r.props=i,r}return N(n,[{key:"validate",value:function(t){return!0}},{key:"build",value:function(t){}},{key:"setIndexBuffer",value:function(t){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=Jn(this.device,st.INDEX,new Uint32Array(ArrayBuffer.isView(t)?t.buffer:t).buffer),this.indices=t,this}},{key:"setVertexBuffer",value:function(t){var e=this,n=t.bufferIndex,r=t.byteStride,i=t.frequency,o=t.attributes,a=t.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={byteStride:r,frequency:i},this.vertices[n]=a,o.forEach((function(t){var r=t.format,i=t.bufferByteOffset,o=t.location,a=t.divisor,s=t.byteStride,u=e.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(t){return t.bufferIndex===n&&t.location===o}));u?(u.format=r,u.bufferByteOffset=i,u.byteStride=s,u.divisor=a):e.inputLayoutDescriptor.vertexAttributeDescriptors.push({format:r,bufferIndex:n,bufferByteOffset:i,location:o,byteStride:s,divisor:a})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var s=Jn(this.device,st.VERTEX,a.buffer);return this.vertexBuffers[n]=s,this}},{key:"getVertexBuffer",value:function(t){return this.vertexBuffers[t]}},{key:"updateVertexBuffer",value:function(t,e,n,r){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[t].byteStride,o=this.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(t){return t.location===e}));if(o){var s=n*i;this.getVertexBuffer(t).setSubData(o.bufferByteOffset+s,r)}this.meshes.forEach((function(t){t.dispatchEvent(new a.n(a.j.ATTR_MODIFIED,t,null,null,"geometry",a.n.MODIFICATION,null,null))}))}},{key:"updateIndices",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.indexBuffer&&this.indexBuffer.setSubData(e,ArrayBuffer.isView(t)?t:new Uint32Array(t)),this}},{key:"destroy",value:function(){this.vertexBuffers.forEach((function(t){t&&t.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexAttributeDescriptors=[],this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0}}]),n}(v.EventEmitter);var tr=function(t){I(n,t);var e=k(n);function n(t,r){var i;return C(this,n),(i=e.call(this,t,S({},r))).defines=S(S({},i.defines),{},{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),i}return N(n)}(function(){function t(e,n){C(this,t),this.device=void 0,this.props={},this.meshes=[],this.defines={},this.uniforms={},this.uniformNames=void 0,this.uboBuffer=[],this.textures={},this.samplers=[],this.programDirty=!0,this.textureDirty=!0,this.geometryDirty=!0;var r=re(ae),i=r.cullMode,o=r.depthCompare,a=r.depthWrite,s=r.stencilCompare,u=r.stencilWrite,c=r.stencilPassOp,l=r.frontFace,f=r.polygonOffset,h=r.attachmentsState;this.device=e,this.props=S({cullMode:i,depthTest:!0,depthCompare:o,depthWrite:a,stencilCompare:s,stencilWrite:u,stencilPassOp:c,frontFace:l,polygonOffset:f,attachmentsState:h,blendEquation:nt.Add,blendEquationAlpha:nt.Add,blendSrc:et.SrcAlpha,blendDst:et.OneMinusSrcAlpha,blendSrcAlpha:et.Zero,blendDstAlpha:et.One,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},n),this.compile()}return N(t,[{key:"cullMode",get:function(){return this.props.cullMode},set:function(t){this.props.cullMode=t}},{key:"frontFace",get:function(){return this.props.frontFace},set:function(t){this.props.frontFace=t}},{key:"blendEquation",get:function(){return this.props.blendEquation},set:function(t){this.props.blendEquation=t}},{key:"blendEquationAlpha",get:function(){return this.props.blendEquationAlpha},set:function(t){this.props.blendEquationAlpha=t}},{key:"blendSrc",get:function(){return this.props.blendSrc},set:function(t){this.props.blendSrc=t}},{key:"blendDst",get:function(){return this.props.blendDst},set:function(t){this.props.blendDst=t}},{key:"blendSrcAlpha",get:function(){return this.props.blendSrcAlpha},set:function(t){this.props.blendSrcAlpha=t}},{key:"blendDstAlpha",get:function(){return this.props.blendDstAlpha},set:function(t){this.props.blendDstAlpha=t}},{key:"depthCompare",get:function(){return this.props.depthCompare},set:function(t){this.props.depthCompare=t}},{key:"depthTest",get:function(){return this.props.depthTest},set:function(t){this.props.depthTest=t}},{key:"depthWrite",get:function(){return this.props.depthWrite},set:function(t){this.props.depthWrite=t}},{key:"stencilCompare",get:function(){return this.props.stencilCompare},set:function(t){this.props.stencilCompare=t}},{key:"stencilWrite",get:function(){return this.props.stencilWrite},set:function(t){this.props.stencilWrite=t}},{key:"stencilPassOp",get:function(){return this.props.stencilPassOp},set:function(t){this.props.stencilPassOp=t}},{key:"stencilRef",get:function(){return this.props.stencilRef},set:function(t){this.props.stencilRef=t}},{key:"polygonOffset",get:function(){return this.props.polygonOffset},set:function(t){this.props.polygonOffset=t}},{key:"dithering",get:function(){return this.props.dithering},set:function(t){this.props.dithering=t}},{key:"wireframe",get:function(){return this.props.wireframe},set:function(t){this.props.wireframe!==t&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=t),this.defines.USE_WIREFRAME=!!t}},{key:"wireframeColor",get:function(){return this.props.wireframeColor},set:function(t){this.props.wireframeColor=t}},{key:"wireframeLineWidth",get:function(){return this.props.wireframeLineWidth},set:function(t){this.props.wireframeLineWidth=t}},{key:"vertexShader",get:function(){return this.props.vertexShader},set:function(t){this.props.vertexShader!==t&&(this.programDirty=!0,this.props.vertexShader=t,this.compile())}},{key:"fragmentShader",get:function(){return this.props.fragmentShader},set:function(t){this.props.fragmentShader!==t&&(this.programDirty=!0,this.props.fragmentShader=t,this.compile())}},{key:"compile",value:function(){var t=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(e,n){return t.samplers.push(n),""})),this.uniformNames=function(t){var e=[],n=[];return t.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(t,e,r){var i=[];return r.trim().split("\n").forEach((function(t){var e=j(t.trim().split(/\s+/),2),n=e[0],r=e[1];i.push({type:n.trim(),name:r.replace(";","").trim()})})),n.push({type:e.trim(),uniforms:i}),""})),t.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(t,r){return r.trim().split("\n").forEach((function(t){var r=j(t.trim().split(" "),2),i=r[0],o=void 0===i?"":i,a=r[1],s=void 0===a?"":a,u=s.indexOf("[")>-1;if(s=s.replace(";","").replace("[","").trim(),!o.startsWith("#")){if(o){var c=n.find((function(t){return o===t.type}));if(c)if(u)for(var l=function(t){c.uniforms.forEach((function(n){e.push("".concat(s,"[").concat(t,"].").concat(n.name))}))},f=0;f<5;f++)l(f);else c.uniforms.forEach((function(t){e.push("".concat(s,".").concat(t.name))}))}s&&e.push(s)}})),""})),e}(this.props.fragmentShader)}},{key:"setUniforms",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r,i=t[n],o=e.textures[n];o&&o!==i&&(e.textureDirty=!0),(r=i)&&r.type?(e.textures[n]=i,e.textureDirty=!0):e.uniforms[n]=i,Object(p.h)(t[n])&&(delete e.textures[n],delete e.uniforms[n])})),this.meshes.forEach((function(t){t.dispatchEvent(new a.n(a.j.ATTR_MODIFIED,t,null,null,"material",a.n.MODIFICATION,null,null))}))}}]),t}());function er(t){var e={};return Object.keys(t).forEach((function(n){"number"==typeof t[n]&&(e[n]=t[n])})),e}var nr,rr=1;!function(t){t[t.INSTANCED=0]="INSTANCED",t[t.MAX=1]="MAX"}(nr||(nr={}));var ir=function(){function t(){C(this,t),this.id=rr++,this.renderer=void 0,this.index=-1,this.renderHelper=void 0,this.texturePool=void 0,this.camera=void 0,this.lightPool=void 0,this.device=void 0,this.renderingService=void 0,this.objects=[],this.material=void 0,this.geometry=void 0,this.clipPath=void 0,this.clipPathTarget=void 0,this.inputState=void 0,this.program=new Hn,this.programDescriptorSimpleWithOrig=void 0,this.geometryDirty=!0,this.materialDirty=!0,this.inputStateDirty=!0,this.textureMappings=[],this.samplerEntries=void 0,this.inited=!1}return N(t,[{key:"instance",get:function(){return this.objects[0]}},{key:"init",value:function(t,e){this.inited||(this.renderer.beforeInitMesh(this),this.device=t,this.renderingService=e,this.material=new tr(this.device),this.geometry=new $n(this.device),this.inited=!0,this.renderer.afterInitMesh(this))}},{key:"shouldMerge",value:function(t,e){return!this.instance||this.instance.nodeName===t.nodeName&&!t.parsedStyle.clipPath}},{key:"createGeometry",value:function(t){var e=this,n=_n(),r=_n(),i=[];t.forEach((function(t){var o,s=t.parsedStyle,u=s.fill,c=s.stroke,l=s.opacity,f=s.fillOpacity,h=s.strokeOpacity,d=s.lineWidth,p=(s.lineDash,s.anchor),v=s.visibility,y=[0,0,0,0];(null==u?void 0:u.type)===a.p.Constant&&(y=u.value);var g=[0,0,0,0];(null==c?void 0:c.type)===a.p.Constant&&(g=c.value),e.clipPathTarget?(En(n,t.getLocalTransform()),y=[1,1,1,1],Rn(n,e.clipPathTarget.getWorldTransform(),n)):En(n,t.getWorldTransform()),Rn(r,e.camera.getViewTransform(),n);var m=(null===(o=t.renderable3D)||void 0===o?void 0:o.encodedPickingColor)||[0,0,0];i.push.apply(i,W(n).concat(W(y),W(g),[l,f,h,d.value,"visible"===v?1:0,0,0,0],W(m),[.005*t.sortable.renderOrder,p[0],p[1]]))})),this.geometry.instancedCount=t.length,this.geometry.setVertexBuffer({bufferIndex:nr.INSTANCED,byteStride:152,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RGBA,bufferByteOffset:0,location:Kn.MODEL_MATRIX0,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:16,location:Kn.MODEL_MATRIX1,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:32,location:Kn.MODEL_MATRIX2,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:48,location:Kn.MODEL_MATRIX3,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:64,location:Kn.COLOR,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:80,location:Kn.STROKE_COLOR,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:96,location:Kn.PACKED_STYLE1,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:112,location:Kn.PACKED_STYLE2,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:128,location:Kn.PICKING_COLOR,divisor:1},{format:Tt.F32_RG,bufferByteOffset:144,location:Kn.ANCHOR,divisor:1}],data:new Float32Array(i)})}},{key:"destroy",value:function(){this.geometry&&this.geometry.destroy(),this.inputState&&this.inputState.destroy()}},{key:"applyRenderInst",value:function(t,e){var n=this,r=this.lightPool.getAllLights(),i=!!this.lightPool.getFog(),o=!!r.length;this.material.defines.USE_WIREFRAME;if(i===this.material.defines.USE_FOG&&o===this.material.defines.USE_LIGHT||(this.material.programDirty=!0),this.material.defines.USE_FOG=i,this.material.defines.USE_LIGHT=o,this.material.defines=S(S({},this.material.defines),this.lightPool.getDefines()),this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilCompare=J.Always,this.material.stencilPassOp=dt.Replace):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilCompare=J.Equal,this.material.stencilPassOp=dt.Keep):this.material.stencilWrite=!1,this.material.textureDirty||this.materialDirty){this.textureMappings=[];var a=this.createFillGradientTextureMapping(e);a&&(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0,this.textureMappings.push(a))}(this.material.programDirty||this.materialDirty)&&(this.createMaterial(e),this.material.defines=S(S({},this.material.defines),er(Kn)),Object.keys(this.material.defines).forEach((function(t){var e=n.material.defines[t];"number"==typeof e?n.program.setDefineString(t,"".concat(e)):n.program.setDefineBool(t,e)})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.programDescriptorSimpleWithOrig=Xn(this.device,this.program),this.material.programDirty=!1),(this.material.textureDirty||this.materialDirty)&&(Object.keys(this.material.textures).sort((function(t,e){return n.material.samplers.indexOf(t)-n.material.samplers.indexOf(e)})).forEach((function(t){var e=new Yn;e.name=t,e.texture=n.material.textures[t],n.device.setResourceName(e.texture,"Material Texture "+t),e.sampler=n.renderHelper.getCache().createSampler({wrapS:rt.Clamp,wrapT:rt.Clamp,minFilter:it.Point,magFilter:it.Bilinear,mipFilter:ot.Linear,minLOD:0,maxLOD:0}),n.textureMappings.push(e)})),this.material.textureDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.inputStateDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(e),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1,this.inputStateDirty=!0);var s=this.renderHelper.getCache().createInputLayout(this.geometry.inputLayoutDescriptor),u=this.renderHelper.getCache().createProgramSimple(this.programDescriptorSimpleWithOrig),c=!!this.geometry.indexBuffer;this.inputStateDirty&&(this.inputState&&this.inputState.destroy(),this.inputState=this.device.createInputState(s,this.geometry.vertexBuffers.map((function(t){return{buffer:t,byteOffset:0}})),c?{buffer:this.geometry.indexBuffer,byteOffset:0}:null,u),this.inputStateDirty=!1),t.renderPipelineDescriptor.topology=this.geometry.drawMode,t.setProgram(u),t.setInputLayoutAndState(s,this.inputState),this.renderer.beforeUploadUBO(t,this,this.index),this.uploadUBO(t),c?t.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):t.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),t.sortKey=gn(dn.OPAQUE,e[0].sortable.renderOrder)}},{key:"updateBatchedAttribute",value:function(t,e,n,r){if("fill"===n){var i=t.parsedStyle.fill,o=this.textureMappings.findIndex((function(t){return"FillTextureMapping"===t.name})),s=[0,0,0,0];if((null==i?void 0:i.type)===a.p.Constant)s=i.value,this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.COLOR,e,new Uint8Array(new Float32Array(W(s)).buffer)),o>=0&&this.textureMappings.splice(o,-1);else{var u=this.createFillGradientTextureMapping([t]);o>=0&&this.textureMappings.splice(o,1,u),this.material.textureDirty=!0}}else if("stroke"===n){var c=t.parsedStyle.stroke,l=[0,0,0,0];(null==c?void 0:c.type)===a.p.Constant&&(l=c.value),this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.STROKE_COLOR,e,new Uint8Array(new Float32Array(W(l)).buffer))}else if(["opacity","fillOpacity","strokeOpacity","lineWidth"].indexOf(n)>-1){var f=t.parsedStyle,h=f.opacity,d=f.fillOpacity,p=f.strokeOpacity,v=f.lineWidth;this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.PACKED_STYLE1,e,new Uint8Array(new Float32Array([h,d,p,v.value]).buffer))}else if("modelMatrix"===n){var y=En(_n(),t.getWorldTransform());this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.MODEL_MATRIX0,e,new Uint8Array(new Float32Array(y).buffer))}else if("anchor"===n){var g=t.parsedStyle.anchor;this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.ANCHOR,e,new Uint8Array(new Float32Array([g[0],g[1]]).buffer))}else if("visibility"===n){var m=t.parsedStyle.visibility;this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.PACKED_STYLE2,e,new Uint8Array(new Float32Array(["visible"===m?1:0]).buffer))}}},{key:"updateAttribute",value:function(t,e,n){"clipPath"===e&&this.clipPath&&(this.geometryDirty=!0)}},{key:"changeRenderOrder",value:function(t,e){var n,r=this.objects.indexOf(t),i=(null===(n=t.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(nr.INSTANCED,Kn.PICKING_COLOR,r,new Uint8Array(new Float32Array([].concat(W(i),[.005*e])).buffer))}},{key:"generateWireframe",value:function(t){for(var e=t.indices,n=t.indices.length,r=t.vertices.map((function(t){return t.slice()})),i=1;i<t.vertexBuffers.length;i++){var o=t.inputLayoutDescriptor.vertexBufferDescriptors[i].byteStride;t.vertices[i]=new Float32Array(o/4*n)}for(var a=0,s=new Uint32Array(n),u=0;u<n;u++){for(var c=e[u],l=1;l<t.vertices.length;l++)for(var f=t.inputLayoutDescriptor.vertexBufferDescriptors[l].byteStride/4,h=0;h<f;h++)t.vertices[l][a*f+h]=r[l][c*f+h];s[u]=a,a++}for(var d=function(e){if(4===e)return"continue";var n=t.inputLayoutDescriptor.vertexBufferDescriptors[e],r=n.frequency,i=n.byteStride,o=t.inputLayoutDescriptor.vertexAttributeDescriptors.find((function(t){return t.bufferIndex===e}));if(o){var a=o.location,s=o.bufferIndex,u=o.bufferByteOffset,c=o.format,l=o.divisor;t.setVertexBuffer({bufferIndex:s,byteStride:i,frequency:r,attributes:[{format:c,bufferByteOffset:u,location:a,divisor:l}],data:t.vertices[e]})}},p=1;p<t.vertexBuffers.length;p++)d(p);for(var v=new Float32Array(3*n),y=0;y<n;)for(var g=0;g<3;g++){v[3*s[y++]+g]=1}t.setVertexBuffer({bufferIndex:4,byteStride:12,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RGB,bufferByteOffset:0,location:Number(this.material.defines.BARYCENTRIC)}],data:v}),t.setIndexBuffer(s)}},{key:"beforeUploadUBO",value:function(t,e,n){}},{key:"uploadUBO",value:function(t){var e=this,n=this.material,r=this.lightPool.getAllLights(),i=this.lightPool.getFog(),o=!!i,s=!!r.length,u=n.defines.USE_WIREFRAME,c=[];if(u){var l=Object(a.x)(n.wireframeColor).value;c.push({name:"u_WireframeLineColor",value:l.slice(0,3)}),c.push({name:"u_WireframeLineWidth",value:n.wireframeLineWidth})}if(o&&this.uploadFog(c,i),this.uploadMaterial(c,n),s){var f={};r.forEach((function(t){f[t.define]||(f[t.define]=-1),f[t.define]++,t.uploadUBO(c,f[t.define])}))}c.sort((function(t,n){return e.material.uniformNames.indexOf(t.name)-e.material.uniformNames.indexOf(n.name)})),t.setUniforms(1,c);var h=n.depthCompare,d=n.depthWrite,p=n.stencilCompare,v=n.stencilWrite,y=n.stencilPassOp,g=n.stencilRef,m=n.cullMode,_=n.frontFace,E=n.polygonOffset,T=n.blendEquation,b=n.blendEquationAlpha,R=n.blendSrc,A=n.blendDst,S=n.blendSrcAlpha,O=n.blendDstAlpha;t.setMegaStateFlags({attachmentsState:[{channelWriteMask:this.material.stencilWrite?ht.None:ht.AllChannels,rgbBlendState:{blendMode:T,blendSrcFactor:R,blendDstFactor:A},alphaBlendState:{blendMode:b,blendSrcFactor:S,blendDstFactor:O}}],depthCompare:h,depthWrite:d,stencilCompare:p,stencilWrite:v,stencilPassOp:y,stencilRef:g,cullMode:m,frontFace:_,polygonOffset:E}),t.setBindingLayouts([{numUniformBuffers:1,numSamplers:this.textureMappings.length,samplerEntries:this.samplerEntries}]),t.setSamplerBindingsFromTextureMappings(this.textureMappings)}},{key:"uploadFog",value:function(t,e){var n=e.parsedStyle,r=n.type,i=n.fill,o=n.start,s=n.end,u=n.density;if((null==i?void 0:i.type)===a.p.Constant){var c=i.value;t.push({name:"u_FogInfos",value:[r,o,s,u]}),t.push({name:"u_FogColor",value:c})}}},{key:"uploadMaterial",value:function(t,e){var n=Object.keys(e.uniforms).map((function(t){return{name:t,value:e.uniforms[t]}}));t.push.apply(t,W(n))}},{key:"createFillGradientTextureMapping",value:function(t){var e=this,n=t[0],r=n.nodeName===a.u.LINE?n.parsedStyle.stroke:n.parsedStyle.fill;if(r&&(r.type===a.p.Pattern||r.type===a.p.LinearGradient||r.type===a.p.RadialGradient)){var i;this.program.setDefineBool("USE_UV",!0),this.program.setDefineBool("USE_MAP",!0),r.type===a.p.LinearGradient||r.type===a.p.RadialGradient?(this.texturePool.getOrCreateGradient(S(S({type:r.type},r.value),{},{width:128,height:128})),i=this.texturePool.getOrCreateCanvas()):i=r.value.src;var o=new Yn;return o.name="FillTextureMapping",o.texture=this.texturePool.getOrCreateTexture(this.device,i,Ot(Tt.U8_RGBA_NORM,1,1,1),(function(){t.forEach((function(t){t.renderable.dirty=!0,e.renderingService.dirtify()}))})),this.device.setResourceName(o.texture,"Fill Texture"+this.id),o.sampler=this.renderHelper.getCache().createSampler({wrapS:rt.Repeat,wrapT:rt.Repeat,minFilter:it.Point,magFilter:it.Bilinear,mipFilter:ot.Linear,minLOD:0,maxLOD:0}),o}return null}}]),t}();Object(s.c)([Object(u.g)(wn),Object(s.f)("design:type",wn)],ir.prototype,"renderHelper",void 0),Object(s.c)([Object(u.g)(Fn),Object(s.f)("design:type",Fn)],ir.prototype,"texturePool",void 0),Object(s.c)([Object(u.g)(a.h),Object(s.f)("design:type",a.b)],ir.prototype,"camera",void 0),Object(s.c)([Object(u.g)(Ln),Object(s.f)("design:type",Ln)],ir.prototype,"lightPool",void 0),ir=Object(s.c)([Object(u.h)()],ir);var or,ar;!function(t){t[t.EXTRUDE_UV=1]="EXTRUDE_UV",t[t.SIZE=2]="SIZE",t[t.PACKED_STYLE3=3]="PACKED_STYLE3"}(or||(or={})),function(t){t[t.EXTRUDE=10]="EXTRUDE",t[t.PACKED_STYLE3=11]="PACKED_STYLE3",t[t.SIZE=12]="SIZE",t[t.UV=13]="UV"}(ar||(ar={}));var sr=[a.u.CIRCLE,a.u.ELLIPSE],ur=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){var r=G(B(n.prototype),"shouldMerge",this).call(this,t,e);return!!r&&(!this.needDrawStrokeSeparately(t)&&!this.needDrawStrokeSeparately(this.instance))}},{key:"createMaterial",value:function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = COLOR) in vec4 a_Color;\nlayout(location = STROKE_COLOR) in vec4 a_StrokeColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\nlayout(location = ANCHOR) in vec2 a_Anchor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = EXTRUDE) in vec2 a_Extrude;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\nlayout(location = SIZE) in vec2 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec4 v_Data;\nout vec2 v_Radius;\nout vec4 v_StylePacked3;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  float antialiasblur = 1.0 / (a_Size.x + u_StrokeWidth);\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size + vec2(omitStroke ? 0.0 : u_StrokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * a_Anchor.xy) * radius;\n\n  gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  \n  v_Radius = radius;\n  v_Data = vec4(a_Extrude, antialiasblur, a_StylePacked3.x);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Data;\nin vec2 v_Radius;\nin vec4 v_StylePacked3;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\nvoid main() {\n  int shape = int(floor(v_Data.w + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  float antialiasblur = v_Data.z;\n  float antialiased_blur = -max(0.0, antialiasblur);\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius;\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data.xy, 1.0);\n    inner_df = sdCircle(v_Data.xy, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data.xy, vec2(1.0));\n    inner_df = sdEllipsoidApproximated(v_Data.xy, r);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  // vec2 imagecoord = mod(v_Uv, 0.1);\n  // vec4 texel = texture(SAMPLER_2D(u_Map), imagecoord);\n  // u_Color = texel;\n\n  vec4 diffuseColor = u_Color;\n\n  vec4 strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n\n  gbuf_color = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  gbuf_color.a = gbuf_color.a * u_Opacity * opacity_t;\n\n  if (gbuf_color.a < 0.001)\n    discard;\n}",this.material.defines=S(S({},this.material.defines),er(ar))}},{key:"createGeometry",value:function(t){var e=this;G(B(n.prototype),"createGeometry",this).call(this,t);var r=[],i=[],o=[],a=[];t.forEach((function(t,n){var s=t,u=4*n,c=s.parsedStyle.radius,l=e.shouldOmitStroke(s.parsedStyle),f=e.getSize(t.parsedStyle,s.nodeName);i.push.apply(i,W(f)),o.push(sr.indexOf(s.nodeName),c||0,l?1:0,0),r.push(-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1),a.push(0+u,2+u,1+u,0+u,3+u,2+u)})),this.geometry.setIndexBuffer(new Uint32Array(a)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:or.EXTRUDE_UV,byteStride:16,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,location:ar.EXTRUDE},{format:Tt.F32_RG,bufferByteOffset:8,location:ar.UV}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:or.SIZE,byteStride:8,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,location:ar.SIZE,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:or.PACKED_STYLE3,byteStride:16,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RGBA,bufferByteOffset:0,location:ar.PACKED_STYLE3,divisor:1}],data:new Float32Array(o)})}},{key:"updateAttribute",value:function(t,e,r){G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var i=this.objects.indexOf(t);if(this.updateBatchedAttribute(t,i,e,r),"r"===e||"rx"===e||"ry"===e||"lineWidth"===e){var o=j(this.getSize(t.parsedStyle,t.nodeName),2),a=[o[0],o[1]];this.geometry.updateVertexBuffer(or.SIZE,ar.SIZE,i,new Uint8Array(new Float32Array([].concat(a)).buffer))}else if("stroke"===e||"lineDash"===e||"strokeOpacity"===e){var s=t,u=this.shouldOmitStroke(s.parsedStyle);this.geometry.updateVertexBuffer(or.PACKED_STYLE3,ar.PACKED_STYLE3,i,new Uint8Array(new Float32Array([sr.indexOf(t.nodeName),t.parsedStyle.radius||0,u?1:0,0]).buffer))}}},{key:"getSize",value:function(t,e){var n=[0,0];if(e===a.u.CIRCLE){var r=t.rInPixels;n=[r,r]}else if(e===a.u.ELLIPSE){n=[t.rxInPixels,t.ryInPixels]}return n}},{key:"shouldOmitStroke",value:function(t){var e=t.lineDash,n=t.stroke,r=t.strokeOpacity;return!(!n||!(e&&e.length&&e.every((function(t){return 0!==t}))||1!==r))}},{key:"needDrawStrokeSeparately",value:function(t){var e=t.parsedStyle,n=e.stroke,r=e.lineDash,i=e.lineWidth,o=e.strokeOpacity;return n&&i.value>0&&(o<1||r&&r.length&&r.every((function(t){return 0!==t})))}}]),n}(ir);ur=Object(s.c)([Object(u.h)()],ur);var cr,lr,fr,hr=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1];!function(t){t[t.POSITION_UV=1]="POSITION_UV",t[t.POINT_CAP_DASH=2]="POINT_CAP_DASH"}(lr||(lr={})),function(t){t[t.POSITION=10]="POSITION",t[t.POINTA=11]="POINTA",t[t.POINTB=12]="POINTB",t[t.CAP=13]="CAP",t[t.UV=14]="UV",t[t.DASH=15]="DASH"}(fr||(fr={}));var dr=(P(cr={},a.l.BUTT,1),P(cr,a.l.ROUND,2),P(cr,a.l.SQUARE,3),cr),pr=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){var r=G(B(n.prototype),"shouldMerge",this).call(this,t,e);if(!r)return!1;var i=this.instance;if(i.nodeName===a.u.LINE){var o=i.parsedStyle.stroke,s=t.parsedStyle.stroke;if(o.type!==s.type)return!1;if(o.type!==a.p.Constant&&s.type!==a.p.Constant)return o.value.hash===s.value.hash}return!0}},{key:"createMaterial",value:function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = COLOR) in vec4 a_Color;\nlayout(location = STROKE_COLOR) in vec4 a_StrokeColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\nlayout(location = ANCHOR) in vec2 a_Anchor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\n// out vec2 v_Normal;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n  float isBillboard = a_Dash.w;\n  if (isBillboard < 0.5) {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * u_StrokeWidth * a_Position.y;\n    point = point - a_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(u_StrokeWidth / 2.0);\n    }\n\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else {\n    // clip space\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + u_StrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + u_StrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  }\n\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n// in vec2 v_Normal;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  gbuf_color = u_StrokeColor;\n  #ifdef USE_MAP\n      gbuf_color = u_Color;\n  #endif\n\n  // float blur = 1. - smoothstep(0.98, 1., length(v_Normal));\n  float u_dash_offset = v_Dash.y;\n  float u_dash_array = v_Dash.z;\n  float u_dash_ratio = v_Dash.w;\n  gbuf_color.a = gbuf_color.a\n    // * blur\n    * u_Opacity * u_StrokeOpacity\n    * ceil(mod(v_Dash.x + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}",this.material.defines=S(S({},this.material.defines),er(fr))}},{key:"createGeometry",value:function(t){var e=this;G(B(n.prototype),"createGeometry",this).call(this,t);var r=[],i=[],o=0;t.forEach((function(t){var n=t.parsedStyle,a=n.x1,s=n.y1,u=n.x2,c=n.y2,l=n.z1,f=n.z2,h=n.defX,d=n.defY,p=n.lineCap,v=n.isBillboard,y=e.calcDash(t),g=y.dashOffset,m=y.dashSegmentPercent,_=y.dashRatioInEachSegment;r.push(a-h,s-d,l,u-h,c-d,f,dr[p],g,m,_,v?1:0),i.push(0+o,2+o,1+o,0+o,3+o,2+o),o+=4})),this.geometry.setIndexBuffer(new Uint32Array(i)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:lr.POSITION_UV,byteStride:20,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RGB,bufferByteOffset:0,location:fr.POSITION,divisor:0},{format:Tt.F32_RG,bufferByteOffset:12,location:fr.UV,divisor:0}],data:new Float32Array(hr)}),this.geometry.setVertexBuffer({bufferIndex:lr.POINT_CAP_DASH,byteStride:44,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RGB,bufferByteOffset:0,location:fr.POINTA,divisor:1},{format:Tt.F32_RGB,bufferByteOffset:12,location:fr.POINTB,divisor:1},{format:Tt.F32_R,bufferByteOffset:24,location:fr.CAP,divisor:1},{format:Tt.F32_RGBA,bufferByteOffset:28,location:fr.DASH,divisor:1}],data:new Float32Array(r)})}},{key:"updateAttribute",value:function(t,e,r){G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var i=this.objects.indexOf(t);this.updateBatchedAttribute(t,i,e,r);var o=t.parsedStyle,a=o.x1,s=o.y1,u=o.x2,c=o.y2,l=o.z1,f=o.z2,h=o.defX,d=o.defY,p=o.lineCap;if("x1"===e||"y1"===e||"x2"===e||"y2"===e||"z1"===e||"z2"===e)this.geometry.updateVertexBuffer(lr.POINT_CAP_DASH,fr.POINTA,i,new Uint8Array(new Float32Array([a-h,s-d,l,u-h,c-d,f]).buffer));else if("lineDashOffset"===e||"lineDash"===e){var v=this.calcDash(t),y=v.dashOffset,g=v.dashSegmentPercent,m=v.dashRatioInEachSegment;this.geometry.updateVertexBuffer(lr.POINT_CAP_DASH,fr.DASH,i,new Uint8Array(new Float32Array([y,g,m]).buffer))}else"lineCap"===e&&this.geometry.updateVertexBuffer(lr.POINT_CAP_DASH,fr.CAP,i,new Uint8Array(new Float32Array([dr[p]]).buffer))}},{key:"calcDash",value:function(t){var e=t.parsedStyle,n=e.lineDash,r=e.lineDashOffset,i=void 0===r?0:r,o=t.getTotalLength(),a=0,s=1,u=0;if(n&&n.length){a=i/o;var c=n.reduce((function(t,e){return t+e}),0);s=c/o,u=n[1]/c}return{dashOffset:a,dashSegmentPercent:s,dashRatioInEachSegment:u}}}]),n}(ir);function vr(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}pr=Object(s.c)([Object(u.h)()],pr);var yr=function(t,e,n,r,i){return{x:(1-i)*t+i*n,y:(1-i)*e+i*r}};function gr(t,e,n,r,i){var o=1-i;return o*o*o*t+3*e*i*o*o+3*n*i*i*o+r*i*i*i}function mr(t,e,n,r,i,o,a,s,u){var c=gr(t,n,i,a,u),l=gr(e,r,o,s,u),f=yr(t,e,n,r,u),h=yr(n,r,i,o,u),d=yr(i,o,a,s,u),p=yr(f.x,f.y,h.x,h.y,u),v=yr(h.x,h.y,d.x,d.y,u);return[[t,e,f.x,f.y,p.x,p.y,c,l],[c,l,v.x,v.y,d.x,d.y,a,s]]}function _r(t,e,n,r,i,o,a,u,c){if(0===c)return function(t,e){for(var n=0,r=t.length,i=0;i<r;i++){n+=vr(t[i],e[i],t[(i+1)%r],e[(i+1)%r])}return n/2}([t,n,i,a],[e,r,o,u]);var l=mr(t,e,n,r,i,o,a,u,.5),f=Object(s.i)(Object(s.i)([],Object(s.g)(l[0]),!1),[c-1],!1),h=Object(s.i)(Object(s.i)([],Object(s.g)(l[1]),!1),[c-1],!1);return _r.apply(null,f)+_r.apply(null,h)}var Er,Tr=function(t,e,n,r,i,o,a,s){return _r(t,e,n,r,i,o,a,s,3)};!function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.JOINT_BEVEL=4]="JOINT_BEVEL",t[t.JOINT_MITER=8]="JOINT_MITER",t[t.JOINT_ROUND=12]="JOINT_ROUND",t[t.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",t[t.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",t[t.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",t[t.FILL_EXPAND=24]="FILL_EXPAND",t[t.CAP_BUTT=32]="CAP_BUTT",t[t.CAP_SQUARE=64]="CAP_SQUARE",t[t.CAP_ROUND=96]="CAP_ROUND",t[t.CAP_BUTT2=128]="CAP_BUTT2"}(Er||(Er={}));var br,Rr;!function(t){t[t.PREV=0]="PREV",t[t.POINT1=1]="POINT1",t[t.POINT2=2]="POINT2",t[t.NEXT=3]="NEXT",t[t.VERTEX_JOINT=4]="VERTEX_JOINT",t[t.VERTEX_NUM=5]="VERTEX_NUM",t[t.TRAVEL=6]="TRAVEL"}(br||(br={})),function(t){t.MODEL_MATRIX="u_ModelMatrix",t.COLOR="u_Color",t.STROKE_COLOR="u_StrokeColor",t.STROKE_WIDTH="u_StrokeWidth",t.OPACITY="u_Opacity",t.FILL_OPACITY="u_FillOpacity",t.STROKE_OPACITY="u_StrokeOpacity",t.EXPAND="u_Expand",t.MITER_LIMIT="u_MiterLimit",t.SCALE_MODE="u_ScaleMode",t.ALIGNMENT="u_Alignment",t.PICKING_COLOR="u_PickingColor",t.DASH="u_Dash",t.GAP="u_Gap",t.DASH_OFFSET="u_DashOffset",t.VISIBLE="u_Visible",t.Z_INDEX="u_ZIndex"}(Rr||(Rr={}));var Ar=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){return!1}},{key:"updateAttribute",value:function(t,e,r){G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var i=t.parsedStyle,o=(i.fill,i.stroke),s=i.opacity,u=i.fillOpacity,c=i.strokeOpacity,l=i.lineWidth,f=i.anchor,h=i.lineDash,d=void 0===h?[]:h,p=i.lineDashOffset,v=void 0===p?0:p,y=i.visibility;if("lineJoin"===e||"lineCap"===e||"lineDash"===e||t.nodeName===a.u.CIRCLE&&"r"===e||t.nodeName===a.u.ELLIPSE&&("rx"===e||"ry"===e)||t.nodeName===a.u.RECT&&("width"===e||"height"===e||"radius"===e)||t.nodeName===a.u.LINE&&("x1"===e||"y1"===e||"x2"===e||"y2"===e)||t.nodeName===a.u.POLYLINE&&"points"===e||t.nodeName===a.u.POLYGON&&"points"===e||t.nodeName===a.u.PATH&&"path"===e)this.material.geometryDirty=!0,this.material.programDirty=!0;else if("stroke"===e){var g=[0,0,0,0];(null==o?void 0:o.type)===a.p.Constant&&(g=o.value),this.material.setUniforms(P({},Rr.STROKE_COLOR,g))}else if("opacity"===e)this.material.setUniforms(P({},Rr.OPACITY,s));else if("fillOpacity"===e)this.material.setUniforms(P({},Rr.FILL_OPACITY,u));else if("strokeOpacity"===e)this.material.setUniforms(P({},Rr.STROKE_OPACITY,c));else if("lineWidth"===e)this.material.setUniforms(P({},Rr.STROKE_WIDTH,l.value));else if("anchor"===e||"modelMatrix"===e){var m=0,_=0,E=t.getGeometryBounds();if(E){var T=E.halfExtents;m=-T[0]*f[0]*2,_=-T[1]*f[1]*2}var b=_n();Rn(b,t.getWorldTransform(),bn(b,An(m,_,0))),this.material.setUniforms(P({},Rr.MODEL_MATRIX,b))}else if("visibility"===e)this.material.setUniforms(P({},Rr.VISIBLE,"visible"===y?1:0));else if("lineDash"===e){var R;this.material.setUniforms((P(R={},Rr.DASH,d[0]||0),P(R,Rr.GAP,d[1]||0),R))}else"lineDashOffset"===e&&this.material.setUniforms(P({},Rr.DASH_OFFSET,v))}},{key:"changeRenderOrder",value:function(t,e){this.material&&this.material.setUniforms(P({},Rr.Z_INDEX,.005*e))}},{key:"createMaterial",value:function(t){var e,n;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec3 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nlayout(location = PREV) in vec2 a_Prev;\nlayout(location = POINT1) in vec2 a_Point1;\nlayout(location = POINT2) in vec2 a_Point2;\nlayout(location = NEXT) in vec2 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\n\nout vec4 v_PickingResult;\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvoid main() {\n  vec2 pointA = (u_ModelMatrix * vec4(a_Point1, 0., 1.0)).xy;\n  vec2 pointB = (u_ModelMatrix * vec4(a_Point2, 0., 1.0)).xy;\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n  float lineWidth = u_StrokeWidth;\n\n  if (u_ScaleMode > 2.5) {\n      lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n      lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n      vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n      lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n      if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n      }\n      type = JOINT_CAP_ROUND;\n      capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n      float dy = lineWidth + u_Expand;\n      float inner = 0.0;\n      if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n      }\n\n      vec2 base, next, xBasis2, bisect;\n      float flag = 0.0;\n      float sign2 = 1.0;\n      if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      next = (u_ModelMatrix * vec4(a_Prev, 0.0, 1.0)).xy;\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n\n      } else {\n      next = (u_ModelMatrix * vec4(a_Next, 0.0, 1.0)).xy;\n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n          flag = step(MITER + 1.5, type);\n          // check miter limit here?\n      }\n      }\n      xBasis2 = next - base;\n      float len2 = length(xBasis2);\n      vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n      float D = norm.x * norm2.y - norm.y * norm2.x;\n      if (D < 0.0) {\n      inner = 1.0 - inner;\n      }\n      norm2 *= sign2;\n\n      if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n          base += norm * shift;\n      } else {\n          base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n      }\n\n      float collinear = step(0.0, dot(norm, norm2));\n      v_Type = 0.0;\n      float dy2 = -1000.0;\n      float dy3 = -1000.0;\n      if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n          type = JOINT_CAP_ROUND;\n      }\n      //TODO: BUTT here too\n      }\n\n      if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n          pos = dy * norm;\n      } else {\n          if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n          } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n          }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n          float extra = step(CAP_SQUARE, capType) * lineWidth;\n          vec2 back = -forward;\n          if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n          } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n          }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n          float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n          if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n          } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n              dy2 -= u_Expand + extra;\n          }\n          }\n      }\n      } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n          dy = -dy;\n          pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n          pos = dy * norm + d2;\n          v_Arc.x = abs(dy);\n      } else {\n          dy = -dy;\n          pos = dy * norm + d2;\n          v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n      } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n      } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n          if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n          }\n          if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n          } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n              if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n              } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n              }\n          }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          v_Arc.x = sign * dot(pos, norm3);\n          v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n          v_Arc.z = dot(norm, norm3) * lineWidth;\n          v_Arc.w = lineWidth;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = v_Arc.z - v_Arc.x;\n          v_Type = 3.0;\n      } else {\n          float hit = 0.0;\n          if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n              type = MITER;\n          }\n          }\n          if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n              dy = -dy;\n              inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n              type = BEVEL;\n          } else {\n              if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n              } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n              } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n              }\n              v_Type = 1.0;\n              dy = -sign * dot(pos, norm);\n              dy2 = -sign * dot(pos, norm2);\n              hit = 1.0;\n          }\n          }\n          if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n              dy = -dy;\n              inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n              pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n              pos = dy * norm2;\n          } else {\n              if (a_VertexNum < 6.5) {\n              pos = pos3;\n              } else {\n              pos = pos4;\n              }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n          }\n          if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n          }\n      }\n      }\n      pos += base;\n      v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n      v_Arc = v_Arc * u_DevicePixelRatio;\n      v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n\n  setPickingColor(u_PickingColor.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec4 u_StrokeColor;\n  float u_StrokeWidth;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_StrokeOpacity;\n  float u_Expand;\n  float u_MiterLimit;\n  float u_ScaleMode;\n  float u_Alignment;\n  vec3 u_PickingColor;\n  float u_Dash;\n  float u_Gap;\n  float u_DashOffset;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin vec4 v_PickingResult;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n\nvoid main(){\n  if (u_Visible < 1.0) {\n    discard;\n  }\n\n  gbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * 0.5 + u_DashOffset, u_Dash + u_Gap) - (u_Gap * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  gbuf_color = u_StrokeColor;\n  gbuf_color.a *= alpha * u_Opacity * u_StrokeOpacity;\n}",this.material.defines=S(S({},this.material.defines),er(br));var r=t[0],i=r.parsedStyle,o=i.fill,s=i.stroke,u=i.opacity,c=i.fillOpacity,l=i.strokeOpacity,f=i.lineWidth,h=i.anchor,d=i.lineDash,p=void 0===d?[]:d,v=i.lineDashOffset,y=void 0===v?0:v,g=i.visibility,m=[0,0,0,0];(null==o?void 0:o.type)===a.p.Constant&&(m=o.value);var _=[0,0,0,0];(null==s?void 0:s.type)===a.p.Constant&&(_=s.value);var E=(null===(e=r.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0],T=0,b=0,R=r.getGeometryBounds();if(R){var A=R.halfExtents;T=-A[0]*h[0]*2,b=-A[1]*h[1]*2}var O=_n();Rn(O,r.getWorldTransform(),bn(O,An(T,b,0))),this.material.setUniforms((P(n={},Rr.MODEL_MATRIX,O),P(n,Rr.COLOR,m),P(n,Rr.STROKE_COLOR,_),P(n,Rr.STROKE_WIDTH,f.value),P(n,Rr.OPACITY,u),P(n,Rr.FILL_OPACITY,c),P(n,Rr.STROKE_OPACITY,l),P(n,Rr.EXPAND,1),P(n,Rr.MITER_LIMIT,5),P(n,Rr.SCALE_MODE,1),P(n,Rr.ALIGNMENT,.5),P(n,Rr.PICKING_COLOR,E),P(n,Rr.DASH,p[0]||0),P(n,Rr.GAP,p[1]||0),P(n,Rr.DASH_OFFSET,y),P(n,Rr.VISIBLE,"visible"===g?1:0),P(n,Rr.Z_INDEX,.005*r.sortable.renderOrder),n)),this.material.cullMode=tt.None}},{key:"createGeometry",value:function(t){var e=Or(t[0]),n=e.pointsBuffer,r=e.travelBuffer,i=e.instancedCount;this.geometry.setVertexBuffer({bufferIndex:0,byteStride:48,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,byteStride:12,location:br.PREV,divisor:1},{format:Tt.F32_RG,bufferByteOffset:12,byteStride:12,location:br.POINT1,divisor:1},{format:Tt.F32_R,bufferByteOffset:20,byteStride:12,location:br.VERTEX_JOINT,divisor:1},{format:Tt.F32_RG,bufferByteOffset:24,byteStride:12,location:br.POINT2,divisor:1},{format:Tt.F32_RG,bufferByteOffset:36,byteStride:12,location:br.NEXT,divisor:1}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:1,byteStride:4,frequency:ct.PerInstance,attributes:[{format:Tt.F32_R,bufferByteOffset:0,byteStride:4,location:br.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:2,byteStride:4,frequency:ct.PerInstance,attributes:[{format:Tt.F32_R,bufferByteOffset:0,byteStride:4,location:br.TRAVEL,divisor:1}],data:new Float32Array(r)}),this.geometry.vertexCount=15,this.geometry.instancedCount=i,this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2,4,6,5,4,7,6,4,7,8]))}}]),n}(ir);function Sr(t,e,n,r,i,o,a){var s=a[a.length-2],u=a[a.length-1];a.length-=2;var c=function(t){var e=Math.ceil(t/10);e<8?e=8:e>2048&&(e=2048);return e}(Tr(s,u,t,e,n,r,i,o)),l=0,f=0,h=0,d=0,p=0;a.push(s,u);for(var v=1,y=0;v<=c;++v)h=(f=(l=1-(y=v/c))*l)*l,p=(d=y*y)*y,a.push(h*s+3*f*y*t+3*l*d*n+p*i,h*u+3*f*y*e+3*l*d*r+p*o)}Ar=Object(s.c)([Object(u.h)()],Ar);function Or(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.parsedStyle,r=n.lineCap,i=n.lineJoin,o=n.defX,s=n.defY,u=[],c=[];if(t.nodeName===a.u.POLYLINE||t.nodeName===a.u.POLYGON){if(u=t.parsedStyle.points.points.reduce((function(t,e){return t.push(e[0]-o,e[1]-s),t}),[]),t.nodeName===a.u.POLYGON){if(e)return c=g()(u,[],2),{pointsBuffer:u,travelBuffer:[],triangles:c,instancedCount:Math.round(u.length/2)};var l;u.push(u[0],u[1]),(l=u).push.apply(l,W(xr(u[0],u[1],u[2],u[3])))}}else if(t.nodeName===a.u.PATH||t.nodeName===a.u.CIRCLE||t.nodeName===a.u.ELLIPSE||t.nodeName===a.u.RECT){var f;t.nodeName!==a.u.PATH?(f=Object(a.y)(Object(a.v)(t)),o=f.rect.x,s=f.rect.y):f=t.parsedStyle.path;var h=f,d=h.zCommandIndexes,p=W(f.curve).map((function(t,e){return d.includes(e)?["Z"]:t})),v=-1;if(p.forEach((function(e){var n=V(e),r=n[0],i=n.slice(1);if("M"===r)v=u.length,u.push(i[0]-o,i[1]-s);else if("C"===r)Sr(i[0]-o,i[1]-s,i[2]-o,i[3]-s,i[4]-o,i[5]-s,u);else if("Z"===r&&(t.nodeName===a.u.PATH||t.nodeName===a.u.RECT)){var c;u.push(u[v],u[v+1]),(c=u).push.apply(c,W(xr(u[v],u[v+1],u[v+2],u[v+3])))}})),e)return c=g()(u,[],2),{pointsBuffer:u,travelBuffer:[],triangles:c,instancedCount:Math.round(u.length/2)}}var y=Mr(i),m=Cr(r),_=m;m===Er.CAP_ROUND&&(_=Er.JOINT_CAP_ROUND),m===Er.CAP_BUTT&&(_=Er.JOINT_CAP_BUTT),m===Er.CAP_SQUARE&&(_=Er.JOINT_CAP_SQUARE);for(var E=3*(Math.round(0)+2),T=0,b=[],R=[],A=0;A<u.length;A+=2)A>1&&(T+=Math.sqrt(Math.pow(u[A]-u[A-2],2)+Math.pow(u[A+1]-u[A+1-2],2))),R.push(T),b[E++]=u[A],b[E++]=u[A+1],b[E]=y,0==A&&m!==Er.CAP_ROUND&&(b[E]+=m),A+4>=u.length?b[E]+=_-y:A+2>=u.length&&(b[E]=0),E++;b[E++]=u[u.length-4],b[E++]=u[u.length-3],b[E++]=0,b[0]=u[0],b[1]=u[1],b[2]=0,b[3]=u[2],b[4]=u[3],b[5]=m===Er.CAP_ROUND?m:0;var S=Math.round(u.length/2);return{pointsBuffer:b,travelBuffer:R,triangles:c,instancedCount:S}}function Mr(t){var e;switch(t){case a.m.BEVEL:e=Er.JOINT_BEVEL;break;case a.m.ROUND:e=Er.JOINT_ROUND;break;default:e=Er.JOINT_MITER}return e}function Cr(t){var e;switch(t){case a.l.SQUARE:e=Er.CAP_SQUARE;break;case a.l.ROUND:e=Er.CAP_ROUND;break;default:e=Er.CAP_BUTT}return e}function xr(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=[n-t,r-e],o=.01;return[t+i[0]*o,e+i[1]*o]}var Nr;!function(t){t[t.POSITION=0]="POSITION"}(Nr||(Nr={}));var Pr=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){return!1}},{key:"createGeometry",value:function(t){var e=Or(t[0],!0),n=e.triangles,r=e.pointsBuffer;this.geometry.setVertexBuffer({bufferIndex:0,byteStride:8,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,byteStride:8,location:Nr.POSITION}],data:new Float32Array(r)}),this.geometry.vertexCount=n.length,this.geometry.setIndexBuffer(new Uint32Array(n))}},{key:"createMaterial",value:function(t){var e,n;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec3 u_PickingColor;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nlayout(location = POSITION) in vec2 a_Position;\n\nout vec4 v_PickingResult;\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvoid main() {\n  gl_Position = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * vec4(a_Position, u_ZIndex, 1.0);\n\n  setPickingColor(u_PickingColor.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  mat4 u_ModelMatrix;\n  vec4 u_Color;\n  vec3 u_PickingColor;\n  float u_Opacity;\n  float u_FillOpacity;\n  float u_Visible;\n  float u_ZIndex;\n};\n\nin vec4 v_PickingResult;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n\nvoid main(){\n  if (u_Visible < 1.0) {\n    discard;\n  }\n\n  gbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\n  gbuf_color = u_Color;\n  gbuf_color.a = gbuf_color.a * u_Opacity * u_FillOpacity;\n}",this.material.defines=S(S({},this.material.defines),er(Nr));var r=t[0],i=r.parsedStyle,o=i.fill,s=i.opacity,u=i.fillOpacity,c=i.anchor,l=i.visibility,f=[0,0,0,0];(null==o?void 0:o.type)===a.p.Constant&&(f=o.value);var h=(null===(e=r.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0],d=0,p=0,v=r.getGeometryBounds();if(v){var y=v.halfExtents;d=-y[0]*c[0]*2,p=-y[1]*c[1]*2}var g=_n();Rn(g,r.getWorldTransform(),bn(g,An(d,p,0))),this.material.setUniforms((P(n={},Rr.MODEL_MATRIX,g),P(n,Rr.COLOR,f),P(n,Rr.PICKING_COLOR,h),P(n,Rr.OPACITY,s),P(n,Rr.FILL_OPACITY,u),P(n,Rr.VISIBLE,"visible"===l?1:0),P(n,Rr.Z_INDEX,.005*r.sortable.renderOrder),n))}},{key:"updateAttribute",value:function(t,e,r){G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var i=t.parsedStyle,o=i.fill,s=i.opacity,u=i.fillOpacity,c=i.anchor,l=i.visibility;if("lineJoin"===e||"lineCap"===e||t.nodeName===a.u.RECT&&("width"===e||"height"===e||"radius"===e)||t.nodeName===a.u.LINE&&("x1"===e||"y1"===e||"x2"===e||"y2"===e)||t.nodeName===a.u.POLYLINE&&"points"===e||t.nodeName===a.u.POLYGON&&"points"===e||t.nodeName===a.u.PATH&&"path"===e)this.material.geometryDirty=!0,this.material.programDirty=!0;else if("fill"===e){var f=[0,0,0,0];(null==o?void 0:o.type)===a.p.Constant&&(f=o.value),this.material.setUniforms(P({},Rr.COLOR,f))}else if("opacity"===e)this.material.setUniforms(P({},Rr.OPACITY,s));else if("fillOpacity"===e)this.material.setUniforms(P({},Rr.FILL_OPACITY,u));else if("anchor"===e||"modelMatrix"===e){var h=0,d=0,p=t.getGeometryBounds();if(p){var v=p.halfExtents;h=-v[0]*c[0]*2,d=-v[1]*c[1]*2}var y=_n();Rn(y,t.getWorldTransform(),bn(y,An(h,d,0))),this.material.setUniforms(P({},Rr.MODEL_MATRIX,y))}else"visibility"===e&&this.material.setUniforms(P({},Rr.VISIBLE,"visible"===l?1:0))}},{key:"changeRenderOrder",value:function(t,e){this.material&&this.material.setUniforms(P({},Rr.Z_INDEX,.005*e))}}]),n}(ir);Pr=Object(s.c)([Object(u.h)()],Pr);var Ir;!function(t){t[t.SIZE=10]="SIZE",t[t.UV=11]="UV"}(Ir||(Ir={}));var Br=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){var r=G(B(n.prototype),"shouldMerge",this).call(this,t,e);return!!r&&this.instance.parsedStyle.img===t.parsedStyle.img}},{key:"createMaterial",value:function(t){var e=this,n=t[0].parsedStyle.img;this.material.defines=S(S({},this.material.defines),{},{USE_UV:!0,USE_MAP:!0},er(Ir)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = COLOR) in vec4 a_Color;\nlayout(location = STROKE_COLOR) in vec4 a_StrokeColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\nlayout(location = ANCHOR) in vec2 a_Anchor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = SIZE) in vec2 a_Size;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n\n  vec2 offset = (a_Uv - a_Anchor.xy) * a_Size;\n\n  gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_Uv.y = 1.0 - v_Uv.y;\n  #endif\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n  u_Color = texelColor;\n#endif\n\n  gbuf_color = u_Color;\n  gbuf_color.a = gbuf_color.a * u_Opacity;\n}";var r=this.texturePool.getOrCreateTexture(this.device,n,void 0,(function(){t.forEach((function(t){t.renderable.dirty=!0,e.renderingService.dirtify()}))}));this.material.setUniforms({u_Map:r})}},{key:"createGeometry",value:function(t){G(B(n.prototype),"createGeometry",this).call(this,t);var e=[],r=[],i=[];t.forEach((function(t,n){var o=4*n,a=t.parsedStyle,s=a.widthInPixels,u=a.heightInPixels;e.push(s,u),r.push(0,0,1,0,1,1,0,1),i.push(0+o,2+o,1+o,0+o,3+o,2+o)})),this.geometry.setIndexBuffer(new Uint32Array(i)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:1,byteStride:8,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,location:Ir.UV}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:2,byteStride:8,frequency:ct.PerInstance,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,location:Ir.SIZE}],data:new Float32Array(e)})}},{key:"updateAttribute",value:function(t,e,r){var i=this;G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var o=this.objects.indexOf(t);this.updateBatchedAttribute(t,o,e,r);var a=t.parsedStyle,s=a.widthInPixels,u=a.heightInPixels;if("width"===e||"height"===e)this.geometry.updateVertexBuffer(2,Ir.SIZE,o,new Uint8Array(new Float32Array([s,u]).buffer));else if("img"===e){var c=this.texturePool.getOrCreateTexture(this.device,r,void 0,(function(){t.renderable.dirty=!0,i.renderingService.dirtify()}));this.material.setUniforms({u_Map:c})}}}]),n}(ir);function Dr(t,e,n,r){var i=e.width,o=e.height;if(r){if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function wr(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var c=((n.y+u)*t.width+n.x)*o,l=((r.y+u)*e.width+r.x)*o,f=0;f<i.width*o;f++)s[l+f]=a[c+f];return e}Br=Object(s.c)([Object(u.h)()],Br);var Fr=function(){function t(e,n){C(this,t),this.width=void 0,this.height=void 0,this.data=void 0,Dr(this,e,1,n)}return N(t,[{key:"resize",value:function(t){!function(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=Dr({},{width:r,height:i},n);wr(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}(this,t,1)}},{key:"clone",value:function(){return new t({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(t,e,n,r,i){wr(t,e,n,r,i,1)}}]),t}();var Lr=N((function t(e){C(this,t),this.image=void 0,this.positions=void 0;var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(c),a[s]={rect:c,metrics:u.metrics}}}}var l=function(t){var e,n=0,r=0,i=K(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;n+=o.w*o.h,r=Math.max(r,o.w)}}catch(v){i.e(v)}finally{i.f()}t.sort((function(t,e){return e.h-t.h}));var a,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],u=0,c=0,l=K(t);try{for(l.s();!(a=l.n()).done;)for(var f=a.value,h=s.length-1;h>=0;h--){var d=s[h];if(!(f.w>d.w||f.h>d.h)){if(f.x=d.x,f.y=d.y,c=Math.max(c,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===d.w&&f.h===d.h){var p=s.pop();h<s.length&&(s[h]=p)}else f.h===d.h?(d.x+=f.w,d.w-=f.w):f.w===d.w?(d.y+=f.h,d.h-=f.h):(s.push({x:d.x+f.w,y:d.y,w:d.w-f.w,h:f.h}),d.y+=f.h,d.h-=f.h);break}}}catch(v){l.e(v)}finally{l.f()}return{w:u,h:c,fill:n/(u*c)||0}}(r),f=l.w,h=l.h,d=new Fr({width:f||1,height:h||1});for(var p in e){var v=e[p];for(var y in v){var g=v[+y];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var m=n[p][y].rect;Fr.copy(g.bitmap,d,{x:0,y:0},{x:m.x+1,y:m.y+1},g.bitmap)}}}this.image=d,this.positions=n}));function kr(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}var Ur=function(){function t(){C(this,t),this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphAtlas=void 0,this.glyphMap={},this.glyphAtlasTexture=void 0}return N(t,[{key:"getMap",value:function(){return this.glyphMap}},{key:"getAtlas",value:function(){return this.glyphAtlas}},{key:"getAtlasTexture",value:function(){return this.glyphAtlasTexture}},{key:"layout",value:function(t,e,n,r,i,o,a){var s=this,u=[],c=o,l=a,f="right"===r||"end"===r?1:"left"===r||"start"===r?0:.5;return t.forEach((function(t){var r=u.length;Array.from(t).forEach((function(t){var n=s.glyphMap[e],r=t.charCodeAt(0),o=n&&n[r];o&&(u.push({glyph:r,x:c,y:l,scale:1,fontStack:e}),c+=o.metrics.advance+i)}));for(var o=c-i,a=r;a<u.length;a++)u[a].x=u[a].x-f*o;c=0,l+=n})),u}},{key:"generateAtlas",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=[];this.glyphMap[e]||(s=kr());var u=Object.keys(this.glyphMap[e]||{});if(Array.from(new Set(o.split(""))).forEach((function(t){-1===u.indexOf(t.charCodeAt(0).toString())&&s.push(t)})),s.length){var c=s.map((function(o){return t.generateSDF(e,n,r.toString(),i,o)})).reduce((function(t,e){return t[e.id]=e,t}),{});this.glyphMap[e]=S(S({},this.glyphMap[e]),c),this.glyphAtlas=new Lr(this.glyphMap);var l=this.glyphAtlas.image,f=l.width,h=l.height,d=l.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=a.createTexture(S(S({},Ot(Tt.ALPHA,f,h,1)),{},{pixelStore:{unpackFlipY:!1,unpackAlignment:1},immutable:!1})),this.glyphAtlasTexture.setImageData([d],0)}}},{key:"generateSDF",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=i.charCodeAt(0),a=this.sdfGeneratorCache[t];a||(a=this.sdfGeneratorCache[t]=new T({fontSize:24,fontFamily:e,fontWeight:n,fontStyle:r,buffer:3,radius:8,cutoff:.25})),this.textMetricsCache[t]||(this.textMetricsCache[t]={}),this.textMetricsCache[t][i]||(this.textMetricsCache[t][i]=a.ctx.measureText(i).width);var s=a.draw(i),u=s.data,c=s.width,l=s.height,f=s.glyphWidth,h=s.glyphHeight,d=s.glyphLeft,p=s.glyphTop,v=s.glyphAdvance;return{id:o,bitmap:new Fr({width:c,height:l},u),metrics:{width:f,height:h,left:d,top:p-24+3,advance:v}}}}]),t}();Ur=Object(s.c)([Object(u.h)()],Ur);var Gr,jr;!function(t){t[t.TEX=10]="TEX",t[t.OFFSET=11]="OFFSET"}(Gr||(Gr={})),function(t){t.SDF_MAP="u_SDFMap",t.SDF_MAP_SIZE="u_SDFMapSize",t.FONT_SIZE="u_FontSize",t.GAMMA_SCALE="u_GammaScale",t.STROKE_BLUR="u_StrokeBlur",t.HAS_STROKE="u_HasStroke"}(jr||(jr={}));var Vr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).glyphManager=void 0,t}return N(n,[{key:"shouldMerge",value:function(t,e){var r=G(B(n.prototype),"shouldMerge",this).call(this,t,e);if(!r)return!1;if(this.index!==e)return!1;var i=this.instance;return i.parsedStyle.fontSize.value===t.parsedStyle.fontSize.value&&(i.parsedStyle.metrics.font===t.parsedStyle.metrics.font&&!["fontFamily","fontWeight","textBaseline","letterSpacing"].some((function(e){return i.parsedStyle[e]!==t.parsedStyle[e]})))}},{key:"createGeometry",value:function(t){var e=this,n=this.instance.parsedStyle,r=n.textBaseline,i=n.fontSize,o=n.letterSpacing,a=void 0===o?0:o,s=24/i.value,u=[],c=[],l=[],f=0;t.forEach((function(t){var n=t.parsedStyle,i=n.metrics,o=n.dx,h=n.dy,d=i.font,p=i.lines,v=i.height,y=i.lineHeight,g=0,m=0;o&&"px"===o.unit&&(g+=o.value),h&&"px"===h.unit&&(m+=h.value);var _=0;"middle"===r?_=-v/2:"bottom"===r?_=-v:"top"===r||"hanging"===r?_=0:"alphabetic"===r?_=.25*y-v:"ideographic"===r&&(_=-v);var E=e.glyphManager.getAtlas(),T=e.buildTextBuffers({object:t,lines:p,fontStack:d,lineHeight:s*y,offsetX:s*g,offsetY:s*(_+m),letterSpacing:s*a,glyphAtlas:E,indicesOffset:f}),b=T.indicesOffset,R=T.indexBuffer,A=T.charUVOffsetBuffer,S=T.charPackedBuffer;f=b,l.push.apply(l,W(S)),c.push.apply(c,W(A)),u.push.apply(u,W(R))})),this.geometry.vertexCount=u.length,this.geometry.setIndexBuffer(new Uint32Array(u)),this.geometry.setVertexBuffer({bufferIndex:0,byteStride:144,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RGBA,bufferByteOffset:0,location:Kn.MODEL_MATRIX0},{format:Tt.F32_RGBA,bufferByteOffset:16,location:Kn.MODEL_MATRIX1},{format:Tt.F32_RGBA,bufferByteOffset:32,location:Kn.MODEL_MATRIX2},{format:Tt.F32_RGBA,bufferByteOffset:48,location:Kn.MODEL_MATRIX3},{format:Tt.F32_RGBA,bufferByteOffset:64,location:Kn.COLOR},{format:Tt.F32_RGBA,bufferByteOffset:80,location:Kn.STROKE_COLOR},{format:Tt.F32_RGBA,bufferByteOffset:96,location:Kn.PACKED_STYLE1},{format:Tt.F32_RGBA,bufferByteOffset:112,location:Kn.PACKED_STYLE2},{format:Tt.F32_RGBA,bufferByteOffset:128,location:Kn.PICKING_COLOR}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:1,byteStride:16,frequency:ct.PerVertex,attributes:[{format:Tt.F32_RG,bufferByteOffset:0,location:Gr.TEX},{format:Tt.F32_RG,bufferByteOffset:8,location:Gr.OFFSET}],data:new Float32Array(c)})}},{key:"createMaterial",value:function(t){var e;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = COLOR) in vec4 a_Color;\nlayout(location = STROKE_COLOR) in vec4 a_StrokeColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\nlayout(location = ANCHOR) in vec2 a_Anchor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_UV;\nout float v_GammaScale;\n\nvoid main() {\n  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n#ifdef CLIPSPACE_NEAR_ZERO\n    gl_Position.z = gl_Position.z * 0.5 + 0.5;\n#endif\n\n  v_UV = a_Tex / u_SDFMapSize;\n\n  float fontScale = u_FontSize / 24.;\n\n  gl_Position = project(vec4(a_Offset * fontScale, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  v_GammaScale = gl_Position.w;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n};\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n\nlayout(location = 0) out vec4 gbuf_color;\nlayout(location = 1) out vec4 gbuf_picking;\n\nin vec2 v_UV;\nin float v_GammaScale;\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\n\ngbuf_picking = vec4(v_PickingResult.rgb, 1.0);\n\nif (u_Visible < 1.0) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_UV).a;\n\n  float EDGE_GAMMA = 0.105 / u_DevicePixelRatio;\n  float fontScale = u_FontSize / 24.0;\n  highp float gamma = EDGE_GAMMA / (fontScale * u_GammaScale);\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    gamma = (u_StrokeBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_GammaScale);\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = gamma * v_GammaScale;\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n  if (opacity < 0.001) {\n    discard;\n  }\n\n  gbuf_color = color;\n  gbuf_color.a *= opacity;\n}",this.material.cullMode=tt.Back,this.material.defines=S(S({},this.material.defines),er(Gr));var n=this.instance.parsedStyle,r=n.fontSize,i=n.fontFamily,o=void 0===i?"":i,a=n.fontWeight,s=void 0===a?"normal":a,u=n.fontStyle,c=n.metrics.font,l=t.map((function(t){return t.parsedStyle.text})).join("");this.glyphManager.generateAtlas(c,o,s,u,l,this.device);var f=this.glyphManager.getAtlasTexture(),h=this.glyphManager.getAtlas();this.device.setResourceName(f,"TextSDF Texture");var d=h.image,p=d.width,v=d.height;this.material.setUniforms((P(e={},jr.SDF_MAP,f),P(e,jr.SDF_MAP_SIZE,[p,v]),P(e,jr.FONT_SIZE,r.value),P(e,jr.GAMMA_SCALE,1),P(e,jr.STROKE_BLUR,.2),P(e,jr.HAS_STROKE,this.index),e))}},{key:"changeRenderOrder",value:function(t,e){this.material&&(this.material.programDirty=!0,this.material.geometryDirty=!0)}},{key:"updateAttribute",value:function(t,e,n){"text"===e||"fontFamily"===e||"fontSize"===e||"fontWeight"===e||"fontStyle"===e||"fontVariant"===e||"textBaseline"===e||"letterSpacing"===e||"wordWrapWidth"===e||"lineHeight"===e||"wordWrap"===e||"textAlign"===e||"modelMatrix"===e||"visibility"===e||"dx"===e||"dy"===e?(this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0):"fill"!==e&&"fillOpacity"!==e&&"stroke"!==e&&"strokeOpacity"!==e&&"opacity"!==e&&"lineWidth"!==e&&"visibility"!==e||(this.material.geometryDirty=!0)}},{key:"buildTextBuffers",value:function(t){var e,n=t.object,r=t.lines,i=t.fontStack,o=t.lineHeight,s=t.letterSpacing,u=t.offsetX,c=t.offsetY,l=t.glyphAtlas,f=t.indicesOffset,h=n.parsedStyle.textAlign,d=void 0===h?"start":h,p=n.parsedStyle,v=p.fill,y=p.stroke,g=p.opacity,m=p.fillOpacity,_=p.strokeOpacity,E=p.lineWidth,T=p.visibility,b=[0,0,0,0];(null==v?void 0:v.type)===a.p.Constant&&(b=v.value);var R=[0,0,0,0];(null==y?void 0:y.type)===a.p.Constant&&(R=y.value);var A=(null===(e=n.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0],S=En(_n(),n.getWorldTransform()),O=[],M=[],C=[],x=f;return function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=e[i.fontStack],a=o&&o[i.glyph];if(a){var s=a.rect;if(s){var u=a.metrics.advance*i.scale/2,c=[i.x+u,i.y],l=(a.metrics.left-4)*i.scale-u+c[0],f=(-a.metrics.top-4)*i.scale+c[1],h=l+s.w*i.scale,d=f+s.h*i.scale,p={x:l,y:f},v={x:h,y:f},y={x:l,y:d},g={x:h,y:d};n.push({tl:p,tr:v,bl:y,br:g,tex:s,glyphOffset:[0,0]})}}}return n}(this.glyphManager.layout(r,i,o,d,s,u,c),l.positions).forEach((function(t){var e=[].concat(W(S),W(b),W(R),[g,m,_,E.value,"visible"===T?1:0,0,0,0],W(A),[.005*n.sortable.renderOrder]);O.push.apply(O,W(e).concat(W(e),W(e),W(e))),M.push(t.tex.x,t.tex.y,t.tl.x,t.tl.y),M.push(t.tex.x+t.tex.w,t.tex.y,t.tr.x,t.tr.y),M.push(t.tex.x+t.tex.w,t.tex.y+t.tex.h,t.br.x,t.br.y),M.push(t.tex.x,t.tex.y+t.tex.h,t.bl.x,t.bl.y),C.push(0+x,2+x,1+x),C.push(2+x,0+x,3+x),x+=4})),{indexBuffer:C,charUVOffsetBuffer:M,charPackedBuffer:O,indicesOffset:x}}}]),n}(ir);Object(s.c)([Object(u.g)(Ur),Object(s.f)("design:type",Ur)],Vr.prototype,"glyphManager",void 0),Vr=Object(s.c)([Object(u.h)()],Vr);var Wr=["style"],Xr=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.style,o=w(t,Wr);return C(this,n),(r=e.call(this,S({type:n.tag,style:S({},i)},o))).style.geometry.meshes.push(F(r)),r.style.material.meshes.push(F(r)),r}return N(n,[{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this);var t=this.style.geometry.meshes,e=t.indexOf(this);t.splice(e,1),e=(t=this.style.material.meshes).indexOf(this),t.splice(e,1)}}]),n}(a.i);Xr.tag="mesh";var Hr=function(t){I(n,t);var e=k(n);function n(){return C(this,n),e.apply(this,arguments)}return N(n,[{key:"shouldMerge",value:function(t,e){var r=G(B(n.prototype),"shouldMerge",this).call(this,t,e);return!!r&&(this.instance.nodeName!==Xr.tag||this.instance.parsedStyle.material===t.parsedStyle.material&&this.instance.parsedStyle.geometry===t.parsedStyle.geometry)}},{key:"updateAttribute",value:function(t,e,r){G(B(n.prototype),"updateAttribute",this).call(this,t,e,r);var i=this.objects.indexOf(t);this.updateBatchedAttribute(t,i,e,r)}},{key:"createMaterial",value:function(t){var e=this.instance.parsedStyle.material;this.material=e}},{key:"createGeometry",value:function(t){var e=this.instance.parsedStyle.geometry;this.geometry=e,G(B(n.prototype),"createGeometry",this).call(this,t),this.geometry.build(t)}}]),n}(ir);Hr=Object(s.c)([Object(u.h)()],Hr);var Yr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[ur,Ar],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){return 1!==e||this.needDrawStrokeSeparately(t)}},{key:"needDrawStrokeSeparately",value:function(t){var e=t.parsedStyle,n=e.stroke,r=e.lineDash,i=e.lineWidth,o=e.strokeOpacity;return n&&i.value>0&&(o<1||r&&r.length&&r.every((function(t){return 0!==t})))}}]),n}(Qn);Yr=Object(s.c)([Object(u.h)({token:[{token:Un,named:a.u.CIRCLE},{token:Un,named:a.u.ELLIPSE}]})],Yr);var zr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[Pr,Ar],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){var n=t.parsedStyle,r=n.strokeOpacity,i=n.lineDash,o=n.lineWidth,s=t.nodeName;if(0===e&&t.nodeName===a.u.POLYLINE)return!1;if(1===e){if(0===r||0===o.value)return!1;var u=i&&i.length&&i.every((function(t){return 0!==t}));if(s===a.u.CIRCLE||s===a.u.ELLIPSE)return u}return!0}}]),n}(Qn);zr=Object(s.c)([Object(u.h)({token:[{token:Un,named:a.u.POLYLINE},{token:Un,named:a.u.PATH},{token:Un,named:a.u.POLYGON},{token:Un,named:a.u.RECT}]})],zr);var qr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){return!0}}]),n}(Qn);qr=Object(s.c)([Object(u.h)({token:[{token:Un,named:a.u.GROUP}]})],qr);var Kr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[Br],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){return!0}}]),n}(Qn);Kr=Object(s.c)([Object(u.h)({token:[{token:Un,named:a.u.IMAGE}]})],Kr);var Zr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[Vr,Vr],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){var n=t.parsedStyle,r=n.stroke,i=n.lineWidth;return!(!(r&&i&&i.value)&&0===e)}},{key:"beforeUploadUBO",value:function(t,e,n){e.material.setUniforms(P({},jr.HAS_STROKE,1-e.index))}}]),n}(Qn);Zr=Object(s.c)([Object(u.h)({token:[{token:Un,named:a.u.TEXT}]})],Zr);var Qr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[pr],t}return N(n,[{key:"shouldSubmitRenderInst",value:function(t,e){return!0}}]),n}(Qn);Qr=Object(s.c)([Object(u.h)({token:{token:Un,named:a.u.LINE}})],Qr);var Jr=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).meshes=[Hr],t}return N(n)}(Qn);Jr=Object(s.c)([Object(u.h)({token:[{token:Un,named:Xr.tag}]})],Jr);var $r="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",ti="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nlayout(location = 0) out vec4 gbuf_color;\n\nvoid main() {\n  gbuf_color = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}",ei=function(t){I(n,t);var e=k(n);function n(){var t;C(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).vert=$r,t.frag=ti,t.features={MRT:!0},t}return N(n)}(Hn),ni=function(){function t(e){var n=e.id,r=e.device;C(this,t),this.id=void 0,this.name=void 0,this.device=void 0,this.id=n,this.device=r,null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceCreated(this)}return N(t,[{key:"destroy",value:function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)}}]),t}(),ri=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Bindings,r.uniformBufferBindings=void 0,r.samplerBindings=void 0;var s=a.bindingLayout,u=a.uniformBufferBindings,c=a.samplerBindings;wt(u.length>=s.numUniformBuffers),wt(c.length>=s.numSamplers);for(var l=0;l<s.numUniformBuffers;l++)wt(u[l].wordCount>0);return r.uniformBufferBindings=a.uniformBufferBindings,r.samplerBindings=a.samplerBindings,r}return N(n)}(ni);function ii(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function oi(t){switch(xt(t)){case mt.BC1:case mt.BC2:case mt.BC3:case mt.BC4_UNORM:case mt.BC4_SNORM:case mt.BC5_UNORM:case mt.BC5_SNORM:return!0;default:return!1}}function ai(t){if(Nt(t)&Et.Normalized)return!1;var e=xt(t);return e===mt.S8||e===mt.S16||e===mt.S32||(e===mt.U8||e===mt.U16||e===mt.U32)}function si(t){return t&st.INDEX?At.ELEMENT_ARRAY_BUFFER:t&st.VERTEX?At.ARRAY_BUFFER:t&st.UNIFORM?At.UNIFORM_BUFFER:void 0}function ui(t){var e=xt(t),n=Ct(t),r=Nt(t),i=function(t){switch(t){case mt.U8:return At.UNSIGNED_BYTE;case mt.U16:return At.UNSIGNED_SHORT;case mt.U32:return At.UNSIGNED_INT;case mt.S8:return At.BYTE;case mt.S16:return At.SHORT;case mt.S32:return At.INT;case mt.F16:return At.HALF_FLOAT;case mt.F32:return At.FLOAT;default:throw"whoops"}}(e);return{size:function(t){switch(t){case _t.R:return 1;case _t.RG:return 2;case _t.RGB:return 3;case _t.RGBA:return 4}}(n),type:i,normalized:!!(r&Et.Normalized)}}function ci(t){switch(t){case rt.Clamp:return At.CLAMP_TO_EDGE;case rt.Repeat:return At.REPEAT;case rt.Mirror:return At.MIRRORED_REPEAT;default:throw"whoops"}}function li(t,e){if(e===ot.Linear&&t===it.Bilinear)return At.LINEAR_MIPMAP_LINEAR;if(e===ot.Linear&&t===it.Point)return At.NEAREST_MIPMAP_LINEAR;if(e===ot.Nearest&&t===it.Bilinear)return At.LINEAR_MIPMAP_NEAREST;if(e===ot.Nearest&&t===it.Point)return At.NEAREST_MIPMAP_NEAREST;if(e===ot.NoMip&&t===it.Bilinear)return At.LINEAR;if(e===ot.NoMip&&t===it.Point)return At.NEAREST;throw new Error("Unknown texture filter mode")}function fi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t;return n.gl_buffer_pages[e/n.pageByteSize|0]}function hi(t){return t.gl_texture}function di(t){return t.gl_sampler}function pi(t,e){t.name=e,t.__SPECTOR_Metadata={name:e}}function vi(t,e){for(var n=[];;){var r=e.exec(t);if(!r)break;n.push(r)}return n}function yi(t){return t.blendMode==nt.Add&&t.blendSrcFactor==et.One&&t.blendDstFactor===et.Zero}function gi(t){if(t===lt.n2D)return At.TEXTURE_2D;if(t===lt.n2DArray)return At.TEXTURE_2D_ARRAY;if(t===lt.Cube)return At.TEXTURE_CUBE_MAP;if(t===lt.n3D)return At.TEXTURE_3D;throw"whoops"}var mi,_i=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Buffer,r.gl_buffer_pages=void 0,r.gl_target=void 0,r.usage=void 0,r.byteSize=void 0,r.pageByteSize=void 0;var s=a.viewOrSize,u=a.usage,c=a.hint,l=o.uniformBufferMaxPageByteSize,f=o.gl,h=u&st.UNIFORM;h||(ii(f)?f.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null));var d,v=Object(p.i)(s)?4*s:4*s.byteLength;if(r.gl_buffer_pages=[],h){wt(v%l==0);for(var y=v;y>0;)r.gl_buffer_pages.push(r.createBufferPage(Math.min(y,l),u,c)),y-=l;d=l}else r.gl_buffer_pages.push(r.createBufferPage(v,u,c)),d=v;return r.pageByteSize=d,r.byteSize=v,r.usage=u,r.gl_target=si(u),h||(ii(f)?f.bindVertexArray(r.device.currentBoundVAO):o.OES_vertex_array_object.bindVertexArrayOES(r.device.currentBoundVAO)),r}return N(n,[{key:"setSubData",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.byteLength-n,i=this.device.gl,o=this.gl_target,a=this.byteSize,s=this.pageByteSize;if(ii(i)&&o===i.UNIFORM_BUFFER){if(t%s!=0)throw new Error("Assert fail: (dstByteOffset [".concat(t,"] % dstPageByteSize [").concat(s,"]) === 0"));if(r%s!=0)throw new Error("Assert fail: (byteSize [".concat(r,"] % dstPageByteSize [").concat(s,"]) === 0"))}if(!(t+r<=a))throw new Error("Assert fail: (dstByteOffset [".concat(t,"] + byteSize [").concat(r,"]) <= dstByteSize [").concat(a,"], gl_target ").concat(o));for(var u=t+r,c=t,l=t%s;c<u;){var f=ii(i)?i.COPY_WRITE_BUFFER:this.gl_target;i.bindBuffer(f,fi(this,c)),ii(i)?i.bufferSubData(f,l,e,n,Math.min(u-c,s)):i.bufferSubData(f,l,e),c+=s,l=0,n+=s,this.device.debugGroupStatisticsBufferUpload()}}},{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t])}},{key:"createBufferPage",value:function(t,e,n){var r=this.device.gl,i=e&st.UNIFORM;if(!ii(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=si(e),s=function(t){switch(t){case ut.Static:return At.STATIC_DRAW;case ut.Dynamic:return At.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,t,s),o}}]),n}(ni),Ei=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.InputLayout,r.vertexAttributeDescriptors=void 0,r.vertexBufferDescriptors=void 0,r.indexBufferFormat=void 0;var s=a.vertexAttributeDescriptors,u=a.vertexBufferDescriptors,c=a.indexBufferFormat;return wt(c===Tt.U16_R||c===Tt.U32_R||null===c),r.vertexAttributeDescriptors=s,r.vertexBufferDescriptors=u,r.indexBufferFormat=c,r}return N(n)}(ni),Ti=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.inputLayout,s=t.vertexBuffers,u=t.indexBufferBinding,c=t.program;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.InputState,r.vao=void 0,r.indexBufferByteOffset=void 0,r.indexBufferType=void 0,r.indexBufferCompByteSize=void 0,r.inputLayout=void 0,r.vertexBuffers=void 0;var l=r.device.gl,f=r.device.ensureResourceExists(ii(l)?l.createVertexArray():o.OES_vertex_array_object.createVertexArrayOES());ii(l)?l.bindVertexArray(f):o.OES_vertex_array_object.bindVertexArrayOES(f),o.currentBoundVAO=f;for(var h=0;h<a.vertexAttributeDescriptors.length;h++){var d,v=a.vertexAttributeDescriptors[h],y=v.format,g=v.divisor,m=void 0===g?1:g,_=v.byteStride,E=v.bufferByteOffset,T=v.bufferIndex,b=ii(l)?v.location:null===(d=c.attributes[v.location])||void 0===d?void 0:d.location;if(!Object(p.h)(b)){ai(y);var R=ui(y),A=R.size,S=R.type,O=R.normalized,M=s[T];if(null===M)continue;var x=Ft(a.vertexBufferDescriptors[T]);wt(!!(M.buffer.usage&st.VERTEX)),l.bindBuffer(l.ARRAY_BUFFER,fi(M.buffer));var N=M.byteOffset+E;l.vertexAttribPointer(b,A,S,O,_||x.byteStride,N),x.frequency===ct.PerInstance&&(ii(l)?l.vertexAttribDivisor(b,m):o.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(b,m)),l.enableVertexAttribArray(b)}}var P=null,I=null,B=null;null!==u&&(wt(!!(u.buffer.usage&st.INDEX)),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,fi(u.buffer)),P=function(t){switch(t){case Tt.U8_R:return At.UNSIGNED_BYTE;case Tt.U16_R:return At.UNSIGNED_SHORT;case Tt.U32_R:return At.UNSIGNED_INT;default:throw"whoops"}}(Ft(a.indexBufferFormat)),I=It(a.indexBufferFormat),B=u.byteOffset);return ii(l)?l.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null),o.currentBoundVAO=null,r.vao=f,r.indexBufferByteOffset=B,r.indexBufferType=P,r.indexBufferCompByteSize=I,r.inputLayout=a,r.vertexBuffers=s,r}return N(n,[{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),this.device.currentBoundVAO===this.vao&&(ii(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)}}]),n}(ni),bi=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor,s=t.fake;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Texture,r.gl_texture=void 0,r.gl_target=void 0,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.depth=void 0,r.numLevels=void 0,r.immutable=void 0,r.pixelStore=void 0,r.mipmaps=void 0,r.formatKind=void 0,r.textureIndex=void 0;var u,c,l=r.device.gl,f=r.clampNumLevels(a);if(r.immutable=!!a.immutable,r.pixelStore=a.pixelStore,r.pixelFormat=a.pixelFormat,r.formatKind=Dt(a.pixelFormat),r.width=a.width,r.height=a.height,r.depth=a.depth,r.mipmaps=f>=1,!s){c=r.device.ensureResourceExists(l.createTexture());var h=r.device.translateTextureType(a.pixelFormat),d=r.device.translateTextureInternalFormat(a.pixelFormat);if(r.device.setActiveTexture(l.TEXTURE0),r.device.currentTextures[0]=null,r.preprocessImage(),a.dimension===lt.n2D){if(u=At.TEXTURE_2D,l.bindTexture(u,c),r.immutable)if(ii(l))l.texStorage2D(u,f,d,a.width,a.height);else{var p=(d===At.DEPTH_COMPONENT||r.isNPOT(),0);l.texImage2D(u,p,d,a.width,a.height,0,d,h,null),r.mipmaps&&r.isNPOT()&&(r.mipmaps=!1,l.texParameteri(At.TEXTURE_2D,At.TEXTURE_MIN_FILTER,At.LINEAR),l.texParameteri(At.TEXTURE_2D,At.TEXTURE_WRAP_S,At.CLAMP_TO_EDGE),l.texParameteri(At.TEXTURE_2D,At.TEXTURE_WRAP_T,At.CLAMP_TO_EDGE))}wt(1===a.depth)}else if(a.dimension===lt.n2DArray)u=At.TEXTURE_2D_ARRAY,l.bindTexture(u,c),ii(l)&&l.texStorage3D(u,f,d,a.width,a.height,a.depth);else if(a.dimension===lt.n3D)u=At.TEXTURE_3D,l.bindTexture(u,c),ii(l)&&l.texStorage3D(u,f,d,a.width,a.height,a.depth);else{if(a.dimension!==lt.Cube)throw"whoops";u=At.TEXTURE_CUBE_MAP,l.bindTexture(u,c),ii(l)&&l.texStorage2D(u,f,d,a.width,a.height),wt(6===a.depth)}}return r.gl_texture=c,r.gl_target=u,r.numLevels=f,r}return N(n,[{key:"setImageData",value:function(t,e){var n,r,i=this.device.gl,o=(oi(this.pixelFormat),this.gl_target===At.TEXTURE_3D||(this.gl_target,At.TEXTURE_2D_ARRAY),this.gl_target,At.TEXTURE_CUBE_MAP,Array.isArray(t));this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null,o?(n=this.width,r=this.height):(n=t.width,r=t.height,this.width=n,this.height=r),i.bindTexture(this.gl_target,this.gl_texture);var a=this.device.translateTextureFormat(this.pixelFormat),s=this.device.translateTextureType(this.pixelFormat);this.preprocessImage(),this.immutable?i.texSubImage2D(this.gl_target,0,0,0,n,r,a,s,o?t[0]:t):ii(i)?i.texImage2D(this.gl_target,0,a,n,r,0,a,s,o?t[0]:t):o?i.texImage2D(this.gl_target,0,a,n,r,0,a,s,t[0]):i.texImage2D(this.gl_target,0,a,a,s,t),this.mipmaps&&this.generateMipmap()}},{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),this.device.gl.deleteTexture(hi(this))}},{key:"clampNumLevels",value:function(t){if(t.dimension===lt.n2DArray&&t.depth>1&&xt(t.pixelFormat)===mt.BC1)for(var e=t.width,n=t.height,r=0;r<t.numLevels;r++){if(e<=2||n<=2)return r-1;e=Math.max(e/2|0,1),n=Math.max(n/2|0,1)}return t.numLevels}},{key:"preprocessImage",value:function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(At.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(At.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(At.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))}},{key:"generateMipmap",value:function(){var t=this.device.gl;return!ii(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),t.generateMipmap(this.gl_target),t.texParameteri(At.TEXTURE_2D,At.TEXTURE_MIN_FILTER,At.NEAREST_MIPMAP_LINEAR),t.bindTexture(this.gl_target,null)),this}},{key:"isNPOT",value:function(){return!ii(this.device.gl)&&(!Ht(this.width)||!Ht(this.height))}}]),n}(ni);!function(t){t[t.NeedsCompile=0]="NeedsCompile",t[t.Compiling=1]="Compiling",t[t.NeedsBind=2]="NeedsBind",t[t.ReadyToUse=3]="ReadyToUse"}(mi||(mi={}));var Ri=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Program,r.gl_program=void 0,r.gl_shader_vert=void 0,r.gl_shader_frag=void 0,r.compileState=void 0,r.descriptor=void 0,r.uniformSetters={},r.attributes=[];var s=r.device.gl;return r.descriptor=a,r.gl_program=r.device.ensureResourceExists(s.createProgram()),r.gl_shader_vert=null,r.gl_shader_frag=null,r.compileState=mi.NeedsCompile,r.tryCompileProgram(),r}return N(n,[{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)}},{key:"tryCompileProgram",value:function(){wt(this.compileState===mi.NeedsCompile);var t=this.descriptor,e=this.device.gl;null!==this.gl_shader_vert&&e.deleteShader(this.gl_shader_vert),null!==this.gl_shader_frag&&e.deleteShader(this.gl_shader_frag),this.gl_shader_vert=this.compileShader(t.preprocessedVert,e.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(t.preprocessedFrag,e.FRAGMENT_SHADER),e.attachShader(this.gl_program,this.gl_shader_vert),e.attachShader(this.gl_program,this.gl_shader_frag),e.linkProgram(this.gl_program),this.compileState=mi.Compiling,ii(e)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram())}},{key:"readAttributesFromLinkedProgram",value:function(){for(var t=this,e=this.device.gl,n=e.getProgramParameter(this.gl_program,e.ACTIVE_ATTRIBUTES),r=function(t){var e={};return t.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(t,n,r){var i=Number(r);return e[n]=isNaN(i)?r:i,""})),e}(this.descriptor.preprocessedVert),i=function(t,e){var n=[];return t.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(t,r,i){var o=Number(r);return n.push({location:isNaN(o)?e[r]:o,name:i}),""})),n}(this.descriptor.vert,r),o=function(n){var r,o=e.getActiveAttrib(t.gl_program,n),a=o.name,s=o.type,u=o.size,c=e.getAttribLocation(t.gl_program,a),l=null===(r=i.find((function(t){return t.name===a})))||void 0===r?void 0:r.location;c>=0&&!Object(p.h)(l)&&(t.attributes[l]={name:a,location:c,type:s,size:u})},a=0;a<n;a++)o(a)}},{key:"readUniformLocationsFromLinkedProgram",value:function(){for(var t=this.device.gl,e=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),n=0;n<e;n++){var r=t.getActiveUniform(this.gl_program,n),i=Pe(r.name).name,o=t.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=Ie(t,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=t.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=Ie(t,o,r)}}},{key:"compileShader",value:function(t,e){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(e));return n.shaderSource(r,t),n.compileShader(r),r}},{key:"setUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.device.gl;if(!ii(e)){var n=!1;for(var r in t){n||(e.useProgram(this.gl_program),n=!0);var i=t[r],o=this.uniformSetters[r];if(o){var a=i;a instanceof bi&&(a=a.textureIndex),o(a)}}}return this}}]),n}(ni);function Ai(t){if(t===Tt.U8_RGBA_RT)return"bgra8unorm";if(t===Tt.U8_RGBA_NORM)return"rgba8unorm";if(t===Tt.U8_RG_NORM)return"rg8unorm";if(t===Tt.U32_R)return"r32uint";if(t===Tt.D24)return"depth24plus";if(t===Tt.D24_S8)return"depth24plus-stencil8";if(t===Tt.D32F)return"depth32float";if(t===Tt.D32F_S8)return"depth32float-stencil8";if(t===Tt.BC1)return"bc1-rgba-unorm";if(t===Tt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(t===Tt.BC2)return"bc2-rgba-unorm";if(t===Tt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(t===Tt.BC3)return"bc3-rgba-unorm";if(t===Tt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(t===Tt.BC4_SNORM)return"bc4-r-snorm";if(t===Tt.BC4_UNORM)return"bc4-r-unorm";if(t===Tt.BC5_SNORM)return"bc5-rg-snorm";if(t===Tt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Si(t){if(t===rt.Clamp)return"clamp-to-edge";if(t===rt.Repeat)return"repeat";if(t===rt.Mirror)return"mirror-repeat";throw"whoops"}function Oi(t){if(t===it.Bilinear)return"linear";if(t===it.Point)return"nearest";throw"whoops"}function Mi(t){if(t===ot.Linear)return"linear";if(t===ot.Nearest)return"nearest";if(t===ot.NoMip)return"nearest";throw"whoops"}function Ci(t){if(t===pt.Float)return"float";if(t===pt.Depth)return"depth";throw"whoops"}function xi(t){if(t===lt.n2D)return"2d";if(t===lt.n2DArray)return"2d-array";if(t===lt.n3D)return"3d";if(t===lt.Cube)return"cube";throw"whoops"}function Ni(t){return t.gpuBuffer}function Pi(t){return t.querySet}function Ii(t){if(t===gt.OcclusionConservative)return"occlusion";throw"whoops"}function Bi(t){switch(t){case at.Triangles:return"triangle-list";case at.Points:return"point-list";case at.TriangleStrip:return"triangle-strip";case at.Lines:return"line-list";case at.LineStrip:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Di(t){if(t===tt.None)return"none";if(t===tt.Front)return"front";if(t===tt.Back)return"back";throw"whoops"}function wi(t){if(t===$.CCW)return"ccw";if(t===$.CW)return"cw";throw"whoops"}function Fi(t){if(t===et.Zero)return"zero";if(t===et.One)return"one";if(t===et.Src)return"src";if(t===et.OneMinusSrc)return"one-minus-src";if(t===et.Dst)return"dst";if(t===et.OneMinusDst)return"one-minus-dst";if(t===et.SrcAlpha)return"src-alpha";if(t===et.OneMinusSrcAlpha)return"one-minus-src-alpha";if(t===et.DstAlpha)return"dst-alpha";if(t===et.OneMinusDstAlpha)return"one-minus-dst-alpha";throw"whoops"}function Li(t){if(t===nt.Add)return"add";if(t===nt.Subtract)return"subtract";if(t===nt.ReverseSubtract)return"reverse-subtract";throw"whoops"}function ki(t){return{operation:Li(t.blendMode),srcFactor:Fi(t.blendSrcFactor),dstFactor:Fi(t.blendDstFactor)}}function Ui(t,e){return e.attachmentsState.map((function(e,n){return function(t,e){return{format:Ai(e),blend:{color:ki(t.rgbBlendState),alpha:ki(t.alphaBlendState)},writeMask:t.channelWriteMask}}(e,t[n])}))}function Gi(t){if(t===J.Never)return"never";if(t===J.Less)return"less";if(t===J.Equal)return"equal";if(t===J.LessEqual)return"less-equal";if(t===J.Greater)return"greater";if(t===J.NotEqual)return"not-equal";if(t===J.GreaterEqual)return"greater-equal";if(t===J.Always)return"always";throw"whoops"}function ji(t){if(t===ct.PerVertex)return"vertex";if(t===ct.PerInstance)return"instance";throw"whoops"}function Vi(t){if(t===Tt.U8_R)return"uint8x2";if(t===Tt.U8_RG)return"uint8x2";if(t===Tt.U8_RGB)return"uint8x4";if(t===Tt.U8_RGBA)return"uint8x4";if(t===Tt.U8_RGBA_NORM)return"unorm8x4";if(t===Tt.S8_RGB_NORM)return"snorm8x4";if(t===Tt.S8_RGBA_NORM)return"snorm8x4";if(t===Tt.S16_RG)return"uint16x2";if(t===Tt.F32_R)return"float32";if(t===Tt.F32_RG)return"float32x2";if(t===Tt.F32_RGB)return"float32x3";if(t===Tt.F32_RGBA)return"float32x4";throw"whoops"}function Wi(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;switch(t){case Tt.S8_R:case Tt.S8_R_NORM:case Tt.S8_RG_NORM:case Tt.S8_RGB_NORM:case Tt.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(e));return r&&i.set(new Int8Array(r)),i;case Tt.U8_R:case Tt.U8_R_NORM:case Tt.U8_RG:case Tt.U8_RG_NORM:case Tt.U8_RGB:case Tt.U8_RGB_NORM:case Tt.U8_RGB_SRGB:case Tt.U8_RGBA:case Tt.U8_RGBA_NORM:case Tt.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(e));return r&&o.set(new Uint8Array(r)),o;case Tt.S16_R:case Tt.S16_RG:case Tt.S16_RG_NORM:case Tt.S16_RGB_NORM:case Tt.S16_RGBA:case Tt.S16_RGBA_NORM:var a=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(n?e/2:e);return r&&a.set(new Int16Array(r)),a;case Tt.U16_R:case Tt.U16_RGB:case Tt.U16_RGBA_5551:case Tt.U16_RGBA_NORM:case Tt.U16_RG_NORM:case Tt.U16_R_NORM:var s=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(n?e/2:e);return r&&s.set(new Uint16Array(r)),s;case Tt.S32_R:var u=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(n?e/4:e);return r&&u.set(new Int32Array(r)),u;case Tt.U32_R:case Tt.U32_RG:var c=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(n?e/4:e);return r&&c.set(new Uint32Array(r)),c;case Tt.F32_R:case Tt.F32_RG:case Tt.F32_RGB:case Tt.F32_RGBA:var l=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(n?e/4:e);return r&&l.set(new Float32Array(r)),l}var f=(ArrayBuffer,new Uint8Array(e));return r&&f.set(new Uint8Array(r)),f}var Xi=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.QueryPool,r.gl_query_type=void 0,r.gl_query=void 0;var s=r.device.gl;if(ii(s)){var u=a.elemCount,c=a.type;r.gl_query=Qt(u,(function(){return r.device.ensureResourceExists(s.createQuery())})),r.gl_query_type=function(t){switch(t){case gt.OcclusionConservative:return At.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw"whoops"}}(c)}return r}return N(n,[{key:"queryResultOcclusion",value:function(t){var e=this.device.gl;if(ii(e)){var n=this.gl_query[t];return e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)?!!e.getQueryParameter(n,e.QUERY_RESULT):null}return null}},{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),Pi(this).destroy()}}]),n}(ni),Hi=function(t){I(o,t);var e,n,r,i=k(o);function o(t){var e,n=t.id,r=t.device;return C(this,o),(e=i.call(this,{id:n,device:r})).type=Q.Readback,e.gl_pbo=null,e.gl_sync=null,e}return N(o,[{key:"clientWaitAsync",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=this.device.gl;return new Promise((function(i,o){!function a(){var s=r.clientWaitSync(t,e,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(a,Object(p.a)(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))}},{key:"getBufferSubDataAsync",value:(r=M(d.a.mark((function t(e,n,r,i){var o,a,s,u=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=u.length>4&&void 0!==u[4]?u[4]:0,a=u.length>5&&void 0!==u[5]?u[5]:i.byteLength||0,!ii(s=this.device.gl)){t.next=12;break}return this.gl_sync=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0),s.flush(),t.next=8,this.clientWaitAsync(this.gl_sync,0,10);case 8:return s.bindBuffer(e,n),s.getBufferSubData(e,r,i,o,a),s.bindBuffer(e,null),t.abrupt("return",i);case 12:case"end":return t.stop()}}),t,this)}))),function(t,e,n,i){return r.apply(this,arguments)})},{key:"readTexture",value:(n=M(d.a.mark((function t(e,n,r,i,o,a){var s,u,c,l,f,h,p,v=arguments;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=v.length>6&&void 0!==v[6]?v[6]:0,u=v.length>7&&void 0!==v[7]?v[7]:a.byteLength||0,c=this.device.gl,l=e,f=this.device.translateTextureFormat(l.pixelFormat),h=this.device.translateTextureType(l.pixelFormat),p=Bt(l.pixelFormat),!ii(c)){t.next=20;break}return this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,u,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(At.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(At.READ_FRAMEBUFFER,At.COLOR_ATTACHMENT0,At.TEXTURE_2D,l.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(n,r,i,o,f,h,s*p),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),t.abrupt("return",this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,a,s,u));case 20:return c.bindFramebuffer(At.FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(At.FRAMEBUFFER,At.COLOR_ATTACHMENT0,At.TEXTURE_2D,l.gl_texture,0),c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(n,r,i,o,c.RGBA,h,a),t.abrupt("return",Promise.resolve(a));case 25:case"end":return t.stop()}}),t,this)}))),function(t,e,r,i,o,a){return n.apply(this,arguments)})},{key:"readBuffer",value:(e=M(d.a.mark((function t(e,n,r,i,o){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ii(a=this.device.gl)){t.next=3;break}return t.abrupt("return",this.getBufferSubDataAsync(a.ARRAY_BUFFER,fi(e,n),n,r,i,o));case 3:return t.abrupt("return",Promise.reject());case 4:case"end":return t.stop()}}),t,this)}))),function(t,n,r,i,o){return e.apply(this,arguments)})},{key:"destroy",value:function(){G(B(o.prototype),"destroy",this).call(this),ii(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))}}]),o}(ni),Yi=function(){function t(e){var n=e.id,r=e.device;C(this,t),this.type=void 0,this.id=void 0,this.name=void 0,this.device=void 0,this.id=n,this.device=r}return N(t,[{key:"destroy",value:function(){}}]),t}(),zi={formatKind:pt.Float,dimension:lt.n2D},qi=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Bindings,r.bindingLayout=void 0,r.gpuBindGroup=void 0;var s=a.pipeline,u=a.bindingLayout;wt(!!s);r._createBindGroupLayout(u);for(var c=[[],[]],l=0,f=0;f<u.storageEntries.length;f++){var h=a.storageBufferBindings[f];wt(h.wordCount>0);var d={buffer:Ni(h.buffer),offset:0,size:h.wordCount<<2};c[0].push({binding:l++,resource:d})}for(var p=0;p<u.numUniformBuffers;p++){var v=a.uniformBufferBindings[p];wt(v.wordCount>0);var y={buffer:Ni(v.buffer),offset:0,size:v.wordCount<<2};c[0].push({binding:l++,resource:y})}l=0;for(var g=0;g<u.numSamplers;g++){var m=void 0!==u.samplerEntries?u.samplerEntries[g]:zi,_=a.samplerBindings[g],E=null!==_.texture?_.texture:r.device.getFallbackTexture(m);wt(m.dimension===E.dimension),wt(m.formatKind===Dt(E.pixelFormat));var T=E.gpuTextureView;c[1].push({binding:l++,resource:T});var b=null!==_.sampler?_.sampler:r.device.fallbackSampler,R=b.gpuSampler;c[1].push({binding:l++,resource:R})}return r.gpuBindGroup=c.map((function(t,e){return r.device.device.createBindGroup({layout:s.getBindGroupLayout(e),entries:t})})),r.bindingLayout=a.bindingLayout,r}return N(n,[{key:"_createBindGroupLayout",value:function(t){var e=this.device.bindGroupLayoutCache.get(t);return null===e&&(e=this._createBindGroupLayoutInternal(t),this.device.bindGroupLayoutCache.add(t,e)),e}},{key:"_createBindGroupLayoutInternal",value:function(t){var e,n=this,r=[[],[]];if(t.storageEntries)for(var i=0;i<t.storageEntries.length;i++)r[0].push({binding:r[0].length,visibility:GPUShaderStage.COMPUTE,buffer:{type:t.storageEntries[i].type}});for(var o=0;o<t.numUniformBuffers;o++)r[0].push({binding:r[0].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform",hasDynamicOffset:!0}});for(var a=0;a<t.numSamplers;a++){var s=void 0!==t.samplerEntries?t.samplerEntries[a]:zi;r[1].push({binding:r[1].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:(e=s,{sampleType:Ci(e.formatKind),viewDimension:xi(e.dimension)})}),r[1].push({binding:r[1].length,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}})}return{gpuBindGroupLayout:r.map((function(t){return n.device.device.createBindGroupLayout({entries:t})}))}}}]),n}(Yi),Ki=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.RenderPipeline,r.bindingLayouts=void 0,r.program=void 0,r.drawMode=void 0,r.megaState=void 0,r.inputLayout=void 0,r.colorAttachmentFormats=void 0,r.depthStencilAttachmentFormat=void 0,r.sampleCount=void 0,r.bindingLayouts=r.createBindingLayouts(a.bindingLayouts),r.drawMode=function(t){switch(t){case at.Triangles:return At.TRIANGLES;case at.Points:return At.POINTS;case at.TriangleStrip:return At.TRIANGLE_STRIP;case at.Lines:return At.LINES;case at.LineStrip:return At.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(a.topology),r.program=a.program,r.inputLayout=a.inputLayout,r.megaState=a.megaStateDescriptor,r.colorAttachmentFormats=a.colorAttachmentFormats.slice(),r.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,r.sampleCount=a.sampleCount,r}return N(n,[{key:"createBindingLayouts",value:function(t){for(var e=0,n=0,r=[],i=0;i<t.length;i++){var o=t[i],a=o.numUniformBuffers,s=o.numSamplers,u=o.samplerEntries,c=[];void 0!==u&&wt(u.length===s);for(var l=0;l<s;l++){var f=void 0!==u?u[l]:zi,h=f.dimension,d=f.formatKind;c.push({gl_target:gi(h),formatKind:d})}r.push({firstUniformBuffer:e,numUniformBuffers:a,firstSampler:n,numSamplers:s,samplerEntries:c}),e+=a,n+=s}return{numUniformBuffers:e,numSamplers:n,bindingLayoutTables:r}}}]),n}(ni),Zi=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.RenderTarget,r.gl_renderbuffer=null,r.texture=null,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.sampleCount=void 0;var s=r.device.gl,u=a.pixelFormat,c=a.width,l=a.height,f=a.texture,h=a.sampleCount;if(f)r.texture=f;else{r.gl_renderbuffer=r.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,r.gl_renderbuffer);var d=r.device.translateTextureInternalFormat(u);ii(s)&&h>0?s.renderbufferStorageMultisample(At.RENDERBUFFER,h,d,c,l):s.renderbufferStorage(At.RENDERBUFFER,d,c,l)}return r.pixelFormat=u,r.width=c,r.height=l,r.sampleCount=h,r}return N(n,[{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer)}}]),n}(ni),Qi=function(){function t(){C(this,t),this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return N(t,[{key:"trackResourceCreated",value:function(t){this.creationStacks.set(t,(new Error).stack),this.liveObjects.add(t)}},{key:"trackResourceDestroyed",value:function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,"\n\nCreation stack: ",this.creationStacks.get(t),"\n\nDeletion stack: ",this.deletionStacks.get(t),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(t,(new Error).stack),this.liveObjects.delete(t)}},{key:"checkForLeaks",value:function(){var t,e=K(this.liveObjects.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;console.warn("Object leaked:",n,"Creation stack:",this.creationStacks.get(n))}}catch(r){e.e(r)}finally{e.f()}}},{key:"setResourceLeakCheck",value:function(t,e){e?this.liveObjects.add(t):this.liveObjects.delete(t)}}]),t}(),Ji=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Sampler,r.gl_sampler=void 0,r.descriptor=void 0;var s=r.device.gl;if(ii(s)){var u,c,l=r.device.ensureResourceExists(s.createSampler());s.samplerParameteri(l,At.TEXTURE_WRAP_S,ci(a.wrapS)),s.samplerParameteri(l,At.TEXTURE_WRAP_T,ci(a.wrapT)),s.samplerParameteri(l,At.TEXTURE_WRAP_R,ci(null!==(u=a.wrapQ)&&void 0!==u?u:a.wrapS)),s.samplerParameteri(l,At.TEXTURE_MIN_FILTER,li(a.minFilter,a.mipFilter)),s.samplerParameteri(l,At.TEXTURE_MAG_FILTER,li(a.magFilter,ot.NoMip)),void 0!==a.minLOD&&s.samplerParameterf(l,At.TEXTURE_MIN_LOD,a.minLOD),void 0!==a.maxLOD&&s.samplerParameterf(l,At.TEXTURE_MAX_LOD,a.maxLOD),void 0!==a.compareMode&&(s.samplerParameteri(l,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.samplerParameteri(l,s.TEXTURE_COMPARE_FUNC,a.compareMode));var f=null!==(c=a.maxAnisotropy)&&void 0!==c?c:1;f>1&&null!==r.device.EXT_texture_filter_anisotropic&&(wt(a.minFilter===it.Bilinear&&a.magFilter===it.Bilinear&&a.mipFilter===ot.Linear),s.samplerParameterf(l,r.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f)),r.gl_sampler=l}else r.descriptor=a;return r}return N(n,[{key:"setTextureParameters",value:function(t,e,n){var r,i=this.device.gl,o=this.descriptor;this.isNPOT(e,n)?i.texParameteri(At.TEXTURE_2D,At.TEXTURE_MIN_FILTER,At.LINEAR):i.texParameteri(t,At.TEXTURE_MIN_FILTER,li(o.minFilter,o.mipFilter)),i.texParameteri(At.TEXTURE_2D,At.TEXTURE_WRAP_S,ci(o.wrapS)),i.texParameteri(At.TEXTURE_2D,At.TEXTURE_WRAP_T,ci(o.wrapT)),i.texParameteri(t,At.TEXTURE_MAG_FILTER,li(o.magFilter,ot.NoMip));var a=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(wt(o.minFilter===it.Bilinear&&o.magFilter===it.Bilinear&&o.mipFilter===ot.Linear),i.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))}},{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),ii(this.device.gl)&&this.device.gl.deleteSampler(di(this))}},{key:"isNPOT",value:function(t,e){return!Ht(t)||!Ht(e)}}]),n}(ni),$i=function(){function t(e,n){C(this,t),this.shaderDebug=!1,this.contextAttributes=void 0,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorResolveTos=[],this.currentDepthStencilAttachment=void 0,this.currentDepthStencilResolveTo=null,this.currentSampleCount=-1,this.currentPipeline=void 0,this.currentInputState=void 0,this.currentMegaState=re(ae),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveColorReadFramebuffer=void 0,this.resolveColorDrawFramebuffer=void 0,this.resolveDepthStencilAttachmentsChanged=!1,this.resolveDepthStencilReadFramebuffer=void 0,this.resolveDepthStencilDrawFramebuffer=void 0,this.renderPassDrawFramebuffer=void 0,this.readbackFramebuffer=void 0,this.fallbackTexture2D=void 0,this.fallbackTexture2DDepth=void 0,this.fallbackTexture2DArray=void 0,this.fallbackTexture3D=void 0,this.fallbackTextureCube=void 0,this.platformString=void 0,this.glslVersion=void 0,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=vt.LowerLeft,this.clipSpaceNearZ=yt.NegativeOne,this.supportMRT=!1,this.inBlitRenderPass=!1,this.blitRenderPipeline=void 0,this.blitInputState=void 0,this.blitBindings=void 0,this.uniformBufferMaxPageByteSize=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.supportedSampleCounts=[],this.maxVertexAttribs=void 0,this.gl=void 0,this.gl=e,this.contextAttributes=Ft(e.getContextAttributes()),ii(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.supportMRT=!0):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives"),this.WEBGL_draw_buffers&&(this.supportMRT=!0)),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),this.OES_draw_buffers_indexed=e.getExtension("OES_draw_buffers_indexed"),ii(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new bi({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depth:1,dimension:lt.n2D,numLevels:1,usage:ft.RenderTarget,pixelFormat:!1===this.contextAttributes.alpha?Tt.U8_RGB_RT:Tt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=pt.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(lt.n2D,pt.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(lt.n2D,pt.Depth),ii(e),this.currentMegaState.depthCompare=J.Less,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=ht.AllChannels,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),n.shaderDebug&&(this.shaderDebug=!0),n.trackResources&&(this.resourceCreationTracker=new Qi)}return N(t,[{key:"createFallbackTexture",value:function(t,e){var n=t===lt.Cube?6:1,r=e===pt.Depth?Tt.D24:Tt.U8_RGBA_NORM,i=this.createTexture({dimension:t,pixelFormat:r,usage:ft.Sampled,width:1,height:1,depth:n,numLevels:1,immutable:!0});return e===pt.Float&&i.setImageData([new Uint8Array(4*n)],0),hi(i)}},{key:"getNextUniqueId",value:function(){return++this.resourceUniqueId}},{key:"checkLimits",value:function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(At.MAX_VERTEX_ATTRIBS),ii(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(At.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var e=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=e?W(e):[]}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(t,e){return t-e}))}},{key:"configureSwapChain",value:function(t,e,n){var r=this.scTexture;r.width=t,r.height=e,this.scPlatformFramebuffer=zt(n)}},{key:"getDevice",value:function(){return this}},{key:"getCanvas",value:function(){return this.gl.canvas}},{key:"getOnscreenTexture",value:function(){return this.scTexture}},{key:"present",value:function(){var t=this.gl;this.currentMegaState.attachmentsState[0].channelWriteMask!==ht.Alpha&&(t.colorMask(!1,!1,!1,!0),this.currentMegaState.attachmentsState[0].channelWriteMask=ht.Alpha);var e=Xt.r,n=Xt.g,r=Xt.b,i=Xt.a;ii(t)?t.clearBufferfv(t.COLOR,0,[e,n,r,i]):this.submitBlitRenderPass()}},{key:"translateTextureInternalFormat",value:function(t){switch(t){case Tt.ALPHA:return At.ALPHA;case Tt.F16_RGBA:return At.RGBA16F;case Tt.F32_R:return At.R32F;case Tt.F32_RG:return At.RG32F;case Tt.F32_RGB:return At.RGB32F;case Tt.F32_RGBA:return At.RGBA32F;case Tt.U8_R_NORM:return At.R8;case Tt.U8_RG_NORM:return At.RG8;case Tt.U8_RGB_NORM:case Tt.U8_RGB_RT:return At.RGB8;case Tt.U8_RGB_SRGB:return At.SRGB8;case Tt.U8_RGBA_NORM:case Tt.U8_RGBA_RT:return ii(this.gl)?At.RGBA8:At.RGBA;case Tt.U8_RGBA_SRGB:case Tt.U8_RGBA_RT_SRGB:return At.SRGB8_ALPHA8;case Tt.U16_R:return At.R16UI;case Tt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Tt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Tt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Tt.U16_RGBA_5551:return At.RGB5_A1;case Tt.U32_R:return At.R32UI;case Tt.S8_RGBA_NORM:return At.RGBA8_SNORM;case Tt.S8_RG_NORM:return At.RG8_SNORM;case Tt.U16_RGBA_5551:return At.UNSIGNED_SHORT_5_5_5_1;case Tt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Tt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Tt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Tt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Tt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Tt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Tt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Tt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Tt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Tt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Tt.D32F_S8:return ii(this.gl)?At.DEPTH32F_STENCIL8:At.DEPTH_STENCIL;case Tt.D24_S8:return ii(this.gl)?At.DEPTH24_STENCIL8:At.DEPTH_STENCIL;case Tt.D32F:return ii(this.gl)?At.DEPTH_COMPONENT32F:At.DEPTH_COMPONENT;case Tt.D24:return ii(this.gl)?At.DEPTH_COMPONENT24:At.DEPTH_COMPONENT;default:throw"whoops"}}},{key:"translateTextureType",value:function(t){switch(xt(t)){case mt.U8:return At.UNSIGNED_BYTE;case mt.U16:return At.UNSIGNED_SHORT;case mt.U32:return At.UNSIGNED_INT;case mt.S8:return At.BYTE;case mt.F16:return At.HALF_FLOAT;case mt.F32:return At.FLOAT;case mt.U16_PACKED_5551:return At.UNSIGNED_SHORT_5_5_5_1;case mt.D32F:return At.FLOAT;case mt.D24:return ii(this.gl)?At.UNSIGNED_INT_24_8:At.UNSIGNED_SHORT;case mt.D24S8:return ii(this.gl)?At.UNSIGNED_INT_24_8:At.UNSIGNED_INT_24_8_WEBGL;case mt.D32FS8:return At.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw"whoops"}}},{key:"translateTextureFormat",value:function(t){if(oi(t))return this.translateTextureInternalFormat(t);switch(t){case Tt.D24_S8:case Tt.D32F_S8:return At.DEPTH_STENCIL;case Tt.D24:case Tt.D32F:return At.DEPTH_COMPONENT}var e=ai(t);switch(Ct(t)){case _t.A:return At.ALPHA;case _t.R:return e?At.RED_INTEGER:At.RED;case _t.RG:return e?At.RG_INTEGER:At.RG;case _t.RGB:return e?At.RGB_INTEGER:At.RGB;case _t.RGBA:return At.RGBA}}},{key:"setActiveTexture",value:function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)}},{key:"bindVAO",value:function(t){this.currentBoundVAO!==t&&(ii(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)}},{key:"programCompiled",value:function(t){wt(t.compileState!==mi.NeedsCompile),t.compileState===mi.Compiling&&(t.compileState=mi.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))}},{key:"useProgram",value:function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)}},{key:"ensureResourceExists",value:function(t){if(null===t){var e=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(e))}return t}},{key:"createBuffer",value:function(t){return new _i({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createTexture",value:function(t){return new bi({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createSampler",value:function(t){return new Ji({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createRenderTarget",value:function(t){return new Zi({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createRenderTargetFromTexture",value:function(t){var e=t.pixelFormat,n=t.width,r=t.height;return wt(1===t.numLevels),this.createRenderTarget({pixelFormat:e,width:n,height:r,sampleCount:1,texture:t})}},{key:"createProgram",value:function(t){return t.ensurePreprocessed(this.queryVendorInfo()),this.createProgramSimple(t)}},{key:"createProgramSimple",value:function(t){return new Ri({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createBindings",value:function(t){var e=t.bindingLayout,n=t.uniformBufferBindings,r=t.samplerBindings;return wt(n.length>=e.numUniformBuffers),wt(r.length>=e.numSamplers),new ri({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createInputLayout",value:function(t){return new Ei({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createInputState",value:function(t,e,n,r){var i=t;return new Ti({id:this.getNextUniqueId(),device:this,inputLayout:i,vertexBuffers:e,indexBufferBinding:n,program:r})}},{key:"createRenderPipeline",value:function(t){return new Ki({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createComputePass",value:function(t){throw new Error("Method not implemented.")}},{key:"createComputePipeline",value:function(t){throw new Error("Method not implemented.")}},{key:"createReadback",value:function(){return new Hi({id:this.getNextUniqueId(),device:this})}},{key:"createQueryPool",value:function(t,e){return new Xi({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})}},{key:"createRenderPass",value:function(t){wt(null===this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t;var e=t.colorAttachment,n=t.colorClearColor,r=t.colorResolveTo,i=t.depthStencilAttachment,o=t.depthClearValue,a=t.stencilClearValue,s=t.depthStencilResolveTo;this.setRenderPassParametersBegin(e.length);for(var u=0;u<e.length;u++)this.setRenderPassParametersColor(u,e[u],r[u]);this.setRenderPassParametersDepthStencil(i,s),this.validateCurrentAttachments();for(var c=0;c<e.length;c++){var l=n[c];"load"!==l&&this.setRenderPassParametersClearColor(c,l.r,l.g,l.b,l.a)}return this.setRenderPassParametersClearDepthStencil(o,a),this}},{key:"submitPass",value:function(t){wt(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptor=null}},{key:"copySubTexture2D",value:function(t,e,n,r,i,o){var a=this.gl,s=t,u=r;wt(1===u.numLevels),wt(1===s.numLevels),ii(a)&&(s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u),a.blitFramebuffer(i,o,i+u.width,o+u.height,e,n,e+u.width,n+u.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null))}},{key:"queryLimits",value:function(){return this}},{key:"queryTextureFormatSupported",value:function(t){switch(t){case Tt.BC1_SRGB:case Tt.BC2_SRGB:case Tt.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb;case Tt.BC1:case Tt.BC2:case Tt.BC3:return null!==this.WEBGL_compressed_texture_s3tc;case Tt.BC4_UNORM:case Tt.BC4_SNORM:case Tt.BC5_UNORM:case Tt.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc;default:return!0}}},{key:"queryProgramReady",value:function(t){var e,n=this.gl;if(t.compileState===mi.NeedsCompile)throw"whoops";return t.compileState===mi.Compiling?((e=null===this.KHR_parallel_shader_compile||n.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(t),e):t.compileState===mi.NeedsBind||t.compileState===mi.ReadyToUse}},{key:"queryPipelineReady",value:function(t){var e=t;return this.queryProgramReady(e.program)}},{key:"queryPlatformAvailable",value:function(){return this.gl.isContextLost()}},{key:"queryVendorInfo",value:function(){return this}},{key:"queryRenderPass",value:function(t){return this.currentRenderPassDescriptor}},{key:"queryRenderTarget",value:function(t){return t}},{key:"setResourceName",value:function(t,e){if(t.name=e,t.type===Q.Buffer)for(var n=t.gl_buffer_pages,r=0;r<n.length;r++)pi(n[r],"".concat(e," Page ").concat(r));else if(t.type===Q.Texture)pi(hi(t),e);else if(t.type===Q.Sampler)pi(di(t),e);else if(t.type===Q.RenderTarget){var i=t.gl_renderbuffer;null!==i&&pi(i,e)}else t.type===Q.InputState&&pi(t.vao,e)}},{key:"setResourceLeakCheck",value:function(t,e){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(t,e)}},{key:"checkForLeaks",value:function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()}},{key:"pushDebugGroup",value:function(t){this.debugGroupStack.push(t)}},{key:"popDebugGroup",value:function(){this.debugGroupStack.pop()}},{key:"programPatched",value:function(t,e){wt(this.shaderDebug)}},{key:"getBufferData",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.gl;ii(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,fi(t,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,e))}},{key:"debugGroupStatisticsDrawCall",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].drawCallCount+=t}},{key:"debugGroupStatisticsBufferUpload",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].bufferUploadCount+=t}},{key:"debugGroupStatisticsTextureBind",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].textureBindCount+=t}},{key:"debugGroupStatisticsTriangles",value:function(t){for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].triangleCount+=t}},{key:"reportShaderError",value:function(t,e){var n=this.gl,r=n.getShaderParameter(t,n.COMPILE_STATUS);if(!r){console.error(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=t.split("\n");return n.map((function(t,n){return"".concat(Jt(""+(e+n),4," "),"  ").concat(t)})).join("\n")}(e));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return r}},{key:"checkProgramCompilationForErrors",value:function(t){var e=this.gl,n=t.gl_program;if(!e.getProgramParameter(n,e.LINK_STATUS)){var r=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,r.preprocessedVert))return;if(!this.reportShaderError(t.gl_shader_frag,r.preprocessedFrag))return;console.error(e.getProgramInfoLog(t.gl_program))}}},{key:"bindFramebufferAttachment",value:function(t,e,n){var r=this.gl;null===n?r.framebufferRenderbuffer(t,e,r.RENDERBUFFER,null):n.type===Q.RenderTarget?null!==n.gl_renderbuffer?r.framebufferRenderbuffer(t,e,r.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&r.framebufferTexture2D(t,e,At.TEXTURE_2D,hi(n.texture),0):n.type===Q.Texture&&r.framebufferTexture2D(t,e,At.TEXTURE_2D,hi(n),0)}},{key:"bindFramebufferDepthStencilAttachment",value:function(t,e){var n=this.gl,r=null!==e?Nt(e.pixelFormat):Et.Depth|Et.Stencil,i=!!(r&Et.Depth),o=!!(r&Et.Stencil);i&&o?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,e):i?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,e),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null)):o&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,e),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null))}},{key:"validateCurrentAttachments",value:function(){for(var t=-1,e=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===t?(t=i.sampleCount,e=i.width,n=i.height):(wt(t===i.sampleCount),wt(e===i.width),wt(n===i.height)))}null!==this.currentDepthStencilAttachment&&(-1===t?(t=this.currentDepthStencilAttachment.sampleCount,e=this.currentDepthStencilAttachment.width,n=this.currentDepthStencilAttachment.height):(wt(t===this.currentDepthStencilAttachment.sampleCount),wt(e===this.currentDepthStencilAttachment.width),wt(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t}},{key:"setRenderPassParametersBegin",value:function(t){var e=this.gl;if(ii(e)?e.bindFramebuffer(At.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||e.bindFramebuffer(At.FRAMEBUFFER,this.renderPassDrawFramebuffer),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var r=ii(e)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,i=ii(e)?At.COLOR_ATTACHMENT0:At.COLOR_ATTACHMENT0_WEBGL;e.framebufferRenderbuffer(r,i+n,At.RENDERBUFFER,null),e.framebufferTexture2D(r,i+n,At.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t,ii(e)?e.drawBuffers([At.COLOR_ATTACHMENT0,At.COLOR_ATTACHMENT1,At.COLOR_ATTACHMENT2,At.COLOR_ATTACHMENT3]):this.inBlitRenderPass||this.WEBGL_draw_buffers.drawBuffersWEBGL([At.COLOR_ATTACHMENT0_WEBGL,At.COLOR_ATTACHMENT1_WEBGL,At.COLOR_ATTACHMENT2_WEBGL,At.COLOR_ATTACHMENT3_WEBGL])}},{key:"setRenderPassParametersColor",value:function(t,e,n){var r=this.gl;this.currentColorAttachments[t]!==e&&(this.currentColorAttachments[t]=e,this.bindFramebufferAttachment(ii(r)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,(ii(r)?At.COLOR_ATTACHMENT0:At.COLOR_ATTACHMENT0_WEBGL)+t,e),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[t]!==n&&(this.currentColorResolveTos[t]=n,null!==n&&(this.resolveColorAttachmentsChanged=!0))}},{key:"setRenderPassParametersDepthStencil",value:function(t,e){var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(ii(n)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==e&&(this.currentDepthStencilResolveTo=e,null!==e&&(this.resolveDepthStencilAttachmentsChanged=!0))}},{key:"setRenderPassParametersClearColor",value:function(t,e,n,r,i){var o=this.gl;if(null!==this.OES_draw_buffers_indexed){var a=this.currentMegaState.attachmentsState[t];a&&a.channelWriteMask!==ht.AllChannels&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),a.channelWriteMask=ht.AllChannels)}else{var s=this.currentMegaState.attachmentsState[0];s&&s.channelWriteMask!==ht.AllChannels&&(o.colorMask(!0,!0,!0,!0),s.channelWriteMask=ht.AllChannels)}this.setScissorEnabled(!1),ii(o)?o.clearBufferfv(o.COLOR,t,[e,n,r,i]):(o.clearColor(e,n,r,i),o.clear(o.COLOR_BUFFER_BIT))}},{key:"setRenderPassParametersClearDepthStencil",value:function(t,e){var n=this.gl;"load"!==t&&(wt(null!==this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),ii(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==e&&(wt(null!==this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),ii(n)?n.clearBufferiv(n.STENCIL,0,[e]):(n.clearStencil(e),n.clear(n.STENCIL_BUFFER_BIT)))}},{key:"setBindings",value:function(t,e,n){var r=this.gl;wt(t<this.currentPipeline.bindingLayouts.bindingLayoutTables.length);var i=this.currentPipeline.bindingLayouts.bindingLayoutTables[t],o=e.uniformBufferBindings,a=e.samplerBindings;wt(o.length>=i.numUniformBuffers),wt(a.length>=i.numSamplers),wt(n.length>=o.length);for(var s=0;s<o.length;s++){var u=o[s];if(0!==u.wordCount){var c=i.firstUniformBuffer+s,l=u.buffer,f=n[s],h=4*u.wordCount;if(l!==this.currentUniformBuffers[c]||f!==this.currentUniformBufferByteOffsets[c]||h!==this.currentUniformBufferByteSizes[c]){var d=f%l.pageByteSize,p=l.gl_buffer_pages[f/l.pageByteSize|0];wt(d+h<=l.pageByteSize),ii(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,p,d,h),this.currentUniformBuffers[c]=l,this.currentUniformBufferByteOffsets[c]=f,this.currentUniformBufferByteSizes[c]=h}}}for(var v=0;v<i.numSamplers;v++){var y=a[v],g=i.firstSampler+v,m=i.samplerEntries[v],_=null!==y&&null!==y.sampler?di(y.sampler):null,E=null!==y&&null!==y.texture?hi(y.texture):null;if(this.currentSamplers[g]!==_&&(ii(r)&&r.bindSampler(g,_),this.currentSamplers[g]=_),this.currentTextures[g]!==E){if(this.setActiveTexture(r.TEXTURE0+g),null!==E){y.texture.textureIndex=g;var T,b=Ft(y).texture,R=b.gl_target,A=(b.formatKind,b.width),S=b.height;if(r.bindTexture(R,E),!ii(r))null===(T=y.sampler)||void 0===T||T.setTextureParameters(R,A,S);this.debugGroupStatisticsTextureBind(),wt(m.gl_target===R)}else r.bindTexture(m.gl_target,this.getFallbackTexture(m));this.currentTextures[g]=E}}}},{key:"setViewport",value:function(t,e,n,r){this.gl.viewport(t,e,n,r)}},{key:"setScissor",value:function(t,e,n,r){var i=this.gl;this.setScissorEnabled(!0),i.scissor(t,e,n,r)}},{key:"applyAttachmentStateIndexed",value:function(t,e,n){var r=this.gl,i=this.OES_draw_buffers_indexed;e.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(t,!!(n.channelWriteMask&ht.Red),!!(n.channelWriteMask&ht.Green),!!(n.channelWriteMask&ht.Blue),!!(n.channelWriteMask&ht.Alpha)),e.channelWriteMask=n.channelWriteMask);var o=e.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=e.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(yi(e.rgbBlendState)&&yi(e.alphaBlendState)?i.enableiOES(t,r.BLEND):yi(n.rgbBlendState)&&yi(n.alphaBlendState)&&i.disableiOES(t,r.BLEND)),o&&(i.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),e.rgbBlendState.blendMode=n.rgbBlendState.blendMode,e.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)}},{key:"applyAttachmentState",value:function(t,e){var n=this.gl;t.channelWriteMask!==e.channelWriteMask&&(n.colorMask(!!(e.channelWriteMask&ht.Red),!!(e.channelWriteMask&ht.Green),!!(e.channelWriteMask&ht.Blue),!!(e.channelWriteMask&ht.Alpha)),t.channelWriteMask=e.channelWriteMask);var r=t.rgbBlendState.blendMode!==e.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==e.alphaBlendState.blendMode,i=t.rgbBlendState.blendSrcFactor!==e.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==e.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==e.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==e.alphaBlendState.blendDstFactor;(i||r)&&(yi(t.rgbBlendState)&&yi(t.alphaBlendState)?n.enable(n.BLEND):yi(e.rgbBlendState)&&yi(e.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(e.rgbBlendState.blendMode,e.alphaBlendState.blendMode),t.rgbBlendState.blendMode=e.rgbBlendState.blendMode,t.alphaBlendState.blendMode=e.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(e.rgbBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor,e.alphaBlendState.blendSrcFactor,e.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=e.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=e.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=e.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=e.alphaBlendState.blendDstFactor)}},{key:"setMegaState",value:function(t){var e=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<t.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],t.attachmentsState[0]);else wt(1===t.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);Lt(n.blendConstant,t.blendConstant)||(e.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),kt(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(e.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),n.depthWrite!==t.depthWrite&&(e.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),n.stencilWrite!==t.stencilWrite&&(e.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite),n.stencilPassOp!==t.stencilPassOp&&(e.stencilOp(e.KEEP,e.KEEP,t.stencilPassOp),n.stencilPassOp=t.stencilPassOp),n.stencilRef===t.stencilRef&&n.stencilCompare===t.stencilCompare||(n.stencilCompare=t.stencilCompare,this.setStencilRef(t.stencilRef)),n.cullMode!==t.cullMode&&(n.cullMode===tt.None?e.enable(e.CULL_FACE):t.cullMode===tt.None&&e.disable(e.CULL_FACE),t.cullMode===tt.Back?e.cullFace(e.BACK):t.cullMode===tt.Front?e.cullFace(e.FRONT):t.cullMode===tt.FrontAndBack&&e.cullFace(e.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(e.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?(e.polygonOffset(1,1),e.enable(e.POLYGON_OFFSET_FILL)):e.disable(e.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset)}},{key:"validatePipelineFormats",value:function(t){for(var e=0;e<this.currentColorAttachments.length;e++){var n=this.currentColorAttachments[e];null!==n&&wt(n.pixelFormat===t.colorAttachmentFormats[e])}null!==this.currentDepthStencilAttachment&&wt(this.currentDepthStencilAttachment.pixelFormat===t.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&wt(this.currentSampleCount===t.sampleCount)}},{key:"setPipeline",value:function(t){this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var e=this.currentPipeline.program;if(this.useProgram(e),e.compileState===mi.NeedsBind){var n=this.gl,r=e.gl_program,i=e.descriptor,o=vi(i.preprocessedVert,/uniform (\w+) {([^]*?)}/g);if(ii(n))for(var a=0;a<o.length;a++){var s=j(o[a],3),u=(s[0],s[1]),c=(s[2],n.getUniformBlockIndex(r,u));-1!==c&&4294967295!==c&&n.uniformBlockBinding(r,c,a)}for(var l=vi(i.preprocessedVert,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),f=0;f<l.length;f++){var h=j(l[f],3),d=(h[0],h[1]),p=h[2],v=n.getUniformLocation(r,d);n.uniform1i(v,parseInt(p))}e.compileState=mi.ReadyToUse}}},{key:"setInputState",value:function(t){var e=t;this.currentInputState=e,null!==this.currentInputState?(wt(this.currentPipeline.inputLayout===this.currentInputState.inputLayout),this.bindVAO(this.currentInputState.vao)):(wt(null===this.currentPipeline.inputLayout),this.bindVAO(null))}},{key:"setStencilRef",value:function(t){this.currentStencilRef=t,this.applyStencil()}},{key:"draw",value:function(t,e){var n=this.gl,r=this.currentPipeline;n.drawArrays(r.drawMode,e,t),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3)}},{key:"drawIndexed",value:function(t,e){var n=this.gl,r=this.currentPipeline,i=this.currentInputState,o=Ft(i.indexBufferByteOffset)+e*Ft(i.indexBufferCompByteSize);n.drawElements(r.drawMode,t,Ft(i.indexBufferType),o),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3)}},{key:"drawIndexedInstanced",value:function(t,e,n){var r,i=this.gl,o=this.currentPipeline,a=this.currentInputState,s=Ft(a.indexBufferByteOffset)+e*Ft(a.indexBufferCompByteSize),u=[o.drawMode,t,Ft(a.indexBufferType),s,n];ii(i)?i.drawElementsInstanced.apply(i,u):(r=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(r,u);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*n)}},{key:"beginOcclusionQuery",value:function(t){var e=this.gl;if(ii(e)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;e.beginQuery(n.gl_query_type,n.gl_query[t])}}},{key:"endOcclusionQuery",value:function(t){var e=this.gl;if(ii(e)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(n.gl_query_type)}}},{key:"beginDebugGroup",value:function(t){}},{key:"endDebugGroup",value:function(){}},{key:"pipelineQueryReady",value:function(t){var e=t;return this.queryProgramReady(e.program)}},{key:"pipelineForceReady",value:function(t){}},{key:"endPass",value:function(){for(var t=this.gl,e=!1,n=0;n<this.currentColorAttachments.length;n++){var r=this.currentColorResolveTos[n];if(null!==r){var i=Ft(this.currentColorAttachments[n]);wt(i.width===r.width&&i.height===r.height),wt(i.pixelFormat===r.pixelFormat),t.disable(At.SCISSOR_TEST),ii(t)&&t.bindFramebuffer(At.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),r===this.scTexture?(t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,this.scPlatformFramebuffer),this.resolveColorAttachmentsChanged&&ii(t)&&this.bindFramebufferAttachment(At.READ_FRAMEBUFFER,At.COLOR_ATTACHMENT0,i),ii(t)?t.blitFramebuffer(0,0,i.width,i.height,0,0,r.width,r.height,At.COLOR_BUFFER_BIT,At.LINEAR):t.bindTexture(At.TEXTURE_2D,i.texture.gl_texture),e=!0):(t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&(this.bindFramebufferAttachment(ii(t)?At.READ_FRAMEBUFFER:At.FRAMEBUFFER,ii(t)?At.COLOR_ATTACHMENT0:At.COLOR_ATTACHMENT0_WEBGL,i),t.framebufferTexture2D(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,ii(t)?At.COLOR_ATTACHMENT0:At.COLOR_ATTACHMENT0_WEBGL,At.TEXTURE_2D,r.gl_texture,0)),ii(t)&&t.blitFramebuffer(0,0,i.width,i.height,0,0,r.width,r.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,null),e=!0),ii(t)&&t.bindFramebuffer(At.READ_FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var o=this.currentDepthStencilAttachment,a=this.currentDepthStencilResolveTo;null!==o&&null!==a&&(wt(o.width===a.width&&o.height===a.height),t.disable(t.SCISSOR_TEST),t.bindFramebuffer(ii(t)?At.READ_FRAMEBUFFER:At.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(ii(t)?At.READ_FRAMEBUFFER:At.FRAMEBUFFER,o),this.bindFramebufferDepthStencilAttachment(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,a)),ii(t)&&t.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(ii(t)?At.READ_FRAMEBUFFER:At.FRAMEBUFFER,null),t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,null),e=!0),this.resolveDepthStencilAttachmentsChanged=!1,e||t.bindFramebuffer(ii(t)?At.DRAW_FRAMEBUFFER:At.FRAMEBUFFER,null)}},{key:"setScissorEnabled",value:function(t){if(this.currentScissorEnabled!==t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.currentScissorEnabled=t}}},{key:"applyStencil",value:function(){null!==this.currentStencilRef&&this.gl.stencilFunc(this.currentMegaState.stencilCompare,this.currentStencilRef,255)}},{key:"getFallbackTexture",value:function(t){var e=t.gl_target,n=t.formatKind;if(e===At.TEXTURE_2D)return n===pt.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===At.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===At.TEXTURE_3D)return this.fallbackTexture3D;if(e===At.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw"whoops"}},{key:"submitBlitRenderPass",value:function(){if(!this.blitRenderPipeline){var t=Jn(this,st.VERTEX,new Float32Array([-4,-4,4,-4,0,4]).buffer),e=this.createInputLayout({vertexBufferDescriptors:[{byteStride:8,frequency:ct.PerVertex}],vertexAttributeDescriptors:[{format:Tt.F32_RG,bufferIndex:0,bufferByteOffset:0,location:0}],indexBufferFormat:null}),n=[{numSamplers:1,numUniformBuffers:0}],r=this.createProgram(S(S({},Xn(this,new ei)),{},{ensurePreprocessed:function(){},associate:function(){}}));this.blitInputState=this.createInputState(e,[{buffer:t,byteOffset:0}],null,r),this.blitRenderPipeline=this.createRenderPipeline({topology:at.Triangles,sampleCount:1,program:r,bindingLayouts:n,colorAttachmentFormats:[Tt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:e,megaStateDescriptor:ae});var i=this.currentColorAttachments[0].texture;this.blitBindings=this.createBindings({bindingLayout:n[0],samplerBindings:[{sampler:null,texture:i,lateBinding:null}],uniformBufferBindings:[]}),r.setUniforms({u_Texture:i})}this.inBlitRenderPass=!0;var o=this.createRenderPass({colorAttachment:[this.currentColorAttachments[0]],colorResolveTo:[this.getOnscreenTexture()],colorClearColor:[Vt],colorStore:[!0],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null}),a=this.getCanvas(),s=a.width,u=a.height;o.setPipeline(this.blitRenderPipeline),o.setBindings(0,this.blitBindings,[0]),o.setInputState(this.blitInputState),o.setViewport(0,0,s,u),o.draw(3,0),this.submitPass(o),this.inBlitRenderPass=!1}}]),t}();function to(t){return void 0!==t.byteLength}var eo=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Buffer,r.gpuBuffer=void 0,r.size=void 0,r.view=void 0,r.usage=void 0;var s=a.usage,u=a.viewOrSize,c=to(u)?u.byteLength+3&-4:u+3&-4;r.usage=s,r.usage&st.MAP_READ&&(r.usage=st.MAP_READ|st.COPY_DST);var l=to(u);if(r.size=to(u)?u.byteLength:u,r.view=to(u)?u:null,r.gpuBuffer=r.device.device.createBuffer({usage:r.usage,size:c,mappedAtCreation:l}),l){var f=r.gpuBuffer.getMappedRange();new u.constructor(f).set(u),r.gpuBuffer.unmap()}return r}return N(n,[{key:"setSubData",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.gpuBuffer;r=r||e.byteLength,r=Math.min(r,this.size-t);var o=e.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var u=new Uint8Array(e.buffer.slice(o,a));(e=new Uint8Array(s)).set(u),n=0,o=0,a=s,r=s}for(var c=15728640,l=0;a-(o+l)>c;)this.device.device.queue.writeBuffer(i,t+l,e.buffer,o+l,c),l+=c;this.device.device.queue.writeBuffer(i,t+l,e.buffer,o+l,r-l)}},{key:"destroy",value:function(){G(B(n.prototype),"destroy",this).call(this),this.gpuBuffer.destroy()}}]),n}(Yi),no=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.InputLayout,r.buffers=void 0,r.indexFormat=void 0;for(var s=[],u=0;u<a.vertexBufferDescriptors.length;u++){var c=a.vertexBufferDescriptors[u];if(null!==c){var l=c.byteStride,f=ji(c.frequency);s[u]={arrayStride:l,stepMode:f,attributes:[]}}}for(var h=0;h<a.vertexAttributeDescriptors.length;h++){var d=a.vertexAttributeDescriptors[h],p=Ft(s[d.bufferIndex]),v={shaderLocation:d.location,format:Vi(d.format),offset:d.bufferByteOffset};p.attributes.push(v)}return r.indexFormat=function(t){if(null!==t){if(t===Tt.U16_R)return"uint16";if(t===Tt.U32_R)return"uint32";throw"whoops"}}(a.indexBufferFormat),r.buffers=s,r}return N(n)}(Yi),ro=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Program,r.descriptor=void 0,r.vertexStage=null,r.fragmentStage=null,r.computeStage=null,r.descriptor=a,a.preprocessedVert&&(r.vertexStage=r.createShaderStage(a.preprocessedVert,"vertex")),a.preprocessedFrag&&(r.fragmentStage=r.createShaderStage(a.preprocessedFrag,"fragment")),a.preprocessedCompute&&(r.computeStage=r.createShaderStage(a.preprocessedCompute,"compute")),r}return N(n,[{key:"createShaderStage",value:function(t,e){var n=t;if("compute"!==e)try{n=this.device.glsl_compile(t,e,!1)}catch(a){throw console.error(a,t),"whoops"}for(var r=function(){var t=o[i];if(!n.includes(t))return"continue";n=(n=n.replace("var T_".concat(t,": texture_2d<f32>;"),"var T_".concat(t,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(t,"(.*)\\);$"),"gm"),(function(e,n){return"vec4<f32>(textureSample(T_".concat(t).concat(n,"), 0.0, 0.0, 0.0);")}))},i=0,o=["u_TextureFramebufferDepth"];i<o.length;i++)r();return{module:this.device.device.createShaderModule({code:n}),entryPoint:"main"}}}]),n}(Yi),io=function(){function t(){C(this,t),this.commandEncoder=null,this.descriptor=void 0,this.gpuRenderPassEncoder=null,this.gpuRenderPassDescriptor=void 0,this.gpuColorAttachments=void 0,this.gpuDepthStencilAttachment=void 0,this.gfxColorAttachment=[],this.gfxColorResolveTo=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadValue:"load",depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return N(t,[{key:"setRenderPassDescriptor",value:function(t){this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var e=t.colorAttachment.length;this.gfxColorAttachment.length=e,this.gfxColorResolveTo.length=e;for(var n=0;n<t.colorAttachment.length;n++){var r=t.colorAttachment[n],i=t.colorResolveTo[n];if(null===r&&null!==i&&(r=i,i=null),this.gfxColorAttachment[n]=r,this.gfxColorResolveTo[n]=i,null===r){this.gpuColorAttachments.length=n,this.gfxColorAttachment.length=n,this.gfxColorResolveTo.length=n;break}void 0===this.gpuColorAttachments[n]&&(this.gpuColorAttachments[n]={});var o=this.gpuColorAttachments[n];o.view=r.gpuTextureView,o.loadValue=t.colorClearColor[n],o.storeOp=t.colorStore[n]?"store":"discard",o.resolveTarget=void 0,null!==i&&(r.sampleCount>1?o.resolveTarget=i.gpuTextureView:o.storeOp="store")}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,null!==t.depthStencilAttachment){var a=t.depthStencilAttachment,s=this.gpuDepthStencilAttachment;s.view=a.gpuTextureView,s.depthLoadValue=t.depthClearValue,s.stencilLoadValue=t.stencilClearValue,s.depthStoreOp=t.depthStencilStore?"store":"discard",s.stencilStoreOp=t.depthStencilStore?"store":"discard",this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment,null!==this.gfxDepthStencilResolveTo&&(s.depthStoreOp="store",s.stencilStoreOp="store")}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=null!==t.occlusionQueryPool?Pi(t.occlusionQueryPool):void 0}},{key:"beginRenderPass",value:function(t){wt(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(t),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)}},{key:"setViewport",value:function(t,e,n,r){this.gpuRenderPassEncoder.setViewport(t,e,n,r,0,1)}},{key:"setScissor",value:function(t,e,n,r){this.gpuRenderPassEncoder.setScissorRect(t,e,n,r)}},{key:"setPipeline",value:function(t){var e=Ft(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(e)}},{key:"setInputState",value:function(t){if(null!==t){var e=t;if(null!==e.indexBuffer){var n=e.inputLayout,r=e.indexBuffer;this.gpuRenderPassEncoder.setIndexBuffer(Ni(r.buffer),Ft(n.indexFormat),r.byteOffset)}for(var i=0;i<e.vertexBuffers.length;i++){var o=e.vertexBuffers[i];null!==o&&this.gpuRenderPassEncoder.setVertexBuffer(i,Ni(o.buffer),o.byteOffset)}}}},{key:"setBindings",value:function(t,e,n){var r=e;this.gpuRenderPassEncoder.setBindGroup(t+0,r.gpuBindGroup[0],n.slice(0,r.bindingLayout.numUniformBuffers)),this.gpuRenderPassEncoder.setBindGroup(t+1,r.gpuBindGroup[1])}},{key:"setStencilRef",value:function(t){this.gpuRenderPassEncoder.setStencilReference(t)}},{key:"draw",value:function(t,e){this.gpuRenderPassEncoder.draw(t,1,e,0)}},{key:"drawIndexed",value:function(t,e){this.gpuRenderPassEncoder.drawIndexed(t,1,e,0,0)}},{key:"drawIndexedInstanced",value:function(t,e,n){this.gpuRenderPassEncoder.drawIndexed(t,n,e,0,0)}},{key:"beginOcclusionQuery",value:function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)}},{key:"endOcclusionQuery",value:function(t){this.gpuRenderPassEncoder.endOcclusionQuery()}},{key:"beginDebugGroup",value:function(t){void 0!==this.gpuRenderPassEncoder.pushDebugGroup&&this.gpuRenderPassEncoder.pushDebugGroup(t)}},{key:"endDebugGroup",value:function(){void 0!==this.gpuRenderPassEncoder.popDebugGroup&&this.gpuRenderPassEncoder.popDebugGroup()}},{key:"finish",value:function(){this.gpuRenderPassEncoder.endPass(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var e=this.gfxColorAttachment[t],n=this.gfxColorResolveTo[t];null!==e&&null!==n&&1===e.sampleCount&&this.copyAttachment(n,e)}return null!==this.gfxDepthStencilAttachment&&null!==this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,this.gfxDepthStencilAttachment)),this.commandEncoder.finish()}},{key:"copyAttachment",value:function(t,e){wt(1===e.sampleCount);var n={texture:e.gpuTexture},r={texture:t.gpuTexture};wt(e.width===t.width),wt(e.height===t.height),wt(!!(e.usage&bt.COPY_SRC)),wt(!!(t.usage&bt.COPY_DST)),this.commandEncoder.copyTextureToTexture(n,r,[t.width,t.height,1])}}]),t}(),oo=function(t){I(n,t);var e=k(n);function n(t){var r,i,o,a=t.id,s=t.device,u=t.descriptor;C(this,n),(o=e.call(this,{id:a,device:s})).type=Q.Sampler,o.gpuSampler=void 0;var c=u.minLOD,l=u.mipFilter===ot.NoMip?u.minLOD:u.maxLOD,f=null!==(r=u.maxAnisotropy)&&void 0!==r?r:1;return f>1&&wt(u.minFilter===it.Bilinear&&u.magFilter===it.Bilinear&&u.mipFilter===ot.Linear),o.gpuSampler=o.device.device.createSampler({addressModeU:Si(u.wrapS),addressModeV:Si(u.wrapT),addressModeW:Si(null!==(i=u.wrapQ)&&void 0!==i?i:u.wrapS),lodMinClamp:c,lodMaxClamp:l,minFilter:Oi(u.minFilter),magFilter:Oi(u.magFilter),mipmapFilter:Mi(u.mipFilter),maxAnisotropy:f}),o}return N(n)}(Yi),ao=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor,s=t.skipCreate;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Texture,r.pixelFormat=void 0,r.dimension=void 0,r.format=void 0,r.width=void 0,r.height=void 0,r.depthOrArrayLayers=void 0,r.numLevels=void 0,r.sampleCount=void 0,r.usage=void 0,r.gpuTexture=void 0,r.gpuTextureView=void 0,r.device.createTextureShared({pixelFormat:a.pixelFormat,dimension:a.dimension,width:a.width,height:a.height,depthOrArrayLayers:a.depth,numLevels:a.numLevels,usage:a.usage,sampleCount:1},F(r),s),r}return N(n,[{key:"setImageData",value:function(t,e){}},{key:"destroy",value:function(){this.gpuTexture.destroy()}}]),n}(Yi),so=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.inputLayout,s=t.vertexBuffers,u=t.indexBuffer;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.InputState,r.inputLayout=void 0,r.vertexBuffers=void 0,r.indexBuffer=void 0,r.inputLayout=a,r.vertexBuffers=s,r.indexBuffer=u,r}return N(n)}(Yi),uo=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.RenderPipeline,r.descriptor=void 0,r.isCreating=!1,r.isCreatingAsync=!1,r.gpuRenderPipeline=null,r.descriptor=a,r.device.ensureRenderPipeline(F(r)),r}return N(n,[{key:"getBindGroupLayout",value:function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)}}]),n}(Yi),co=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device;return C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.Readback,r}return N(n,[{key:"readTexture",value:function(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=t,c=0,l=this.getBlockInformationFromFormat(u.format),f=Math.ceil(r/l.width)*l.length,h=256*Math.ceil(f/256),d=h*i,p=this.device.createBuffer({usage:st.STORAGE|st.MAP_READ|st.COPY_DST,hint:ut.Static,viewOrSize:d}),v=this.device.device.createCommandEncoder();return v.copyTextureToBuffer({texture:u.gpuTexture,mipLevel:0,origin:{x:e,y:n,z:Math.max(c,0)}},{buffer:p.gpuBuffer,offset:0,bytesPerRow:h},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([v.finish()]),this.readBuffer(p,d,o,a,s,u.pixelFormat)}},{key:"readBuffer",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Tt.U8_RGB,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=t,u=i||s.size,c=r||s.view,l=c&&c.constructor&&c.constructor.BYTES_PER_ELEMENT||It(o),f=s;if(!(s.usage&st.MAP_READ&&s.usage&st.COPY_DST)){var h=this.device.device.createCommandEncoder();f=this.device.createBuffer({usage:st.STORAGE|st.MAP_READ|st.COPY_DST,hint:ut.Static,viewOrSize:u}),h.copyBufferToBuffer(s.gpuBuffer,n,f.gpuBuffer,0,u),this.device.device.queue.submit([h.finish()])}return new Promise((function(t,r){f.gpuBuffer.mapAsync(Rt.READ,n,u).then((function(){var r=f.gpuBuffer.getMappedRange(n,u),i=c;if(a)i=null===i?Wi(o,u,!0,r):Wi(o,i.buffer,void 0,r);else if(null===i)switch(l){case 1:(i=new Uint8Array(u)).set(new Uint8Array(r));break;case 2:i=e.getHalfFloatAsFloatRGBAArrayBuffer(u/2,r);break;case 4:(i=new Float32Array(u/4)).set(new Float32Array(r))}else switch(l){case 1:(i=new Uint8Array(i.buffer)).set(new Uint8Array(r));break;case 2:i=e.getHalfFloatAsFloatRGBAArrayBuffer(u/2,r,c);break;case 4:var s=c&&c.constructor||Float32Array;(i=new s(i.buffer)).set(new s(r))}f.gpuBuffer.unmap(),t(i)}),(function(t){return r(t)}))}))}},{key:"getHalfFloatAsFloatRGBAArrayBuffer",value:function(t,e,n){n||(n=new Float32Array(t));for(var r,i,o,a,s=new Uint16Array(e);t--;)n[t]=(r=s[t],i=void 0,o=void 0,a=void 0,i=(32768&r)>>15,a=1023&r,0===(o=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return n}},{key:"getBlockInformationFromFormat",value:function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw"No fixed size for Stencil8 format!";case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw"No fixed size for Depth24Plus format!";case"depth24plus-stencil8":throw"No fixed size for Depth24PlusStencil8 format!";case"depth32float":case"depth24unorm-stencil8":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}}]),n}(Yi),lo=function(){function t(){C(this,t),this.commandEncoder=null,this.descriptor=void 0,this.gpuComputePassDescriptor=void 0,this.gpuComputePassEncoder=null}return N(t,[{key:"dispatch",value:function(t,e,n){this.gpuComputePassEncoder.dispatch(t,e,n)}},{key:"finish",value:function(){return this.gpuComputePassEncoder.endPass(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()}},{key:"beginComputePass",value:function(t){wt(null===this.gpuComputePassEncoder),this.setComputePassDescriptor(t),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)}},{key:"setPipeline",value:function(t){var e=Ft(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(e)}},{key:"setBindings",value:function(t,e){var n=e;this.gpuComputePassEncoder.setBindGroup(t,n.gpuBindGroup[0])}},{key:"setComputePassDescriptor",value:function(t){this.descriptor=t}}]),t}(),fo=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.ComputePipeline,r.descriptor=void 0,r.gpuComputePipeline=null,r.descriptor=a;var s=a.program.computeStage;if(null===s)return L(r);var u={compute:S({},s)};return r.gpuComputePipeline=r.device.device.createComputePipeline(u),void 0!==r.name&&(r.gpuComputePipeline.label=r.name),r}return N(n,[{key:"getBindGroupLayout",value:function(t){return this.gpuComputePipeline.getBindGroupLayout(t)}}]),n}(Yi),ho=function(){function t(e){C(this,t),this.shaderModule=void 0,this.pipeline=void 0,this.shaderText="\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>;\n};\n\n@stage(vertex)\nfn vs(\n  @builtin(vertex_index) index: u32\n) -> VertexOutput {\n  var out: VertexOutput;\n  out.pos.x = select(-1.0, 3.0, index == 1u);\n  out.pos.y = select(-1.0, 3.0, index == 2u);\n  out.pos.z = 1.0;\n  out.pos.w = 1.0;\n  return out;\n}\n\nstruct FragmentOutput { @location(0) color: vec4<f32>; };\n\n@ stage(fragment)\nfn fs() -> FragmentOutput {\n  return FragmentOutput(vec4<f32>(1.0, 0.0, 1.0, 1.0));\n}\n";this.shaderModule=e.createShaderModule({code:this.shaderText}),this.pipeline=e.createRenderPipeline({vertex:{module:this.shaderModule,entryPoint:"vs"},fragment:{module:this.shaderModule,entryPoint:"fs",targets:[{format:"bgra8unorm",writeMask:8}]}})}return N(t,[{key:"render",value:function(t,e){var n=t.createCommandEncoder(),r=n.beginRenderPass({colorAttachments:[{view:e,loadOp:"load",loadValue:"load",storeOp:"store"}]});r.setPipeline(this.pipeline),r.draw(3),r.endPass(),t.queue.submit([n.finish()])}}]),t}(),po=function(t){I(n,t);var e=k(n);function n(t){var r,i=t.id,o=t.device,a=t.descriptor;C(this,n),(r=e.call(this,{id:i,device:o})).type=Q.QueryPool,r.querySet=void 0;var s=a.elemCount,u=a.type;return r.querySet=r.device.device.createQuerySet({type:Ii(u),count:s}),r}return N(n,[{key:"queryResultOcclusion",value:function(t){return!0}}]),n}(Yi),vo=function(){function t(e,n,r,i,o){C(this,t),this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=bt.RENDER_ATTACHMENT|bt.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.bindGroupLayoutCache=new Qe(fe,Ke),this.fallbackTexture2D=void 0,this.fallbackTexture2DDepth=void 0,this.fallbackTexture2DArray=void 0,this.fallbackTexture3D=void 0,this.fallbackTextureCube=void 0,this.fallbackSampler=void 0,this.featureTextureCompressionBC=!1,this.fullscreenAlphaClear=void 0,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=vt.UpperLeft,this.clipSpaceNearZ=yt.Zero,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.adapter=void 0,this.device=void 0,this.canvas=void 0,this.canvasContext=void 0,this.glsl_compile=void 0,this.adapter=e,this.device=n,this.canvas=r,this.canvasContext=i,this.glsl_compile=o,this.fallbackTexture2D=this.createFallbackTexture(lt.n2D,pt.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(lt.n2D,pt.Depth),this.fallbackTexture2DArray=this.createFallbackTexture(lt.n2DArray,pt.Float),this.fallbackTexture3D=this.createFallbackTexture(lt.n3D,pt.Float),this.fallbackTextureCube=this.createFallbackTexture(lt.Cube,pt.Float),this.fallbackSampler=this.createSampler({wrapS:rt.Clamp,wrapT:rt.Clamp,minFilter:it.Point,magFilter:it.Point,mipFilter:ot.NoMip}),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(t){console.error(t.error)},this.fullscreenAlphaClear=new ho(this.device)}return N(t,[{key:"configureSwapChain",value:function(t,e){this.swapChainWidth===t&&this.swapChainHeight===e||(this.swapChainWidth=t,this.swapChainHeight=e,this.canvasContext.configure({device:this.device,format:"bgra8unorm",usage:this.swapChainTextureUsage}))}},{key:"getOnscreenTexture",value:function(){var t=this.canvasContext.getCurrentTexture(),e=t.createView(),n=new ao({id:0,device:this,descriptor:{pixelFormat:Tt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depth:0,dimension:lt.n2D,numLevels:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=t,n.gpuTextureView=e,n}},{key:"getDevice",value:function(){return this}},{key:"getCanvas",value:function(){return this.canvas}},{key:"present",value:function(){this.fullscreenAlphaClear.render(this.device,this.canvasContext.getCurrentTexture().createView())}},{key:"getNextUniqueId",value:function(){return++this._resourceUniqueId}},{key:"createBuffer",value:function(t){return new eo({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createTexture",value:function(t){return new ao({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createSampler",value:function(t){return new oo({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createRenderTarget",value:function(t){var e=new ao({id:this.getNextUniqueId(),device:this,descriptor:S(S({},t),{},{dimension:lt.n2D,numLevels:1,depth:1,usage:ft.RenderTarget})});return e.depthOrArrayLayers=1,e.type=Q.RenderTarget,e}},{key:"createRenderTargetFromTexture",value:function(t){var e=t.pixelFormat,n=t.width,r=t.height,i=t.depthOrArrayLayers,o=t.sampleCount,a=t.numLevels,s=t.gpuTexture,u=t.gpuTextureView,c=t.usage;wt(!!(c&bt.RENDER_ATTACHMENT));var l=new ao({id:this.getNextUniqueId(),device:this,descriptor:{pixelFormat:e,width:n,height:r,depth:i,dimension:lt.n2D,numLevels:a,usage:c},skipCreate:!0});return l.depthOrArrayLayers=i,l.sampleCount=o,l.gpuTexture=s,l.gpuTextureView=u,l}},{key:"createProgram",value:function(t){return t.ensurePreprocessed(this),this.createProgramSimple(t)}},{key:"createProgramSimple",value:function(t){return new ro({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createTextureShared",value:function(t,e,n){var r={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},i=t.numLevels,o=Ai(t.pixelFormat),a=function(t){if(t===lt.n2D)return"2d";if(t===lt.Cube)return"3d";if(t===lt.n2DArray)return"3d";if(t===lt.n3D)return"3d";throw"whoops"}(t.dimension),s=function(t){var e=0;return t&ft.Sampled&&(e|=bt.TEXTURE_BINDING|bt.COPY_DST),t&ft.RenderTarget&&(e|=bt.RENDER_ATTACHMENT|bt.TEXTURE_BINDING|bt.COPY_SRC|bt.COPY_DST),e}(t.usage);if(e.format=o,e.dimension=t.dimension,e.pixelFormat=t.pixelFormat,e.width=t.width,e.height=t.height,e.depthOrArrayLayers=t.depthOrArrayLayers,e.numLevels=i,e.usage=s,e.sampleCount=1,!n){var u=this.device.createTexture({size:r,mipLevelCount:i,format:o,dimension:a,usage:s}),c=u.createView();e.gpuTexture=u,e.gpuTextureView=c}}},{key:"getFallbackTexture",value:function(t){var e=t.dimension,n=t.formatKind;if(e===lt.n2D)return n===pt.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===lt.n2DArray)return this.fallbackTexture2DArray;if(e===lt.n3D)return this.fallbackTexture3D;if(e===lt.Cube)return this.fallbackTextureCube;throw"whoops"}},{key:"createFallbackTexture",value:function(t,e){var n=t===lt.Cube?6:1,r=e===pt.Float?Tt.U8_RGBA_NORM:Tt.D24;return this.createTexture({dimension:t,pixelFormat:r,usage:ft.Sampled,width:1,height:1,depth:n,numLevels:1})}},{key:"createBindings",value:function(t){return t.pipeline,new qi({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createInputLayout",value:function(t){return new no({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createInputState",value:function(t,e,n){return new so({id:this.getNextUniqueId(),device:this,inputLayout:t,vertexBuffers:e,indexBuffer:n})}},{key:"createComputePipeline",value:function(t){return new fo({id:this.getNextUniqueId(),device:this,descriptor:t})}},{key:"createRenderPipeline",value:function(t){return new uo({id:this.getNextUniqueId(),device:this,descriptor:S({},t)})}},{key:"createQueryPool",value:function(t,e){return new po({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})}},{key:"ensureRenderPipeline",value:function(t){if(!t.isCreating&&null===t.gpuRenderPipeline){var e=t.descriptor,n=e.program,r=n.vertexStage,i=n.fragmentStage;if(null!==r&&null!==i){var o,a,s=(o=e.topology,a=e.megaStateDescriptor,{topology:Bi(o),cullMode:Di(a.cullMode),frontFace:wi(a.frontFace)}),u=Ui(e.colorAttachmentFormats,e.megaStateDescriptor),c=function(t,e){if(null!==t)return{format:Ai(t),depthWriteEnabled:e.depthWrite,depthCompare:Gi(e.depthCompare),depthBias:e.polygonOffset?1:0,depthBiasSlopeScale:e.polygonOffset?1:0}}(e.depthStencilAttachmentFormat,e.megaStateDescriptor),l=void 0;null!==e.inputLayout&&(l=e.inputLayout.buffers);var f=e.sampleCount;t.isCreating=!0;var h={vertex:S(S({},r),{},{buffers:l}),primitive:s,depthStencil:c,multisample:{count:f},fragment:S(S({},i),{},{targets:u})};t.gpuRenderPipeline=this.device.createRenderPipeline(h),void 0!==t.name&&(t.gpuRenderPipeline.label=t.name)}}}},{key:"createReadback",value:function(){return new co({id:this.getNextUniqueId(),device:this})}},{key:"destroyRenderTarget",value:function(t){t.gpuTexture.destroy()}},{key:"createRenderPass",value:function(t){var e=this.renderPassPool.pop();return void 0===e&&(e=new io),e.commandEncoder=this.device.createCommandEncoder(),e.beginRenderPass(t),e}},{key:"createComputePass",value:function(t){var e=this.computePassPool.pop();return void 0===e&&(e=new lo),e.commandEncoder=this.device.createCommandEncoder(),e.beginComputePass(t),e}},{key:"submitPass",value:function(t){var e=this.device.queue,n=t,r=n.finish();e.submit([r]),n.commandEncoder=null,n instanceof io?this.renderPassPool.push(n):this.computePassPool.push(n)}},{key:"copySubTexture2D",value:function(t,e,n,r,i,o){var a=this.device.createCommandEncoder(),s=t,u=r,c={texture:u.gpuTexture,origin:[i,o,0]},l={texture:s.gpuTexture,origin:[e,n,0]};wt(!!(u.usage&bt.COPY_SRC)),wt(!!(s.usage&bt.COPY_DST)),a.copyTextureToTexture(c,l,[u.width,u.height,1]),this.device.queue.submit([a.finish()])}},{key:"queryLimits",value:function(){return{uniformBufferMaxPageWordSize:4096,uniformBufferWordAlignment:64,supportedSampleCounts:[1]}}},{key:"queryTextureFormatSupported",value:function(t,e,n){if(function(t){switch(xt(t)){case mt.BC1:case mt.BC2:case mt.BC3:case mt.BC4_SNORM:case mt.BC4_UNORM:case mt.BC5_SNORM:case mt.BC5_UNORM:return!0}return!1}(t)){if(!this.featureTextureCompressionBC)return!1;var r=function(t){switch(xt(t)){case mt.BC1:case mt.BC2:case mt.BC3:case mt.BC4_SNORM:case mt.BC4_UNORM:case mt.BC5_SNORM:case mt.BC5_UNORM:return 4}return 1}(t);return e%r==0&&n%r==0&&this.featureTextureCompressionBC}return!0}},{key:"queryPipelineReady",value:function(t){var e=t;return this.ensureRenderPipeline(e),null!==e.gpuRenderPipeline}},{key:"queryPlatformAvailable",value:function(){return!0}},{key:"queryVendorInfo",value:function(){return this}},{key:"queryRenderPass",value:function(t){return t.descriptor}},{key:"queryRenderTarget",value:function(t){return t}},{key:"setResourceName",value:function(t,e){if(t.name=e,t.type===Q.Buffer)t.gpuBuffer.label=e;else if(t.type===Q.Texture){var n=t;n.gpuTexture.label=e,n.gpuTextureView.label=e}else if(t.type===Q.RenderTarget){var r=t;r.gpuTexture.label=e,r.gpuTextureView.label=e}else if(t.type===Q.Sampler){t.gpuSampler.label=e}else if(t.type===Q.RenderPipeline){var i=t;null!==i.gpuRenderPipeline&&(i.gpuRenderPipeline.label=e)}}},{key:"setResourceLeakCheck",value:function(t,e){}},{key:"checkForLeaks",value:function(){}},{key:"programPatched",value:function(t){}},{key:"pushDebugGroup",value:function(t){}},{key:"popDebugGroup",value:function(){}},{key:"pipelineQueryReady",value:function(t){return null!==t.gpuRenderPipeline}},{key:"pipelineForceReady",value:function(t){}}]),t}(),yo=function(){function t(e){C(this,t),this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load",this.pixelFormat=e}return N(t,[{key:"setDimensions",value:function(t,e,n){this.width=t,this.height=e,this.sampleCount=n}},{key:"copyDimensions",value:function(t){this.width=t.width,this.height=t.height,this.sampleCount=t.sampleCount}}]),t}();function go(t){return{colorClearColor:t,depthClearValue:1,stencilClearValue:0}}var mo,_o=go(Xt);function Eo(t,e){var n=function(t){return t.antialiasingMode===mo.MSAAx4?4:1}(e);t.setDimensions(e.backbufferWidth,e.backbufferHeight,n)}function To(t,e,n){var r=function(t){if(t===an.Color0)return Tt.U8_RGBA_RT;if(t===an.DepthStencil)return Tt.D24_S8;throw"whoops"}(t),i=new yo(r);return Eo(i,e),null!==n&&(i.colorClearColor=n.colorClearColor,i.depthClearValue=n.depthClearValue,i.stencilClearValue=n.stencilClearValue),i}!function(t){t[t.None=0]="None",t[t.FXAA=1]="FXAA",t[t.MSAAx4=2]="MSAAx4"}(mo||(mo={}));var bo=["style"],Ro=function(t){I(n,t);var e=k(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.style,i=w(t,bo);return C(this,n),e.call(this,S({type:n.tag,style:S({intensity:Math.PI},r)},i))}return N(n)}(a.i);Ro.tag="light";var Ao,So=["style"];!function(t){t[t.NONE=0]="NONE",t[t.EXP=1]="EXP",t[t.EXP2=2]="EXP2",t[t.LINEAR=3]="LINEAR"}(Ao||(Ao={}));var Oo,Mo,Co,xo=function(t){I(n,t);var e=k(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.style,i=w(t,So);return C(this,n),e.call(this,S({type:n.tag,style:S({type:Ao.NONE,fill:"black",start:1,end:1e3,density:0},r)},i))}return N(n)}(a.i);xo.tag="fog",function(t){t.PROJECTION_MATRIX="u_ProjectionMatrix",t.VIEW_MATRIX="u_ViewMatrix",t.CAMERA_POSITION="u_CameraPosition",t.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",t.VIEWPORT="u_Viewport",t.IS_ORTHO="u_IsOrtho"}(Co||(Co={}));var No,Po,Io=((Oo=function(){function t(){C(this,t),this.canvasConfig=void 0,this.contextService=void 0,this.renderingContext=void 0,this.camera=void 0,this.pluginOptions=void 0,this.pickingIdGenerator=void 0,this.renderHelper=void 0,this.lightPool=void 0,this.texturePool=void 0,this.batchManager=void 0,this.renderingService=void 0,this.device=void 0,this.swapChain=void 0,this.renderLists={world:new In},this.builder=void 0,this.pickingTexture=void 0,this.firstFrame=!0}var e,n,r;return N(t,[{key:"getDevice",value:function(){return this.device}},{key:"apply",value:function(t){var e=this;this.renderingService=t,t.hooks.init.tapPromise(Mo.tag,M(d.a.mark((function s(){var u,c,l,f;return d.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e.renderingContext.root.addEventListener(a.j.MOUNTED,n),e.renderingContext.root.addEventListener(a.j.UNMOUNTED,r),e.renderingContext.root.addEventListener(a.j.ATTR_MODIFIED,i),e.renderingContext.root.addEventListener(a.j.RENDER_ORDER_CHANGED,o),e.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering=!1,u=e.contextService.getDomElement(),c=e.canvasConfig,l=c.width,f=c.height,e.contextService.resize(l,f),s.next=10,e.createSwapChain(u);case 10:e.device=e.swapChain.getDevice(),e.renderHelper.setDevice(e.device),e.renderHelper.renderInstManager.disableSimpleMode(),e.swapChain.configureSwapChain(u.width,u.height),e.renderingContext.root.ownerDocument.defaultView.on(a.e.RESIZE,(function(){e.swapChain.configureSwapChain(u.width,u.height)})),e.batchManager.attach(e.device,t);case 16:case"end":return s.stop()}}),s)})))),t.hooks.destroy.tap(Mo.tag,(function(){e.renderHelper.destroy(),e.renderingContext.root.removeEventListener(a.j.MOUNTED,n),e.renderingContext.root.removeEventListener(a.j.UNMOUNTED,r),e.renderingContext.root.removeEventListener(a.j.ATTR_MODIFIED,i),e.renderingContext.root.removeEventListener(a.j.RENDER_ORDER_CHANGED,o)})),t.hooks.beginFrame.tap(Mo.tag,(function(){var t=e.swapChain.getCanvas(),n=e.renderHelper.renderInstManager;e.builder=e.renderHelper.renderGraph.newGraphBuilder();var r=e.canvasConfig.background?Gt.apply(void 0,W(Object(a.x)(e.canvasConfig.background).value)):Wt,i={backbufferWidth:t.width,backbufferHeight:t.height,antialiasingMode:mo.None},o=To(an.Color0,i,go(r)),s=To(an.DepthStencil,i,_o),u=e.builder.createRenderTargetID(o,"Main Render Target"),c=e.builder.createRenderTargetID(s,"Main Depth"),l=e.builder.createRenderTargetID(o,"Picking Render Target");e.builder.pushPass((function(t){t.setDebugName("Main Render Pass"),t.attachRenderTargetID(an.Color0,u),t.attachRenderTargetID(an.Color1,l),t.attachRenderTargetID(an.DepthStencil,c),t.exec((function(t){n.drawListOnPassRenderer(e.renderLists.world,t)})),t.post((function(t){e.pickingTexture=t.getRenderTargetTexture(an.Color1)}))})),e.builder.resolveRenderTargetToExternalTexture(u,e.swapChain.getOnscreenTexture())})),t.hooks.endFrame.tap(Mo.tag,(function(){var t,n,r=e.renderHelper.renderInstManager,i=e.renderHelper.pushTemplateRenderInst();i.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),i.setMegaStateFlags((t={depthWrite:!0},n={rgbBlendMode:nt.Add,alphaBlendMode:nt.Add,rgbBlendSrcFactor:et.SrcAlpha,alphaBlendSrcFactor:et.Zero,rgbBlendDstFactor:et.OneMinusSrcAlpha,alphaBlendDstFactor:et.One},void 0===t.attachmentsState&&(t.attachmentsState=[],ee(t.attachmentsState,ae.attachmentsState)),function(t,e){void 0!==e.channelWriteMask&&(t.channelWriteMask=e.channelWriteMask),void 0!==e.rgbBlendMode&&(t.rgbBlendState.blendMode=e.rgbBlendMode),void 0!==e.alphaBlendMode&&(t.alphaBlendState.blendMode=e.alphaBlendMode),void 0!==e.rgbBlendSrcFactor&&(t.rgbBlendState.blendSrcFactor=e.rgbBlendSrcFactor),void 0!==e.alphaBlendSrcFactor&&(t.alphaBlendState.blendSrcFactor=e.alphaBlendSrcFactor),void 0!==e.rgbBlendDstFactor&&(t.rgbBlendState.blendDstFactor=e.rgbBlendDstFactor),void 0!==e.alphaBlendDstFactor&&(t.alphaBlendState.blendDstFactor=e.alphaBlendDstFactor)}(t.attachmentsState[0],n),t));var o=e.canvasConfig,a=o.width,s=o.height;i.setUniforms(0,[{name:Co.PROJECTION_MATRIX,value:e.camera.getPerspective()},{name:Co.VIEW_MATRIX,value:e.camera.getViewTransform()},{name:Co.CAMERA_POSITION,value:e.camera.getPosition()},{name:Co.DEVICE_PIXEL_RATIO,value:e.contextService.getDPR()},{name:Co.VIEWPORT,value:[a,s]},{name:Co.IS_ORTHO,value:e.camera.isOrtho()?1:0}]),r.setCurrentRenderInstList(e.renderLists.world),e.batchManager.render(e.renderLists.world),r.popTemplateRenderInst(),e.renderLists.world.renderInsts.length>0&&e.renderHelper.prepareToRender(),e.renderHelper.renderGraph.execute(),r.resetRenderInsts(),e.swapChain.present(),"WebGL2"===e.device.platformString&&e.firstFrame&&(e.firstFrame=!1,setTimeout((function(){e.renderingService.dirtify()})))}));var n=function(t){var n=t.target;if(n.nodeName!==Ro.tag)if(n.nodeName!==xo.tag){var r=new Z,i=e.pickingIdGenerator.getId(n);r.pickingId=i,r.encodedPickingColor=e.pickingIdGenerator.encodePickingColor(i),n.renderable3D=r,e.batchManager.add(n)}else e.lightPool.addFog(n);else e.lightPool.addLight(n)},r=function(t){var n=t.target;n.nodeName!==Ro.tag?n.nodeName!==xo.tag?(e.batchManager.remove(n),delete n.renderable3D):e.lightPool.removeFog(n):e.lightPool.removeLight(n)},i=function(t){var n=t.target,r=t.attrName,i=t.newValue;e.batchManager.updateAttribute(n,r,i)},o=function(t){var n=t.target,r=t.detail.renderOrder;e.batchManager.changeRenderOrder(n,r)}}},{key:"createSwapChain",value:(r=M(d.a.mark((function t(e){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.pluginOptions.targets).includes("webgpu")){t.next=5;break}return t.next=4,this.createSwapChainForWebGPU(e);case 4:this.swapChain=t.sent;case 5:this.swapChain||(this.swapChain=this.createSwapChainForWebGL(e,n));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"createSwapChainForWebGL",value:function(t,e){var n,r={antialias:!1,preserveDrawingBuffer:!1,stencil:!0};return this.handleContextEvents(t),e.includes("webgl2")&&(n=t.getContext("webgl2",r)||t.getContext("experimental-webgl2",r)),!n&&e.includes("webgl1")&&(n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)),new $i(n,{shaderDebug:!0,trackResources:!0})}},{key:"createSwapChainForWebGPU",value:(n=M(d.a.mark((function t(e){var n,r,i,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==navigator.gpu){t.next=2;break}return t.abrupt("return",null);case 2:return n=null,t.prev=3,t.next=6,navigator.gpu.requestAdapter();case 6:n=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),console.log(t.t0);case 12:if(null!==n){t.next=14;break}return t.abrupt("return",null);case 14:return r=["depth24unorm-stencil8","depth32float-stencil8","texture-compression-bc"].filter((function(t){return n.features.has(t)})),t.next=18,n.requestDevice({requiredFeatures:r});case 18:if(null!==(i=t.sent)){t.next=21;break}return t.abrupt("return",null);case 21:if(o=e.getContext("webgpu")){t.next=24;break}return t.abrupt("return",null);case 24:return t.abrupt("return",new vo(n,i,e,o,(function(){})));case 25:case"end":return t.stop()}}),t,null,[[3,9]])}))),function(t){return n.apply(this,arguments)})},{key:"handleContextEvents",value:function(t){var e=this.pluginOptions,n=e.onContextLost,r=e.onContextRestored,i=e.onContextCreationError;i&&t.addEventListener("webglcontextcreationerror",i,!1),n&&t.addEventListener("webglcontextlost",n,!1),r&&t.addEventListener("webglcontextrestored",r,!1)}},{key:"pickByRectangle",value:(e=M(d.a.mark((function t(e){var n,r,i,o,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=[],r=this.device.createReadback(),!this.pickingTexture){t.next=10;break}return t.next=5,r.readTexture(this.pickingTexture,e.x,e.y,e.width,e.height,new Uint8Array(e.width*e.height*4));case 5:i=t.sent,o=-1,!i||0===i[0]&&0===i[1]&&0===i[2]||(o=this.pickingIdGenerator.decodePickingColor(i)),o>-1&&(a=this.pickingIdGenerator.getById(o))&&a.interactive&&-1===n.indexOf(a)&&n.push(a),r.destroy();case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"loadTexture",value:function(t,e,n){var r=this;return this.texturePool.getOrCreateTexture(this.device,t,e,(function(){r.renderingService.dirtify(),n&&n()}))}}]),t}()).tag="RenderGraphPlugin",Mo=Oo);Object(s.c)([Object(u.g)(a.d),Object(s.f)("design:type",Object)],Io.prototype,"canvasConfig",void 0),Object(s.c)([Object(u.g)(a.g),Object(s.f)("design:type",Object)],Io.prototype,"contextService",void 0),Object(s.c)([Object(u.g)(a.r),Object(s.f)("design:type",Object)],Io.prototype,"renderingContext",void 0),Object(s.c)([Object(u.g)(a.h),Object(s.f)("design:type",a.b)],Io.prototype,"camera",void 0),Object(s.c)([Object(u.g)("WebGLRendererPluginOptions"),Object(s.f)("design:type",Object)],Io.prototype,"pluginOptions",void 0),Object(s.c)([Object(u.g)(St),Object(s.f)("design:type",St)],Io.prototype,"pickingIdGenerator",void 0),Object(s.c)([Object(u.g)(wn),Object(s.f)("design:type",wn)],Io.prototype,"renderHelper",void 0),Object(s.c)([Object(u.g)(Ln),Object(s.f)("design:type",Ln)],Io.prototype,"lightPool",void 0),Object(s.c)([Object(u.g)(Fn),Object(s.f)("design:type",Fn)],Io.prototype,"texturePool",void 0),Object(s.c)([Object(u.g)(qn),Object(s.f)("design:type",qn)],Io.prototype,"batchManager",void 0),Io=Mo=Object(s.c)([Object(u.j)({contrib:a.s})],Io);var Bo=((No=function(){function t(){C(this,t),this.canvasConfig=void 0,this.sceneGraphService=void 0,this.contextService=void 0,this.renderGraphPlugin=void 0}return N(t,[{key:"apply",value:function(t){var e=this;t.hooks.pick.tapPromise(Po.tag,function(){var t=M(d.a.mark((function t(n){var r,i,o,s,u,c,l,f,h,v,y;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.position,i=r.viewportX,o=r.viewportY,s=e.contextService.getDPR(),u=e.canvasConfig.width*s,c=e.canvasConfig.height*s,f=o*s,!((l=i*s)>u||l<0||f>c||f<0)){t.next=9;break}return n.picked=null,t.abrupt("return",n);case 9:return t.next=11,e.renderGraphPlugin.pickByRectangle(new a.q(Object(p.a)(Math.round(l),0,u-1),Object(p.a)(Math.round(c-(o+1)*s),0,c-1),1,1));case 11:return h=t.sent,v=j(h,1),y=v[0],n.picked=y||null,t.abrupt("return",n);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),t}()).tag="PickingPlugin",Po=No);Object(s.c)([Object(u.g)(a.d),Object(s.f)("design:type",Object)],Bo.prototype,"canvasConfig",void 0),Object(s.c)([Object(u.g)(a.t),Object(s.f)("design:type",Object)],Bo.prototype,"sceneGraphService",void 0),Object(s.c)([Object(u.g)(a.g),Object(s.f)("design:type",Object)],Bo.prototype,"contextService",void 0),Object(s.c)([Object(u.g)(Io),Object(s.f)("design:type",Io)],Bo.prototype,"renderGraphPlugin",void 0),Bo=Po=Object(s.c)([Object(u.j)({contrib:a.s})],Bo);var Do=function(){function t(){C(this,t)}return N(t,[{key:"update",value:function(t){t.geometry;return{width:0,height:0,depth:0,x:0,y:0,z:0}}}]),t}();Do=Object(s.c)([Object(u.j)({token:{token:a.k,named:Xr.tag}})],Do);var wo=Object(u.c)((function(t){t,t(wn),t(Fn),t(Ln),t(Ur),t(St),t(qn),t(Io),t(Bo),t(ur),t(pr),t(Ar),t(Pr),t(Br),t(Vr),t(Hr),t({token:Gn,useFactory:function(t){return function(e){return t.container.isBound(e)&&t.container.get(e)||null}}}),t(Yr),t(zr),t(Kr),t(Qr),t(Zr),t(Jr),t({token:kn,useFactory:function(t){return function(e){return t.container.isBoundNamed(Un,e)&&t.container.getNamed(Un,e)||null}}})})),Fo=function(){function t(e){C(this,t),this.options=void 0,this.container=void 0,this.options=e}return N(t,[{key:"init",value:function(t){a.w.register(Do),this.container=t,t.register({token:"WebGLRendererPluginOptions",useValue:S({targets:["webgl2","webgl1"]},this.options)}),t.load(wo,!0)}},{key:"destroy",value:function(t){a.w.remove(Do),t.remove("WebGLRendererPluginOptions"),t.unload(wo)}},{key:"getDevice",value:function(){return this.container.get(Io).getDevice()}},{key:"loadTexture",value:function(t,e,n){return this.container.get(Io).loadTexture(t,e,n)}}]),t}(),Lo="undefined"!=typeof window&&void 0!==window.document;var ko,Uo,Go=function(){function t(){}return t.prototype.init=function(){var t=this.canvasConfig,e=t.container,n=t.canvas,r=t.devicePixelRatio;if(n)this.$canvas=n,e&&n.parentElement!==e&&e.appendChild(n),this.$container=n.parentElement,this.canvasConfig.container=this.$container;else if(e&&(this.$container=Object(p.k)(e)?document.getElementById(e):e,this.$container)){var i=document.createElement("canvas");this.$container.appendChild(i),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=i}var o=r||Lo&&window.devicePixelRatio||1;o=o>=1?Math.ceil(o):1,this.dpr=o},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getContext=function(){return this.context},t.prototype.getBoundingClientRect=function(){var t;return null===(t=this.$container)||void 0===t?void 0:t.getBoundingClientRect()},t.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},t.prototype.resize=function(t,e){if(this.$canvas){var n=this.getDPR();this.$canvas.width=n*t,this.$canvas.height=n*e,function(t,e,n){Lo&&t.style&&(t.style.width=e+"px",t.style.height=n+"px")}(this.$canvas,t,e)}},t.prototype.getDPR=function(){return this.dpr},t.prototype.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},Object(s.c)([Object(u.g)(a.d),Object(s.f)("design:type",Object)],t.prototype,"canvasConfig",void 0),t=Object(s.c)([Object(u.j)({token:a.g})],t)}(),jo=Object(u.c)((function(t){t(Go)})),Vo=function(){function t(){}return t.prototype.init=function(t){t.load(jo,!0)},t.prototype.destroy=function(t){t.unload(jo)},t}(),Wo=function(t){function e(e){var n,r=this;return(r=t.call(this,e)||this).registerPlugin(new Vo),r.renderGraphPlugin=new Fo((null==e?void 0:e.targets)?{targets:e.targets}:{}),r.registerPlugin(r.renderGraphPlugin),!1!==(null===(n=null==e?void 0:e.plugins)||void 0===n?void 0:n.enableDOMInteraction)&&r.registerPlugin(new f),r}return Object(s.d)(e,t),e.prototype.getDevice=function(){return this.renderGraphPlugin.getDevice()},e.prototype.loadTexture=function(t,e,n){return this.renderGraphPlugin.loadTexture(t,e,n)},e}(a.a);function Xo(t,e){const n=new Wo({targets:["webgl1"],plugins:{enableDOMInteraction:!1}}),r=new a.c({canvas:t,devicePixelRatio:e,renderer:n}),i=new a.f({style:{x:300,y:200,r:50,fill:"#1890FF",stroke:"#F04864",lineWidth:4}});r.appendChild(i),i.animate([{transform:"scale(1)",fill:"#1890FF",stroke:"#F04864",opacity:1,shadowColor:"black",shadowBlur:30},{transform:"scale(2)",fill:"red",stroke:"#1890FF",opacity:.8,shadowColor:"red",shadowBlur:0}],{duration:1500,iterations:1/0,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"})}ko={render:{fn:Xo}},(Uo=Object(o.a)()).addEventListener("message",(function(t){var e,n=t.data,r=n.type,o=n.method,a=n.id,s=n.params;"RPC_transferable"===r&&o&&((e=ko[o])?Promise.resolve().then((function(){var t;return(t=e).fn.apply(t,i(s))})):Promise.reject("No such method")).then((function(t){Uo.postMessage({type:"RPC_transferable",id:a,result:t},e.pickTransferablesFromResult?e.pickTransferablesFromResult(t):[])})).catch((function(t){var e;try{e=t.message.toString()}catch(r){e=null}var n={message:e};t.stack&&(n.stack=t.stack,n.name=t.name),t.status&&(n.status=t.status,n.responseJson=t.responseJson),Uo.postMessage({type:"RPC_transferable",id:a,error:n})}))})),addEventListener("message",(function(t){var n,r=t.data,i=r.type,o=r.method,a=r.id,s=r.params;"RPC"===i&&o&&((n=e[o])?Promise.resolve().then((function(){return n.apply(e,s)})):Promise.reject("No such method")).then((function(t){postMessage({type:"RPC",id:a,result:t})})).catch((function(t){var e={message:t};t.stack&&(e.message=t.message,e.stack=t.stack,e.name=t.name),postMessage({type:"RPC",id:a,error:e})}))})),postMessage({type:"RPC",method:"ready"})}]);